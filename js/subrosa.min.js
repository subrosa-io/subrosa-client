function closeEvents(){for(var i in appcore.list)if(appcore.list[i].active){var oldState=appcore.list[i].active.state,oldType=appcore.list[i].active.callType;appcore.list[i].active=-1,api.emit("callUpdate",{state:"",oldState:oldState,target:appcore.list[i].id,callType:oldType})}}function commHandler(comm,target,isFromBuffer){if(target||(target=comm.target),isFromBuffer||(isFromBuffer=!1),comm.sender||(comm.sender=appcore.uid),comm.time||(comm.time=(new Date).getTime()),!getProp(comm.sender+"-blocked")&&comm.type){if(37==target.length&&!appcore.list[appcore.listHash[target]])return appcore.noListBuffer[target]||(appcore.noListBuffer[target]=[]),void appcore.noListBuffer[target].push(comm);var listItem=appcore.list[appcore.listHash[target]]?appcore.list[appcore.listHash[target]]:!1;if(1==comm.type){if(isFromBuffer&&-1!=appcore.bufferTimestampIgnore.indexOf(comm.time+target))return;comm.sender!=appcore.uid&&(appcore.profileBlob.conversations[target]||decryptAndVerifyRSA(comm.data,comm.auxdata,comm.pubKey)),comm.pubKey&&(listItem.pubKey=comm.pubKey),api.emit("newText",{user:"*",userShow:"*",message:"<span class='fa fa-lock'></span> Encryption initialized. <a href='javascript:;' class='verifyKey'>Verify</a>",isMe:!1,target:target,unread:!1,isFromBuffer:isFromBuffer,small:!0}),appcore.sockemit("clearHistory",{target:target,time:comm.time}),isFromBuffer||listItem.hasBundle||appcore.bufferTimestampIgnore.push(comm.time+target)}else{var obj=decryptComm(comm,target);if(obj.failedDecrypt&&(comm.type=2),obj){if(isFromBuffer&&-1!=appcore.bufferTimestampIgnore.indexOf(comm.time+target))return;var userInfo=getUserItem(comm.sender);userInfo||(comm.username?(appcore.userList[comm.sender]={username:comm.username},appcore.bgColorCache[comm.sender]=comm.bgColor,userInfo=appcore.userList[comm.sender],api.emit("notify",{type:"userIdentified",target:target})):alert("DEBUG: No userInfo & no comm.username"));var isMe=comm.sender==appcore.uid,userDisplay=escapeText(userInfo.displayname?userInfo.displayname:userInfo.username),unread=listItem.lastRead<comm.time,theMessage="";if(2==comm.type){if(theMessage=parseChatMessage(escapeText(obj.msg),userDisplay),listItem.typings)for(var i in listItem.typings)if(listItem.typings[i][0]==comm.sender){listItem.typings.splice(i,1),api.emit("refreshTypingDisplay",{});break}if(obj.replaceTimestamp)return appcore.bufferTimestampReplace[obj.replaceTimestamp]={target:target,newMessage:theMessage,replaceTimestamp:obj.replaceTimestamp,user:comm.sender,replacedTime:comm.time},void api.emit("replaceText",appcore.bufferTimestampReplace[obj.replaceTimestamp])}else if(5==comm.type)theMessage=obj.accepted?"<b>"+userDisplay+" accepted the contact request</b>":isMe?'<b>You sent a contact request</b>: "'+escapeText(obj.msg)+'"':"<b>"+userDisplay+' sent you a contact request</b>: "'+escapeText(obj.msg)+'"';else if(6==comm.type){if(2==listItem.contact||20==listItem.id.length)if("voice"==obj.type||"video"==obj.type){if(listItem.active&&-1!=listItem.active)return;listItem.active={type:obj.type,state:"CALLING",myInitiate:!1},37==listItem.id.length?callTimeout=setTimeout(function(){if("CALLING"==listItem.active.state){var oldType=listItem.active.type;listItem.active=-1,api.emit("callUpdate",{state:"",oldState:"CALLING",target:target,callType:oldType})}},3e4):listItem.active.callUsers=[comm.sender],api.emit("callUpdate",{state:"CALLING",oldState:"",target:target,callType:listItem.active.type})}else if("acceptCall"==obj.type)37==target.length?acceptCall(listItem.id,!1):listItem.active&&(listItem.active.callUsers.push(comm.sender),api.emit("notify",{type:"callUserUpdate",event:"JOIN",target:listItem.id,uid:comm.sender,callType:listItem.active.type}));else if(37==target.length){clearTimeout(callTimeout);var oldState=listItem.active.state,oldType=listItem.active.type;listItem.active={},appcore.activeCall="",api.emit("callUpdate",{state:"",oldState:oldState,target:target,callType:oldType})}else handleRoomCallQuit(target,comm.sender)}else if(7==comm.type)theMessage=isMe?'<b>You invited them to <a href="javascript:;" class="roomInviteLink dottedLink" data-target="'+escapeText(obj.target)+'" data-convKey="'+btoa(obj.convKey)+'">'+escapeText(obj.name)+"</a> (group chat)</b>":"<b>"+userDisplay+' invited you to <a href="javascript:;" class="roomInviteLink dottedLink" data-target="'+escapeText(obj.target)+'" data-convKey="'+btoa(obj.convKey)+'">'+escapeText(obj.name)+"</a> (group chat)</b>";else if(8==comm.type)theMessage=isMe?'<b>You invited <a href="javascript:;" class="userLink dottedLink" data-uid="'+escapeText(obj.uid)+'">'+escapeText(obj.username)+"</a> to this room.</b>":"<b>"+userDisplay+' invited <a href="javascript:;" class="userLink dottedLink" data-uid="'+escapeText(obj.uid)+'">'+escapeText(obj.username)+"</a> to this room.</b>";else if(9==comm.type)isMe?theMessage=obj.quit?"<b>You left the room.</b>":"<b>You joined the room.</b>":obj.quit?(theMessage=obj.kickedByUID?"<b>"+userDisplay+' was kicked from the room by <a href="javascript:;" class="userLink dottedLink" data-uid="'+escapeText(obj.kickedByUID)+'">'+escapeText(obj.kickedByUsername)+"</a>":"<b>"+userDisplay+" left the room.</b>",listItem.active&&listItem.active.callUsers&&-1!==listItem.active.callUsers.indexOf(comm.sender)&&handleRoomCallQuit(target,comm.sender),-1!=listItem.users.indexOf(comm.sender)&&(listItem.users.splice(listItem.users.indexOf(comm.sender),1),isFromBuffer||listItem.usercount--,api.emit("notify",{type:"userIdentified",target:listItem.id}))):(theMessage="<b>"+userDisplay+" joined the room.</b>",isFromBuffer||listItem.usercount++);else if(10==comm.type)try{rtcProcessSignal(obj.o,obj.to,comm.sender)}catch(error){console.log(error)}else if(11==comm.type){var ranks=["normal user","","moderator","","admin","","","","","superadmin"];theMessage="<b>"+(isMe?"You":userDisplay)+' set the rank of <a href="javascript:;" class="userLink dottedLnk" data-uid="'+escapeText(obj.targetUserUID)+'">'+escapeText(obj.targetUserUsername)+"</a> to <i>"+ranks[obj.newRank]+"</i>.</b>",isFromBuffer||(listItem.ranks[obj.targetUserUID]=obj.newRank,obj.targetUserUID==appcore.uid&&(listItem.myRank=obj.newRank),api.emit("notify",{type:"userRankChanged",target:target,uid:obj.targetUserUID,newRank:obj.newRank}))}(5==comm.type||2==comm.type||comm.type>=7&&comm.type<=9||11==comm.type)&&(isFromBuffer||listItem.hasBundle||appcore.bufferTimestampIgnore.push(comm.time+target),listItem.canMarkRead=!0,api.emit("newText",{user:comm.sender,userShow:2==comm.type?userDisplay:"*",message:theMessage,isMe:isMe,timestamp:comm.time,target:target,unread:unread,isFromBuffer:isFromBuffer,bgColor:appcore.bgColorCache[comm.sender]?appcore.bgColorCache[comm.sender]:""}),2==comm.type&&appcore.bufferTimestampReplace[comm.time]&&appcore.bufferTimestampReplace[comm.time].target==target&&api.emit("replaceText",appcore.bufferTimestampReplace[comm.time]),!listItem.users||-1!=listItem.users.indexOf(comm.sender)||9==comm.type&&obj.quit||(listItem.users.push(comm.sender),api.emit("notify",{type:"userIdentified",target:listItem.id})))}}}}function handleRoomCallQuit(target,quitter){var listItem=appcore.list[appcore.listHash[target]];-1!=listItem.active.callUsers.indexOf(quitter)&&(listItem.active.callUsers.splice(listItem.active.callUsers.indexOf(quitter),1),0==listItem.active.callUsers.length?(listItem.active=-1,api.emit("callUpdate",{state:"CALLING",oldState:"",target:target,callType:listItem.active.type})):api.emit("notify",{type:"callUserUpdate",event:"QUIT",target:listItem.id,uid:quitter,callType:listItem.active.type}))}function escapeText(input){return input.toString().replace(/&/g,"&amp;").replace(/'/g,"&#39;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")}function parseChatMessage(input,userDisplay){var links=input.match(/(^|\s|<br>)https?:\/\/[A-Za-z0-9\-]+\.[A-za-z0-9\/?&%;.#=\-~+!]+/g);for(var i in links)links[i]=links[i].trim().replace("<br>",""),input=input.replace(links[i],'<a href="'+links[i].replace(/&amp;/g,"&")+'" target="_blank">'+links[i]+"</a>");return"/me "==input.substr(0,4)&&(input="<i>"+userDisplay+" "+input.substr(4)+"</i>"),input}function uploadPart(){var partsLeft=Math.ceil(appcore.fileString.length/10240),part=appcore.fileString.substr(0,10240);appcore.fileString=appcore.fileString.substr(10240),appcore.sockemit("filePart",{t:"a",p:partsLeft-1,d:part}),api.emit("avatarUploadProgress",{percent:Math.round((appcore.partsTotal-partsLeft)/appcore.partsTotal*100)})}function acceptCall(target,sendAccept){var listItem=appcore.list[appcore.listHash[target]];"CALLING"==listItem.active.state&&(appcore.activeCall&&api.emit("dropCall",{target:appcore.activeCall}),clearTimeout(callTimeout),listItem.active.state="INCALL",appcore.activeCall=listItem.id,sendAccept&&(api.emit("sendComm",{target:target,type:6,message:{type:"acceptCall"}}),listItem.active.callUsers&&listItem.active.callUsers.push(appcore.uid)),appcore.sockemit("setActive",{target:target,type:listItem.active.type}),api.emit("callUpdate",{state:"INCALL",oldState:"CALLING",target:target,callType:listItem.active.type}))}function decryptComm(comm,target){if(comm.decrypted)return comm.decrypted;if(8==comm.type||9==comm.type||11==comm.type)return JSON.parse(comm.data);appcore.list[appcore.listHash[target]];try{var key=appcore.profileBlob.conversations[target],cipher=forge.cipher.createDecipher("AES-GCM",key);cipher.start({iv:comm.auxdata}),cipher.update(forge.util.createBuffer(comm.data)),cipher.finish()}catch(error){return console.error("Failed to decrypt message in "+target,comm),{failedDecrypt:!0,msg:"Failed to decrypt message."}}var decryptedData=cipher.output;decryptedData.data&&(decryptedData=decryptedData.data);var decryptedObject;try{decryptedObject=JSON.parse(decryptedData);var fullTimestamp=14e11+36e5*decryptedObject.t;if(!(Math.abs(fullTimestamp-comm.time)<9e7))throw decryptedObject=!1,new Error("Difference between client and server timestamp exceeds threshold.")}catch(e){console.log(e,decryptedData)}return decryptedObject?decryptedObject:!1}function decryptAndVerifyRSA(encrypted,signature,otherPubKey){var privateKey=forge.pki.privateKeyFromPem(appcore.profileBlob.privateKey);try{var decrypted=privateKey.decrypt(encrypted,"RSA-OAEP"),md=forge.md.sha256.create();md.update(decrypted,"utf8"),otherPubKey=forge.pki.publicKeyFromPem(otherPubKey);var verified=otherPubKey.verify(md.digest().bytes(),signature);if(verified){var convKey=decrypted.substr(0,32),convId=decrypted.substr(32);37==convId.length&&(appcore.profileBlob.conversations[convId]=convKey,updateBlob(!0,"decryptAndVerify"))}}catch(exception){throw exception}}function sortUID(a,b){var r=[a,b].sort();return r[0]+"-"+r[1]}function updateBlob(force,info){if(appcore.profileBlob){var newProfileBlob=JSON.parse(JSON.stringify(appcore.profileBlob)),modified=!1;if(appcore.profileBlob.props||(newProfileBlob.props={},modified=!0),modified||force){var profileBlobJson=JSON.stringify(newProfileBlob),iv=forge.random.getBytesSync(16),cipher=forge.cipher.createCipher("AES-CBC",appcore.derivedKey);cipher.start({iv:iv}),cipher.update(forge.util.createBuffer(profileBlobJson)),cipher.finish();var cipherOutput=btoa(cipher.output.data);console.log("Updated userblob. - ",force,info),appcore.sockemit("updateBlob",{iv:iv,blob:cipherOutput}),appcore.profileBlob=newProfileBlob}}}function randomUID(length){for(var s="",randomchar=function(){var n=Math.floor(62*Math.random());return 10>n?n:String.fromCharCode(36>n?n+55:n+61)};s.length<length;)s+=randomchar();return s}function getUserItem(uid){if(uid==appcore.uid)return appcore;for(var i in appcore.list)if(appcore.list[i].uid==uid)return appcore.list[i];for(var i in appcore.userList)if(i==uid)return appcore.userList[i];return!1}function getNameFromUID(uid){var item=getUserItem(uid);return item?item.displayname||item.username:"?"}function getProp(name){return appcore.profileBlob.props[name]||!1}function layScreen(keepScrollBot){var w=$(window).width(),h=$(window).height(),headerHeight=$("#header").height();if($("#app").width(w),$("#body").height(h-headerHeight),$("#startScreen").is(":visible")&&(500>h-headerHeight?($("#startScreenContent,#createAccountContent").css("height",h-headerHeight+"px"),$("#startScreenContent,#createAccountContent").css("top","10px")):($("#startScreenContent,#createAccountContent").css("height","480px"),$("#startScreenContent,#createAccountContent").css("top",(h-headerHeight-480)/2+"px"))),685>=w&&!sidebarCollapsed?(sidebarCollapsed=!0,$("#mainSidebar").addClass("collapsed"),$("#mainLeftDivider").hide()):w>685&&sidebarCollapsed&&(sidebarCollapsed=!1,$("#mainSidebar").removeClass("collapsed"),$("#mainLeftDivider").show()),$("#mainScreen").is(":visible")&&($("#mainSidebar").width(sidebarCollapsed?73:sidebarWidth),$("#mainSidebar #sidebarList").height(h-headerHeight-20-30-45),$("#mainContent").height(h-headerHeight-22),$("#mainContent").width(w-(sidebarCollapsed?73:sidebarWidth)-35)),$("#permissionScreen").is(":visible")&&($("#permissionScreenContent").css("left",(w-500)/2+"px"),500>h-headerHeight?($("#permissionScreenContent").css("height",h-headerHeight+"px"),$("#permissionScreenContent").css("top","0px")):($("#permissionScreenContent").css("height","480px"),$("#permissionScreenContent").css("top",(h-headerHeight-480)/2+"px"))),lastMessageContentWidth=$("#mainContent").width()<530?$("#mainContent").width()-167:$("#mainContent").width()-226,$(".tab-conv").is(":visible")){var tabH=$(".tab-conv").height(),tabW=$(".tab-conv").width(),interactive=$("#convActive").is(":visible")?$("#convActive").height():0;$("#convBody").height(tabH-71-interactive-70),$(".convMessageContent").width(lastMessageContentWidth),$("#convInput").width(Math.min(475,$("#convFooter").width()-190)),keepScrollBot===!0&&($("#convText")[0].scrollTop=$("#convText")[0].scrollHeight),530>=tabW&&!convMessageMetaHidden?(convMessageMetaHidden=!0,$("#convText").addClass("hideMeta")):tabW>530&&convMessageMetaHidden&&(convMessageMetaHidden=!1,$("#convText").removeClass("hideMeta"))}keepPos&&keepPos(),keepPosModals&&keepPosModals()}function layContent(header,body){var curTab=$(".contentTab:visible");document.getElementsByTagName("body")[0].style.display="none";var curItem=curTab.attr("data-item");if(curTab.hasClass("tab-conv")){var listItem=appcore.list[appcore.listHash[currentTab]],convHeader=curTab.find("#convHeader"),convFooter=curTab.find("#convFooter");if(header){-1!=listItem.id.indexOf("-")?(convHeader.find("#convPicture").removeClass("hide").attr("data-status","undefined"!=typeof listItem.status?listItem.status:""),convHeader.find("#convPicture")[0].src=listItem.avatar?listItem.avatar:"img/noavatar.png",convHeader.find("#convDisplayName").text(listItem.displayname?listItem.displayname:listItem.username),convHeader.find("#convSubtitleStatus").show().text("undefined"!=typeof listItem.status?statusText[listItem.status]:"Not contacts"),convHeader.find("#convSubtitleUsers").hide(),convHeader.find("#inviteButton").hide(),convHeader.find("#newGroupChat, #blockUser").show(),2==listItem.contact?(convHeader.find("#addContactButton,#addContactFakeButton,#removeFromList,#removeFromListRoom,#acceptContactButton").hide(),convHeader.find("#voiceButton,#videoButton,#removeFromContacts").show()):1==listItem.contact?(listItem.myRequest?(convHeader.find("#addContactFakeButton,#removeFromList").show(),convHeader.find("#acceptContactButton").hide()):(convHeader.find("#acceptContactButton").show(),convHeader.find("#addContactFakeButton").hide()),convHeader.find("#removeFromList").show(),convHeader.find("#voiceButton,#videoButton,#removeFromListRoom,#addContactButton,#removeFromContacts").hide()):0==listItem.contact&&(convHeader.find("#addContactButton,#removeFromList").show(),convHeader.find("#voiceButton,#videoButton,#removeFromListRoom,#addContactFakeButton,#removeFromContacts,#acceptContactButton").hide(),api.emit("generateKeyExchange",listItem)),getProp(listItem.uid+"-blocked")?($("#unblockButton").show(),$("#addContactButton,#blockUser").hide()):$("#unblockButton").hide()):(convHeader.find("#convPicture").addClass("hide"),convHeader.find("#convDisplayName").text(listItem.name),layUsers(),convHeader.find("#convSubtitleStatus,#addContactButton,#addContactFakeButton,#removeFromList,#removeFromContacts,#acceptContactButton,#newGroupChat,#unblockButton,#blockUser").hide(),convHeader.find("#convSubtitleUsers,#voiceButton,#videoButton,#removeFromListRoom,#inviteButton").show()),getProp(listItem.id+"-pinned")?($("#unpinFromList").show(),$("#pinToList").hide()):($("#unpinFromList").hide(),$("#pinToList").show());var convActive=$("#convActive");listItem.active&&listItem.active.type?(listItem.active.callUsers?(convActive.find("#voiceUsers").show(),convActive.find("#voiceUsersCount").text(listItem.active.callUsers.length)):convActive.find("#voiceUsers").hide(),"voice"==listItem.active.type?($("#voiceButton").addClass("disabled"),listItem.active.callUsers&&$("#videoButton").addClass("disabled"),$("#voiceActive").removeClass("video"),$("#videoIcon,#videoMute").hide(),$("#voiceIcon").show()):($("#videoButton").addClass("disabled"),listItem.active.callUsers&&$("#voiceButton").addClass("disabled"),$("#voiceActive").addClass("video"),$("#voiceIcon").hide(),$("#videoIcon,#videoMute").show()),"CALLING"==listItem.active.state?listItem.active.myInitiate?(convActive.find("#voiceAccept,#voiceDropDrop,#voiceIncallText,#callDuration,#voiceGroupText,#voiceControls,#voiceIncomingText").hide(),convActive.find("#voiceRingingText,#voiceDropCancel").show()):(convActive.find("#voiceDropCancel,#voiceRingingText,#voiceIncallText,#callDuration,#voiceControls").hide(),convActive.find("#voiceIncomingText,#voiceAccept,#voiceDropAccept,#voiceDropDrop").show(),listItem.active.callUsers?(convActive.find("#voiceAcceptAccept,#voiceDrop,#voiceIncomingText").hide(),convActive.find("#voiceAcceptJoin,#voiceGroupText").show()):(convActive.find("#voiceAcceptJoin,#voiceGroupText").hide(),convActive.find("#voiceAcceptAccept,#voiceIncomingText").show())):"INCALL"==listItem.active.state&&(convActive.find("#voiceIncomingText,#voiceAccept,#voiceRingingText,#voiceDropCancel,#voiceGroupText").hide(),convActive.find("#voiceIncallText,#callDuration,#voiceDropDrop,#voiceDrop,#voiceControls").show()),convActive.is(":visible")||convActive.slideDown(400,function(){layScreen(!0)})):(appcore.activeCall&&appcore.activeCall!=currentTab?convActive.hide():convActive.slideUp(400,function(){layScreen(!0)}),$("#voiceButton").removeClass("disabled"),$("#videoButton").removeClass("disabled"))}if(appcore.profileBlob.conversations[listItem.id]?(convFooter.find("#encInfoReady,#encPopoverReady").hide(),convFooter.find("#encInfoEncrypted,#encPopoverEncrypted").show(),convFooter.find("#encKey").text(appcore.profileBlob.conversations[listItem.id])):(convFooter.find("#encInfoReady,#encPopoverReady").show(),convFooter.find("#encInfoEncrypted,#encPopoverEncrypted").hide()),body){curTab.find("#convText").html((listItem.hasBundle?1==listItem.hasBundle?"<a id='bufferMore' href='javascript:;'><span class='fa fa-clock-o'></span>Decrypt earlier history</a>":"":"<div id='bufferLoading'>Loading..</div>")+convBodyHolders[curItem].buffer.join("")+"<div id='bufferLiveDivider'></div>"+convBodyHolders[curItem].live.join("")),curTab.find("#convText")[0].scrollTop=curTab.find("#convText")[0].scrollHeight,curTab.find("#convText .convMessage[data-unread=true]:not(.smallMessage):first").before("<hr class='readMarker' />"),setTimeout(function(){curTab.find("#convText .convMessage[data-unread=true]").attr("data-unread",!1)},70);for(var i in convBodyHolders[curItem].buffer)convBodyHolders[curItem].buffer[i]=convBodyHolders[curItem].buffer[i].replace("data-unread='true'","data-unread='false'");for(var i in convBodyHolders[curItem].live)convBodyHolders[curItem].live[i]=convBodyHolders[curItem].live[i].replace("data-unread='true'","data-unread='false'")}layScreen(),$(".sidebarListItem[data-item='"+listItem.id+"'] .listItemIcon").attr("data-status","undefined"!=typeof listItem.status?listItem.status:"")}document.getElementsByTagName("body")[0].style.display="block"}function layList(){$(".sidebarList").hide();for(var i in appcore.list){var item=appcore.list[i];if(0==$(".sidebarListItem[data-item='"+item.id+"']").length){var added=!1,thisPinned=getProp(item.id+"-pinned");$(".sidebarListItem").each(function(){var itemID=$(this).attr("data-item");if("me"==itemID||"searchElement"==itemID||"home"==itemID||"meta"==itemID);else{var lastCommunication=Math.max(appcore.list[appcore.listHash[itemID]].lastMessage,appcore.list[appcore.listHash[itemID]].lastMyMessage),objPinned=getProp(itemID+"-pinned");if(Math.max(item.lastMessage,item.lastMyMessage)>lastCommunication&&!objPinned||!objPinned&&thisPinned)return $(this).before(createItemHTML("conv",item)),added=!0,!1}}),added||$(".sidebarListItem:last").after(createItemHTML("conv",item)),convBodyHolders[item.id]||(convBodyHolders[item.id]={buffer:[],live:[]}),$(".sidebarListItem[data-item='searchElement']").attr("data-searchelementadd")==item.id&&($(".sidebarSearchInput").val("").trigger("keyup"),changeTabTo(item.id)),item.created&&changeTabTo(item.id)}}appcore.list.length&&$("#quickstart").hide(),$(".sidebarList").show()}function createItemHTML(type,item){if("conv"==type){var pinnedIcon='<span class="listItemPinned fa fa-thumb-tack"'+(getProp(item.id+"-pinned")?"":' style="display: none"')+"></span>";if(-1!=item.id.indexOf("-")){var subtitle="undefined"!=typeof item.displayname?item.username:"";return subtitle||(subtitle=0==item.contact?"Not contacts":item.myRequest?"Sent request":"Contact request"),'<div class="sidebarListItem'+(currentTab==item.id?" activeItem":"")+'" data-item="'+escapeText(item.id)+'" data-trigger="conv"><div class="unreadBadge">0</div><img src="'+(item.avatar?escapeText(item.avatar):"img/noavatar.png")+'" class="listItemIcon" data-status="'+("undefined"!=typeof item.status?item.status:"")+'" /><span class="listItemTitle">'+escapeText(item.displayname||item.username)+"</span> "+pinnedIcon+'<br /><span class="listItemSubtitle">'+escapeText(subtitle)+"</span></div>"}return'<div class="sidebarListItem'+(currentTab==item.id?" activeItem":"")+'" data-item="'+escapeText(item.id)+'" data-trigger="conv"><div class="unreadBadge">0</div><img src="img/group.png" class="listItemIcon" data-status="room" /><span class="listItemTitle">'+escapeText(item.name)+"</span> "+pinnedIcon+'<br /><span class="listItemSubtitle">'+(item.active?'<span class="inCallSubtitle">Group call</span>':"Group chat")+"</span></div>"}}function setListItem(id){var sidebarList=$(".sidebarListItem[data-item='"+id+"']"),listItem=appcore.list[appcore.listHash[id]];if(20==id.length)sidebarList.find(".listItemTitle").text(listItem.name),sidebarList.find(".listItemSubtitle").html(listItem.active&&-1!=listItem.active?'<span class="inCallSubtitle">Group call</span>':"Group chat");else{sidebarList.find(".listItemTitle").text(listItem.displayname||listItem.username);var subtitle="undefined"!=typeof listItem.displayname?escapeText(listItem.username):"";subtitle||(subtitle=0==listItem.contact?"Not contacts":listItem.myRequest?"Sent request":"Contact request"),sidebarList.find(".listItemSubtitle").html(subtitle)}appcore.activeCall==id&&sidebarList.find(".listItemSubtitle").html('<span class="inCallSubtitle">In call..</span>')}function layRoomInviteUserList(checked,addTo){var userListHTML="";for(var i in appcore.list)if(-1!=appcore.list[i].id.indexOf("-")){var selected=-1!=checked.indexOf(appcore.list[i].uid);userListHTML+='<div class="userListElement '+(selected?"selected":"")+'" data-uid="'+escapeText(appcore.list[i].uid)+'"><img src="'+(appcore.list[i].avatar?escapeText(appcore.list[i].avatar):"img/noavatar.png")+'" class="userListIcon" /><span>'+escapeText(appcore.list[i].username)+'</span><br /><small class="inviteMsg">'+(selected?"Selected":"Not selected")+"</small></div>"}if($("#roomInviteConfirm").addClass("disabled"),$("#roomInviteUserlist").html(userListHTML),addTo){var name=appcore.list[appcore.listHash[addTo]].name;$("#roomInviteCreate,#roomCreateBtnText").hide(),$("#roomInviteAdd,#roomAddBtnText").show(),$("#roomAddName").text(name),disableInvited(addTo),appcore.list[appcore.listHash[addTo]].pendingInvites||api.emit("getUsers",{target:addTo})}else $("#roomInviteCreate,#roomCreateBtnText").show(),$("#roomInviteAdd,#roomAddBtnText").hide();$(".userListElement").click(function(){var userListElement=$(this).hasClass("userListElement")?$(this):$(this).parent();userListElement.hasClass("invited")?$(userListElement).shake():userListElement.hasClass("selected")?$(userListElement).removeClass("selected").find(".inviteMsg").text("Not selected"):$(userListElement).addClass("selected").find(".inviteMsg").text("Selected"),testRoomInviteConfirm()})}function testRoomInviteConfirm(){$("#roomInviteUserlist").find(".userListElement.selected").length>=1&&$("#roomInviteUserlist").find(".userListElement.selected").length<=20&&(!$("#roomCreateName").is(":visible")||$("#roomCreateName").val().length>0)?$("#roomInviteConfirm").removeClass("disabled"):$("#roomInviteConfirm").addClass("disabled")}function layUsers(){lastLayTime+1e3<(new Date).getTime()?_layUsers():layUsersTimeout||(layUsersTimeout=setTimeout(_layUsers,50))}function _layUsers(){if("home"!=currentTab){lastLayTime=(new Date).getTime(),layUsersTimeout=0;var uidArray=appcore.list[appcore.listHash[currentTab]].users,returnString="",notShownUsers=appcore.list[appcore.listHash[currentTab]].usercount,showLeft=4;for(var i in uidArray)if(showLeft>0){var userItem=getUserItem(uidArray[i]);if(!userItem)return String+=(0==i?"":", ")+"<small>Not found</small>";returnString+=userItem.uid==appcore.uid?(0==i?"":", ")+escapeText(userItem.displayname):(0==i?"":", ")+'<a href="javascript:;" class="userLink dottedLink" data-uid="'+escapeText(uidArray[i])+'">'+escapeText(userItem.displayname?userItem.displayname:userItem.username)+"</a>",showLeft--,notShownUsers--}$("#convSubtitleUsersList").html(returnString),notShownUsers?$("#convSubtitleUsersMore").text(notShownUsers+" more").show():$("#convSubtitleUsersMore").text("More")}}function getUsersMore(){appcore.list[appcore.listHash[currentTab]];api.emit("getUsers",{target:currentTab}),$("#usersMorePopoverLoading").show(),$("#usersMorePopoverContent").hide()}function getCallUsers(){layUsersMore(!0)}function layUsersMore(call){var usersHTML="",usersArray=[],uidArray=call?appcore.list[appcore.listHash[currentTab]].active.callUsers:appcore.list[appcore.listHash[currentTab]].users,ranks=appcore.list[appcore.listHash[currentTab]].ranks||[],myRank=appcore.list[appcore.listHash[currentTab]].myRank;call&&(usersHTML+="<b>Call Participants</b><hr />");for(var i in uidArray)usersArray.push([getNameFromUID(uidArray[i]),uidArray[i]]);usersArray.sort(function(a,b){return a[0]>b[0]});for(var i in usersArray){var userRank=0;call||ranks[usersArray[i][1]]&&(userRank=ranks[usersArray[i][1]]),usersArray[i][1]!=appcore.uid?(usersHTML+='<a href="javascript:;" class="userLink userPopoverLink dottedLink" data-uid="'+escapeText(usersArray[i][1])+'" data-rank="'+userRank+'">'+escapeText(usersArray[i][0])+"</a> ",call||(myRank>=4&&(usersHTML+='<a href="javascript:;" class="userRankLink" data-uid="'+escapeText(usersArray[i][1])+'">Set</a>'),myRank>=1&&(9==myRank||myRank>userRank)&&(usersHTML+='<a href="javascript:;" class="userKickLink" data-uid="'+escapeText(usersArray[i][1])+'">Kick</a>')),usersHTML+="<br />"):usersHTML+='<span data-rank="'+userRank+'">'+escapeText(usersArray[i][0])+"</span><br />"}$("#usersMorePopoverLoading").hide(),$("#usersMorePopoverContent").html(usersHTML).show()}function userList(data){data.target==currentTab&&layUsersMore(),"meta"==currentTab&&lastTab==data.target&&disableInvited(lastTab)}function disableInvited(target){var pendingInvites=($("#roomInviteUserlist"),appcore.list[appcore.listHash[target]].pendingInvites||[]),users=appcore.list[appcore.listHash[target]].users;$(".userListElement").each(function(){var uid=$(this).attr("data-uid");-1!=pendingInvites.indexOf(uid)?$(this).addClass("invited").find(".inviteMsg").text("Invited"):-1!=users.indexOf(uid)&&$(this).addClass("invited").find(".inviteMsg").text("Joined")})}function refreshTypingDisplay(){var listItem=appcore.list[appcore.listHash[currentTab]];if(listItem){var typingText="";if(listItem.typings){var typingArray=[],typedArray=[];for(var i in listItem.typings){var displayName;displayName=37==listItem.id.length?listItem.displayname||listItem.username:getUserItem(listItem.typings[i][0]).username,"typing"==listItem.typings[i][1]?typingArray.push(displayName):typedArray.push(displayName)}1==typingArray.length?typingText+=typingArray[0]+" is typing.. ":typingArray.length>1&&(typingText+=typingArray.join(", ")+" is typing.. "),1==typedArray.length?typingText+=typedArray[0]+" has typed.":typedArray.length>1&&(typingText+=typedArray.join(", ")+" has typed."),$("#convTyping").text(typingText)}}}function keepPosModals(){if(activeModal){var left=window.innerWidth/2-activeModal.outerWidth()/2;window.innerWidth<400&&(left=0);var top=window.innerHeight/2-activeModal.outerHeight()/2;activeModal.css({left:left+"px",top:top+"px"})}}function canvasLoadImage(context,src){var imageObj=new Image;imageObj.onload=function(){context.drawImage(this,0,0)},imageObj.src=src}function setFaviconBadge(badgeNumber){var faviconCanvas=document.createElement("canvas");faviconCanvas.width=16,faviconCanvas.height=16;var ctx=faviconCanvas.getContext("2d");ctx.drawImage(baseFaviconImage,0,0);var numberMasks=["","^`_^^^y","hkjf\\[y","hkjfjkh","kkkxjjj","y[[ijji","hk[ikkh","yjjb^^^","hkkhkkh","hkkxjjj","Z^^y^^Z"];if(0!=badgeNumber){ctx.fillStyle="#FF955A",ctx.fillRect(9,7,7,9),ctx.fillStyle="#FFFFFF";for(var numberMask=numberMasks[Math.min(badgeNumber,10)],i=0;7>i;i++){var currentMask=numberMask.charCodeAt(i)-90;1&currentMask&&ctx.fillRect(10,8+i,1,1),2&currentMask&&ctx.fillRect(11,8+i,1,1),4&currentMask&&ctx.fillRect(12,8+i,1,1),8&currentMask&&ctx.fillRect(13,8+i,1,1),16&currentMask&&ctx.fillRect(14,8+i,1,1)}}var imgDataUrl=faviconCanvas.toDataURL();$("#favicon").remove();var newFavicon=document.createElement("link");newFavicon.setAttribute("id","favicon"),newFavicon.setAttribute("rel","icon"),newFavicon.setAttribute("type","image/png"),newFavicon.setAttribute("href",imgDataUrl),document.head.appendChild(newFavicon)}function startTitleAlert(title){originalTitle=title,clearInterval(titleAlertInterval),titleAlertInterval=setInterval(function(){document.title=document.title==originalTitle?"** "+originalTitle:originalTitle},700)}function stopTitleAlert(){clearInterval(titleAlertInterval),document.title=originalTitle}function startScreen(){$("#createAccountContent").hide(),$("#startScreen").css("position","relative").show(),$("#startScreenContent").fadeIn(250),layScreen(),$("#createAccountBtn").click(function(){$(this).hasClass("disabled")||createAccountScreen()}),0==$("#loginUsername").val().length&&localStorage.getItem("lastUsername")&&$("#loginUsername").val(localStorage.getItem("lastUsername")),$("#header").children().hide(),"http:"==document.location.protocol&&"localhost"!=document.location.hostname&&"127.0.0.1"!=document.location.hostname&&$("#httpWarning").removeClass("hide"),$("#versionString").text(appcore.version)}function createAccountScreen(){$("#startScreenContent").fadeOut(250),layScreen(),setTimeout(function(){$("#createAccountContent").fadeIn(250)},250),$("#backToStartScreen").show()}function hooks(){createAccountHooks(),mainAppHooks(),$("form").submit(function(e){e.preventDefault()})}function createAccountHooks(){$("#backToStartScreen").click(startScreen),$("#createAccountStep1Username").val(""),$("#createAccountStep1Username").keyup(function(){clearTimeout(checkUsernameTimeout),checkUsernameTimeout=setTimeout(function(){api.emit("userExists",{username:$("#createAccountStep1Username").val()}),$("#createAccountStep1Available").text("Checking.."),$("#createAccountStep1Available").removeClass("errorNotice")},550)}),$("#createAccountStep1Displayname,#createAccountStep1Username").keyup(function(){$("#createAccountStep1Displayname").val().length>2&&!$("#createAccountStep1Available").hasClass("errorNotice")?$("#createAccountStep1Btn").removeClass("disabled"):$("#createAccountStep1Btn").addClass("disabled")
}),$("#createAccountStep1Btn").click(function(){$(this).hasClass("disabled")||($("#createAccountFooterError").text(""),$("#createAccountStep1").css("position","absolute").animate({left:"-500px"},550),$("#createAccountStep2").show().css("left","500px").animate({left:"0px"},550),$("#loginUsername").val($("#createAccountStep1Username").val()))}),$("#createAccountStep2Pass1").keyup(function(){$("#createAccountStep2Length").text($("#createAccountStep2Pass1").val().length>=10?"OK":"At least 10 chars"),$("#createAccountStep2Match").text($("#createAccountStep2Pass1").val()==$("#createAccountStep2Pass2").val()?"OK":"Doesn't match.")}),$("#createAccountStep2Pass2").keyup(function(){$("#createAccountStep2Match").text($("#createAccountStep2Pass1").val()==$("#createAccountStep2Pass2").val()?"OK":"Doesn't match."),"OK"==$("#createAccountStep2Match").text()&&"OK"==$("#createAccountStep2Length").text()&&$("#createAccountStep2Btn").removeClass("disabled")}),$("#createAccountStep2Btn").click(function(){$(this).hasClass("disabled")||($("#backToStartScreen").hide(),$(this).addClass("disabled"),$("#createAccountStep2").css("position","absolute").animate({left:"-500px"},550),$("#createAccountStep3").show().css("left","500px").animate({left:"0px"},550),api.emit("genKey",{generating:function(){for(var htmlGen="",i=0;10>i;i++)htmlGen+=randomUID(53)+"<br />";$("#createAccountStep3Gen").html(htmlGen)},generated:function(){$("#createAccountStep3").css("position","absolute").animate({left:"-500px"},550),$("#createAccountStep4").show().css("left","500px").animate({left:"0px"},550),api.emit("getCaptcha",{purpose:"createAccount"})}}))}),$("#createAccountStep4Captcha,#createAccountStep4Email").keyup(function(){$("#createAccountStep2Pass1").val().length>5&&$("#createAccountStep4Email").val().length>5&&$("#createAccountStep4Btn").removeClass("disabled")}),$("#createAccountStep4Btn").click(function(){$(this).hasClass("disabled")||($("#createAccountFooterError").text(""),api.emit("register",{username:$("#createAccountStep1Username").val(),displayname:$("#createAccountStep1Displayname").val(),password:$("#createAccountStep2Pass1").val(),email:$("#createAccountStep4Email").val(),newsletter:$("#createAccountStep4Newsletter").is(":checked"),challenge:lastCaptchaChallenge,captcha:$("input#createAccountStep4Captcha").val()}),$("#createAccountStep4Btn").hide(),$("#createAccountStep4Text").html("<img src='/img/spinner.gif' class='spinneralign'> Registering.."))}),api.on("registerResult",function(data){"FAIL"==data.status?($("input#createAccountStep4Captcha").val(""),$("#createAccountFooterError").text(data.message),$("#createAccountStep4Text").text(""),setTimeout(function(){$("#createAccountStep4Btn").show()},300),data.restart?($("#createAccountStep1").css("position","relative").css("left","0px"),$("#createAccountStep2").hide().css("position","relative").css("left","0px"),$("#createAccountStep3").hide().css("position","relative").css("left","0px"),$("#createAccountStep4").hide().css("position","absolute").css("left","-500px"),$("#createAccountStep1Available").text(""),$("#createAccountStep2Btn").removeClass("disabled")):api.emit("getCaptcha",{purpose:"createAccount"})):($("#createAccountStep4").css("position","absolute").animate({left:"-500px"},550),$("#createAccountStep5").show().css("left","500px").animate({left:"0px"},550),$("#createAccountStep5Name").text($("#createAccountStep1Displayname").val()),$("#createAccountStep5Username").text($("#createAccountStep1Username").val()),$("#createAccountStep1Username").val(""))}),$("#createAccountStep5Btn").click(startScreen),api.on("userExistsResult",function(data){data.username==$("#createAccountStep1Username").val()?($("#createAccountStep1Available").text(data.exists?"Already taken.":"Available!"),data.error&&$("#createAccountStep1Available").text(data.error),(data.exists||data.error)&&$("#createAccountStep1Available").addClass("errorNotice"),$("#createAccountStep1Displayname").val().length>2&&!$("#createAccountStep1Available").hasClass("errorNotice")&&$("#createAccountStep1Btn").removeClass("disabled")):data.exists?($(".sidebarListItem[data-item=searchElement] .listItemSubtitle").text("Add to your list"),$(".sidebarListItem[data-item=searchElement]").attr("data-searchElementAdd","conv"+sortUID(data.uid,appcore.uid))):$(".sidebarListItem[data-item=searchElement] .listItemSubtitle").text("There is no user named "+data.username)}),$("#loginButton").click(function(){if(!$(this).hasClass("disabled")){if(0==$("#loginUsername").val().length)return void $("#loginUsername").shake();if(0==$("#loginPassword").val().length)return void $("#loginPassword").shake();$("#loginButton").addClass("disabled"),$("#loginButton").text("Logging in.."),$("#loginErrorMessage").text(""),$("#signInSpinner").show(),api.emit("loginMain",{username:$("#loginUsername").val(),password:$("#loginPassword").val()})}}),api.on("loginMainResult",function(data){$("#loginButton").text("Decrypt & Login"),$("#loginButton").removeClass("disabled"),$("#signInSpinner").hide(),"FAIL"==data.status?$("#loginErrorMessage").text(data.message):"OK"==data.status&&(loggedInCalls(),mainApp())})}function mainAppHooks(){permissionsContinue=function(){$("#permissionScreen").css("position","absolute").fadeOut(300),$("#mainScreen").css("position","relative").fadeIn(300),changeTabTo("home")},-1!=navigator.userAgent.indexOf("Chrome")?($(".permissionsWebkit").removeClass("hide"),"granted"===window.Notification.permission&&(hasNotificationPerm=!0)):-1!=navigator.userAgent.indexOf("Firefox")?($(".permissionsMozilla").removeClass("hide"),"granted"==Notification.permission&&(hasNotificationPerm=!0)):hasNotificationPerm=!0,$(".notificationPermPrompt").click(function(){$(this).hasClass("disabled")||(Notification&&Notification.requestPermission(function(){hasNotificationPerm=!0,permissionsContinue()}),$(this).addClass("disabled").text("Look up"))}),$(".sidebarListItem[data-item='me']").click(function(){$(this).popover($("#setStatusPopover"))});var allowedBgColors=["EDFBFF","EDECFC","F2E8FF","F3DAFF","FCE1F9","FFECEF","FFF5E8","FFF9E8","FEFFE8","E8FDE5","E9FFD2","FCFDFC"],editProfileBgColorPicksHTML="";for(var i in allowedBgColors)editProfileBgColorPicksHTML+="<div class='bgColorPick' style='background-color: #"+allowedBgColors[i]+"' data-bgColor='"+allowedBgColors[i]+"'></div>";$("#editProfileBgColorPicks").html(editProfileBgColorPicksHTML),$("#editProfileBgColorPicks").on("click",".bgColorPick",function(){api.emit("changeProfile",{bgColor:$(this).attr("data-bgColor")}),$("#editProfileBack").click()}),$("#mainSidebar").on("click",".sidebarListItem",function(){var itemName=$(this).attr("data-item");"searchElement"==itemName?$(this).attr("data-searchElementAdd")&&"invalid"!=$(this).attr("data-searchElementAdd")?($(this).find(".listItemSubtitle").text("Loading.."),api.emit("addList",{id:$(this).attr("data-searchElementAdd")}),$("#quickstart").hide(),$("#sidebarSearchInput").val("").trigger("keyup")):$(this).shake():"me"==itemName||changeTabTo(itemName)}),$("#sidebarSearchInput").clearable(),$("#sidebarSearchInput").keyup(function(){searchChange($("#sidebarSearchInput").val())}),$("#mainLeftDivider").mousedown(function(){this.onselectstart=function(e){return e.preventDefault(),!1},dividerDragging="mainLeftDivider"}),$("body").mouseup(function(){"mainLeftDivider"==dividerDragging&&window.localStorage&&window.localStorage.setItem("sidebarWidth",sidebarWidth),dividerDragging="",$("body").css("cursor","auto"),$("body").removeClass("noSelect")}),$("body").mousemove(function(event){dividerDragging&&"mainLeftDivider"==dividerDragging&&(sidebarWidth=event.pageX-15,215>sidebarWidth?sidebarWidth=215:sidebarWidth>500&&(sidebarWidth=500),$("body").addClass("noSelect"),$("body").css("cursor","ew-resize"),layScreen())}),$(".requestTextarea").keyup(function(){$(".requestTextarea").val().length?$(".sendRequestBtn").removeClass("disabled"):$(".sendRequestBtn").addClass("disabled")}),$(".sendRequestBtn").click(function(){if($(this).hasClass("disabled"))return void $(this).shake();$("#addContactButton").removeClass("active");var listItem=appcore.list[appcore.listHash[currentTab]],emitFunction=function(){api.emit("addContact",{id:currentTab,message:$(".requestTextarea").val()}),layContent(!0,!1),$(".addContactButton").popover($(".addContactPopover"))};if(listItem.keyExchange&&"pending"!=listItem.keyExchange)emitFunction();else var waitInterval=setInterval(function(){listItem.keyExchange&&(clearInterval(waitInterval),emitFunction())},500)}),$("#convButtons").on("click","button",convButtonClick),$(".convMorePopover").on("click","li",convButtonClick),api.on("getListsResult",layList),api.on("newText",newText),$("#convInput").keydown(function(event){if(13==event.keyCode&&!event.shiftKey){event.preventDefault();var layContentAfter=!1;appcore.profileBlob.conversations[currentTab]||(layContentAfter=!0),api.emit("sendText",{target:currentTab,message:$("#convInput").val()}),layContentAfter&&layContent(!1,!1),$("#convInput").val("")}}),$("#convInput").keyup(function(event){(8==event.keyCode||event.keyCode>=46&&event.keyCode<=90)&&($("#convInput").val().length>0?api.emit("updateTypingState",{target:currentTab,state:"typing"}):api.emit("updateTypingState",{target:currentTab,state:"empty"}))}),api.on("refreshTypingDisplay",refreshTypingDisplay),$("#convText").on("click",".messageEditButton",function(){$(this).hide(),$(this).parent().find(".messageEditCancelButton").show();var $convMessageContent=$(this).parent().parent().find(".convMessageContent"),originalContent=$convMessageContent.text();$convMessageContent.html("<textarea class='messageEditArea' data-original='"+escapeText(originalContent)+"'>"+escapeText(originalContent)+"</textarea>"),$convMessageContent.find("textarea").focus().moveCaretToEnd()}),$("#convText").on("click",".messageEditCancelButton",function(){$(this).hide(),$(this).parent().find(".messageEditButton").show();var $convMessageContent=$(this).parent().parent().find(".convMessageContent"),originalContent=$convMessageContent.find("textarea.messageEditArea").attr("data-original");$(this).parent().parent().find(".convMessageContent").html(originalContent)}),$("#convText").on("keydown",".messageEditArea",function(event){var replaceTimestamp=$(this).parent().parent().attr("data-timestamp");13==event.keyCode&&(event.shiftKey||(event.preventDefault(),$(this).parent().parent().find(".messageEditCancelButton").click(),api.emit("editText",{target:currentTab,newMessage:$(this).val(),replaceTimestamp:replaceTimestamp})))}),$("#encInfo").click(function(event){$(this).popover($("#encInfoPopover")),event.preventDefault()}),$("#myStatusSelect").change(function(){api.emit("changeStatus",{status:$(this).val()});var myListItem=$(".sidebarListItem[data-item='me']");myListItem.find(".listItemIcon").attr("data-status",appcore.status),myListItem.find(".listItemSubtitle").text(statusText[appcore.status]),$("#editProfileIcon").popover($("#setStatusPopover"))}),$("#editProfileDisplayNameLink").click(function(){$("#editProfileHeader").fadeOut(500),$("#editProfileBack").fadeIn(500),$("#editProfileMain").hide(),$("#editProfileDisplayName").fadeIn(500)}),$("#editProfileBgColorLink").click(function(){$("#editProfileHeader").fadeOut(500),$("#editProfileBack").fadeIn(500),$("#editProfileMain").hide(),$("#editProfileBgColor").fadeIn(500)}),$("#editProfileBack").click(function(){$("#editProfileBack").fadeOut(500),$("#editProfileHeader").fadeIn(500),$("#editProfileDisplayName,#editProfileAvatar,#editProfilePassword,#editProfileAvatar,#editProfileBgColor").hide(),$("#editProfileMain").fadeIn(500)}),$("#editProfilePasswordLink").click(function(){$("#editProfileHeader").fadeOut(500),$("#editProfileBack").fadeIn(500),$("#editProfileMain").hide(),$("#editProfilePassword").fadeIn(500)}),$("#editProfileAvatarLink").click(function(){$("#editProfileHeader").fadeOut(500),$("#editProfileBack").fadeIn(500),$("#editProfileMain").hide(),$("#editProfileAvatar").fadeIn(500)}),$("#editProfilePasswordSave").click(function(){var errorMessages=$("#editProfilePassShort,#editProfilePassMismatch,#editProfilePassOldFail,#editProfileBgColor");return errorMessages.hide(),$("#editProfileNewPass1").val().length<10?void $("#editProfilePassShort").show().shake():$("#editProfileNewPass1").val()!=$("#editProfileNewPass2").val()?void $("#editProfilePassMismatch").show().shake():(api.emit("changeProfile",{newpass:$("#editProfileNewPass1").val(),oldpass:$("#editProfileOldPass").val()}),$("#editProfileNewPass1,#editProfileNewPass2,#editProfileOldPass").val(""),void(errorMessages.is(":visible")||$("#editProfileBack").click()))}),$("#editProfileDisplayNameSave").click(function(){"*"==$("#editProfileDisplayNameInput").val()?$.modal("displayNameNotAllowed"):(api.emit("changeProfile",{displayname:$("#editProfileDisplayNameInput").val()}),$("#editProfileDisplayNameText").text(appcore.displayname),$("#editProfileBack").click())}),$("#settingsBtn").click(function(){$(this).popover($("#settingsPopover"))}),$("#generalVolumeSlider").change(function(){api.emit("setProp",{name:"generalVolume",value:this.value/100});var soundNewMessage=$("#soundNewMessage")[0];soundNewMessage.volume=this.value/100,soundNewMessage.pause(),soundNewMessage.currentTime=0,soundNewMessage.play()}),$("#ringerVolumeSlider").change(function(){api.emit("setProp",{name:"ringervolume",value:this.value/100});var soundRinging=$("#soundRinging")[0];(soundRinging.paused||!soundRinging.loop)&&(soundRinging.volume=this.value/100,soundRinging.pause(),soundRinging.currentTime=0,soundRinging.loop=!1,soundRinging.play())}),$("#enableNotificationsCheckbox").change(function(){api.emit("setProp",{name:"disableNotifications",value:!this.checked})}),$("#roomInviteConfirm").click(function(){if(!$(this).hasClass("disabled")){var uids=[];$("#roomInviteUserlist").find(".userListElement.selected").each(function(){uids.push($(this).attr("data-uid"))}),$(this).find("#roomCreateBtnText").is(":visible")?(api.emit("createRoom",{invite:uids,mode:"new",name:$("#roomCreateName").val()}),$(this).addClass("disabled")):(api.emit("createRoom",{invite:uids,mode:"add",target:lastTab}),$(this).addClass("disabled"),changeTabTo(lastTab))}}),$("#roomCreateName").keyup(testRoomInviteConfirm),$("#convText").on("click","a.roomInviteLink",function(){appcore.listHash[$(this).attr("data-target")]?changeTabTo($(this).attr("data-target")):api.emit("joinRoom",{target:$(this).attr("data-target"),convKey:atob($(this).attr("data-convkey"))})}),$("#convText").on("click","#bufferMore",function(){$(this).text("Loading.."),$(this).attr("data-scrollPos",$("#convText")[0].scrollHeight),api.emit("getBuffer",{target:currentTab,small:!1})}),$("#convText").on("click",".verifyKey",function(){api.emit("verifyKey",{target:currentTab})}),$("#roomInviteCancel").click(function(){changeTabTo(lastTab)}),$("#convSubtitleUsersMore").click(function(){$(this).popover($("#usersMorePopover")),getUsersMore()}),$("#voiceUsers").click(function(){$(this).popover($("#usersMorePopover")),getCallUsers()}),$("#convSubtitleUsersList,#usersMorePopoverContent,#convText,#kickerUsername,#userRankUsername").on("click",".userLink",function(){var convID="conv"+sortUID(appcore.uid,$(this).attr("data-uid"));appcore.listHash[convID]?changeTabTo(convID):(api.emit("addList",{id:convID}),$(this).text("Loading..")),$(this).parents("#usersMorePopoverContent").length&&$(this).popover($("#usersMorePopover")),$.modal("kick","hide")}),$("#usersMorePopover").on("click",".userKickLink",function(){api.emit("kickUser",{target:currentTab,kicking:$(this).attr("data-uid")}),$(this).text("Kicking.."),$(this).parents("#usersMorePopoverContent").length&&$(this).popover($("#usersMorePopover")),layContent(!0,!1)}),$("#usersMorePopover").on("click",".userRankLink",function(){$("#userRankUsername").text(getNameFromUID($(this).attr("data-uid"))),$("#userRankUsername").attr("data-uid",$(this).attr("data-uid")),$.modal("userRank","show")}),$("#userRankSelect").change(function(){$(".userRankDesc").hide(),$(".userRankDesc[data-rank='"+$("#userRankSelect").val()+"']").show()}),$("#userRankApply").click(function(){$.modal("userRank","hide"),api.emit("setUserRank",{target:currentTab,user:$("#userRankUsername").attr("data-uid"),newRank:$("#userRankSelect").val()})}),api.on("userList",userList),$("#voiceDrop").click(function(){api.emit("dropCall",{target:currentTab})}),$("#voiceAccept").click(function(){return apprtc.supported?getProp("webrtcWarning")?void api.emit("acceptCall",{target:currentTab}):($("#p2pWarningContinue").attr("data-click","#voiceAccept"),$.modal("p2pWarning"),void api.emit("setProp",{name:"webrtcWarning",value:!0})):void $.modal("callsNotSupported","show")}),$("#voiceMute").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),setMicrophoneMute(!1)):($(this).addClass("on"),setMicrophoneMute(!0))}),$("#videoMute").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),setVideoMute(!1)):($(this).addClass("on"),setVideoMute(!0))}),$("#avatarFile").change(function(event){var allowedTypes=["image/png","image/jpg","image/jpeg"];if(event.target.files.length)if($("#uploadAvatarProgress").show(),event.target.files[0].size>2097152)$("#uploadAvatarProgress").text("File size is too large (Max: 2MB)");else if(-1==allowedTypes.indexOf(event.target.files[0].type))$("#uploadAvatarProgress").text("Only PNG and JPEG files are supported.");else{$("#avatarFile").hide();var reader=new FileReader;reader.onload=function(){api.emit("uploadAvatar",{data:reader.result})},reader.readAsBinaryString(event.target.files[0])}}),$("#logoutBtn").click(function(){api.emit("logout",{}),$(".sidebarListItem").each(function(){var dataItem=$(this).attr("data-item");"home"!=dataItem&&"searchElement"!=dataItem&&"meta"!=dataItem&&"me"!=dataItem&&$(this).remove()}),$(".contentTab.tab-conv,#mainScreen").hide(),$.modal("logout"),startScreen()}),$("#p2pWarningContinue").click(function(){$.modal("videoSecurity","hide"),$(this).attr("data-click")&&$($(this).attr("data-click")).click()}),$("#videoSecurityCancel").click(function(){$.modal("videoSecurity","hide")}),$("#blockUser").click(function(){api.emit("blockUser",{target:currentTab}),removeList(currentTab),$.modal("blockedUser","show")}),$("#unblockButton").click(function(){api.emit("blockUser",{target:currentTab,unblock:!0}),layContent(!0,!1)}),$("#securityInfoTrigger").click(function(){$.modal("securityInfo")}),$("#quickstartLink").click(function(){$(this).select()}),$("#quickstartSearchTip").mouseover(function(){$("#sidebarSearchInput").addClass("highlighted")}),$("#quickstartSearchTip").mouseout(function(){$("#sidebarSearchInput").removeClass("highlighted")}),$("#pinToList").click(function(){$(this).hide(),$("#unpinFromList").show(),$(".sidebarListItem[data-item='"+currentTab+"']").remove(),api.emit("setProp",{name:currentTab+"-pinned",value:!0}),layList()}),$("#unpinFromList").click(function(){$(this).hide(),$("#pinToList").show(),$(".sidebarListItem[data-item='"+currentTab+"']").remove(),api.emit("setProp",{name:currentTab+"-pinned",value:null}),layList()})}function mainApp(){$(".loginButton").text("Decrypt & Login"),$(".loginButton").removeClass("disabled"),$(".signInSpinner").hide(),$(".loginPassword").val(""),localStorage.setItem("lastUsername",$("#loginUsername").val()),$("#startScreen").css("position","absolute").fadeOut(300),hasNotificationPerm?($("#mainScreen").css("position","relative").fadeIn(300),changeTabTo("home")):$("#permissionScreen").css("position","relative").fadeIn(300),layScreen()}function changeTabTo(tab){if(""!=currentTab){var currentTrigger=$(".sidebarListItem[data-item="+currentTab+"]").attr("data-trigger");"conv"==currentTrigger&&(convInputHolders[currentTab]=$("#convInput").val()),$(".tab-"+currentTrigger).hide(),$(".sidebarListItem[data-item="+currentTab+"]").removeClass("activeItem")}lastTab=currentTab,currentTab=tab;var currentTrigger=$(".sidebarListItem[data-item="+currentTab+"]").attr("data-trigger");if($(".tab-"+currentTrigger).show(),$(".tab-"+currentTrigger).attr("data-item",currentTab),$(".sidebarListItem[data-item="+currentTab+"]").addClass("activeItem"),$(".sidebarListItem[data-item="+currentTab+"] .unreadBadge").slideUp(400,function(){$(this).text("0")}),"conv"==currentTrigger){var listItem=appcore.list[appcore.listHash[currentTab]];if(api.emit("markRead",{target:currentTab}),api.emit("getBuffer",{target:currentTab,small:!0}),focusInput(),refreshTypingDisplay(),listItem.relatedNotifications&&listItem.relatedNotifications.length){for(var i in listItem.relatedNotifications)listItem.relatedNotifications[i].close();listItem.relatedNotifications=[]}convInputHolders[currentTab]?($("#convInput").val(convInputHolders[currentTab]),delete convInputHolders[currentTab]):$("#convInput").val("")}layContent(!0,!0),layScreen(!0)}function removeList(id){currentTab==id&&changeTabTo("home"),$(".sidebarListItem[data-item='"+id+"']").remove()}function newText(data){appcore.list[appcore.listHash[data.target]];convBodyHolders[data.target]||(convBodyHolders[data.target]={buffer:[],live:[],lastUser:null,lastMsgSystem:null,lastDate:null});var convMessageUser=data.user,convMessageUserShow=data.userShow,isChatMessage=!("*"==data.userShow),convMessageContent=data.message,convMessageMeta=data.timestamp?"<span title='"+fullTime(data.timestamp)+"'>"+friendlyTime(data.timestamp)+"</span>":"",convMessageActions=data.isMe&&"*"!=data.userShow?"<div class='messageEditButton tinyButton'>Edit</div> <div class='messageEditCancelButton tinyButton' style='display: none'>Cancel</div>":"",newDivider=!0,lapseDivider="",date=new Date(parseInt(data.timestamp)).getDate();if(date!=convBodyHolders[data.target].lastDate&&null!=convBodyHolders[data.target].lastDate){var countdown=dateTime(data.timestamp);lapseDivider="<div class='convMessage lapseDivider'><i class='fa fa-calendar'></i> "+countdown+"</div>",convBodyHolders[data.target].lastUser="calendar"}convBodyHolders[data.target].lastDate=date,data.bgColor=data.bgColor&&6==data.bgColor.length&&0/0!=parseInt("0x"+data.bgColor)?"#"+data.bgColor:"inherit","*"!=data.userShow?(convBodyHolders[data.target].lastUser!=data.user||convBodyHolders[data.target].lastMsgSystem||(convMessageUserShow="&nbsp;",newDivider=!1),convBodyHolders[data.target].lastMsgSystem=!1):convBodyHolders[data.target].lastMsgSystem=!0,convBodyHolders[data.target].lastUser=data.user;var htmlBuild=lapseDivider+"<div class='convMessage "+(data.isMe?"myMessage ":"")+(data.small?"smallMessage ":"")+(newDivider?"newDivider ":"")+(isChatMessage?"chatMessage ":"")+"' data-unread='"+(data.unread&&data.target!=currentTab)+"' style='background-color:"+data.bgColor+"' data-timestamp='"+data.timestamp+"' data-user='"+convMessageUser+"'><div class='newOrb'></div><div class='convMessageActions'>"+convMessageActions+"</div><div class='convMessageUser'>"+convMessageUserShow+"</div><div class='convMessageContent' style='width:"+lastMessageContentWidth+"px'>"+convMessageContent+"</div><div class='convMessageMeta'>"+convMessageMeta+"</span></div></div>";if(data.isFromBuffer?convBodyHolders[data.target].buffer.push(htmlBuild):convBodyHolders[data.target].live.push(htmlBuild),convBodyHolders[data.target].buffer.length+convBodyHolders[data.target].live.length>300&&(convBodyHolders[data.target].buffer.length?convBodyHolders[data.target].buffer.splice(0,1):convBodyHolders[data.target].live.splice(0,1),data.target==currentTab&&$(".convMessage:first").remove()),data.target==currentTab){var convText=$("#convText");if(data.isFromBuffer){var bLD=convText.find("#bufferLiveDivider");bLD.length?bLD.before(htmlBuild):convText.append(htmlBuild),convText[0].scrollTop=convText[0].scrollHeight}else convText[0].scrollTop+convText[0].offsetHeight>convText[0].scrollHeight-50&&convText.stop().animate({scrollTop:convText[0].scrollHeight}),convText.append(htmlBuild);api.emit("markRead",{target:currentTab})}else if(data.unread&&!data.isMe){var badge=$(".sidebarListItem[data-item='"+data.target+"'] .unreadBadge");badge.slideDown(500).text(parseInt(badge.text())+1)}!data.unread||data.isFromBuffer||data.isMe||api.emit("notify",{type:"newMessage",uid:data.user,target:data.target,displayname:data.userShow,message:convMessageContent})}function loggedInCalls(){var myListItem=$(".sidebarListItem[data-item='me']");myListItem.find(".listItemIcon").attr("data-status",appcore.status),myListItem.find(".listItemSubtitle").text(statusText[appcore.status]),$("#myStatusSelect").val(appcore.status),$("#meUsername").text(appcore.username),$("#editProfileUsernameText").text(appcore.username),$("#editProfileDisplayNameText").text(appcore.displayname),$("#editProfileDisplayNameInput").val(appcore.displayname),appcore.avatar&&(myListItem.find(".listItemIcon")[0].src=appcore.avatar),$("#header").children().not("#settingsPopover").show(),apprtc.supported?$("#infoSupportCalls").show():$("#infoNotSupportCalls").show(),getProp("generalVolume")&&$("#generalVolumeSlider").val(100*getProp("generalVolume")),getProp("ringingVolume")&&$("#ringingVolumeSlider").val(100*getProp("ringingVolume"))}function friendlyTime(timeMs){if(!timeMs)return"?";var theDate=new Date(parseInt(timeMs)),nowDate=new Date;if(nowDate.getTime()-theDate.getTime()>864e5)return shortMonths[theDate.getMonth()]+" "+theDate.getDate();var amOrPm="am",ampmHour=theDate.getHours();theDate.getHours()>12&&(ampmHour=theDate.getHours()-12,amOrPm="pm");var paddedMinute=1==theDate.getMinutes().toString().length?"0"+theDate.getMinutes():theDate.getMinutes();return ampmHour+":"+paddedMinute+amOrPm}function dateTime(timeMs){if(!timeMs)return"?";var theDate=new Date(parseInt(timeMs));return shortMonths[theDate.getMonth()]+" "+theDate.getDate()}function fullTime(timeMs){if(!timeMs)return"?";var theDate=new Date(parseInt(timeMs)),paddedMinute=1==theDate.getSeconds().toString().length?"0"+theDate.getSeconds():theDate.getSeconds(),paddedSecond=1==theDate.getSeconds().toString().length?"0"+theDate.getSeconds():theDate.getSeconds();return theDate.getFullYear()+" "+shortMonths[theDate.getMonth()]+" "+theDate.getDate()+" "+theDate.getHours()+":"+paddedMinute+":"+paddedSecond}function focusInput(){$("#convInput").is(":visible")&&$("#convInput").focus()}function searchChange(newSearchTerm){var neverHide=["me","home","searchElement"],alreadyInList=!1;$(".sidebarListItem").each(function(){if("meta"!=$(this).attr("data-item")&&-1==neverHide.indexOf($(this).attr("data-item"))){var title=$(this).find(".listItemTitle").text().toLowerCase();-1==title.indexOf(newSearchTerm.toLowerCase())?$(this).slideUp(80):($(this).slideDown(80),title==newSearchTerm.toLowerCase()&&(alreadyInList=!0))}});var searchElement=$(".sidebarListItem[data-item=searchElement]");0!=newSearchTerm.length?(searchElement.find(".listItemTitle").text(newSearchTerm),searchElement.attr("data-searchElementAdd","invalid"),clearTimeout(searchNameTimeout),newSearchTerm.length<3?searchElement.find(".listItemSubtitle").text("There is no user named "+newSearchTerm):newSearchTerm.toLowerCase()==appcore.username.toLowerCase()?searchElement.find(".listItemSubtitle").text("That's you!"):alreadyInList?searchElement.find(".listItemSubtitle").text("Already in your list!"):(searchElement.find(".listItemSubtitle").text("Loading "+newSearchTerm+".."),searchNameTimeout=setTimeout(function(){api.emit("userExists",{username:newSearchTerm})},700)),searchElement.slideDown(80)):searchElement.slideUp(80)}function newNotification(icon,title,content,closeAfter,showWithFocus){if((!hasFocus||showWithFocus)&&!getProp("disableNotifications")){var newNotif;return hasFocus||closeAfter||(titleBadgeCount++,document.title="("+titleBadgeCount+") Subrosa",setFaviconBadge(titleBadgeCount)),title=$("#htmlToText").html(title).text(),content=$("#htmlToText").html(content).text(),title.length>100&&(title=title.substr(0,98)+".."),content.length>100&&(content=content.substr(0,98)+".."),Notification&&(newNotif=new Notification(title,{body:content,icon:icon})),showWithFocus||openNotifications.push(newNotif),closeAfter&&setTimeout(function(){newNotif.close?newNotif.close():newNotif.cancel&&newNotif.cancel()},closeAfter),newNotif}}function convButtonClick(){"addContactButton"==$(this).attr("id")?($(this).popover($(".addContactPopover")),$(".requestTextarea").val().length?$(".sendRequestBtn").removeClass("disabled"):$(".sendRequestBtn").addClass("disabled")):"moreButton"==$(this).attr("id")?$(this).popover($(".convMorePopover")):"removeFromList"==$(this).attr("id")||"removeFromListRoom"==$(this).attr("id")?(api.emit("removeList",{id:currentTab}),$("#moreButton").popover($(".convMorePopover")),removeList(currentTab)):"removeFromContacts"==$(this).attr("id")?(api.emit("removeContact",{id:currentTab}),layContent(!0,!1)):"acceptContactButton"==$(this).attr("id")?(api.emit("acceptContact",{id:currentTab}),layContent(!0,!1)):"newGroupChat"==$(this).attr("id")?(layRoomInviteUserList([appcore.list[appcore.listHash[currentTab]].uid],""),changeTabTo("meta")):"inviteButton"==$(this).attr("id")?(layRoomInviteUserList([],currentTab),changeTabTo("meta")):"clearHistory"==$(this).attr("id")?(api.emit("clearHistory",{target:currentTab}),convBodyHolders[currentTab]={live:[],buffer:[]},$("#convText").text(""),$.modal("historyCleared")):"voiceButton"==$(this).attr("id")?$(this).hasClass("disabled")||(apprtc.supported?getProp("webrtcWarning")?20==currentTab.length||appcore.list[appcore.listHash[currentTab]].status>0?(api.emit("makeCall",{target:currentTab,type:"voice"}),layContent(!0,!1),$(this).addClass("disabled"),20==currentTab.length&&$("#videoButton").addClass("disabled")):$.modal("notOnline","show"):($("#p2pWarningContinue").attr("data-click","#voiceButton"),$.modal("p2pWarning"),api.emit("setProp",{name:"webrtcWarning",value:!0})):$.modal("callsNotSupported","show")):"videoButton"==$(this).attr("id")&&($(this).hasClass("disabled")||(apprtc.supported?getProp("webrtcWarning")?20==currentTab.length||appcore.list[appcore.listHash[currentTab]].status>0?(api.emit("makeCall",{target:currentTab,type:"video"}),layContent(!0,!1),$(this).addClass("disabled"),20==currentTab.length&&$("#voiceButton").addClass("disabled")):$.modal("notOnline","show"):($("#p2pWarningContinue").attr("data-click","#videoButton"),$.modal("p2pWarning"),api.emit("setProp",{name:"webrtcWarning",value:!0})):$.modal("callsNotSupported","show")))}function startRinging(){$("#soundRinging")[0].volume=getProp("generalVolume")?getProp("generalVolume"):.7,$("#soundRinging")[0].loop=!0,$("#soundRinging")[0].play()}function stopRinging(){$("#soundRinging")[0].pause()}function startCallInput(group,type){navigator.getUserMedia({audio:!0,video:"video"==type},function(myMediaStream){return $("#overlay").css({opacity:0,"z-index":-100}),$("#permissionGuide").css({"z-index":-101}),appcall.mediaStream=myMediaStream,appcore.activeCall?void(group||appcore.activeCall.substr(4).split("-")[0]!=appcore.uid?rtcStart(appcall.mediaStream,group,"video"==type):setTimeout(function(){rtcStart(appcall.mediaStream,group,"video"==type)},400)):void stopCallInput()},function(error){alert("An error "+error+" has occured. Please make sure you have allowed permission.")}),setTimeout(function(){(!appcall.mediaStream||appcall.mediaStream.ended)&&($("#overlay").css({opacity:1,"z-index":1e4}),$("#permissionGuide").css({"z-index":1e4}))},50),appcall.callDurationInterval=setInterval(function(){appcall.callDuration++;var durationText=Math.floor(appcall.callDuration/60)+":"+(1==(appcall.callDuration%60).toString().length?"0"+appcall.callDuration%60:appcall.callDuration%60);$("#callDuration").text(durationText)},1e3)}function callUserUpdate(event,uid){"JOIN"==event?rtcUserJoin(uid):"QUIT"==event&&rtcUserQuit(uid)}function stopCallInput(){appcall.mediaStream&&appcall.mediaStream.stop(),$("#callDuration").text("0:00"),$("#voiceMute").removeClass("on"),$("#videoMute").removeClass("on"),$("#overlay").css({opacity:0,"z-index":-100}),$("#permissionGuide").css({"z-index":-101}),appcall.micMute=!1,appcall.videoMute=!1,rtcStop(),appcall.callDuration=0,clearInterval(appcall.callDurationInterval)
}function setMicrophoneMute(muted){appcall.micMute=muted,appcall.mediaStream&&(appcall.mediaStream.getAudioTracks()[0].enabled=!muted)}function setVideoMute(muted){appcall.videoMute=muted,appcall.mediaStream&&(appcall.mediaStream.getVideoTracks()[0].enabled=!muted),rtcSetVideoMute(muted)}function randomChar(){var n=Math.floor(62*Math.random());return 10>n?n:String.fromCharCode(36>n?n+55:n+61)}function rtcStart(mediaStream,group,video){apprtc.mediaStream=mediaStream,apprtc.group=group,apprtc.callVideo=video,video&&(apprtc.localVideoPanel=createVideoPanel(mediaStream,!0,!1,"")),rtcSendSignal({type:"ready"},null);var callUsers=appcore.list[appcore.listHash[appcore.activeCall]].active.callUsers;callUsers||(callUsers=appcore.activeCall.substr(4).split("-"));for(var i in callUsers)if(callUsers[i]!=appcore.uid){createPeerConnection(callUsers[i]);var pc=apprtc.pc[callUsers[i]];try{pc.addStream(mediaStream)}catch(error){alert("Error while sending mediaStream when I'm joining: "+error+" ; mediastream has "+apprtc.mediaStream.getAudioTracks().length+" audio tracks.")}}}function rtcUserJoin(uid){createPeerConnection(uid);try{apprtc.pc[uid].addStream(apprtc.mediaStream)}catch(error){alert("Error while sending mediaStream to new peer: "+error+" ; mediastream has "+apprtc.mediaStream.getAudioTracks().length+" audio tracks.")}}function rtcUserQuit(uid){apprtc.pc[uid]&&removeVideoPanel(apprtc.pc[uid].playerID)}function createVideoPanel(mediaStream,me,pc,userDisplay){var id="panel"+Math.round(999999999*Math.random());$("body").append("<div id='"+id+"' class='videoPanel'><video></video><div class='videoPanelActions'><div class='videoName'>"+(me?"You":escapeText(userDisplay))+"</div><div class='videoHangup'>End</div></div></div>");var videoPanel=$("#"+id);return videoPanel.draggable(),videoPanel.find(".videoHangup").click(function(){api.emit("dropCall",{target:appcore.activeCall})}),apprtc.playerCount++,me?(videoPanel.addClass("small"),apprtc.group?(videoPanel[0].style.left=window.innerWidth-160-25+"px",videoPanel[0].style.top="315px"):window.innerHeight>=570?(videoPanel[0].style.left=window.innerWidth-160-25+"px",videoPanel[0].style.top="410px"):(videoPanel[0].style.left=window.innerWidth-400-160-15-25+"px",videoPanel[0].style.top="95px")):apprtc.group?(pc.playerID=id,videoPanel.addClass("medium"),videoPanel[0].style.left=window.innerWidth-292*(apprtc.playerCount-1)+"px",videoPanel[0].style.top="95px"):(pc.playerID=id,videoPanel[0].style.left=window.innerWidth-400-25+"px",videoPanel[0].style.top="95px"),attachMediaStream(videoPanel.find("video")[0],mediaStream),videoPanel.find("video")[0].play(),id}function createAudioPlayer(mediaStream,me,pc){var id="player"+Math.round(999999999*Math.random());return pc.playerID=id,apprtc.playerCount++,apprtc.audioPlayers[id]=new Audio,attachMediaStream(apprtc.audioPlayers[id],mediaStream),apprtc.audioPlayers[id].play(),id}function rtcStop(){if(apprtc.callVideo){removeVideoPanel(apprtc.localVideoPanel);for(var i in apprtc.pc)removeVideoPanel(apprtc.pc[i].playerID)}else for(var i in apprtc.pc)removeAudioPlayer(apprtc.pc[i].playerID);apprtc.mediaStream=null,apprtc.pc=[],apprtc.playerCount=0,apprtc.localVideoPanel=null,apprtc.callVideo=null}function removeVideoPanel(playerID){playerID&&$("#"+playerID).remove()}function removeAudioPlayer(playerID){playerID&&(apprtc.audioPlayers[playerID].pause(),delete apprtc.audioPlayers[playerID])}function attachMediaStream(element,stream){"undefined"!=typeof element.srcObject?element.srcObject=stream:"undefined"!=typeof element.mozSrcObject?element.mozSrcObject=stream:"undefined"!=typeof element.src?element.src=URL.createObjectURL(stream):console.log("Error attaching stream to element.")}function createPeerConnection(uid){var pc=new RTCPeerConnection(apprtc.pc_config,apprtc.pc_constraints);apprtc.pc[uid]=pc,pc.uid=uid,pc.onicecandidate=function(event){event.candidate&&rtcSendSignal({type:"candidate",label:event.candidate.sdpMLineIndex,id:event.candidate.sdpMid,candidate:event.candidate.candidate},pc.uid)},pc.onaddstream=handleRemoteStreamAdded,pc.onremovestream=handleRemoteStreamRemoved,dataChannelsEnabled&&(isInitiator?(sendChannel=pc.createDataChannel("sendDataChannel",{reliable:!1}),sendChannel.onmessage=handleMessage,sendChannel.onopen=handleSendChannelStateChange,sendChannel.onclose=handleSendChannelStateChange):apprtc.pc[i].ondatachannel=gotReceiveChannel)}function rtcCall(pc){pc.createOffer(function(sessionDescription){pc.setLocalDescription(sessionDescription),rtcSendSignal(sessionDescription,pc.uid)},function(error){alert(error)})}function rtcSetVideoMute(muted){apprtc.localVideoPanel&&(muted?$("#"+apprtc.localVideoPanel).find("video").hide():$("#"+apprtc.localVideoPanel).find("video").show())}function handleIceCandidate(){}function handleRemoteStreamAdded(event){var userItem=getUserItem(event.target.uid);apprtc.callVideo?createVideoPanel(event.stream,!1,event.target,userItem.displayname||userItem.username):createAudioPlayer(event.stream,!1,event.target,userItem.displayname||userItem.username),setTimeout(function(){verifyFingerprint(event.target.uid,apprtc.pc[event.target.uid].remoteDescription.sdp,apprtc.pc[event.target.uid].localDescription.sdp)},1e3)}function handleRemoteStreamRemoved(){console.log("handleRemoteStreamRemoved")}function handleMessage(){console.log("handleMessage")}function handleSendChannelStateChange(){console.log("handleSendChannelStateChange")}function gotReceiveChannel(){console.log("gotReceiveChannel")}function rtcProcessSignal(object,to,sender){if("candidate"==object.type){var candidate=new RTCIceCandidate({sdpMLineIndex:object.label,candidate:object.candidate});apprtc.pc[sender].addIceCandidate(candidate)}else"ready"==object.type?(apprtc.playerCount>0||!apprtc.callVideo&&apprtc.mediaStream)&&(apprtc.pc[sender].playerID||(rtcCall(apprtc.pc[sender]),rtcSendSignal({type:"ackReady"},sender))):"ackReady"==object.type&&to==appcore.uid?apprtc.pc[sender].playerID||rtcCall[apprtc.pc[sender]]:"offer"==object.type&&to==appcore.uid?apprtc.pc[sender]&&(apprtc.pc[sender].setRemoteDescription(new RTCSessionDescription(object)),apprtc.pc[sender].createAnswer(function(sessionDescription){apprtc.pc[sender].setLocalDescription(sessionDescription),rtcSendSignal(sessionDescription,sender)},function(){},apprtc.sdpVideoConstraints)):"answer"==object.type&&to==appcore.uid?apprtc.pc[sender]&&apprtc.pc[sender].setRemoteDescription(new RTCSessionDescription(object)):console.log("Discarding RTC signal",object,to,sender)}function rtcSendSignal(object,to){api.emit("sendComm",{target:appcore.activeCall,type:10,message:{o:object,to:to}})}function verifyFingerprint(uid,remoteSdp,localSdp){var remoteFingerprint=remoteSdp.match(/^a=fingerprint:.+/m),localFingerprint=localSdp.match(/^a=fingerprint:.+/m);1==remoteFingerprint.length&&1==localFingerprint.length?(remoteFingerprint=remoteFingerprint[0],console.log("Remote fingerprint for "+uid+": "+remoteFingerprint),localFingerprint=localFingerprint[0],console.log("Local fingerprint for "+uid+": "+localFingerprint)):api.emit("dropCall",{target:appcore.activeCall}),api.emit("verifyFingerprint",{remoteFingerprint:remoteFingerprint,localFingerprint:localFingerprint,uid:uid})}!function(e,t){function M(e){var t=e.length,n=x.type(e);return x.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}function F(e){var t=O[e]={};return x.each(e.match(T)||[],function(e,n){t[n]=!0}),t}function R(e,n,r,i){if(x.acceptData(e)){var o,a,s=x.expando,l=e.nodeType,u=l?x.cache:e,c=l?e[s]:e[s]&&s;if(c&&u[c]&&(i||u[c].data)||r!==t||"string"!=typeof n)return c||(c=l?e[s]=p.pop()||x.guid++:s),u[c]||(u[c]=l?{}:{toJSON:x.noop}),("object"==typeof n||"function"==typeof n)&&(i?u[c]=x.extend(u[c],n):u[c].data=x.extend(u[c].data,n)),a=u[c],i||(a.data||(a.data={}),a=a.data),r!==t&&(a[x.camelCase(n)]=r),"string"==typeof n?(o=a[n],null==o&&(o=a[x.camelCase(n)])):o=a,o}}function W(e,t,n){if(x.acceptData(e)){var r,i,o=e.nodeType,a=o?x.cache:e,s=o?e[x.expando]:x.expando;if(a[s]){if(t&&(r=n?a[s]:a[s].data)){x.isArray(t)?t=t.concat(x.map(t,x.camelCase)):t in r?t=[t]:(t=x.camelCase(t),t=t in r?[t]:t.split(" ")),i=t.length;for(;i--;)delete r[t[i]];if(n?!I(r):!x.isEmptyObject(r))return}(n||(delete a[s].data,I(a[s])))&&(o?x.cleanData([e],!0):x.support.deleteExpando||a!=a.window?delete a[s]:a[s]=null)}}}function $(e,n,r){if(r===t&&1===e.nodeType){var i="data-"+n.replace(P,"-$1").toLowerCase();if(r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:B.test(r)?x.parseJSON(r):r}catch(o){}x.data(e,n,r)}else r=t}return r}function I(e){var t;for(t in e)if(("data"!==t||!x.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function it(){return!0}function ot(){return!1}function at(){try{return a.activeElement}catch(e){}}function pt(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function ft(e,t,n){if(x.isFunction(t))return x.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return x.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(st.test(t))return x.filter(t,e,n);t=x.filter(t,e)}return x.grep(e,function(e){return x.inArray(e,t)>=0!==n})}function dt(e){var t=ht.split("|"),n=e.createDocumentFragment();if(n.createElement)for(;t.length;)n.createElement(t.pop());return n}function Lt(e,t){return x.nodeName(e,"table")&&x.nodeName(1===t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function Ht(e){return e.type=(null!==x.find.attr(e,"type"))+"/"+e.type,e}function qt(e){var t=Et.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function _t(e,t){for(var n,r=0;null!=(n=e[r]);r++)x._data(n,"globalEval",!t||x._data(t[r],"globalEval"))}function Mt(e,t){if(1===t.nodeType&&x.hasData(e)){var n,r,i,o=x._data(e),a=x._data(t,o),s=o.events;if(s){delete a.handle,a.events={};for(n in s)for(r=0,i=s[n].length;i>r;r++)x.event.add(t,n,s[n][r])}a.data&&(a.data=x.extend({},a.data))}}function Ot(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!x.support.noCloneEvent&&t[x.expando]){i=x._data(t);for(r in i.events)x.removeEvent(t,r,i.handle);t.removeAttribute(x.expando)}"script"===n&&t.text!==e.text?(Ht(t).text=e.text,qt(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),x.support.html5Clone&&e.innerHTML&&!x.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&Ct.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}function Ft(e,n){var r,o,a=0,s=typeof e.getElementsByTagName!==i?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==i?e.querySelectorAll(n||"*"):t;if(!s)for(s=[],r=e.childNodes||e;null!=(o=r[a]);a++)!n||x.nodeName(o,n)?s.push(o):x.merge(s,Ft(o,n));return n===t||n&&x.nodeName(e,n)?x.merge([e],s):s}function Bt(e){Ct.test(e.type)&&(e.defaultChecked=e.checked)}function tn(e,t){if(t in e)return t;for(var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=en.length;i--;)if(t=en[i]+n,t in e)return t;return r}function nn(e,t){return e=t||e,"none"===x.css(e,"display")||!x.contains(e.ownerDocument,e)}function rn(e,t){for(var n,r,i,o=[],a=0,s=e.length;s>a;a++)r=e[a],r.style&&(o[a]=x._data(r,"olddisplay"),n=r.style.display,t?(o[a]||"none"!==n||(r.style.display=""),""===r.style.display&&nn(r)&&(o[a]=x._data(r,"olddisplay",ln(r.nodeName)))):o[a]||(i=nn(r),(n&&"none"!==n||!i)&&x._data(r,"olddisplay",i?n:x.css(r,"display"))));for(a=0;s>a;a++)r=e[a],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?o[a]||"":"none"));return e}function on(e,t,n){var r=Vt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function an(e,t,n,r,i){for(var o=n===(r?"border":"content")?4:"width"===t?1:0,a=0;4>o;o+=2)"margin"===n&&(a+=x.css(e,n+Zt[o],!0,i)),r?("content"===n&&(a-=x.css(e,"padding"+Zt[o],!0,i)),"margin"!==n&&(a-=x.css(e,"border"+Zt[o]+"Width",!0,i))):(a+=x.css(e,"padding"+Zt[o],!0,i),"padding"!==n&&(a+=x.css(e,"border"+Zt[o]+"Width",!0,i)));return a}function sn(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,o=Rt(e),a=x.support.boxSizing&&"border-box"===x.css(e,"boxSizing",!1,o);if(0>=i||null==i){if(i=Wt(e,t,o),(0>i||null==i)&&(i=e.style[t]),Yt.test(i))return i;r=a&&(x.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+an(e,t,n||(a?"border":"content"),r,o)+"px"}function ln(e){var t=a,n=Gt[e];return n||(n=un(e,t),"none"!==n&&n||(Pt=(Pt||x("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(Pt[0].contentWindow||Pt[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=un(e,t),Pt.detach()),Gt[e]=n),n}function un(e,t){var n=x(t.createElement(e)).appendTo(t.body),r=x.css(n[0],"display");return n.remove(),r}function gn(e,t,n,r){var i;if(x.isArray(t))x.each(t,function(t,i){n||pn.test(e)?r(e,i):gn(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==x.type(t))r(e,t);else for(i in t)gn(e+"["+i+"]",t[i],n,r)}function Hn(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(T)||[];if(x.isFunction(n))for(;r=o[i++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function qn(e,n,r,i){function s(l){var u;return o[l]=!0,x.each(e[l]||[],function(e,l){var c=l(n,r,i);return"string"!=typeof c||a||o[c]?a?!(u=c):t:(n.dataTypes.unshift(c),s(c),!1)}),u}var o={},a=e===jn;return s(n.dataTypes[0])||!o["*"]&&s("*")}function _n(e,n){var r,i,o=x.ajaxSettings.flatOptions||{};for(i in n)n[i]!==t&&((o[i]?e:r||(r={}))[i]=n[i]);return r&&x.extend(!0,e,r),e}function Mn(e,n,r){for(var i,o,a,s,l=e.contents,u=e.dataTypes;"*"===u[0];)u.shift(),o===t&&(o=e.mimeType||n.getResponseHeader("Content-Type"));if(o)for(s in l)if(l[s]&&l[s].test(o)){u.unshift(s);break}if(u[0]in r)a=u[0];else{for(s in r){if(!u[0]||e.converters[s+" "+u[0]]){a=s;break}i||(i=s)}a=a||i}return a?(a!==u[0]&&u.unshift(a),r[a]):t}function On(e,t,n,r){var i,o,a,s,l,u={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)u[a.toLowerCase()]=e.converters[a];for(o=c.shift();o;)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!l&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=o,o=c.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(a=u[l+" "+o]||u["* "+o],!a)for(i in u)if(s=i.split(" "),s[1]===o&&(a=u[l+" "+s[0]]||u["* "+s[0]])){a===!0?a=u[i]:u[i]!==!0&&(o=s[0],c.unshift(s[1]));break}if(a!==!0)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(p){return{state:"parsererror",error:a?p:"No conversion from "+l+" to "+o}}}return{state:"success",data:t}}function In(){try{return new e.XMLHttpRequest}catch(t){}}function zn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function Kn(){return setTimeout(function(){Xn=t}),Xn=x.now()}function Zn(e,t,n){for(var r,i=(Qn[t]||[]).concat(Qn["*"]),o=0,a=i.length;a>o;o++)if(r=i[o].call(n,t,e))return r}function er(e,t,n){var r,i,o=0,a=Gn.length,s=x.Deferred().always(function(){delete l.elem}),l=function(){if(i)return!1;for(var t=Xn||Kn(),n=Math.max(0,u.startTime+u.duration-t),r=n/u.duration||0,o=1-r,a=0,l=u.tweens.length;l>a;a++)u.tweens[a].run(o);return s.notifyWith(e,[u,o,n]),1>o&&l?n:(s.resolveWith(e,[u]),!1)},u=s.promise({elem:e,props:x.extend({},t),opts:x.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Xn||Kn(),duration:n.duration,tweens:[],createTween:function(t,n){var r=x.Tween(e,u.opts,t,n,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(r),r},stop:function(t){var n=0,r=t?u.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)u.tweens[n].run(1);return t?s.resolveWith(e,[u,t]):s.rejectWith(e,[u,t]),this}}),c=u.props;for(tr(c,u.opts.specialEasing);a>o;o++)if(r=Gn[o].call(u,e,c,u.opts))return r;return x.map(c,Zn,u),x.isFunction(u.opts.start)&&u.opts.start.call(e,u),x.fx.timer(x.extend(l,{elem:e,anim:u,queue:u.opts.queue})),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}function tr(e,t){var n,r,i,o,a;for(n in e)if(r=x.camelCase(n),i=t[r],o=e[n],x.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),a=x.cssHooks[r],a&&"expand"in a){o=a.expand(o),delete e[r];for(n in o)n in e||(e[n]=o[n],t[n]=i)}else t[r]=i}function nr(e,t,n){var r,i,o,a,s,l,u=this,c={},p=e.style,f=e.nodeType&&nn(e),d=x._data(e,"fxshow");n.queue||(s=x._queueHooks(e,"fx"),null==s.unqueued&&(s.unqueued=0,l=s.empty.fire,s.empty.fire=function(){s.unqueued||l()}),s.unqueued++,u.always(function(){u.always(function(){s.unqueued--,x.queue(e,"fx").length||s.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],"inline"===x.css(e,"display")&&"none"===x.css(e,"float")&&(x.support.inlineBlockNeedsLayout&&"inline"!==ln(e.nodeName)?p.zoom=1:p.display="inline-block")),n.overflow&&(p.overflow="hidden",x.support.shrinkWrapBlocks||u.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(r in t)if(i=t[r],Vn.exec(i)){if(delete t[r],o=o||"toggle"===i,i===(f?"hide":"show"))continue;c[r]=d&&d[r]||x.style(e,r)}if(!x.isEmptyObject(c)){d?"hidden"in d&&(f=d.hidden):d=x._data(e,"fxshow",{}),o&&(d.hidden=!f),f?x(e).show():u.done(function(){x(e).hide()}),u.done(function(){var t;x._removeData(e,"fxshow");for(t in c)x.style(e,t,c[t])});for(r in c)a=Zn(f?d[r]:0,r,u),r in d||(d[r]=a.start,f&&(a.end=a.start,a.start="width"===r||"height"===r?1:0))}}function rr(e,t,n,r,i){return new rr.prototype.init(e,t,n,r,i)}function ir(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=Zt[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function or(e){return x.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var n,r,i=typeof t,o=e.location,a=e.document,s=a.documentElement,l=e.jQuery,u=e.$,c={},p=[],f="1.10.2",d=p.concat,h=p.push,g=p.slice,m=p.indexOf,y=c.toString,v=c.hasOwnProperty,b=f.trim,x=function(e,t){return new x.fn.init(e,t,r)},w=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,T=/\S+/g,C=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,N=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,k=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,E=/^[\],:{}\s]*$/,S=/(?:^|:|,)(?:\s*\[)+/g,A=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,j=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,D=/^-ms-/,L=/-([\da-z])/gi,H=function(e,t){return t.toUpperCase()},q=function(e){(a.addEventListener||"load"===e.type||"complete"===a.readyState)&&(_(),x.ready())},_=function(){a.addEventListener?(a.removeEventListener("DOMContentLoaded",q,!1),e.removeEventListener("load",q,!1)):(a.detachEvent("onreadystatechange",q),e.detachEvent("onload",q))};x.fn=x.prototype={jquery:f,constructor:x,init:function(e,n,r){var i,o;if(!e)return this;if("string"==typeof e){if(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:N.exec(e),!i||!i[1]&&n)return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e);if(i[1]){if(n=n instanceof x?n[0]:n,x.merge(this,x.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:a,!0)),k.test(i[1])&&x.isPlainObject(n))for(i in n)x.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i]);return this}if(o=a.getElementById(i[2]),o&&o.parentNode){if(o.id!==i[2])return r.find(e);this.length=1,this[0]=o}return this.context=a,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):x.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),x.makeArray(e,this))},selector:"",length:0,toArray:function(){return g.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=x.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return x.each(this,e,t)},ready:function(e){return x.ready.promise().done(e),this},slice:function(){return this.pushStack(g.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(x.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:h,sort:[].sort,splice:[].splice},x.fn.init.prototype=x.fn,x.extend=x.fn.extend=function(){var e,n,r,i,o,a,s=arguments[0]||{},l=1,u=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[1]||{},l=2),"object"==typeof s||x.isFunction(s)||(s={}),u===l&&(s=this,--l);u>l;l++)if(null!=(o=arguments[l]))for(i in o)e=s[i],r=o[i],s!==r&&(c&&r&&(x.isPlainObject(r)||(n=x.isArray(r)))?(n?(n=!1,a=e&&x.isArray(e)?e:[]):a=e&&x.isPlainObject(e)?e:{},s[i]=x.extend(c,a,r)):r!==t&&(s[i]=r));return s},x.extend({expando:"jQuery"+(f+Math.random()).replace(/\D/g,""),noConflict:function(t){return e.$===x&&(e.$=u),t&&e.jQuery===x&&(e.jQuery=l),x},isReady:!1,readyWait:1,holdReady:function(e){e?x.readyWait++:x.ready(!0)},ready:function(e){if(e===!0?!--x.readyWait:!x.isReady){if(!a.body)return setTimeout(x.ready);x.isReady=!0,e!==!0&&--x.readyWait>0||(n.resolveWith(a,[x]),x.fn.trigger&&x(a).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===x.type(e)},isArray:Array.isArray||function(e){return"array"===x.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?c[y.call(e)]||"object":typeof e},isPlainObject:function(e){var n;if(!e||"object"!==x.type(e)||e.nodeType||x.isWindow(e))return!1;try{if(e.constructor&&!v.call(e,"constructor")&&!v.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(r){return!1}if(x.support.ownLast)for(n in e)return v.call(e,n);for(n in e);return n===t||v.call(e,n)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||a;var r=k.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=x.buildFragment([e],t,i),i&&x(i).remove(),x.merge([],r.childNodes))},parseJSON:function(n){return e.JSON&&e.JSON.parse?e.JSON.parse(n):null===n?n:"string"==typeof n&&(n=x.trim(n),n&&E.test(n.replace(A,"@").replace(j,"]").replace(S,"")))?Function("return "+n)():(x.error("Invalid JSON: "+n),t)},parseXML:function(n){var r,i;if(!n||"string"!=typeof n)return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(o){r=t}return r&&r.documentElement&&!r.getElementsByTagName("parsererror").length||x.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&x.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(D,"ms-").replace(L,H)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,o=e.length,a=M(e);if(n){if(a)for(;o>i&&(r=t.apply(e[i],n),r!==!1);i++);else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(a)for(;o>i&&(r=t.call(e[i],i,e[i]),r!==!1);i++);else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:b&&!b.call("")?function(e){return null==e?"":b.call(e)}:function(e){return null==e?"":(e+"").replace(C,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(M(Object(e))?x.merge(n,"string"==typeof e?[e]:e):h.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(m)return m.call(t,e,n);for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,o=0;if("number"==typeof r)for(;r>o;o++)e[i++]=n[o];else for(;n[o]!==t;)e[i++]=n[o++];return e.length=i,e},grep:function(e,t,n){var r,i=[],o=0,a=e.length;for(n=!!n;a>o;o++)r=!!t(e[o],o),n!==r&&i.push(e[o]);return i},map:function(e,t,n){var r,i=0,o=e.length,a=M(e),s=[];if(a)for(;o>i;i++)r=t(e[i],i,n),null!=r&&(s[s.length]=r);else for(i in e)r=t(e[i],i,n),null!=r&&(s[s.length]=r);return d.apply([],s)},guid:1,proxy:function(e,n){var r,i,o;return"string"==typeof n&&(o=e[n],n=e,e=o),x.isFunction(e)?(r=g.call(arguments,2),i=function(){return e.apply(n||this,r.concat(g.call(arguments)))},i.guid=e.guid=e.guid||x.guid++,i):t},access:function(e,n,r,i,o,a,s){var l=0,u=e.length,c=null==r;if("object"===x.type(r)){o=!0;for(l in r)x.access(e,n,l,r[l],!0,a,s)}else if(i!==t&&(o=!0,x.isFunction(i)||(s=!0),c&&(s?(n.call(e,i),n=null):(c=n,n=function(e,t,n){return c.call(x(e),n)})),n))for(;u>l;l++)n(e[l],r,s?i:i.call(e[l],l,n(e[l],r)));return o?e:c?n.call(e):u?n(e[0],r):a},now:function(){return(new Date).getTime()},swap:function(e,t,n,r){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];i=n.apply(e,r||[]);for(o in t)e.style[o]=a[o];return i}}),x.ready.promise=function(t){if(!n)if(n=x.Deferred(),"complete"===a.readyState)setTimeout(x.ready);else if(a.addEventListener)a.addEventListener("DOMContentLoaded",q,!1),e.addEventListener("load",q,!1);else{a.attachEvent("onreadystatechange",q),e.attachEvent("onload",q);var r=!1;try{r=null==e.frameElement&&a.documentElement}catch(i){}r&&r.doScroll&&function o(){if(!x.isReady){try{r.doScroll("left")}catch(e){return setTimeout(o,50)}_(),x.ready()}}()}return n.promise(t)},x.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){c["[object "+t+"]"]=t.toLowerCase()}),r=x(a),function(e,t){function at(e,t,n,i){var o,a,s,l,u,c,d,m,y,x;if((t?t.ownerDocument||t:w)!==f&&p(t),t=t||f,n=n||[],!e||"string"!=typeof e)return n;if(1!==(l=t.nodeType)&&9!==l)return[];if(h&&!i){if(o=Z.exec(e))if(s=o[1]){if(9===l){if(a=t.getElementById(s),!a||!a.parentNode)return n;if(a.id===s)return n.push(a),n}else if(t.ownerDocument&&(a=t.ownerDocument.getElementById(s))&&v(t,a)&&a.id===s)return n.push(a),n}else{if(o[2])return M.apply(n,t.getElementsByTagName(e)),n;if((s=o[3])&&r.getElementsByClassName&&t.getElementsByClassName)return M.apply(n,t.getElementsByClassName(s)),n}if(r.qsa&&(!g||!g.test(e))){if(m=d=b,y=t,x=9===l&&e,1===l&&"object"!==t.nodeName.toLowerCase()){for(c=mt(e),(d=t.getAttribute("id"))?m=d.replace(nt,"\\$&"):t.setAttribute("id",m),m="[id='"+m+"'] ",u=c.length;u--;)c[u]=m+yt(c[u]);y=V.test(e)&&t.parentNode||t,x=c.join(",")}if(x)try{return M.apply(n,y.querySelectorAll(x)),n}catch(T){}finally{d||t.removeAttribute("id")}}}return kt(e.replace(z,"$1"),t,n,i)}function st(){function t(n,r){return e.push(n+=" ")>o.cacheLength&&delete t[e.shift()],t[n]=r}var e=[];return t}function lt(e){return e[b]=!0,e}function ut(e){var t=f.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ct(e,t){for(var n=e.split("|"),r=e.length;r--;)o.attrHandle[n[r]]=t}function pt(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||D)-(~e.sourceIndex||D);if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function ft(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function dt(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ht(e){return lt(function(t){return t=+t,lt(function(n,r){for(var i,o=e([],n.length,t),a=o.length;a--;)n[i=o[a]]&&(n[i]=!(r[i]=n[i]))})})}function gt(){}function mt(e,t){var n,r,i,a,s,l,u,c=k[e+" "];if(c)return t?0:c.slice(0);for(s=e,l=[],u=o.preFilter;s;){(!n||(r=X.exec(s)))&&(r&&(s=s.slice(r[0].length)||s),l.push(i=[])),n=!1,(r=U.exec(s))&&(n=r.shift(),i.push({value:n,type:r[0].replace(z," ")}),s=s.slice(n.length));for(a in o.filter)!(r=Q[a].exec(s))||u[a]&&!(r=u[a](r))||(n=r.shift(),i.push({value:n,type:a,matches:r}),s=s.slice(n.length));if(!n)break}return t?s.length:s?at.error(e):k(e,l).slice(0)}function yt(e){for(var t=0,n=e.length,r="";n>t;t++)r+=e[t].value;return r}function vt(e,t,n){var r=t.dir,o=n&&"parentNode"===r,a=C++;return t.first?function(t,n,i){for(;t=t[r];)if(1===t.nodeType||o)return e(t,n,i)}:function(t,n,s){var l,u,c,p=T+" "+a;if(s){for(;t=t[r];)if((1===t.nodeType||o)&&e(t,n,s))return!0}else for(;t=t[r];)if(1===t.nodeType||o)if(c=t[b]||(t[b]={}),(u=c[r])&&u[0]===p){if((l=u[1])===!0||l===i)return l===!0}else if(u=c[r]=[p],u[1]=e(t,n,s)||i,u[1]===!0)return!0}}function bt(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function xt(e,t,n,r,i){for(var o,a=[],s=0,l=e.length,u=null!=t;l>s;s++)(o=e[s])&&(!n||n(o,r,i))&&(a.push(o),u&&t.push(s));return a}function wt(e,t,n,r,i,o){return r&&!r[b]&&(r=wt(r)),i&&!i[b]&&(i=wt(i,o)),lt(function(o,a,s,l){var u,c,p,f=[],d=[],h=a.length,g=o||Nt(t||"*",s.nodeType?[s]:s,[]),m=!e||!o&&t?g:xt(g,f,e,s,l),y=n?i||(o?e:h||r)?[]:a:m;if(n&&n(m,y,s,l),r)for(u=xt(y,d),r(u,[],s,l),c=u.length;c--;)(p=u[c])&&(y[d[c]]=!(m[d[c]]=p));if(o){if(i||e){if(i){for(u=[],c=y.length;c--;)(p=y[c])&&u.push(m[c]=p);i(null,y=[],u,l)}for(c=y.length;c--;)(p=y[c])&&(u=i?F.call(o,p):f[c])>-1&&(o[u]=!(a[u]=p))}}else y=xt(y===a?y.splice(h,y.length):y),i?i(null,a,y,l):M.apply(a,y)})}function Tt(e){for(var t,n,r,i=e.length,a=o.relative[e[0].type],s=a||o.relative[" "],l=a?1:0,c=vt(function(e){return e===t},s,!0),p=vt(function(e){return F.call(t,e)>-1},s,!0),f=[function(e,n,r){return!a&&(r||n!==u)||((t=n).nodeType?c(e,n,r):p(e,n,r))}];i>l;l++)if(n=o.relative[e[l].type])f=[vt(bt(f),n)];else{if(n=o.filter[e[l].type].apply(null,e[l].matches),n[b]){for(r=++l;i>r&&!o.relative[e[r].type];r++);return wt(l>1&&bt(f),l>1&&yt(e.slice(0,l-1).concat({value:" "===e[l-2].type?"*":""})).replace(z,"$1"),n,r>l&&Tt(e.slice(l,r)),i>r&&Tt(e=e.slice(r)),i>r&&yt(e))}f.push(n)}return bt(f)}function Ct(e,t){var n=0,r=t.length>0,a=e.length>0,s=function(s,l,c,p,d){var h,g,m,y=[],v=0,b="0",x=s&&[],w=null!=d,C=u,N=s||a&&o.find.TAG("*",d&&l.parentNode||l),k=T+=null==C?1:Math.random()||.1;for(w&&(u=l!==f&&l,i=n);null!=(h=N[b]);b++){if(a&&h){for(g=0;m=e[g++];)if(m(h,l,c)){p.push(h);break}w&&(T=k,i=++n)}r&&((h=!m&&h)&&v--,s&&x.push(h))}if(v+=b,r&&b!==v){for(g=0;m=t[g++];)m(x,y,l,c);if(s){if(v>0)for(;b--;)x[b]||y[b]||(y[b]=q.call(p));y=xt(y)}M.apply(p,y),w&&!s&&y.length>0&&v+t.length>1&&at.uniqueSort(p)}return w&&(T=k,u=C),x};return r?lt(s):s}function Nt(e,t,n){for(var r=0,i=t.length;i>r;r++)at(e,t[r],n);return n}function kt(e,t,n,i){var a,s,u,c,p,f=mt(e);if(!i&&1===f.length){if(s=f[0]=f[0].slice(0),s.length>2&&"ID"===(u=s[0]).type&&r.getById&&9===t.nodeType&&h&&o.relative[s[1].type]){if(t=(o.find.ID(u.matches[0].replace(rt,it),t)||[])[0],!t)return n;e=e.slice(s.shift().value.length)}for(a=Q.needsContext.test(e)?0:s.length;a--&&(u=s[a],!o.relative[c=u.type]);)if((p=o.find[c])&&(i=p(u.matches[0].replace(rt,it),V.test(s[0].type)&&t.parentNode||t))){if(s.splice(a,1),e=i.length&&yt(s),!e)return M.apply(n,i),n;break}}return l(e,f)(i,t,!h,n,V.test(e)),n}var n,r,i,o,a,s,l,u,c,p,f,d,h,g,m,y,v,b="sizzle"+-new Date,w=e.document,T=0,C=0,N=st(),k=st(),E=st(),S=!1,A=function(e,t){return e===t?(S=!0,0):0},j=typeof t,D=1<<31,L={}.hasOwnProperty,H=[],q=H.pop,_=H.push,M=H.push,O=H.slice,F=H.indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(this[t]===e)return t;return-1},B="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",P="[\\x20\\t\\r\\n\\f]",R="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",W=R.replace("w","w#"),$="\\["+P+"*("+R+")"+P+"*(?:([*^$|!~]?=)"+P+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+W+")|)|)"+P+"*\\]",I=":("+R+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+$.replace(3,8)+")*)|.*)\\)|)",z=RegExp("^"+P+"+|((?:^|[^\\\\])(?:\\\\.)*)"+P+"+$","g"),X=RegExp("^"+P+"*,"+P+"*"),U=RegExp("^"+P+"*([>+~]|"+P+")"+P+"*"),V=RegExp(P+"*[+~]"),Y=RegExp("="+P+"*([^\\]'\"]*)"+P+"*\\]","g"),J=RegExp(I),G=RegExp("^"+W+"$"),Q={ID:RegExp("^#("+R+")"),CLASS:RegExp("^\\.("+R+")"),TAG:RegExp("^("+R.replace("w","w*")+")"),ATTR:RegExp("^"+$),PSEUDO:RegExp("^"+I),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+P+"*(even|odd|(([+-]|)(\\d*)n|)"+P+"*(?:([+-]|)"+P+"*(\\d+)|))"+P+"*\\)|)","i"),bool:RegExp("^(?:"+B+")$","i"),needsContext:RegExp("^"+P+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+P+"*((?:-\\d)?\\d*)"+P+"*\\)|)(?=[^-]|$)","i")},K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,et=/^(?:input|select|textarea|button)$/i,tt=/^h\d$/i,nt=/'|\\/g,rt=RegExp("\\\\([\\da-f]{1,6}"+P+"?|("+P+")|.)","ig"),it=function(e,t,n){var r="0x"+t-65536;
return r!==r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(55296|r>>10,56320|1023&r)};try{M.apply(H=O.call(w.childNodes),w.childNodes),H[w.childNodes.length].nodeType}catch(ot){M={apply:H.length?function(e,t){_.apply(e,O.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}s=at.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},r=at.support={},p=at.setDocument=function(e){var n=e?e.ownerDocument||e:w,i=n.defaultView;return n!==f&&9===n.nodeType&&n.documentElement?(f=n,d=n.documentElement,h=!s(n),i&&i.attachEvent&&i!==i.top&&i.attachEvent("onbeforeunload",function(){p()}),r.attributes=ut(function(e){return e.className="i",!e.getAttribute("className")}),r.getElementsByTagName=ut(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),r.getElementsByClassName=ut(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),r.getById=ut(function(e){return d.appendChild(e).id=b,!n.getElementsByName||!n.getElementsByName(b).length}),r.getById?(o.find.ID=function(e,t){if(typeof t.getElementById!==j&&h){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},o.filter.ID=function(e){var t=e.replace(rt,it);return function(e){return e.getAttribute("id")===t}}):(delete o.find.ID,o.filter.ID=function(e){var t=e.replace(rt,it);return function(e){var n=typeof e.getAttributeNode!==j&&e.getAttributeNode("id");return n&&n.value===t}}),o.find.TAG=r.getElementsByTagName?function(e,n){return typeof n.getElementsByTagName!==j?n.getElementsByTagName(e):t}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){for(;n=o[i++];)1===n.nodeType&&r.push(n);return r}return o},o.find.CLASS=r.getElementsByClassName&&function(e,n){return typeof n.getElementsByClassName!==j&&h?n.getElementsByClassName(e):t},m=[],g=[],(r.qsa=K.test(n.querySelectorAll))&&(ut(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||g.push("\\["+P+"*(?:value|"+B+")"),e.querySelectorAll(":checked").length||g.push(":checked")}),ut(function(e){var t=n.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("t",""),e.querySelectorAll("[t^='']").length&&g.push("[*^$]="+P+"*(?:''|\"\")"),e.querySelectorAll(":enabled").length||g.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),g.push(",.*:")})),(r.matchesSelector=K.test(y=d.webkitMatchesSelector||d.mozMatchesSelector||d.oMatchesSelector||d.msMatchesSelector))&&ut(function(e){r.disconnectedMatch=y.call(e,"div"),y.call(e,"[s!='']:x"),m.push("!=",I)}),g=g.length&&RegExp(g.join("|")),m=m.length&&RegExp(m.join("|")),v=K.test(d.contains)||d.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},A=d.compareDocumentPosition?function(e,t){if(e===t)return S=!0,0;var i=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t);return i?1&i||!r.sortDetached&&t.compareDocumentPosition(e)===i?e===n||v(w,e)?-1:t===n||v(w,t)?1:c?F.call(c,e)-F.call(c,t):0:4&i?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,o=e.parentNode,a=t.parentNode,s=[e],l=[t];if(e===t)return S=!0,0;if(!o||!a)return e===n?-1:t===n?1:o?-1:a?1:c?F.call(c,e)-F.call(c,t):0;if(o===a)return pt(e,t);for(r=e;r=r.parentNode;)s.unshift(r);for(r=t;r=r.parentNode;)l.unshift(r);for(;s[i]===l[i];)i++;return i?pt(s[i],l[i]):s[i]===w?-1:l[i]===w?1:0},n):f},at.matches=function(e,t){return at(e,null,null,t)},at.matchesSelector=function(e,t){if((e.ownerDocument||e)!==f&&p(e),t=t.replace(Y,"='$1']"),!(!r.matchesSelector||!h||m&&m.test(t)||g&&g.test(t)))try{var n=y.call(e,t);if(n||r.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(i){}return at(t,f,null,[e]).length>0},at.contains=function(e,t){return(e.ownerDocument||e)!==f&&p(e),v(e,t)},at.attr=function(e,n){(e.ownerDocument||e)!==f&&p(e);var i=o.attrHandle[n.toLowerCase()],a=i&&L.call(o.attrHandle,n.toLowerCase())?i(e,n,!h):t;return a===t?r.attributes||!h?e.getAttribute(n):(a=e.getAttributeNode(n))&&a.specified?a.value:null:a},at.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},at.uniqueSort=function(e){var t,n=[],i=0,o=0;if(S=!r.detectDuplicates,c=!r.sortStable&&e.slice(0),e.sort(A),S){for(;t=e[o++];)t===e[o]&&(i=n.push(o));for(;i--;)e.splice(n[i],1)}return e},a=at.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=a(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r];r++)n+=a(t);return n},o=at.selectors={cacheLength:50,createPseudo:lt,match:Q,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(rt,it),e[3]=(e[4]||e[5]||"").replace(rt,it),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||at.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&at.error(e[0]),e},PSEUDO:function(e){var n,r=!e[5]&&e[2];return Q.CHILD.test(e[0])?null:(e[3]&&e[4]!==t?e[2]=e[4]:r&&J.test(r)&&(n=mt(r,!0))&&(n=r.indexOf(")",r.length-n)-r.length)&&(e[0]=e[0].slice(0,n),e[2]=r.slice(0,n)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(rt,it).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=N[e+" "];return t||(t=RegExp("(^|"+P+")"+e+"("+P+"|$)"))&&N(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==j&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=at.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,l){var u,c,p,f,d,h,g=o!==a?"nextSibling":"previousSibling",m=t.parentNode,y=s&&t.nodeName.toLowerCase(),v=!l&&!s;if(m){if(o){for(;g;){for(p=t;p=p[g];)if(s?p.nodeName.toLowerCase()===y:1===p.nodeType)return!1;h=g="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?m.firstChild:m.lastChild],a&&v){for(c=m[b]||(m[b]={}),u=c[e]||[],d=u[0]===T&&u[1],f=u[0]===T&&u[2],p=d&&m.childNodes[d];p=++d&&p&&p[g]||(f=d=0)||h.pop();)if(1===p.nodeType&&++f&&p===t){c[e]=[T,d,f];break}}else if(v&&(u=(t[b]||(t[b]={}))[e])&&u[0]===T)f=u[1];else for(;(p=++d&&p&&p[g]||(f=d=0)||h.pop())&&((s?p.nodeName.toLowerCase()!==y:1!==p.nodeType)||!++f||(v&&((p[b]||(p[b]={}))[e]=[T,f]),p!==t)););return f-=i,f===r||0===f%r&&f/r>=0}}},PSEUDO:function(e,t){var n,r=o.pseudos[e]||o.setFilters[e.toLowerCase()]||at.error("unsupported pseudo: "+e);return r[b]?r(t):r.length>1?(n=[e,e,"",t],o.setFilters.hasOwnProperty(e.toLowerCase())?lt(function(e,n){for(var i,o=r(e,t),a=o.length;a--;)i=F.call(e,o[a]),e[i]=!(n[i]=o[a])}):function(e){return r(e,0,n)}):r}},pseudos:{not:lt(function(e){var t=[],n=[],r=l(e.replace(z,"$1"));return r[b]?lt(function(e,t,n,i){for(var o,a=r(e,null,i,[]),s=e.length;s--;)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),!n.pop()}}),has:lt(function(e){return function(t){return at(e,t).length>0}}),contains:lt(function(e){return function(t){return(t.textContent||t.innerText||a(t)).indexOf(e)>-1}}),lang:lt(function(e){return G.test(e||"")||at.error("unsupported lang: "+e),e=e.replace(rt,it).toLowerCase(),function(t){var n;do if(n=h?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===d},focus:function(e){return e===f.activeElement&&(!f.hasFocus||f.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!o.pseudos.empty(e)},header:function(e){return tt.test(e.nodeName)},input:function(e){return et.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:ht(function(){return[0]}),last:ht(function(e,t){return[t-1]}),eq:ht(function(e,t,n){return[0>n?n+t:n]}),even:ht(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:ht(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:ht(function(e,t,n){for(var r=0>n?n+t:n;--r>=0;)e.push(r);return e}),gt:ht(function(e,t,n){for(var r=0>n?n+t:n;t>++r;)e.push(r);return e})}},o.pseudos.nth=o.pseudos.eq;for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})o.pseudos[n]=ft(n);for(n in{submit:!0,reset:!0})o.pseudos[n]=dt(n);gt.prototype=o.filters=o.pseudos,o.setFilters=new gt,l=at.compile=function(e,t){var n,r=[],i=[],o=E[e+" "];if(!o){for(t||(t=mt(e)),n=t.length;n--;)o=Tt(t[n]),o[b]?r.push(o):i.push(o);o=E(e,Ct(i,r))}return o},r.sortStable=b.split("").sort(A).join("")===b,r.detectDuplicates=S,p(),r.sortDetached=ut(function(e){return 1&e.compareDocumentPosition(f.createElement("div"))}),ut(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||ct("type|href|height|width",function(e,n,r){return r?t:e.getAttribute(n,"type"===n.toLowerCase()?1:2)}),r.attributes&&ut(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||ct("value",function(e,n,r){return r||"input"!==e.nodeName.toLowerCase()?t:e.defaultValue}),ut(function(e){return null==e.getAttribute("disabled")})||ct(B,function(e,n,r){var i;return r?t:(i=e.getAttributeNode(n))&&i.specified?i.value:e[n]===!0?n.toLowerCase():null}),x.find=at,x.expr=at.selectors,x.expr[":"]=x.expr.pseudos,x.unique=at.uniqueSort,x.text=at.getText,x.isXMLDoc=at.isXML,x.contains=at.contains}(e);var O={};x.Callbacks=function(e){e="string"==typeof e?O[e]||F(e):x.extend({},e);var n,r,i,o,a,s,l=[],u=!e.once&&[],c=function(t){for(r=e.memory&&t,i=!0,a=s||0,s=0,o=l.length,n=!0;l&&o>a;a++)if(l[a].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}n=!1,l&&(u?u.length&&c(u.shift()):r?l=[]:p.disable())},p={add:function(){if(l){var t=l.length;!function i(t){x.each(t,function(t,n){var r=x.type(n);"function"===r?e.unique&&p.has(n)||l.push(n):n&&n.length&&"string"!==r&&i(n)})}(arguments),n?o=l.length:r&&(s=t,c(r))}return this},remove:function(){return l&&x.each(arguments,function(e,t){for(var r;(r=x.inArray(t,l,r))>-1;)l.splice(r,1),n&&(o>=r&&o--,a>=r&&a--)}),this},has:function(e){return e?x.inArray(e,l)>-1:!(!l||!l.length)},empty:function(){return l=[],o=0,this},disable:function(){return l=u=r=t,this},disabled:function(){return!l},lock:function(){return u=t,r||p.disable(),this},locked:function(){return!u},fireWith:function(e,t){return!l||i&&!u||(t=t||[],t=[e,t.slice?t.slice():t],n?u.push(t):c(t)),this},fire:function(){return p.fireWith(this,arguments),this},fired:function(){return!!i}};return p},x.extend({Deferred:function(e){var t=[["resolve","done",x.Callbacks("once memory"),"resolved"],["reject","fail",x.Callbacks("once memory"),"rejected"],["notify","progress",x.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return x.Deferred(function(n){x.each(t,function(t,o){var a=o[0],s=x.isFunction(e[t])&&e[t];i[o[1]](function(){var e=s&&s.apply(this,arguments);e&&x.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[a+"With"](this===r?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?x.extend(e,r):r}},i={};return r.pipe=r.then,x.each(t,function(e,o){var a=o[2],s=o[3];r[o[1]]=a.add,s&&a.add(function(){n=s},t[1^e][2].disable,t[2][2].lock),i[o[0]]=function(){return i[o[0]+"With"](this===i?r:this,arguments),this},i[o[0]+"With"]=a.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var s,l,u,t=0,n=g.call(arguments),r=n.length,i=1!==r||e&&x.isFunction(e.promise)?r:0,o=1===i?e:x.Deferred(),a=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?g.call(arguments):r,n===s?o.notifyWith(t,n):--i||o.resolveWith(t,n)}};if(r>1)for(s=Array(r),l=Array(r),u=Array(r);r>t;t++)n[t]&&x.isFunction(n[t].promise)?n[t].promise().done(a(t,u,n)).fail(o.reject).progress(a(t,l,s)):--i;return i||o.resolveWith(u,n),o.promise()}}),x.support=function(t){var n,r,o,s,l,u,c,p,f,d=a.createElement("div");if(d.setAttribute("className","t"),d.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=d.getElementsByTagName("*")||[],r=d.getElementsByTagName("a")[0],!r||!r.style||!n.length)return t;s=a.createElement("select"),u=s.appendChild(a.createElement("option")),o=d.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t.getSetAttribute="t"!==d.className,t.leadingWhitespace=3===d.firstChild.nodeType,t.tbody=!d.getElementsByTagName("tbody").length,t.htmlSerialize=!!d.getElementsByTagName("link").length,t.style=/top/.test(r.getAttribute("style")),t.hrefNormalized="/a"===r.getAttribute("href"),t.opacity=/^0.5/.test(r.style.opacity),t.cssFloat=!!r.style.cssFloat,t.checkOn=!!o.value,t.optSelected=u.selected,t.enctype=!!a.createElement("form").enctype,t.html5Clone="<:nav></:nav>"!==a.createElement("nav").cloneNode(!0).outerHTML,t.inlineBlockNeedsLayout=!1,t.shrinkWrapBlocks=!1,t.pixelPosition=!1,t.deleteExpando=!0,t.noCloneEvent=!0,t.reliableMarginRight=!0,t.boxSizingReliable=!0,o.checked=!0,t.noCloneChecked=o.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!u.disabled;try{delete d.test}catch(h){t.deleteExpando=!1}o=a.createElement("input"),o.setAttribute("value",""),t.input=""===o.getAttribute("value"),o.value="t",o.setAttribute("type","radio"),t.radioValue="t"===o.value,o.setAttribute("checked","t"),o.setAttribute("name","t"),l=a.createDocumentFragment(),l.appendChild(o),t.appendChecked=o.checked,t.checkClone=l.cloneNode(!0).cloneNode(!0).lastChild.checked,d.attachEvent&&(d.attachEvent("onclick",function(){t.noCloneEvent=!1}),d.cloneNode(!0).click());for(f in{submit:!0,change:!0,focusin:!0})d.setAttribute(c="on"+f,"t"),t[f+"Bubbles"]=c in e||d.attributes[c].expando===!1;d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===d.style.backgroundClip;for(f in x(t))break;return t.ownLast="0"!==f,x(function(){var n,r,o,s="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",l=a.getElementsByTagName("body")[0];l&&(n=a.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",l.appendChild(n).appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",o=d.getElementsByTagName("td"),o[0].style.cssText="padding:0;margin:0;border:0;display:none",p=0===o[0].offsetHeight,o[0].style.display="",o[1].style.display="none",t.reliableHiddenOffsets=p&&0===o[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",x.swap(l,null!=l.style.zoom?{zoom:1}:{},function(){t.boxSizing=4===d.offsetWidth}),e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(d,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(d,null)||{width:"4px"}).width,r=d.appendChild(a.createElement("div")),r.style.cssText=d.style.cssText=s,r.style.marginRight=r.style.width="0",d.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),typeof d.style.zoom!==i&&(d.innerHTML="",d.style.cssText=s+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.innerHTML="<div></div>",d.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==d.offsetWidth,t.inlineBlockNeedsLayout&&(l.style.zoom=1)),l.removeChild(n),n=d=o=r=null)}),n=s=l=u=r=o=null,t}({});var B=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,P=/([A-Z])/g;x.extend({cache:{},noData:{applet:!0,embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return e=e.nodeType?x.cache[e[x.expando]]:e[x.expando],!!e&&!I(e)},data:function(e,t,n){return R(e,t,n)},removeData:function(e,t){return W(e,t)},_data:function(e,t,n){return R(e,t,n,!0)},_removeData:function(e,t){return W(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&x.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),x.fn.extend({data:function(e,n){var r,i,o=null,a=0,s=this[0];if(e===t){if(this.length&&(o=x.data(s),1===s.nodeType&&!x._data(s,"parsedAttrs"))){for(r=s.attributes;r.length>a;a++)i=r[a].name,0===i.indexOf("data-")&&(i=x.camelCase(i.slice(5)),$(s,i,o[i]));x._data(s,"parsedAttrs",!0)}return o}return"object"==typeof e?this.each(function(){x.data(this,e)}):arguments.length>1?this.each(function(){x.data(this,e,n)}):s?$(s,e,x.data(s,e)):null},removeData:function(e){return this.each(function(){x.removeData(this,e)})}}),x.extend({queue:function(e,n,r){var i;return e?(n=(n||"fx")+"queue",i=x._data(e,n),r&&(!i||x.isArray(r)?i=x._data(e,n,x.makeArray(r)):i.push(r)),i||[]):t},dequeue:function(e,t){t=t||"fx";var n=x.queue(e,t),r=n.length,i=n.shift(),o=x._queueHooks(e,t),a=function(){x.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,a,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return x._data(e,n)||x._data(e,n,{empty:x.Callbacks("once memory").add(function(){x._removeData(e,t+"queue"),x._removeData(e,n)})})}}),x.fn.extend({queue:function(e,n){var r=2;return"string"!=typeof e&&(n=e,e="fx",r--),r>arguments.length?x.queue(this[0],e):n===t?this:this.each(function(){var t=x.queue(this,e,n);x._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&x.dequeue(this,e)})},dequeue:function(e){return this.each(function(){x.dequeue(this,e)})},delay:function(e,t){return e=x.fx?x.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,o=x.Deferred(),a=this,s=this.length,l=function(){--i||o.resolveWith(a,[a])};for("string"!=typeof e&&(n=e,e=t),e=e||"fx";s--;)r=x._data(a[s],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(l));return l(),o.promise(n)}});var z,X,U=/[\t\r\n\f]/g,V=/\r/g,Y=/^(?:input|select|textarea|button|object)$/i,J=/^(?:a|area)$/i,G=/^(?:checked|selected)$/i,Q=x.support.getSetAttribute,K=x.support.input;x.fn.extend({attr:function(e,t){return x.access(this,x.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){x.removeAttr(this,e)})},prop:function(e,t){return x.access(this,x.prop,e,t,arguments.length>1)},removeProp:function(e){return e=x.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,o,a=0,s=this.length,l="string"==typeof e&&e;if(x.isFunction(e))return this.each(function(t){x(this).addClass(e.call(this,t,this.className))});if(l)for(t=(e||"").match(T)||[];s>a;a++)if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(U," "):" ")){for(o=0;i=t[o++];)0>r.indexOf(" "+i+" ")&&(r+=i+" ");n.className=x.trim(r)}return this},removeClass:function(e){var t,n,r,i,o,a=0,s=this.length,l=0===arguments.length||"string"==typeof e&&e;if(x.isFunction(e))return this.each(function(t){x(this).removeClass(e.call(this,t,this.className))});if(l)for(t=(e||"").match(T)||[];s>a;a++)if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(U," "):"")){for(o=0;i=t[o++];)for(;r.indexOf(" "+i+" ")>=0;)r=r.replace(" "+i+" "," ");n.className=e?x.trim(r):""}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):this.each(x.isFunction(e)?function(n){x(this).toggleClass(e.call(this,n,this.className,t),t)}:function(){if("string"===n)for(var t,r=0,o=x(this),a=e.match(T)||[];t=a[r++];)o.hasClass(t)?o.removeClass(t):o.addClass(t);else(n===i||"boolean"===n)&&(this.className&&x._data(this,"__className__",this.className),this.className=this.className||e===!1?"":x._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,r=this.length;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(U," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,o=this[0];return arguments.length?(i=x.isFunction(e),this.each(function(n){var o;1===this.nodeType&&(o=i?e.call(this,n,x(this).val()):e,null==o?o="":"number"==typeof o?o+="":x.isArray(o)&&(o=x.map(o,function(e){return null==e?"":e+""})),r=x.valHooks[this.type]||x.valHooks[this.nodeName.toLowerCase()],r&&"set"in r&&r.set(this,o,"value")!==t||(this.value=o))})):o?(r=x.valHooks[o.type]||x.valHooks[o.nodeName.toLowerCase()],r&&"get"in r&&(n=r.get(o,"value"))!==t?n:(n=o.value,"string"==typeof n?n.replace(V,""):null==n?"":n)):void 0}}),x.extend({valHooks:{option:{get:function(e){var t=x.find.attr(e,"value");return null!=t?t:e.text}},select:{get:function(e){for(var t,n,r=e.options,i=e.selectedIndex,o="select-one"===e.type||0>i,a=o?null:[],s=o?i+1:r.length,l=0>i?s:o?i:0;s>l;l++)if(n=r[l],!(!n.selected&&l!==i||(x.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&x.nodeName(n.parentNode,"optgroup"))){if(t=x(n).val(),o)return t;a.push(t)}return a},set:function(e,t){for(var n,r,i=e.options,o=x.makeArray(t),a=i.length;a--;)r=i[a],(r.selected=x.inArray(x(r).val(),o)>=0)&&(n=!0);return n||(e.selectedIndex=-1),o}}},attr:function(e,n,r){var o,a,s=e.nodeType;return e&&3!==s&&8!==s&&2!==s?typeof e.getAttribute===i?x.prop(e,n,r):(1===s&&x.isXMLDoc(e)||(n=n.toLowerCase(),o=x.attrHooks[n]||(x.expr.match.bool.test(n)?X:z)),r===t?o&&"get"in o&&null!==(a=o.get(e,n))?a:(a=x.find.attr(e,n),null==a?t:a):null!==r?o&&"set"in o&&(a=o.set(e,r,n))!==t?a:(e.setAttribute(n,r+""),r):(x.removeAttr(e,n),t)):void 0},removeAttr:function(e,t){var n,r,i=0,o=t&&t.match(T);if(o&&1===e.nodeType)for(;n=o[i++];)r=x.propFix[n]||n,x.expr.match.bool.test(n)?K&&Q||!G.test(n)?e[r]=!1:e[x.camelCase("default-"+n)]=e[r]=!1:x.attr(e,n,""),e.removeAttribute(Q?n:r)},attrHooks:{type:{set:function(e,t){if(!x.support.radioValue&&"radio"===t&&x.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(e,n,r){var i,o,a,s=e.nodeType;return e&&3!==s&&8!==s&&2!==s?(a=1!==s||!x.isXMLDoc(e),a&&(n=x.propFix[n]||n,o=x.propHooks[n]),r!==t?o&&"set"in o&&(i=o.set(e,r,n))!==t?i:e[n]=r:o&&"get"in o&&null!==(i=o.get(e,n))?i:e[n]):void 0},propHooks:{tabIndex:{get:function(e){var t=x.find.attr(e,"tabindex");return t?parseInt(t,10):Y.test(e.nodeName)||J.test(e.nodeName)&&e.href?0:-1}}}}),X={set:function(e,t,n){return t===!1?x.removeAttr(e,n):K&&Q||!G.test(n)?e.setAttribute(!Q&&x.propFix[n]||n,n):e[x.camelCase("default-"+n)]=e[n]=!0,n}},x.each(x.expr.match.bool.source.match(/\w+/g),function(e,n){var r=x.expr.attrHandle[n]||x.find.attr;x.expr.attrHandle[n]=K&&Q||!G.test(n)?function(e,n,i){var o=x.expr.attrHandle[n],a=i?t:(x.expr.attrHandle[n]=t)!=r(e,n,i)?n.toLowerCase():null;return x.expr.attrHandle[n]=o,a}:function(e,n,r){return r?t:e[x.camelCase("default-"+n)]?n.toLowerCase():null}}),K&&Q||(x.attrHooks.value={set:function(e,n,r){return x.nodeName(e,"input")?(e.defaultValue=n,t):z&&z.set(e,n,r)}}),Q||(z={set:function(e,n,r){var i=e.getAttributeNode(r);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r)),i.value=n+="","value"===r||n===e.getAttribute(r)?n:t}},x.expr.attrHandle.id=x.expr.attrHandle.name=x.expr.attrHandle.coords=function(e,n,r){var i;return r?t:(i=e.getAttributeNode(n))&&""!==i.value?i.value:null},x.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&r.specified?r.value:t},set:z.set},x.attrHooks.contenteditable={set:function(e,t,n){z.set(e,""===t?!1:t,n)}},x.each(["width","height"],function(e,n){x.attrHooks[n]={set:function(e,r){return""===r?(e.setAttribute(n,"auto"),r):t}}})),x.support.hrefNormalized||x.each(["href","src"],function(e,t){x.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),x.support.style||(x.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),x.support.optSelected||(x.propHooks.selected={get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}),x.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){x.propFix[this.toLowerCase()]=this}),x.support.enctype||(x.propFix.enctype="encoding"),x.each(["radio","checkbox"],function(){x.valHooks[this]={set:function(e,n){return x.isArray(n)?e.checked=x.inArray(x(e).val(),n)>=0:t}},x.support.checkOn||(x.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Z=/^(?:input|select|textarea)$/i,et=/^key/,tt=/^(?:mouse|contextmenu)|click/,nt=/^(?:focusinfocus|focusoutblur)$/,rt=/^([^.]*)(?:\.(.+)|)$/;x.event={global:{},add:function(e,n,r,o,a){var s,l,u,c,p,f,d,h,g,m,y,v=x._data(e);if(v){for(r.handler&&(c=r,r=c.handler,a=c.selector),r.guid||(r.guid=x.guid++),(l=v.events)||(l=v.events={}),(f=v.handle)||(f=v.handle=function(e){return typeof x===i||e&&x.event.triggered===e.type?t:x.event.dispatch.apply(f.elem,arguments)},f.elem=e),n=(n||"").match(T)||[""],u=n.length;u--;)s=rt.exec(n[u])||[],g=y=s[1],m=(s[2]||"").split(".").sort(),g&&(p=x.event.special[g]||{},g=(a?p.delegateType:p.bindType)||g,p=x.event.special[g]||{},d=x.extend({type:g,origType:y,data:o,handler:r,guid:r.guid,selector:a,needsContext:a&&x.expr.match.needsContext.test(a),namespace:m.join(".")},c),(h=l[g])||(h=l[g]=[],h.delegateCount=0,p.setup&&p.setup.call(e,o,m,f)!==!1||(e.addEventListener?e.addEventListener(g,f,!1):e.attachEvent&&e.attachEvent("on"+g,f))),p.add&&(p.add.call(e,d),d.handler.guid||(d.handler.guid=r.guid)),a?h.splice(h.delegateCount++,0,d):h.push(d),x.event.global[g]=!0);e=null}},remove:function(e,t,n,r,i){var o,a,s,l,u,c,p,f,d,h,g,m=x.hasData(e)&&x._data(e);if(m&&(c=m.events)){for(t=(t||"").match(T)||[""],u=t.length;u--;)if(s=rt.exec(t[u])||[],d=g=s[1],h=(s[2]||"").split(".").sort(),d){for(p=x.event.special[d]||{},d=(r?p.delegateType:p.bindType)||d,f=c[d]||[],s=s[2]&&RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),l=o=f.length;o--;)a=f[o],!i&&g!==a.origType||n&&n.guid!==a.guid||s&&!s.test(a.namespace)||r&&r!==a.selector&&("**"!==r||!a.selector)||(f.splice(o,1),a.selector&&f.delegateCount--,p.remove&&p.remove.call(e,a));l&&!f.length&&(p.teardown&&p.teardown.call(e,h,m.handle)!==!1||x.removeEvent(e,d,m.handle),delete c[d])}else for(d in c)x.event.remove(e,d+t[u],n,r,!0);x.isEmptyObject(c)&&(delete m.handle,x._removeData(e,"events"))}},trigger:function(n,r,i,o){var s,l,u,c,p,f,d,h=[i||a],g=v.call(n,"type")?n.type:n,m=v.call(n,"namespace")?n.namespace.split("."):[];if(u=f=i=i||a,3!==i.nodeType&&8!==i.nodeType&&!nt.test(g+x.event.triggered)&&(g.indexOf(".")>=0&&(m=g.split("."),g=m.shift(),m.sort()),l=0>g.indexOf(":")&&"on"+g,n=n[x.expando]?n:new x.Event(g,"object"==typeof n&&n),n.isTrigger=o?2:3,n.namespace=m.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=i),r=null==r?[n]:x.makeArray(r,[n]),p=x.event.special[g]||{},o||!p.trigger||p.trigger.apply(i,r)!==!1)){if(!o&&!p.noBubble&&!x.isWindow(i)){for(c=p.delegateType||g,nt.test(c+g)||(u=u.parentNode);u;u=u.parentNode)h.push(u),f=u;f===(i.ownerDocument||a)&&h.push(f.defaultView||f.parentWindow||e)}for(d=0;(u=h[d++])&&!n.isPropagationStopped();)n.type=d>1?c:p.bindType||g,s=(x._data(u,"events")||{})[n.type]&&x._data(u,"handle"),s&&s.apply(u,r),s=l&&u[l],s&&x.acceptData(u)&&s.apply&&s.apply(u,r)===!1&&n.preventDefault();if(n.type=g,!o&&!n.isDefaultPrevented()&&(!p._default||p._default.apply(h.pop(),r)===!1)&&x.acceptData(i)&&l&&i[g]&&!x.isWindow(i)){f=i[l],f&&(i[l]=null),x.event.triggered=g;try{i[g]()}catch(y){}x.event.triggered=t,f&&(i[l]=f)}return n.result}},dispatch:function(e){e=x.event.fix(e);var n,r,i,o,a,s=[],l=g.call(arguments),u=(x._data(this,"events")||{})[e.type]||[],c=x.event.special[e.type]||{};if(l[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){for(s=x.event.handlers.call(this,e,u),n=0;(o=s[n++])&&!e.isPropagationStopped();)for(e.currentTarget=o.elem,a=0;(i=o.handlers[a++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,r=((x.event.special[i.origType]||{}).handle||i.handler).apply(o.elem,l),r!==t&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,n){var r,i,o,a,s=[],l=n.delegateCount,u=e.target;if(l&&u.nodeType&&(!e.button||"click"!==e.type))for(;u!=this;u=u.parentNode||this)if(1===u.nodeType&&(u.disabled!==!0||"click"!==e.type)){for(o=[],a=0;l>a;a++)i=n[a],r=i.selector+" ",o[r]===t&&(o[r]=i.needsContext?x(r,this).index(u)>=0:x.find(r,this,null,[u]).length),o[r]&&o.push(i);o.length&&s.push({elem:u,handlers:o})}return n.length>l&&s.push({elem:this,handlers:n.slice(l)}),s},fix:function(e){if(e[x.expando])return e;var t,n,r,i=e.type,o=e,s=this.fixHooks[i];for(s||(this.fixHooks[i]=s=tt.test(i)?this.mouseHooks:et.test(i)?this.keyHooks:{}),r=s.props?this.props.concat(s.props):this.props,e=new x.Event(o),t=r.length;t--;)n=r[t],e[n]=o[n];return e.target||(e.target=o.srcElement||a),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,o):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,o,s=n.button,l=n.fromElement;return null==e.pageX&&null!=n.clientX&&(i=e.target.ownerDocument||a,o=i.documentElement,r=i.body,e.pageX=n.clientX+(o&&o.scrollLeft||r&&r.scrollLeft||0)-(o&&o.clientLeft||r&&r.clientLeft||0),e.pageY=n.clientY+(o&&o.scrollTop||r&&r.scrollTop||0)-(o&&o.clientTop||r&&r.clientTop||0)),!e.relatedTarget&&l&&(e.relatedTarget=l===e.target?n.toElement:l),e.which||s===t||(e.which=1&s?1:2&s?3:4&s?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==at()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===at()&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},click:{trigger:function(){return x.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t
},_default:function(e){return x.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=x.extend(new x.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?x.event.trigger(i,null,t):x.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},x.removeEvent=a.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===i&&(e[r]=null),e.detachEvent(r,n))},x.Event=function(e,n){return this instanceof x.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?it:ot):this.type=e,n&&x.extend(this,n),this.timeStamp=e&&e.timeStamp||x.now(),this[x.expando]=!0,t):new x.Event(e,n)},x.Event.prototype={isDefaultPrevented:ot,isPropagationStopped:ot,isImmediatePropagationStopped:ot,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=it,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=it,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=it,this.stopPropagation()}},x.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){x.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;return(!i||i!==r&&!x.contains(r,i))&&(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),x.support.submitBubbles||(x.event.special.submit={setup:function(){return x.nodeName(this,"form")?!1:(x.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=x.nodeName(n,"input")||x.nodeName(n,"button")?n.form:t;r&&!x._data(r,"submitBubbles")&&(x.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),x._data(r,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&x.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return x.nodeName(this,"form")?!1:(x.event.remove(this,"._submit"),t)}}),x.support.changeBubbles||(x.event.special.change={setup:function(){return Z.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(x.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),x.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),x.event.simulate("change",this,e,!0)})),!1):(x.event.add(this,"beforeactivate._change",function(e){var t=e.target;Z.test(t.nodeName)&&!x._data(t,"changeBubbles")&&(x.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||x.event.simulate("change",this.parentNode,e,!0)}),x._data(t,"changeBubbles",!0))}),t)},handle:function(e){var n=e.target;return this!==n||e.isSimulated||e.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return x.event.remove(this,"._change"),!Z.test(this.nodeName)}}),x.support.focusinBubbles||x.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){x.event.simulate(t,e.target,x.event.fix(e),!0)};x.event.special[t]={setup:function(){0===n++&&a.addEventListener(e,r,!0)},teardown:function(){0===--n&&a.removeEventListener(e,r,!0)}}}),x.fn.extend({on:function(e,n,r,i,o){var a,s;if("object"==typeof e){"string"!=typeof n&&(r=r||n,n=t);for(a in e)this.on(a,n,r,e[a],o);return this}if(null==r&&null==i?(i=n,r=n=t):null==i&&("string"==typeof n?(i=r,r=t):(i=r,r=n,n=t)),i===!1)i=ot;else if(!i)return this;return 1===o&&(s=i,i=function(e){return x().off(e),s.apply(this,arguments)},i.guid=s.guid||(s.guid=x.guid++)),this.each(function(){x.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,o;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,x(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(o in e)this.off(o,n,e[o]);return this}return(n===!1||"function"==typeof n)&&(r=n,n=t),r===!1&&(r=ot),this.each(function(){x.event.remove(this,e,r,n)})},trigger:function(e,t){return this.each(function(){x.event.trigger(e,t,this)})},triggerHandler:function(e,n){var r=this[0];return r?x.event.trigger(e,n,r,!0):t}});var st=/^.[^:#\[\.,]*$/,lt=/^(?:parents|prev(?:Until|All))/,ut=x.expr.match.needsContext,ct={children:!0,contents:!0,next:!0,prev:!0};x.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if("string"!=typeof e)return this.pushStack(x(e).filter(function(){for(t=0;i>t;t++)if(x.contains(r[t],this))return!0}));for(t=0;i>t;t++)x.find(e,r[t],n);return n=this.pushStack(i>1?x.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},has:function(e){var t,n=x(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++)if(x.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ft(this,e||[],!0))},filter:function(e){return this.pushStack(ft(this,e||[],!1))},is:function(e){return!!ft(this,"string"==typeof e&&ut.test(e)?x(e):e||[],!1).length},closest:function(e,t){for(var n,r=0,i=this.length,o=[],a=ut.test(e)||"string"!=typeof e?x(e,t||this.context):0;i>r;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(11>n.nodeType&&(a?a.index(n)>-1:1===n.nodeType&&x.find.matchesSelector(n,e))){n=o.push(n);break}return this.pushStack(o.length>1?x.unique(o):o)},index:function(e){return e?"string"==typeof e?x.inArray(this[0],x(e)):x.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?x(e,t):x.makeArray(e&&e.nodeType?[e]:e),r=x.merge(this.get(),n);return this.pushStack(x.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),x.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return x.dir(e,"parentNode")},parentsUntil:function(e,t,n){return x.dir(e,"parentNode",n)},next:function(e){return pt(e,"nextSibling")},prev:function(e){return pt(e,"previousSibling")},nextAll:function(e){return x.dir(e,"nextSibling")},prevAll:function(e){return x.dir(e,"previousSibling")},nextUntil:function(e,t,n){return x.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return x.dir(e,"previousSibling",n)},siblings:function(e){return x.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return x.sibling(e.firstChild)},contents:function(e){return x.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:x.merge([],e.childNodes)}},function(e,t){x.fn[e]=function(n,r){var i=x.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=x.filter(r,i)),this.length>1&&(ct[e]||(i=x.unique(i)),lt.test(e)&&(i=i.reverse())),this.pushStack(i)}}),x.extend({filter:function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?x.find.matchesSelector(r,e)?[r]:[]:x.find.matches(e,x.grep(t,function(e){return 1===e.nodeType}))},dir:function(e,n,r){for(var i=[],o=e[n];o&&9!==o.nodeType&&(r===t||1!==o.nodeType||!x(o).is(r));)1===o.nodeType&&i.push(o),o=o[n];return i},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});var ht="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",gt=/ jQuery\d+="(?:null|\d+)"/g,mt=RegExp("<(?:"+ht+")[\\s/>]","i"),yt=/^\s+/,vt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bt=/<([\w:]+)/,xt=/<tbody/i,wt=/<|&#?\w+;/,Tt=/<(?:script|style|link)/i,Ct=/^(?:checkbox|radio)$/i,Nt=/checked\s*(?:[^=]|=\s*.checked.)/i,kt=/^$|\/(?:java|ecma)script/i,Et=/^true\/(.*)/,St=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,At={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:x.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},jt=dt(a),Dt=jt.appendChild(a.createElement("div"));At.optgroup=At.option,At.tbody=At.tfoot=At.colgroup=At.caption=At.thead,At.th=At.td,x.fn.extend({text:function(e){return x.access(this,function(e){return e===t?x.text(this):this.empty().append((this[0]&&this[0].ownerDocument||a).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Lt(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Lt(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,r=e?x.filter(e,this):this,i=0;null!=(n=r[i]);i++)t||1!==n.nodeType||x.cleanData(Ft(n)),n.parentNode&&(t&&x.contains(n.ownerDocument,n)&&_t(Ft(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){for(1===e.nodeType&&x.cleanData(Ft(e,!1));e.firstChild;)e.removeChild(e.firstChild);e.options&&x.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return x.clone(this,e,t)})},html:function(e){return x.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return 1===n.nodeType?n.innerHTML.replace(gt,""):t;if(!("string"!=typeof e||Tt.test(e)||!x.support.htmlSerialize&&mt.test(e)||!x.support.leadingWhitespace&&yt.test(e)||At[(bt.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(vt,"<$1></$2>");try{for(;i>r;r++)n=this[r]||{},1===n.nodeType&&(x.cleanData(Ft(n,!1)),n.innerHTML=e);n=0}catch(o){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=x.map(this,function(e){return[e.nextSibling,e.parentNode]}),t=0;return this.domManip(arguments,function(n){var r=e[t++],i=e[t++];i&&(r&&r.parentNode!==i&&(r=this.nextSibling),x(this).remove(),i.insertBefore(n,r))},!0),t?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t,n){e=d.apply([],e);var r,i,o,a,s,l,u=0,c=this.length,p=this,f=c-1,h=e[0],g=x.isFunction(h);if(g||!(1>=c||"string"!=typeof h||x.support.checkClone)&&Nt.test(h))return this.each(function(r){var i=p.eq(r);g&&(e[0]=h.call(this,r,i.html())),i.domManip(e,t,n)});if(c&&(l=x.buildFragment(e,this[0].ownerDocument,!1,!n&&this),r=l.firstChild,1===l.childNodes.length&&(l=r),r)){for(a=x.map(Ft(l,"script"),Ht),o=a.length;c>u;u++)i=l,u!==f&&(i=x.clone(i,!0,!0),o&&x.merge(a,Ft(i,"script"))),t.call(this[u],i,u);if(o)for(s=a[a.length-1].ownerDocument,x.map(a,qt),u=0;o>u;u++)i=a[u],kt.test(i.type||"")&&!x._data(i,"globalEval")&&x.contains(s,i)&&(i.src?x._evalUrl(i.src):x.globalEval((i.text||i.textContent||i.innerHTML||"").replace(St,"")));l=r=null}return this}}),x.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){x.fn[e]=function(e){for(var n,r=0,i=[],o=x(e),a=o.length-1;a>=r;r++)n=r===a?this:this.clone(!0),x(o[r])[t](n),h.apply(i,n.get());return this.pushStack(i)}}),x.extend({clone:function(e,t,n){var r,i,o,a,s,l=x.contains(e.ownerDocument,e);if(x.support.html5Clone||x.isXMLDoc(e)||!mt.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(Dt.innerHTML=e.outerHTML,Dt.removeChild(o=Dt.firstChild)),!(x.support.noCloneEvent&&x.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||x.isXMLDoc(e)))for(r=Ft(o),s=Ft(e),a=0;null!=(i=s[a]);++a)r[a]&&Ot(i,r[a]);if(t)if(n)for(s=s||Ft(e),r=r||Ft(o),a=0;null!=(i=s[a]);a++)Mt(i,r[a]);else Mt(e,o);return r=Ft(o,"script"),r.length>0&&_t(r,!l&&Ft(e,"script")),r=s=i=null,o},buildFragment:function(e,t,n,r){for(var i,o,a,s,l,u,c,p=e.length,f=dt(t),d=[],h=0;p>h;h++)if(o=e[h],o||0===o)if("object"===x.type(o))x.merge(d,o.nodeType?[o]:o);else if(wt.test(o)){for(s=s||f.appendChild(t.createElement("div")),l=(bt.exec(o)||["",""])[1].toLowerCase(),c=At[l]||At._default,s.innerHTML=c[1]+o.replace(vt,"<$1></$2>")+c[2],i=c[0];i--;)s=s.lastChild;if(!x.support.leadingWhitespace&&yt.test(o)&&d.push(t.createTextNode(yt.exec(o)[0])),!x.support.tbody)for(o="table"!==l||xt.test(o)?"<table>"!==c[1]||xt.test(o)?0:s:s.firstChild,i=o&&o.childNodes.length;i--;)x.nodeName(u=o.childNodes[i],"tbody")&&!u.childNodes.length&&o.removeChild(u);for(x.merge(d,s.childNodes),s.textContent="";s.firstChild;)s.removeChild(s.firstChild);s=f.lastChild}else d.push(t.createTextNode(o));for(s&&f.removeChild(s),x.support.appendChecked||x.grep(Ft(d,"input"),Bt),h=0;o=d[h++];)if((!r||-1===x.inArray(o,r))&&(a=x.contains(o.ownerDocument,o),s=Ft(f.appendChild(o),"script"),a&&_t(s),n))for(i=0;o=s[i++];)kt.test(o.type||"")&&n.push(o);return s=null,f},cleanData:function(e,t){for(var n,r,o,a,s=0,l=x.expando,u=x.cache,c=x.support.deleteExpando,f=x.event.special;null!=(n=e[s]);s++)if((t||x.acceptData(n))&&(o=n[l],a=o&&u[o])){if(a.events)for(r in a.events)f[r]?x.event.remove(n,r):x.removeEvent(n,r,a.handle);u[o]&&(delete u[o],c?delete n[l]:typeof n.removeAttribute!==i?n.removeAttribute(l):n[l]=null,p.push(o))}},_evalUrl:function(e){return x.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}}),x.fn.extend({wrapAll:function(e){if(x.isFunction(e))return this.each(function(t){x(this).wrapAll(e.call(this,t))});if(this[0]){var t=x(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return this.each(x.isFunction(e)?function(t){x(this).wrapInner(e.call(this,t))}:function(){var t=x(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=x.isFunction(e);return this.each(function(n){x(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){x.nodeName(this,"body")||x(this).replaceWith(this.childNodes)}).end()}});var Pt,Rt,Wt,$t=/alpha\([^)]*\)/i,It=/opacity\s*=\s*([^)]*)/,zt=/^(top|right|bottom|left)$/,Xt=/^(none|table(?!-c[ea]).+)/,Ut=/^margin/,Vt=RegExp("^("+w+")(.*)$","i"),Yt=RegExp("^("+w+")(?!px)[a-z%]+$","i"),Jt=RegExp("^([+-])=("+w+")","i"),Gt={BODY:"block"},Qt={position:"absolute",visibility:"hidden",display:"block"},Kt={letterSpacing:0,fontWeight:400},Zt=["Top","Right","Bottom","Left"],en=["Webkit","O","Moz","ms"];x.fn.extend({css:function(e,n){return x.access(this,function(e,n,r){var i,o,a={},s=0;if(x.isArray(n)){for(o=Rt(e),i=n.length;i>s;s++)a[n[s]]=x.css(e,n[s],!1,o);return a}return r!==t?x.style(e,n,r):x.css(e,n)},e,n,arguments.length>1)},show:function(){return rn(this,!0)},hide:function(){return rn(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){nn(this)?x(this).show():x(this).hide()})}}),x.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Wt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":x.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,a,s,l=x.camelCase(n),u=e.style;if(n=x.cssProps[l]||(x.cssProps[l]=tn(u,l)),s=x.cssHooks[n]||x.cssHooks[l],r===t)return s&&"get"in s&&(o=s.get(e,!1,i))!==t?o:u[n];if(a=typeof r,"string"===a&&(o=Jt.exec(r))&&(r=(o[1]+1)*o[2]+parseFloat(x.css(e,n)),a="number"),!(null==r||"number"===a&&isNaN(r)||("number"!==a||x.cssNumber[l]||(r+="px"),x.support.clearCloneStyle||""!==r||0!==n.indexOf("background")||(u[n]="inherit"),s&&"set"in s&&(r=s.set(e,r,i))===t)))try{u[n]=r}catch(c){}}},css:function(e,n,r,i){var o,a,s,l=x.camelCase(n);return n=x.cssProps[l]||(x.cssProps[l]=tn(e.style,l)),s=x.cssHooks[n]||x.cssHooks[l],s&&"get"in s&&(a=s.get(e,!0,r)),a===t&&(a=Wt(e,n,i)),"normal"===a&&n in Kt&&(a=Kt[n]),""===r||r?(o=parseFloat(a),r===!0||x.isNumeric(o)?o||0:a):a}}),e.getComputedStyle?(Rt=function(t){return e.getComputedStyle(t,null)},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),l=s?s.getPropertyValue(n)||s[n]:t,u=e.style;return s&&(""!==l||x.contains(e.ownerDocument,e)||(l=x.style(e,n)),Yt.test(l)&&Ut.test(n)&&(i=u.width,o=u.minWidth,a=u.maxWidth,u.minWidth=u.maxWidth=u.width=l,l=s.width,u.width=i,u.minWidth=o,u.maxWidth=a)),l}):a.documentElement.currentStyle&&(Rt=function(e){return e.currentStyle},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),l=s?s[n]:t,u=e.style;return null==l&&u&&u[n]&&(l=u[n]),Yt.test(l)&&!zt.test(n)&&(i=u.left,o=e.runtimeStyle,a=o&&o.left,a&&(o.left=e.currentStyle.left),u.left="fontSize"===n?"1em":l,l=u.pixelLeft+"px",u.left=i,a&&(o.left=a)),""===l?"auto":l}),x.each(["height","width"],function(e,n){x.cssHooks[n]={get:function(e,r,i){return r?0===e.offsetWidth&&Xt.test(x.css(e,"display"))?x.swap(e,Qt,function(){return sn(e,n,i)}):sn(e,n,i):t},set:function(e,t,r){var i=r&&Rt(e);return on(e,t,r?an(e,n,r,x.support.boxSizing&&"border-box"===x.css(e,"boxSizing",!1,i),i):0)}}}),x.support.opacity||(x.cssHooks.opacity={get:function(e,t){return It.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=x.isNumeric(t)?"alpha(opacity="+100*t+")":"",o=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===x.trim(o.replace($t,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=$t.test(o)?o.replace($t,i):o+" "+i)}}),x(function(){x.support.reliableMarginRight||(x.cssHooks.marginRight={get:function(e,n){return n?x.swap(e,{display:"inline-block"},Wt,[e,"marginRight"]):t}}),!x.support.pixelPosition&&x.fn.position&&x.each(["top","left"],function(e,n){x.cssHooks[n]={get:function(e,r){return r?(r=Wt(e,n),Yt.test(r)?x(e).position()[n]+"px":r):t}}})}),x.expr&&x.expr.filters&&(x.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight||!x.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||x.css(e,"display"))},x.expr.filters.visible=function(e){return!x.expr.filters.hidden(e)}),x.each({margin:"",padding:"",border:"Width"},function(e,t){x.cssHooks[e+t]={expand:function(n){for(var r=0,i={},o="string"==typeof n?n.split(" "):[n];4>r;r++)i[e+Zt[r]+t]=o[r]||o[r-2]||o[0];return i}},Ut.test(e)||(x.cssHooks[e+t].set=on)});var cn=/%20/g,pn=/\[\]$/,fn=/\r?\n/g,dn=/^(?:submit|button|image|reset|file)$/i,hn=/^(?:input|select|textarea|keygen)/i;x.fn.extend({serialize:function(){return x.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=x.prop(this,"elements");return e?x.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!x(this).is(":disabled")&&hn.test(this.nodeName)&&!dn.test(e)&&(this.checked||!Ct.test(e))}).map(function(e,t){var n=x(this).val();return null==n?null:x.isArray(n)?x.map(n,function(e){return{name:t.name,value:e.replace(fn,"\r\n")}}):{name:t.name,value:n.replace(fn,"\r\n")}}).get()}}),x.param=function(e,n){var r,i=[],o=function(e,t){t=x.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=x.ajaxSettings&&x.ajaxSettings.traditional),x.isArray(e)||e.jquery&&!x.isPlainObject(e))x.each(e,function(){o(this.name,this.value)});else for(r in e)gn(r,e[r],n,o);return i.join("&").replace(cn,"+")},x.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){x.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),x.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var mn,yn,vn=x.now(),bn=/\?/,xn=/#.*$/,wn=/([?&])_=[^&]*/,Tn=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Cn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Nn=/^(?:GET|HEAD)$/,kn=/^\/\//,En=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Sn=x.fn.load,An={},jn={},Dn="*/".concat("*");try{yn=o.href}catch(Ln){yn=a.createElement("a"),yn.href="",yn=yn.href}mn=En.exec(yn.toLowerCase())||[],x.fn.load=function(e,n,r){if("string"!=typeof e&&Sn)return Sn.apply(this,arguments);var i,o,a,s=this,l=e.indexOf(" ");return l>=0&&(i=e.slice(l,e.length),e=e.slice(0,l)),x.isFunction(n)?(r=n,n=t):n&&"object"==typeof n&&(a="POST"),s.length>0&&x.ajax({url:e,type:a,dataType:"html",data:n}).done(function(e){o=arguments,s.html(i?x("<div>").append(x.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){s.each(r,o||[e.responseText,t,e])}),this},x.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){x.fn[t]=function(e){return this.on(t,e)}}),x.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:yn,type:"GET",isLocal:Cn.test(mn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Dn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":x.parseJSON,"text xml":x.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?_n(_n(e,x.ajaxSettings),t):_n(x.ajaxSettings,e)},ajaxPrefilter:Hn(An),ajaxTransport:Hn(jn),ajax:function(e,n){function k(e,n,r,i){var c,y,v,w,T,N=n;2!==b&&(b=2,s&&clearTimeout(s),u=t,a=i||"",C.readyState=e>0?4:0,c=e>=200&&300>e||304===e,r&&(w=Mn(p,C,r)),w=On(p,w,C,c),c?(p.ifModified&&(T=C.getResponseHeader("Last-Modified"),T&&(x.lastModified[o]=T),T=C.getResponseHeader("etag"),T&&(x.etag[o]=T)),204===e||"HEAD"===p.type?N="nocontent":304===e?N="notmodified":(N=w.state,y=w.data,v=w.error,c=!v)):(v=N,(e||!N)&&(N="error",0>e&&(e=0))),C.status=e,C.statusText=(n||N)+"",c?h.resolveWith(f,[y,N,C]):h.rejectWith(f,[C,N,v]),C.statusCode(m),m=t,l&&d.trigger(c?"ajaxSuccess":"ajaxError",[C,p,c?y:v]),g.fireWith(f,[C,N]),l&&(d.trigger("ajaxComplete",[C,p]),--x.active||x.event.trigger("ajaxStop")))}"object"==typeof e&&(n=e,e=t),n=n||{};var r,i,o,a,s,l,u,c,p=x.ajaxSetup({},n),f=p.context||p,d=p.context&&(f.nodeType||f.jquery)?x(f):x.event,h=x.Deferred(),g=x.Callbacks("once memory"),m=p.statusCode||{},y={},v={},b=0,w="canceled",C={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!c)for(c={};t=Tn.exec(a);)c[t[1].toLowerCase()]=t[2];t=c[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===b?a:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return b||(e=v[n]=v[n]||e,y[e]=t),this},overrideMimeType:function(e){return b||(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>b)for(t in e)m[t]=[m[t],e[t]];else C.always(e[C.status]);return this},abort:function(e){var t=e||w;return u&&u.abort(t),k(0,t),this}};if(h.promise(C).complete=g.add,C.success=C.done,C.error=C.fail,p.url=((e||p.url||yn)+"").replace(xn,"").replace(kn,mn[1]+"//"),p.type=n.method||n.type||p.method||p.type,p.dataTypes=x.trim(p.dataType||"*").toLowerCase().match(T)||[""],null==p.crossDomain&&(r=En.exec(p.url.toLowerCase()),p.crossDomain=!(!r||r[1]===mn[1]&&r[2]===mn[2]&&(r[3]||("http:"===r[1]?"80":"443"))===(mn[3]||("http:"===mn[1]?"80":"443")))),p.data&&p.processData&&"string"!=typeof p.data&&(p.data=x.param(p.data,p.traditional)),qn(An,p,n,C),2===b)return C;l=p.global,l&&0===x.active++&&x.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Nn.test(p.type),o=p.url,p.hasContent||(p.data&&(o=p.url+=(bn.test(o)?"&":"?")+p.data,delete p.data),p.cache===!1&&(p.url=wn.test(o)?o.replace(wn,"$1_="+vn++):o+(bn.test(o)?"&":"?")+"_="+vn++)),p.ifModified&&(x.lastModified[o]&&C.setRequestHeader("If-Modified-Since",x.lastModified[o]),x.etag[o]&&C.setRequestHeader("If-None-Match",x.etag[o])),(p.data&&p.hasContent&&p.contentType!==!1||n.contentType)&&C.setRequestHeader("Content-Type",p.contentType),C.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Dn+"; q=0.01":""):p.accepts["*"]);for(i in p.headers)C.setRequestHeader(i,p.headers[i]);if(p.beforeSend&&(p.beforeSend.call(f,C,p)===!1||2===b))return C.abort();w="abort";for(i in{success:1,error:1,complete:1})C[i](p[i]);if(u=qn(jn,p,n,C)){C.readyState=1,l&&d.trigger("ajaxSend",[C,p]),p.async&&p.timeout>0&&(s=setTimeout(function(){C.abort("timeout")},p.timeout));try{b=1,u.send(y,k)}catch(N){if(!(2>b))throw N;k(-1,N)}}else k(-1,"No Transport");return C},getJSON:function(e,t,n){return x.get(e,t,n,"json")},getScript:function(e,n){return x.get(e,t,n,"script")}}),x.each(["get","post"],function(e,n){x[n]=function(e,r,i,o){return x.isFunction(r)&&(o=o||i,i=r,r=t),x.ajax({url:e,type:n,dataType:o,data:r,success:i})}}),x.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return x.globalEval(e),e}}}),x.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),x.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=a.head||x("head")[0]||a.documentElement;return{send:function(t,i){n=a.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||i(200,"success"))},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var Fn=[],Bn=/(=)\?(?=&|$)|\?\?/;x.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Fn.pop()||x.expando+"_"+vn++;return this[e]=!0,e}}),x.ajaxPrefilter("json jsonp",function(n,r,i){var o,a,s,l=n.jsonp!==!1&&(Bn.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Bn.test(n.data)&&"data");return l||"jsonp"===n.dataTypes[0]?(o=n.jsonpCallback=x.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,l?n[l]=n[l].replace(Bn,"$1"+o):n.jsonp!==!1&&(n.url+=(bn.test(n.url)?"&":"?")+n.jsonp+"="+o),n.converters["script json"]=function(){return s||x.error(o+" was not called"),s[0]},n.dataTypes[0]="json",a=e[o],e[o]=function(){s=arguments},i.always(function(){e[o]=a,n[o]&&(n.jsonpCallback=r.jsonpCallback,Fn.push(o)),s&&x.isFunction(a)&&a(s[0]),s=a=t}),"script"):t});var Pn,Rn,Wn=0,$n=e.ActiveXObject&&function(){var e;for(e in Pn)Pn[e](t,!0)};x.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&In()||zn()}:In,Rn=x.ajaxSettings.xhr(),x.support.cors=!!Rn&&"withCredentials"in Rn,Rn=x.support.ajax=!!Rn,Rn&&x.ajaxTransport(function(n){if(!n.crossDomain||x.support.cors){var r;return{send:function(i,o){var a,s,l=n.xhr();if(n.username?l.open(n.type,n.url,n.async,n.username,n.password):l.open(n.type,n.url,n.async),n.xhrFields)for(s in n.xhrFields)l[s]=n.xhrFields[s];n.mimeType&&l.overrideMimeType&&l.overrideMimeType(n.mimeType),n.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");try{for(s in i)l.setRequestHeader(s,i[s])}catch(u){}l.send(n.hasContent&&n.data||null),r=function(e,i){var s,u,c,p;try{if(r&&(i||4===l.readyState))if(r=t,a&&(l.onreadystatechange=x.noop,$n&&delete Pn[a]),i)4!==l.readyState&&l.abort();else{p={},s=l.status,u=l.getAllResponseHeaders(),"string"==typeof l.responseText&&(p.text=l.responseText);try{c=l.statusText}catch(f){c=""}s||!n.isLocal||n.crossDomain?1223===s&&(s=204):s=p.text?200:404}}catch(d){i||o(-1,d)}p&&o(s,c,p,u)},n.async?4===l.readyState?setTimeout(r):(a=++Wn,$n&&(Pn||(Pn={},x(e).unload($n)),Pn[a]=r),l.onreadystatechange=r):r()},abort:function(){r&&r(t,!0)}}}});var Xn,Un,Vn=/^(?:toggle|show|hide)$/,Yn=RegExp("^(?:([+-])=|)("+w+")([a-z%]*)$","i"),Jn=/queueHooks$/,Gn=[nr],Qn={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=Yn.exec(t),o=i&&i[3]||(x.cssNumber[e]?"":"px"),a=(x.cssNumber[e]||"px"!==o&&+r)&&Yn.exec(x.css(n.elem,e)),s=1,l=20;if(a&&a[3]!==o){o=o||a[3],i=i||[],a=+r||1;do s=s||".5",a/=s,x.style(n.elem,e,a+o);while(s!==(s=n.cur()/r)&&1!==s&&--l)}return i&&(a=n.start=+a||+r||0,n.unit=o,n.end=i[1]?a+(i[1]+1)*i[2]:+i[2]),n}]};x.Animation=x.extend(er,{tweener:function(e,t){x.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var n,r=0,i=e.length;i>r;r++)n=e[r],Qn[n]=Qn[n]||[],Qn[n].unshift(t)},prefilter:function(e,t){t?Gn.unshift(e):Gn.push(e)}}),x.Tween=rr,rr.prototype={constructor:rr,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(x.cssNumber[n]?"":"px")},cur:function(){var e=rr.propHooks[this.prop];return e&&e.get?e.get(this):rr.propHooks._default.get(this)},run:function(e){var t,n=rr.propHooks[this.prop];return this.pos=t=this.options.duration?x.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):rr.propHooks._default.set(this),this}},rr.prototype.init.prototype=rr.prototype,rr.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=x.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){x.fx.step[e.prop]?x.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[x.cssProps[e.prop]]||x.cssHooks[e.prop])?x.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},rr.propHooks.scrollTop=rr.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},x.each(["toggle","show","hide"],function(e,t){var n=x.fn[t];x.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ir(t,!0),e,r,i)}}),x.fn.extend({fadeTo:function(e,t,n,r){return this.filter(nn).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=x.isEmptyObject(e),o=x.speed(t,n,r),a=function(){var t=er(this,x.extend({},e),o);(i||x._data(this,"finish"))&&t.stop(!0)};return a.finish=a,i||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",o=x.timers,a=x._data(this);if(n)a[n]&&a[n].stop&&i(a[n]);else for(n in a)a[n]&&a[n].stop&&Jn.test(n)&&i(a[n]);for(n=o.length;n--;)o[n].elem!==this||null!=e&&o[n].queue!==e||(o[n].anim.stop(r),t=!1,o.splice(n,1));(t||!r)&&x.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=x._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=x.timers,a=r?r.length:0;for(n.finish=!0,x.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;a>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),x.each({slideDown:ir("show"),slideUp:ir("hide"),slideToggle:ir("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){x.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),x.speed=function(e,t,n){var r=e&&"object"==typeof e?x.extend({},e):{complete:n||!n&&t||x.isFunction(e)&&e,duration:e,easing:n&&t||t&&!x.isFunction(t)&&t};
return r.duration=x.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in x.fx.speeds?x.fx.speeds[r.duration]:x.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){x.isFunction(r.old)&&r.old.call(this),r.queue&&x.dequeue(this,r.queue)},r},x.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},x.timers=[],x.fx=rr.prototype.init,x.fx.tick=function(){var e,n=x.timers,r=0;for(Xn=x.now();n.length>r;r++)e=n[r],e()||n[r]!==e||n.splice(r--,1);n.length||x.fx.stop(),Xn=t},x.fx.timer=function(e){e()&&x.timers.push(e)&&x.fx.start()},x.fx.interval=13,x.fx.start=function(){Un||(Un=setInterval(x.fx.tick,x.fx.interval))},x.fx.stop=function(){clearInterval(Un),Un=null},x.fx.speeds={slow:600,fast:200,_default:400},x.fx.step={},x.expr&&x.expr.filters&&(x.expr.filters.animated=function(e){return x.grep(x.timers,function(t){return e===t.elem}).length}),x.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){x.offset.setOffset(this,e,t)});var n,r,o={top:0,left:0},a=this[0],s=a&&a.ownerDocument;return s?(n=s.documentElement,x.contains(n,a)?(typeof a.getBoundingClientRect!==i&&(o=a.getBoundingClientRect()),r=or(s),{top:o.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:o.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):o):void 0},x.offset={setOffset:function(e,t,n){var r=x.css(e,"position");"static"===r&&(e.style.position="relative");var p,f,i=x(e),o=i.offset(),a=x.css(e,"top"),s=x.css(e,"left"),l=("absolute"===r||"fixed"===r)&&x.inArray("auto",[a,s])>-1,u={},c={};l?(c=i.position(),p=c.top,f=c.left):(p=parseFloat(a)||0,f=parseFloat(s)||0),x.isFunction(t)&&(t=t.call(e,n,o)),null!=t.top&&(u.top=t.top-o.top+p),null!=t.left&&(u.left=t.left-o.left+f),"using"in t?t.using.call(e,u):i.css(u)}},x.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===x.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),x.nodeName(e[0],"html")||(n=e.offset()),n.top+=x.css(e[0],"borderTopWidth",!0),n.left+=x.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-x.css(r,"marginTop",!0),left:t.left-n.left-x.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||s;e&&!x.nodeName(e,"html")&&"static"===x.css(e,"position");)e=e.offsetParent;return e||s})}}),x.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);x.fn[e]=function(i){return x.access(this,function(e,i,o){var a=or(e);return o===t?a?n in a?a[n]:a.document.documentElement[i]:e[i]:(a?a.scrollTo(r?x(a).scrollLeft():o,r?o:x(a).scrollTop()):e[i]=o,t)},e,i,arguments.length,null)}}),x.each({Height:"height",Width:"width"},function(e,n){x.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){x.fn[i]=function(i,o){var a=arguments.length&&(r||"boolean"!=typeof i),s=r||(i===!0||o===!0?"margin":"border");return x.access(this,function(n,r,i){var o;return x.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(o=n.documentElement,Math.max(n.body["scroll"+e],o["scroll"+e],n.body["offset"+e],o["offset"+e],o["client"+e])):i===t?x.css(n,r,s):x.style(n,r,i,s)},n,a?i:t,a,null)}})}),x.fn.size=function(){return this.length},x.fn.andSelf=x.fn.addBack,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=x:(e.jQuery=e.$=x,"function"==typeof define&&define.amd&&define("jquery",[],function(){return x}))}(window),function(e,t){"function"==typeof define&&define.amd?define([],t):e.forge=t()}(this,function(){var e,t,n;return function(r){function v(e,t){return h.call(e,t)}function m(e,t){var n,r,i,s,o,u,a,f,c,h,p,v=t&&t.split("/"),m=l.map,g=m&&m["*"]||{};if(e&&"."===e.charAt(0))if(t){for(v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,l.nodeIdCompat&&d.test(e[o])&&(e[o]=e[o].replace(d,"")),e=v.concat(e),c=0;c<e.length;c+=1)if(p=e[c],"."===p)e.splice(c,1),c-=1;else if(".."===p){if(1===c&&(".."===e[2]||".."===e[0]))break;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((v||g)&&m){for(n=e.split("/"),c=n.length;c>0;c-=1){if(r=n.slice(0,c).join("/"),v)for(h=v.length;h>0;h-=1)if(i=m[v.slice(0,h).join("/")],i&&(i=i[r])){s=i,u=c;break}if(s)break;!a&&g&&g[r]&&(a=g[r],f=c)}!s&&a&&(s=a,u=f),s&&(n.splice(0,u,s),e=n.join("/"))}return e}function g(e,t){return function(){return s.apply(r,p.call(arguments,0).concat([e,t]))}}function y(e){return function(t){return m(t,e)}}function b(e){return function(t){a[e]=t}}function w(e){if(v(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!v(a,e)&&!v(c,e))throw new Error("No "+e);return a[e]}function E(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice,d=/\.js$/;o=function(e,t){var n,r=E(e),i=r[0];return e=r[1],i&&(i=m(i,t),n=w(i)),i?e=n&&n.normalize?n.normalize(e,y(t)):m(e,t):(e=m(e,t),r=E(e),i=r[0],e=r[1],i&&(n=w(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return g(e)},exports:function(e){var t=a[e];return"undefined"!=typeof t?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:S(e)}}},i=function(e,t,n,i){var s,l,h,p,d,E,m=[],y=typeof n;if(i=i||e,"undefined"===y||"function"===y){for(t=!t.length&&n.length?["require","exports","module"]:t,d=0;d<t.length;d+=1)if(p=o(t[d],i),l=p.f,"require"===l)m[d]=u.require(e);else if("exports"===l)m[d]=u.exports(e),E=!0;else if("module"===l)s=m[d]=u.module(e);else if(v(a,l)||v(f,l)||v(c,l))m[d]=w(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,g(i,!0),b(l),{}),m[d]=a[l]}h=n?n.apply(a[e],m):void 0,e&&(s&&s.exports!==r&&s.exports!==a[e]?a[e]=s.exports:h===r&&E||(a[e]=h))}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){if("string"==typeof e)return u[e]?u[e](t):w(o(e,t).f);if(!e.splice){if(l=e,l.deps&&s(l.deps,l.callback),!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},"function"==typeof n&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s},s.config=function(e){return s(e)},e._defined=a,n=function(e,t,n){t.splice||(n=t,t=[]),!v(a,e)&&!v(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("node_modules/almond/almond",function(){}),function(){function e(e){var t=e.util=e.util||{};"undefined"!=typeof process&&process.nextTick?(t.nextTick=process.nextTick,t.setImmediate="function"==typeof setImmediate?setImmediate:t.nextTick):"function"==typeof setImmediate?(t.setImmediate=setImmediate,t.nextTick=function(e){return setImmediate(e)}):(t.setImmediate=function(e){setTimeout(e,0)},t.nextTick=t.setImmediate),t.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},t.isArrayBuffer=function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer};var n=[];"undefined"!=typeof Int8Array&&n.push(Int8Array),"undefined"!=typeof Uint8Array&&n.push(Uint8Array),"undefined"!=typeof Uint8ClampedArray&&n.push(Uint8ClampedArray),"undefined"!=typeof Int16Array&&n.push(Int16Array),"undefined"!=typeof Uint16Array&&n.push(Uint16Array),"undefined"!=typeof Int32Array&&n.push(Int32Array),"undefined"!=typeof Uint32Array&&n.push(Uint32Array),"undefined"!=typeof Float32Array&&n.push(Float32Array),"undefined"!=typeof Float64Array&&n.push(Float64Array),t.isArrayBufferView=function(e){for(var t=0;t<n.length;++t)if(e instanceof n[t])return!0;return!1},t.ByteBuffer=function(e){if(this.data="",this.read=0,"string"==typeof e)this.data=e;else if(t.isArrayBuffer(e)||t.isArrayBufferView(e)){var n=new Uint8Array(e);try{this.data=String.fromCharCode.apply(null,n)}catch(r){for(var i=0;i<n.length;++i)this.putByte(n[i])}}else e instanceof t.ByteBuffer?(this.data=e.data,this.read=e.read):"object"==typeof e&&"data"in e&&"read"in e&&"string"==typeof e.data&&"number"==typeof e.read&&(this.data=e.data,this.read=e.read)},t.ByteBuffer.prototype.length=function(){return this.data.length-this.read},t.ByteBuffer.prototype.isEmpty=function(){return this.length()<=0},t.ByteBuffer.prototype.putByte=function(e){return this.data+=String.fromCharCode(e),this},t.ByteBuffer.prototype.fillWithByte=function(e,t){e=String.fromCharCode(e);for(var n=this.data;t>0;)1&t&&(n+=e),t>>>=1,t>0&&(e+=e);return this.data=n,this},t.ByteBuffer.prototype.putBytes=function(e){return this.data+=e,this},t.ByteBuffer.prototype.putString=function(e){return this.data+=t.encodeUtf8(e),this},t.ByteBuffer.prototype.putInt16=function(e){return this.data+=String.fromCharCode(e>>8&255)+String.fromCharCode(255&e),this},t.ByteBuffer.prototype.putInt24=function(e){return this.data+=String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e),this},t.ByteBuffer.prototype.putInt32=function(e){return this.data+=String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e),this},t.ByteBuffer.prototype.putInt16Le=function(e){return this.data+=String.fromCharCode(255&e)+String.fromCharCode(e>>8&255),this},t.ByteBuffer.prototype.putInt24Le=function(e){return this.data+=String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255),this},t.ByteBuffer.prototype.putInt32Le=function(e){return this.data+=String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>24&255),this},t.ByteBuffer.prototype.putInt=function(e,t){do t-=8,this.data+=String.fromCharCode(e>>t&255);while(t>0);return this},t.ByteBuffer.prototype.putSignedInt=function(e,t){return 0>e&&(e+=2<<t-1),this.putInt(e,t)},t.ByteBuffer.prototype.putBuffer=function(e){return this.data+=e.getBytes(),this},t.ByteBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},t.ByteBuffer.prototype.getInt16=function(){var e=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,e},t.ByteBuffer.prototype.getInt24=function(){var e=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,e},t.ByteBuffer.prototype.getInt32=function(){var e=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,e},t.ByteBuffer.prototype.getInt16Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,e},t.ByteBuffer.prototype.getInt24Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,e},t.ByteBuffer.prototype.getInt32Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,e},t.ByteBuffer.prototype.getInt=function(e){var t=0;do t=(t<<8)+this.data.charCodeAt(this.read++),e-=8;while(e>0);return t},t.ByteBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),n=2<<e-2;return t>=n&&(t-=n<<1),t},t.ByteBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},t.ByteBuffer.prototype.bytes=function(e){return"undefined"==typeof e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},t.ByteBuffer.prototype.at=function(e){return this.data.charCodeAt(this.read+e)},t.ByteBuffer.prototype.setAt=function(e,t){return this.data=this.data.substr(0,this.read+e)+String.fromCharCode(t)+this.data.substr(this.read+e+1),this},t.ByteBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},t.ByteBuffer.prototype.copy=function(){var e=t.createBuffer(this.data);return e.read=this.read,e},t.ByteBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this},t.ByteBuffer.prototype.clear=function(){return this.data="",this.read=0,this},t.ByteBuffer.prototype.truncate=function(e){var t=Math.max(0,this.length()-e);return this.data=this.data.substr(this.read,t),this.read=0,this},t.ByteBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.length;++t){var n=this.data.charCodeAt(t);16>n&&(e+="0"),e+=n.toString(16)}return e},t.ByteBuffer.prototype.toString=function(){return t.decodeUtf8(this.bytes())},t.createBuffer=function(e,n){return n=n||"raw",void 0!==e&&"utf8"===n&&(e=t.encodeUtf8(e)),new t.ByteBuffer(e)},t.fillString=function(e,t){for(var n="";t>0;)1&t&&(n+=e),t>>>=1,t>0&&(e+=e);return n},t.xorBytes=function(e,t,n){for(var r="",i="",s="",o=0,u=0;n>0;--n,++o)i=e.charCodeAt(o)^t.charCodeAt(o),u>=10&&(r+=s,s="",u=0),s+=String.fromCharCode(i),++u;return r+=s},t.hexToBytes=function(e){var t="",n=0;for(e.length&!0&&(n=1,t+=String.fromCharCode(parseInt(e[0],16)));n<e.length;n+=2)t+=String.fromCharCode(parseInt(e.substr(n,2),16));return t},t.bytesToHex=function(e){return t.createBuffer(e).toHex()},t.int32ToBytes=function(e){return String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e)};var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];t.encode64=function(e,t){for(var s,o,u,n="",i="",a=0;a<e.length;)s=e.charCodeAt(a++),o=e.charCodeAt(a++),u=e.charCodeAt(a++),n+=r.charAt(s>>2),n+=r.charAt((3&s)<<4|o>>4),isNaN(o)?n+="==":(n+=r.charAt((15&o)<<2|u>>6),n+=isNaN(u)?"=":r.charAt(63&u)),t&&n.length>t&&(i+=n.substr(0,t)+"\r\n",n=n.substr(t));return i+=n},t.decode64=function(e){e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var n,r,s,o,t="",u=0;u<e.length;)n=i[e.charCodeAt(u++)-43],r=i[e.charCodeAt(u++)-43],s=i[e.charCodeAt(u++)-43],o=i[e.charCodeAt(u++)-43],t+=String.fromCharCode(n<<2|r>>4),64!==s&&(t+=String.fromCharCode((15&r)<<4|s>>2),64!==o&&(t+=String.fromCharCode((3&s)<<6|o)));return t},t.encodeUtf8=function(e){return unescape(encodeURIComponent(e))},t.decodeUtf8=function(e){return decodeURIComponent(escape(e))},t.deflate=function(e,n,r){if(n=t.decode64(e.deflate(t.encode64(n)).rval),r){var i=2,s=n.charCodeAt(1);32&s&&(i=6),n=n.substring(i,n.length-4)}return n},t.inflate=function(e,n){var i=e.inflate(t.encode64(n)).rval;return null===i?null:t.decode64(i)};var s=function(e,n,r){if(!e)throw{message:"WebStorage not available."};var i;if(null===r?i=e.removeItem(n):(r=t.encode64(JSON.stringify(r)),i=e.setItem(n,r)),"undefined"!=typeof i&&i.rval!==!0)throw i.error},o=function(e,n){if(!e)throw{message:"WebStorage not available."};var r=e.getItem(n);if(e.init)if(null===r.rval){if(r.error)throw r.error;r=null}else r=r.rval;return null!==r&&(r=JSON.parse(t.decode64(r))),r},u=function(e,t,n,r){var i=o(e,t);null===i&&(i={}),i[n]=r,s(e,t,i)},a=function(e,t,n){var r=o(e,t);return null!==r&&(r=n in r?r[n]:null),r},f=function(e,t,n){var r=o(e,t);if(null!==r&&n in r){delete r[n];var i=!0;for(var u in r){i=!1;break}i&&(r=null),s(e,t,r)}},l=function(e,t){s(e,t,null)},c=function(e,t,n){var r=null;"undefined"==typeof n&&(n=["web","flash"]);var i,s=!1,o=null;for(var u in n){i=n[u];try{if("flash"===i||"both"===i){if(null===t[0])throw{message:"Flash local storage not available."};r=e.apply(this,t),s="flash"===i}("web"===i||"both"===i)&&(t[0]=localStorage,r=e.apply(this,t),s=!0)}catch(a){o=a}if(s)break}if(!s)throw o;return r};t.setItem=function(e,t,n,r,i){c(u,arguments,i)},t.getItem=function(e,t,n,r){return c(a,arguments,r)},t.removeItem=function(e,t,n,r){c(f,arguments,r)},t.clearItems=function(e,t,n){c(l,arguments,n)},t.parseUrl=function(e){var t=/^(https?):\/\/([^:&^\/]*):?(\d*)(.*)$/g;t.lastIndex=0;var n=t.exec(e),r=null===n?null:{full:e,scheme:n[1],host:n[2],port:n[3],path:n[4]};return r&&(r.fullHost=r.host,r.port?80!==r.port&&"http"===r.scheme?r.fullHost+=":"+r.port:443!==r.port&&"https"===r.scheme&&(r.fullHost+=":"+r.port):"http"===r.scheme?r.port=80:"https"===r.scheme&&(r.port=443),r.full=r.scheme+"://"+r.fullHost),r};var h=null;t.getQueryVariables=function(e){var n,t=function(e){for(var t={},n=e.split("&"),r=0;r<n.length;r++){var s,o,i=n[r].indexOf("=");i>0?(s=n[r].substring(0,i),o=n[r].substring(i+1)):(s=n[r],o=null),s in t||(t[s]=[]),!(s in Object.prototype)&&null!==o&&t[s].push(unescape(o))}return t};return"undefined"==typeof e?(null===h&&(h="undefined"==typeof window?{}:t(window.location.search.substring(1))),n=h):n=t(e),n},t.parseFragment=function(e){var n=e,r="",i=e.indexOf("?");i>0&&(n=e.substring(0,i),r=e.substring(i+1));var s=n.split("/");s.length>0&&""===s[0]&&s.shift();var o=""===r?{}:t.getQueryVariables(r);return{pathString:n,queryString:r,path:s,query:o}},t.makeRequest=function(e){var n=t.parseFragment(e),r={path:n.pathString,query:n.queryString,getPath:function(e){return"undefined"==typeof e?n.path:n.path[e]},getQuery:function(e,t){var r;return"undefined"==typeof e?r=n.query:(r=n.query[e],r&&"undefined"!=typeof t&&(r=r[t])),r},getQueryLast:function(e,t){var n,i=r.getQuery(e);return n=i?i[i.length-1]:t}};return r},t.makeLink=function(e,t,n){e=jQuery.isArray(e)?e.join("/"):e;var r=jQuery.param(t||{});return n=n||"",e+(r.length>0?"?"+r:"")+(n.length>0?"#"+n:"")},t.setPath=function(e,t,n){if("object"==typeof e&&null!==e)for(var r=0,i=t.length;i>r;){var s=t[r++];if(r==i)e[s]=n;else{var o=s in e;(!o||o&&"object"!=typeof e[s]||o&&null===e[s])&&(e[s]={}),e=e[s]}}},t.getPath=function(e,t,n){for(var r=0,i=t.length,s=!0;s&&i>r&&"object"==typeof e&&null!==e;){var o=t[r++];s=o in e,s&&(e=e[o])}return s?e:n},t.deletePath=function(e,t){if("object"==typeof e&&null!==e)for(var n=0,r=t.length;r>n;){var i=t[n++];if(n==r)delete e[i];else{if(!(i in e&&"object"==typeof e[i]&&null!==e[i]))break;e=e[i]}}},t.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},t.format=function(e){for(var n,r,t=/%./g,i=0,s=[],o=0;n=t.exec(e);){r=e.substring(o,t.lastIndex-2),r.length>0&&s.push(r),o=t.lastIndex;var u=n[0][1];switch(u){case"s":case"o":s.push(i<arguments.length?arguments[i++ +1]:"<?>");break;case"%":s.push("%");break;default:s.push("<%"+u+"?>")}}return s.push(e.substring(o)),s.join("")},t.formatNumber=function(e,t,n,r){var i=e,s=isNaN(t=Math.abs(t))?2:t,o=void 0===n?",":n,u=void 0===r?".":r,a=0>i?"-":"",f=parseInt(i=Math.abs(+i||0).toFixed(s),10)+"",l=f.length>3?f.length%3:0;return a+(l?f.substr(0,l)+u:"")+f.substr(l).replace(/(\d{3})(?=\d)/g,"$1"+u)+(s?o+Math.abs(i-f).toFixed(s).slice(2):"")},t.formatSize=function(e){return e=e>=1073741824?t.formatNumber(e/1073741824,2,".","")+" GiB":e>=1048576?t.formatNumber(e/1048576,2,".","")+" MiB":e>=1024?t.formatNumber(e/1024,0)+" KiB":t.formatNumber(e,0)+" bytes"},t.bytesFromIP=function(e){return-1!==e.indexOf(".")?t.bytesFromIPv4(e):-1!==e.indexOf(":")?t.bytesFromIPv6(e):null},t.bytesFromIPv4=function(e){if(e=e.split("."),4!==e.length)return null;for(var n=t.createBuffer(),r=0;r<e.length;++r){var i=parseInt(e[r],10);if(isNaN(i))return null;n.putByte(i)}return n.getBytes()},t.bytesFromIPv6=function(e){var n=0;e=e.split(":").filter(function(e){return 0===e.length&&++n,!0});for(var r=2*(8-e.length+n),i=t.createBuffer(),s=0;8>s;++s)if(e[s]&&0!==e[s].length){var o=t.hexToBytes(e[s]);o.length<2&&i.putByte(0),i.putBytes(o)}else i.fillWithByte(0,r),r=0;return i.getBytes()},t.bytesToIP=function(e){return 4===e.length?t.bytesToIPv4(e):16===e.length?t.bytesToIPv6(e):null},t.bytesToIPv4=function(e){if(4!==e.length)return null;for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t.join(".")},t.bytesToIPv6=function(e){if(16!==e.length)return null;for(var n=[],r=[],i=0,s=0;s<e.length;s+=2){for(var o=t.bytesToHex(e[s]+e[s+1]);"0"===o[0]&&"0"!==o;)o=o.substr(1);if("0"===o){var u=r[r.length-1],a=n.length;u&&a===u.end+1?(u.end=a,u.end-u.start>r[i].end-r[i].start&&(i=r.length-1)):r.push({start:a,end:a})}n.push(o)}if(r.length>0){var f=r[i];f.end-f.start>0&&(n.splice(f.start,f.end-f.start+1,""),0===f.start&&n.unshift(""),7===f.end&&n.push(""))}return n.join(":")},t.estimateCores=function(e,n){function i(e,u,a){if(0===u){var f=Math.floor(e.reduce(function(e,t){return e+t},0)/e.length);return t.cores=Math.max(1,f),URL.revokeObjectURL(r),n(null,t.cores)}s(a,function(t,n){e.push(o(a,n)),i(e,u-1,a)})}function s(e,t){for(var n=[],i=[],s=0;e>s;++s){var o=new Worker(r);o.addEventListener("message",function(r){if(i.push(r.data),i.length===e){for(var s=0;e>s;++s)n[s].terminate();t(null,i)}}),n.push(o)}for(var s=0;e>s;++s)n[s].postMessage(s)}function o(e,t){for(var n=[],r=0;e>r;++r)for(var i=t[r],s=n[r]=[],o=0;e>o;++o)if(r!==o){var u=t[o];(i.st>u.st&&i.st<u.et||u.st>i.st&&u.st<i.et)&&s.push(o)}return n.reduce(function(e,t){return Math.max(e,t.length)},0)}if("function"==typeof e&&(n=e,e={}),e=e||{},"cores"in t&&!e.update)return n(null,t.cores);if(void 0===typeof Worker)return t.cores=1,n(null,t.cores);if(void 0===typeof Blob)return t.cores=2,n(null,t.cores);var r=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(){for(var t=Date.now(),n=t+4;Date.now()<n;);self.postMessage({st:t,et:n})})}.toString(),")()"],{type:"application/javascript"}));i([],5,16)}}var r="util";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/util",["require","module"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){e.cipher=e.cipher||{},e.cipher.algorithms=e.cipher.algorithms||{},e.cipher.createCipher=function(t,n){var r=t;if("string"==typeof r&&(r=e.cipher.getAlgorithm(r),r&&(r=r())),!r)throw new Error("Unsupported algorithm: "+t);return new e.cipher.BlockCipher({algorithm:r,key:n,decrypt:!1})},e.cipher.createDecipher=function(t,n){var r=t;if("string"==typeof r&&(r=e.cipher.getAlgorithm(r),r&&(r=r())),!r)throw new Error("Unsupported algorithm: "+t);return new e.cipher.BlockCipher({algorithm:r,key:n,decrypt:!0})},e.cipher.registerAlgorithm=function(t,n){t=t.toUpperCase(),e.cipher.algorithms[t]=n},e.cipher.getAlgorithm=function(t){return t=t.toUpperCase(),t in e.cipher.algorithms?e.cipher.algorithms[t]:null};var t=e.cipher.BlockCipher=function(e){this.algorithm=e.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=e.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=e.decrypt,this.algorithm.initialize(e)};t.prototype.start=function(t){t=t||{},this._finish=!1,this._input=e.util.createBuffer(),this.output=t.output||e.util.createBuffer(),this.mode.start(t)},t.prototype.update=function(e){for(this._finish||this._input.putBuffer(e);this._input.length()>=this.blockSize||this._input.length()>0&&this._finish;)this._op.call(this.mode,this._input,this.output);this._input.compact()},t.prototype.finish=function(e){e&&"CBC"===this.mode.name&&(this.mode.pad=function(t){return e(this.blockSize,t,!1)},this.mode.unpad=function(t){return e(this.blockSize,t,!0)});var t={};return t.overflow=this._input.length()%this.blockSize,this._decrypt||!this.mode.pad||this.mode.pad(this._input,t)?(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,t)?!1:this.mode.afterFinish&&!this.mode.afterFinish(this.output,t)?!1:!0):!1}}var r="cipher";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/cipher",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function n(t){if("string"==typeof t&&(t=e.util.createBuffer(t)),e.util.isArray(t)&&t.length>4){var n=t;t=e.util.createBuffer();for(var r=0;r<t.length;++r)t.putByte(n[r])}return e.util.isArray(t)||(t=[t.getInt32(),t.getInt32(),t.getInt32(),t.getInt32()]),t}function r(e){e[e.length-1]=e[e.length-1]+1&4294967295}function i(e){return[e/4294967296|0,4294967295&e]}e.cipher=e.cipher||{};var t=e.cipher.modes=e.cipher.modes||{};t.ecb=function(e){e=e||{},this.name="ECB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._blocks=this.blockSize/4,this._inBlock=new Array(this._blocks),this._outBlock=new Array(this._blocks)},t.ecb.prototype.start=function(){},t.ecb.prototype.encrypt=function(e,t){for(var n=0;n<this._blocks;++n)this._inBlock[n]=e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._blocks;++n)t.putInt32(this._outBlock[n])},t.ecb.prototype.decrypt=function(e,t){for(var n=0;n<this._blocks;++n)this._inBlock[n]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var n=0;n<this._blocks;++n)t.putInt32(this._outBlock[n])},t.ecb.prototype.pad=function(e){var n=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(n,n),!0},t.ecb.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var n=e.length(),r=e.at(n-1);return r>this.blockSize<<2?!1:(e.truncate(r),!0)},t.cbc=function(e){e=e||{},this.name="CBC",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._blocks=this.blockSize/4,this._inBlock=new Array(this._blocks),this._outBlock=new Array(this._blocks)},t.cbc.prototype.start=function(e){if(null===e.iv){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else{if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=n(e.iv),this._prev=this._iv.slice(0)}},t.cbc.prototype.encrypt=function(e,t){for(var n=0;n<this._blocks;++n)this._inBlock[n]=this._prev[n]^e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._blocks;++n)t.putInt32(this._outBlock[n]);this._prev=this._outBlock},t.cbc.prototype.decrypt=function(e,t){for(var n=0;n<this._blocks;++n)this._inBlock[n]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var n=0;n<this._blocks;++n)t.putInt32(this._prev[n]^this._outBlock[n]);this._prev=this._inBlock.slice(0)},t.cbc.prototype.pad=function(e){var n=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(n,n),!0},t.cbc.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var n=e.length(),r=e.at(n-1);return r>this.blockSize<<2?!1:(e.truncate(r),!0)},t.cfb=function(e){e=e||{},this.name="CFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._blocks=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._blocks)},t.cfb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=n(e.iv),this._inBlock=this._iv.slice(0)},t.cfb.prototype.encrypt=function(e,t){this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._blocks;++n)this._inBlock[n]=e.getInt32()^this._outBlock[n],t.putInt32(this._inBlock[n])},t.cfb.prototype.decrypt=function(e,t){this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._blocks;++n)this._inBlock[n]=e.getInt32(),t.putInt32(this._inBlock[n]^this._outBlock[n])},t.cfb.prototype.afterFinish=function(e,t){return t.overflow>0&&e.truncate(this.blockSize-t.overflow),!0},t.ofb=function(e){e=e||{},this.name="OFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._blocks=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._blocks)},t.ofb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=n(e.iv),this._inBlock=this._iv.slice(0)},t.ofb.prototype.encrypt=function(e,t){this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._blocks;++n)t.putInt32(e.getInt32()^this._outBlock[n]),this._inBlock[n]=this._outBlock[n]},t.ofb.prototype.decrypt=t.ofb.prototype.encrypt,t.ofb.prototype.afterFinish=function(e,t){return t.overflow>0&&e.truncate(this.blockSize-t.overflow),!0},t.ctr=function(e){e=e||{},this.name="CTR",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._blocks=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._blocks)},t.ctr.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=n(e.iv),this._inBlock=this._iv.slice(0)},t.ctr.prototype.encrypt=function(e,t){this.cipher.encrypt(this._inBlock,this._outBlock),r(this._inBlock);for(var n=0;n<this._blocks;++n)t.putInt32(e.getInt32()^this._outBlock[n])},t.ctr.prototype.decrypt=t.ctr.prototype.encrypt,t.ctr.prototype.afterFinish=function(e,t){return t.overflow>0&&e.truncate(this.blockSize-t.overflow),!0},t.gcm=function(e){e=e||{},this.name="GCM",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._blocks=this.blockSize/4,this._inBlock=new Array(this._blocks),this._outBlock=new Array(this._blocks),this._R=3774873600},t.gcm.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");var n=e.util.createBuffer(t.iv);this._cipherLength=0;var s;s="additionalData"in t?e.util.createBuffer(t.additionalData):e.util.createBuffer(),this._tagLength="tagLength"in t?t.tagLength:128,this._tag=e.util.createBuffer(t.tag).getBytes(),this._hashBlock=new Array(this._blocks),this.tag=null,this._hashSubkey=new Array(this._blocks),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var o=n.length();if(12===o)this._j0=[n.getInt32(),n.getInt32(),n.getInt32(),1];else{for(this._j0=[0,0,0,0];n.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[n.getInt32(),n.getInt32(),n.getInt32(),n.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(i(8*o)))}this._inBlock=this._j0.slice(0),r(this._inBlock),s=e.util.createBuffer(s),this._aDataLength=i(8*s.length());var u=s.length()%this.blockSize;for(u&&s.fillWithByte(0,this.blockSize-u),this._s=[0,0,0,0];s.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[s.getInt32(),s.getInt32(),s.getInt32(),s.getInt32()])},t.gcm.prototype.encrypt=function(t,n){this.cipher.encrypt(this._inBlock,this._outBlock),r(this._inBlock);for(var i=t.length(),s=0;s<this._blocks;++s)this._outBlock[s]^=t.getInt32();if(i<this.blockSize){var o=i%this.blockSize;this._cipherLength+=o;var u=e.util.createBuffer();u.putInt32(this._outBlock[0]),u.putInt32(this._outBlock[1]),u.putInt32(this._outBlock[2]),u.putInt32(this._outBlock[3]),u.truncate(this.blockSize-o),this._outBlock[0]=u.getInt32(),this._outBlock[1]=u.getInt32(),this._outBlock[2]=u.getInt32(),this._outBlock[3]=u.getInt32()}else this._cipherLength+=this.blockSize;for(var s=0;s<this._blocks;++s)n.putInt32(this._outBlock[s]);this._s=this.ghash(this._hashSubkey,this._s,this._outBlock)},t.gcm.prototype.decrypt=function(e,t){this.cipher.encrypt(this._inBlock,this._outBlock),r(this._inBlock);var n=e.length();this._hashBlock[0]=e.getInt32(),this._hashBlock[1]=e.getInt32(),this._hashBlock[2]=e.getInt32(),this._hashBlock[3]=e.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var i=0;i<this._blocks;++i)t.putInt32(this._outBlock[i]^this._hashBlock[i]);this._cipherLength+=n<this.blockSize?n%this.blockSize:this.blockSize},t.gcm.prototype.afterFinish=function(t,n){var r=!0;n.overflow&&t.truncate(this.blockSize-n.overflow),this.tag=e.util.createBuffer();
var s=this._aDataLength.concat(i(8*this._cipherLength));this._s=this.ghash(this._hashSubkey,this._s,s);var o=[];this.cipher.encrypt(this._j0,o);for(var u=0;u<this._blocks;++u)this.tag.putInt32(this._s[u]^o[u]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),this._tag&&this.tag.bytes()!==this._tag&&(r=!1),r},t.gcm.prototype.multiply=function(e,t){for(var n=[0,0,0,0],r=t.slice(0),i=0;128>i;++i){var s=e[i/32|0]&1<<31-i%32;s&&(n[0]^=r[0],n[1]^=r[1],n[2]^=r[2],n[3]^=r[3]),this.pow(r,r)}return n},t.gcm.prototype.pow=function(e,t){for(var n=1&e[3],r=3;r>0;--r)t[r]=e[r]>>>1|(1&e[r-1])<<31;t[0]=e[0]>>>1,n&&(t[0]^=this._R)},t.gcm.prototype.tableMultiply=function(e){for(var t=[0,0,0,0],n=0;32>n;++n){var r=n/8|0,i=e[r]>>>4*(7-n%8)&15,s=this._m[n][i];t[0]^=s[0],t[1]^=s[1],t[2]^=s[2],t[3]^=s[3]}return t},t.gcm.prototype.ghash=function(e,t,n){return t[0]^=n[0],t[1]^=n[1],t[2]^=n[2],t[3]^=n[3],this.tableMultiply(t)},t.gcm.prototype.generateHashTable=function(e,t){for(var n=8/t,r=4*n,i=16*n,s=new Array(i),o=0;i>o;++o){var u=[0,0,0,0],a=o/r|0,f=(r-1-o%r)*t;u[a]=1<<t-1<<f,s[o]=this.generateSubHashTable(this.multiply(u,e),t)}return s},t.gcm.prototype.generateSubHashTable=function(e,t){var n=1<<t,r=n>>>1,i=new Array(n);i[r]=e.slice(0);for(var s=r>>>1;s>0;)this.pow(i[2*s],i[s]=[]),s>>=1;for(s=2;r>s;){for(var o=1;s>o;++o){var u=i[s],a=i[o];i[s+o]=[u[0]^a[0],u[1]^a[1],u[2]^a[2],u[3]^a[3]]}s*=2}for(i[0]=[0,0,0,0],s=r+1;n>s;++s){var f=i[s^r];i[s]=[e[0]^f[0],e[1]^f[1],e[2]^f[2],e[3]^f[3]]}return i}}var r="cipherModes";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/cipherModes",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function t(t,n){var r=function(){return new e.aes.Algorithm(t,n)};e.cipher.registerAlgorithm(t,r)}function f(){n=!0,o=[0,1,2,4,8,16,32,64,128,27,54];for(var e=new Array(256),t=0;128>t;++t)e[t]=t<<1,e[t+128]=t+128<<1^283;i=new Array(256),s=new Array(256),u=new Array(4),a=new Array(4);for(var t=0;4>t;++t)u[t]=new Array(256),a[t]=new Array(256);for(var l,c,h,p,d,v,m,r=0,f=0,t=0;256>t;++t){p=f^f<<1^f<<2^f<<3^f<<4,p=p>>8^255&p^99,i[r]=p,s[p]=r,d=e[p],l=e[r],c=e[l],h=e[c],v=d<<24^p<<16^p<<8^(p^d),m=(l^c^h)<<24^(r^h)<<16^(r^c^h)<<8^(r^l^h);for(var g=0;4>g;++g)u[g][r]=v,a[g][p]=m,v=v<<24|v>>>8,m=m<<24|m>>>8;0===r?r=f=1:(r=l^e[e[e[l^h]]],f^=e[e[f]])}}function l(e,t){for(var s,n=e.slice(0),u=1,f=n.length,l=f+6+1,c=r*l,h=f;c>h;++h)s=n[h-1],h%f===0?(s=i[s>>>16&255]<<24^i[s>>>8&255]<<16^i[255&s]<<8^i[s>>>24]^o[u]<<24,u++):f>6&&h%f===4&&(s=i[s>>>24]<<24^i[s>>>16&255]<<16^i[s>>>8&255]<<8^i[255&s]),n[h]=n[h-f]^s;if(t){var p,d=a[0],v=a[1],m=a[2],g=a[3],y=n.slice(0);c=n.length;for(var h=0,b=c-r;c>h;h+=r,b-=r)if(0===h||h===c-r)y[h]=n[b],y[h+1]=n[b+3],y[h+2]=n[b+2],y[h+3]=n[b+1];else for(var w=0;r>w;++w)p=n[b+w],y[h+(3&-w)]=d[i[p>>>24]]^v[i[p>>>16&255]]^m[i[p>>>8&255]]^g[i[255&p]];n=y}return n}function c(e,t,n,r){var f,l,c,h,p,o=e.length/4-1;r?(f=a[0],l=a[1],c=a[2],h=a[3],p=s):(f=u[0],l=u[1],c=u[2],h=u[3],p=i);var d,v,m,g,y,b,w;d=t[0]^e[0],v=t[r?3:1]^e[1],m=t[2]^e[2],g=t[r?1:3]^e[3];for(var E=3,S=1;o>S;++S)y=f[d>>>24]^l[v>>>16&255]^c[m>>>8&255]^h[255&g]^e[++E],b=f[v>>>24]^l[m>>>16&255]^c[g>>>8&255]^h[255&d]^e[++E],w=f[m>>>24]^l[g>>>16&255]^c[d>>>8&255]^h[255&v]^e[++E],g=f[g>>>24]^l[d>>>16&255]^c[v>>>8&255]^h[255&m]^e[++E],d=y,v=b,m=w;n[0]=p[d>>>24]<<24^p[v>>>16&255]<<16^p[m>>>8&255]<<8^p[255&g]^e[++E],n[r?3:1]=p[v>>>24]<<24^p[m>>>16&255]<<16^p[g>>>8&255]<<8^p[255&d]^e[++E],n[2]=p[m>>>24]<<24^p[g>>>16&255]<<16^p[d>>>8&255]<<8^p[255&v]^e[++E],n[r?1:3]=p[g>>>24]<<24^p[d>>>16&255]<<16^p[v>>>8&255]<<8^p[255&m]^e[++E]}function h(t){t=t||{};var i,n=(t.mode||"CBC").toUpperCase(),r="AES-"+n;i=t.decrypt?e.cipher.createDecipher(r,t.key):e.cipher.createCipher(r,t.key);var s=i.start;return i.start=function(t,n){var r=null;n instanceof e.util.ByteBuffer&&(r=n,n={}),n=n||{},n.output=r,n.iv=t,s.call(i,n)},i}e.aes=e.aes||{},e.aes.startEncrypting=function(e,t,n,r){var i=h({key:e,output:n,decrypt:!1,mode:r});return i.start(t),i},e.aes.createEncryptionCipher=function(e,t){return h({key:e,output:null,decrypt:!1,mode:t})},e.aes.startDecrypting=function(e,t,n,r){var i=h({key:e,output:n,decrypt:!0,mode:r});return i.start(t),i},e.aes.createDecryptionCipher=function(e,t){return h({key:e,output:null,decrypt:!0,mode:t})},e.aes.Algorithm=function(e,t){n||f();var r=this;r.name=e,r.mode=new t({blockSize:16,cipher:{encrypt:function(e,t){return c(r._w,e,t,!1)},decrypt:function(e,t){return c(r._w,e,t,!0)}}}),r._init=!1},e.aes.Algorithm.prototype.initialize=function(t){if(!this._init){var r,n=t.key;if("string"!=typeof n||16!==n.length&&24!==n.length&&32!==n.length){if(e.util.isArray(n)&&(16===n.length||24===n.length||32===n.length)){r=n,n=e.util.createBuffer();for(var i=0;i<r.length;++i)n.putByte(r[i])}}else n=e.util.createBuffer(n);if(!e.util.isArray(n)){r=n,n=[];var s=r.length();if(16===s||24===s||32===s){s>>>=2;for(var i=0;s>i;++i)n.push(r.getInt32())}}if(!e.util.isArray(n)||4!==n.length&&6!==n.length&&8!==n.length)throw new Error("Invalid key parameter.");var o=this.mode.name,u=-1!==["CFB","OFB","CTR","GCM"].indexOf(o);this._w=l(n,t.decrypt&&!u),this._init=!0}},e.aes._expandKey=function(e,t){return n||f(),l(e,t)},e.aes._updateBlock=c,t("AES-CBC",e.cipher.modes.cbc),t("AES-CFB",e.cipher.modes.cfb),t("AES-OFB",e.cipher.modes.ofb),t("AES-CTR",e.cipher.modes.ctr),t("AES-GCM",e.cipher.modes.gcm);var i,s,o,u,a,n=!1,r=4}var r="aes";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/aes",["require","module","./cipher","./cipherModes","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){e.pki=e.pki||{};var t=e.pki.oids=e.oids=e.oids||{};t["1.2.840.113549.1.1.1"]="rsaEncryption",t.rsaEncryption="1.2.840.113549.1.1.1",t["1.2.840.113549.1.1.4"]="md5WithRSAEncryption",t.md5WithRSAEncryption="1.2.840.113549.1.1.4",t["1.2.840.113549.1.1.5"]="sha1WithRSAEncryption",t.sha1WithRSAEncryption="1.2.840.113549.1.1.5",t["1.2.840.113549.1.1.7"]="RSAES-OAEP",t["RSAES-OAEP"]="1.2.840.113549.1.1.7",t["1.2.840.113549.1.1.8"]="mgf1",t.mgf1="1.2.840.113549.1.1.8",t["1.2.840.113549.1.1.9"]="pSpecified",t.pSpecified="1.2.840.113549.1.1.9",t["1.2.840.113549.1.1.10"]="RSASSA-PSS",t["RSASSA-PSS"]="1.2.840.113549.1.1.10",t["1.2.840.113549.1.1.11"]="sha256WithRSAEncryption",t.sha256WithRSAEncryption="1.2.840.113549.1.1.11",t["1.2.840.113549.1.1.12"]="sha384WithRSAEncryption",t.sha384WithRSAEncryption="1.2.840.113549.1.1.12",t["1.2.840.113549.1.1.13"]="sha512WithRSAEncryption",t.sha512WithRSAEncryption="1.2.840.113549.1.1.13",t["1.3.14.3.2.7"]="desCBC",t.desCBC="1.3.14.3.2.7",t["1.3.14.3.2.26"]="sha1",t.sha1="1.3.14.3.2.26",t["2.16.840.1.101.3.4.2.1"]="sha256",t.sha256="2.16.840.1.101.3.4.2.1",t["2.16.840.1.101.3.4.2.2"]="sha384",t.sha384="2.16.840.1.101.3.4.2.2",t["2.16.840.1.101.3.4.2.3"]="sha512",t.sha512="2.16.840.1.101.3.4.2.3",t["1.2.840.113549.2.5"]="md5",t.md5="1.2.840.113549.2.5",t["1.2.840.113549.1.7.1"]="data",t.data="1.2.840.113549.1.7.1",t["1.2.840.113549.1.7.2"]="signedData",t.signedData="1.2.840.113549.1.7.2",t["1.2.840.113549.1.7.3"]="envelopedData",t.envelopedData="1.2.840.113549.1.7.3",t["1.2.840.113549.1.7.4"]="signedAndEnvelopedData",t.signedAndEnvelopedData="1.2.840.113549.1.7.4",t["1.2.840.113549.1.7.5"]="digestedData",t.digestedData="1.2.840.113549.1.7.5",t["1.2.840.113549.1.7.6"]="encryptedData",t.encryptedData="1.2.840.113549.1.7.6",t["1.2.840.113549.1.9.1"]="emailAddress",t.emailAddress="1.2.840.113549.1.9.1",t["1.2.840.113549.1.9.2"]="unstructuredName",t.unstructuredName="1.2.840.113549.1.9.2",t["1.2.840.113549.1.9.3"]="contentType",t.contentType="1.2.840.113549.1.9.3",t["1.2.840.113549.1.9.4"]="messageDigest",t.messageDigest="1.2.840.113549.1.9.4",t["1.2.840.113549.1.9.5"]="signingTime",t.signingTime="1.2.840.113549.1.9.5",t["1.2.840.113549.1.9.6"]="counterSignature",t.counterSignature="1.2.840.113549.1.9.6",t["1.2.840.113549.1.9.7"]="challengePassword",t.challengePassword="1.2.840.113549.1.9.7",t["1.2.840.113549.1.9.8"]="unstructuredAddress",t.unstructuredAddress="1.2.840.113549.1.9.8",t["1.2.840.113549.1.9.20"]="friendlyName",t.friendlyName="1.2.840.113549.1.9.20",t["1.2.840.113549.1.9.21"]="localKeyId",t.localKeyId="1.2.840.113549.1.9.21",t["1.2.840.113549.1.9.22.1"]="x509Certificate",t.x509Certificate="1.2.840.113549.1.9.22.1",t["1.2.840.113549.1.12.10.1.1"]="keyBag",t.keyBag="1.2.840.113549.1.12.10.1.1",t["1.2.840.113549.1.12.10.1.2"]="pkcs8ShroudedKeyBag",t.pkcs8ShroudedKeyBag="1.2.840.113549.1.12.10.1.2",t["1.2.840.113549.1.12.10.1.3"]="certBag",t.certBag="1.2.840.113549.1.12.10.1.3",t["1.2.840.113549.1.12.10.1.4"]="crlBag",t.crlBag="1.2.840.113549.1.12.10.1.4",t["1.2.840.113549.1.12.10.1.5"]="secretBag",t.secretBag="1.2.840.113549.1.12.10.1.5",t["1.2.840.113549.1.12.10.1.6"]="safeContentsBag",t.safeContentsBag="1.2.840.113549.1.12.10.1.6",t["1.2.840.113549.1.5.13"]="pkcs5PBES2",t.pkcs5PBES2="1.2.840.113549.1.5.13",t["1.2.840.113549.1.5.12"]="pkcs5PBKDF2",t.pkcs5PBKDF2="1.2.840.113549.1.5.12",t["1.2.840.113549.1.12.1.1"]="pbeWithSHAAnd128BitRC4",t.pbeWithSHAAnd128BitRC4="1.2.840.113549.1.12.1.1",t["1.2.840.113549.1.12.1.2"]="pbeWithSHAAnd40BitRC4",t.pbeWithSHAAnd40BitRC4="1.2.840.113549.1.12.1.2",t["1.2.840.113549.1.12.1.3"]="pbeWithSHAAnd3-KeyTripleDES-CBC",t["pbeWithSHAAnd3-KeyTripleDES-CBC"]="1.2.840.113549.1.12.1.3",t["1.2.840.113549.1.12.1.4"]="pbeWithSHAAnd2-KeyTripleDES-CBC",t["pbeWithSHAAnd2-KeyTripleDES-CBC"]="1.2.840.113549.1.12.1.4",t["1.2.840.113549.1.12.1.5"]="pbeWithSHAAnd128BitRC2-CBC",t["pbeWithSHAAnd128BitRC2-CBC"]="1.2.840.113549.1.12.1.5",t["1.2.840.113549.1.12.1.6"]="pbewithSHAAnd40BitRC2-CBC",t["pbewithSHAAnd40BitRC2-CBC"]="1.2.840.113549.1.12.1.6",t["1.2.840.113549.3.7"]="des-EDE3-CBC",t["des-EDE3-CBC"]="1.2.840.113549.3.7",t["2.16.840.1.101.3.4.1.2"]="aes128-CBC",t["aes128-CBC"]="2.16.840.1.101.3.4.1.2",t["2.16.840.1.101.3.4.1.22"]="aes192-CBC",t["aes192-CBC"]="2.16.840.1.101.3.4.1.22",t["2.16.840.1.101.3.4.1.42"]="aes256-CBC",t["aes256-CBC"]="2.16.840.1.101.3.4.1.42",t["2.5.4.3"]="commonName",t.commonName="2.5.4.3",t["2.5.4.5"]="serialName",t.serialName="2.5.4.5",t["2.5.4.6"]="countryName",t.countryName="2.5.4.6",t["2.5.4.7"]="localityName",t.localityName="2.5.4.7",t["2.5.4.8"]="stateOrProvinceName",t.stateOrProvinceName="2.5.4.8",t["2.5.4.10"]="organizationName",t.organizationName="2.5.4.10",t["2.5.4.11"]="organizationalUnitName",t.organizationalUnitName="2.5.4.11",t["2.16.840.1.113730.1.1"]="nsCertType",t.nsCertType="2.16.840.1.113730.1.1",t["2.5.29.1"]="authorityKeyIdentifier",t["2.5.29.2"]="keyAttributes",t["2.5.29.3"]="certificatePolicies",t["2.5.29.4"]="keyUsageRestriction",t["2.5.29.5"]="policyMapping",t["2.5.29.6"]="subtreesConstraint",t["2.5.29.7"]="subjectAltName",t["2.5.29.8"]="issuerAltName",t["2.5.29.9"]="subjectDirectoryAttributes",t["2.5.29.10"]="basicConstraints",t["2.5.29.11"]="nameConstraints",t["2.5.29.12"]="policyConstraints",t["2.5.29.13"]="basicConstraints",t["2.5.29.14"]="subjectKeyIdentifier",t.subjectKeyIdentifier="2.5.29.14",t["2.5.29.15"]="keyUsage",t.keyUsage="2.5.29.15",t["2.5.29.16"]="privateKeyUsagePeriod",t["2.5.29.17"]="subjectAltName",t.subjectAltName="2.5.29.17",t["2.5.29.18"]="issuerAltName",t.issuerAltName="2.5.29.18",t["2.5.29.19"]="basicConstraints",t.basicConstraints="2.5.29.19",t["2.5.29.20"]="cRLNumber",t["2.5.29.21"]="cRLReason",t["2.5.29.22"]="expirationDate",t["2.5.29.23"]="instructionCode",t["2.5.29.24"]="invalidityDate",t["2.5.29.25"]="cRLDistributionPoints",t["2.5.29.26"]="issuingDistributionPoint",t["2.5.29.27"]="deltaCRLIndicator",t["2.5.29.28"]="issuingDistributionPoint",t["2.5.29.29"]="certificateIssuer",t["2.5.29.30"]="nameConstraints",t["2.5.29.31"]="cRLDistributionPoints",t["2.5.29.32"]="certificatePolicies",t["2.5.29.33"]="policyMappings",t["2.5.29.34"]="policyConstraints",t["2.5.29.35"]="authorityKeyIdentifier",t["2.5.29.36"]="policyConstraints",t["2.5.29.37"]="extKeyUsage",t.extKeyUsage="2.5.29.37",t["2.5.29.46"]="freshestCRL",t["2.5.29.54"]="inhibitAnyPolicy",t["1.3.6.1.5.5.7.3.1"]="serverAuth",t.serverAuth="1.3.6.1.5.5.7.3.1",t["1.3.6.1.5.5.7.3.2"]="clientAuth",t.clientAuth="1.3.6.1.5.5.7.3.2",t["1.3.6.1.5.5.7.3.3"]="codeSigning",t.codeSigning="1.3.6.1.5.5.7.3.3",t["1.3.6.1.5.5.7.3.4"]="emailProtection",t.emailProtection="1.3.6.1.5.5.7.3.4",t["1.3.6.1.5.5.7.3.8"]="timeStamping",t.timeStamping="1.3.6.1.5.5.7.3.8"}var r="oids";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/oids",["require","module"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){var t=e.asn1=e.asn1||{};t.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192},t.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30},t.create=function(t,n,r,i){if(e.util.isArray(i)){for(var s=[],o=0;o<i.length;++o)void 0!==i[o]&&s.push(i[o]);i=s}return{tagClass:t,type:n,constructed:r,composed:r||e.util.isArray(i),value:i}};var n=function(e){var t=e.getByte();if(128===t)return void 0;var n,r=128&t;return n=r?e.getInt((127&t)<<3):t};t.fromDer=function(r,i){if(void 0===i&&(i=!0),"string"==typeof r&&(r=e.util.createBuffer(r)),r.length()<2)throw{message:"Too few bytes to parse DER.",bytes:r.length()};var s=r.getByte(),o=192&s,u=31&s,a=n(r);if(r.length()<a){if(i)throw{message:"Too few bytes to read ASN.1 value.",detail:r.length()+" < "+a};a=r.length()}var f,l=32===(32&s),c=l;if(!c&&o===t.Class.UNIVERSAL&&u===t.Type.BITSTRING&&a>1){var h=r.read,p=r.getByte();if(0===p){s=r.getByte();var d=192&s;if(d===t.Class.UNIVERSAL||d===t.Class.CONTEXT_SPECIFIC)try{var v=n(r);c=v===a-(r.read-h),c&&(++h,--a)}catch(m){}}r.read=h}if(c)if(f=[],void 0===a)for(;;){if(r.bytes(2)===String.fromCharCode(0,0)){r.getBytes(2);break}f.push(t.fromDer(r,i))}else for(var g=r.length();a>0;)f.push(t.fromDer(r,i)),a-=g-r.length(),g=r.length();else{if(void 0===a){if(i)throw{message:"Non-constructed ASN.1 object of indefinite length."};a=r.length()}if(u===t.Type.BMPSTRING){f="";for(var y=0;a>y;y+=2)f+=String.fromCharCode(r.getInt16())}else f=r.getBytes(a)}return t.create(o,u,l,f)},t.toDer=function(n){var r=e.util.createBuffer(),i=n.tagClass|n.type,s=e.util.createBuffer();if(n.composed){n.constructed?i|=32:s.putByte(0);for(var o=0;o<n.value.length;++o)void 0!==n.value[o]&&s.putBuffer(t.toDer(n.value[o]))}else if(n.type===t.Type.BMPSTRING)for(var o=0;o<n.value.length;++o)s.putInt16(n.value.charCodeAt(o));else s.putBytes(n.value);if(r.putByte(i),s.length()<=127)r.putByte(127&s.length());else{var u=s.length(),a="";do a+=String.fromCharCode(255&u),u>>>=8;while(u>0);r.putByte(128|a.length);for(var o=a.length-1;o>=0;--o)r.putByte(a.charCodeAt(o))}return r.putBuffer(s),r},t.oidToDer=function(t){var n=t.split("."),r=e.util.createBuffer();r.putByte(40*parseInt(n[0],10)+parseInt(n[1],10));for(var i,s,o,u,a=2;a<n.length;++a){i=!0,s=[],o=parseInt(n[a],10);do u=127&o,o>>>=7,i||(u|=128),s.push(u),i=!1;while(o>0);for(var f=s.length-1;f>=0;--f)r.putByte(s[f])}return r},t.derToOid=function(t){var n;"string"==typeof t&&(t=e.util.createBuffer(t));var r=t.getByte();n=Math.floor(r/40)+"."+r%40;for(var i=0;t.length()>0;)r=t.getByte(),i<<=7,128&r?i+=127&r:(n+="."+(i+r),i=0);return n},t.utcTimeToDate=function(e){var t=new Date,n=parseInt(e.substr(0,2),10);n=n>=50?1900+n:2e3+n;var r=parseInt(e.substr(2,2),10)-1,i=parseInt(e.substr(4,2),10),s=parseInt(e.substr(6,2),10),o=parseInt(e.substr(8,2),10),u=0;if(e.length>11){var a=e.charAt(10),f=10;"+"!==a&&"-"!==a&&(u=parseInt(e.substr(10,2),10),f+=2)}if(t.setUTCFullYear(n,r,i),t.setUTCHours(s,o,u,0),f&&(a=e.charAt(f),"+"===a||"-"===a)){var l=parseInt(e.substr(f+1,2),10),c=parseInt(e.substr(f+4,2),10),h=60*l+c;h*=6e4,t.setTime("+"===a?+t-h:+t+h)}return t},t.generalizedTimeToDate=function(e){var t=new Date,n=parseInt(e.substr(0,4),10),r=parseInt(e.substr(4,2),10)-1,i=parseInt(e.substr(6,2),10),s=parseInt(e.substr(8,2),10),o=parseInt(e.substr(10,2),10),u=parseInt(e.substr(12,2),10),a=0,f=0,l=!1;"Z"===e.charAt(e.length-1)&&(l=!0);var c=e.length-5,h=e.charAt(c);if("+"===h||"-"===h){var p=parseInt(e.substr(c+1,2),10),d=parseInt(e.substr(c+4,2),10);f=60*p+d,f*=6e4,"+"===h&&(f*=-1),l=!0}return"."===e.charAt(14)&&(a=1e3*parseFloat(e.substr(14),10)),l?(t.setUTCFullYear(n,r,i),t.setUTCHours(s,o,u,a),t.setTime(+t+f)):(t.setFullYear(n,r,i),t.setHours(s,o,u,a)),t},t.dateToUtcTime=function(e){var t="",n=[];n.push((""+e.getUTCFullYear()).substr(2)),n.push(""+(e.getUTCMonth()+1)),n.push(""+e.getUTCDate()),n.push(""+e.getUTCHours()),n.push(""+e.getUTCMinutes()),n.push(""+e.getUTCSeconds());for(var r=0;r<n.length;++r)n[r].length<2&&(t+="0"),t+=n[r];return t+="Z"},t.integerToDer=function(t){var n=e.util.createBuffer();if(t>=-128&&128>t)return n.putSignedInt(t,8);if(t>=-32768&&32768>t)return n.putSignedInt(t,16);if(t>=-8388608&&8388608>t)return n.putSignedInt(t,24);if(t>=-2147483648&&2147483648>t)return n.putSignedInt(t,32);throw{message:"Integer too large; max is 32-bits.",integer:t}},t.derToInteger=function(t){"string"==typeof t&&(t=e.util.createBuffer(t));var n=8*t.length();if(n>32)throw{message:"Integer too large; max is 32-bits."};return t.getSignedInt(n)},t.validate=function(n,r,i,s){var o=!1;if(n.tagClass!==r.tagClass&&"undefined"!=typeof r.tagClass||n.type!==r.type&&"undefined"!=typeof r.type)s&&(n.tagClass!==r.tagClass&&s.push("["+r.name+'] Expected tag class "'+r.tagClass+'", got "'+n.tagClass+'"'),n.type!==r.type&&s.push("["+r.name+'] Expected type "'+r.type+'", got "'+n.type+'"'));else if(n.constructed===r.constructed||"undefined"==typeof r.constructed){if(o=!0,r.value&&e.util.isArray(r.value))for(var u=0,a=0;o&&a<r.value.length;++a)o=r.value[a].optional||!1,n.value[u]&&(o=t.validate(n.value[u],r.value[a],i,s),o?++u:r.value[a].optional&&(o=!0)),!o&&s&&s.push("["+r.name+'] Tag class "'+r.tagClass+'", type "'+r.type+'" expected value length "'+r.value.length+'", got "'+n.value.length+'"');o&&i&&(r.capture&&(i[r.capture]=n.value),r.captureAsn1&&(i[r.captureAsn1]=n))}else s&&s.push("["+r.name+'] Expected constructed "'+r.constructed+'", got "'+n.constructed+'"');return o};var r=/[^\\u0000-\\u00ff]/;t.prettyPrint=function(n,i,s){var o="";i=i||0,s=s||2,i>0&&(o+="\n");for(var u="",a=0;i*s>a;++a)u+=" ";switch(o+=u+"Tag: ",n.tagClass){case t.Class.UNIVERSAL:o+="Universal:";break;case t.Class.APPLICATION:o+="Application:";break;case t.Class.CONTEXT_SPECIFIC:o+="Context-Specific:";break;case t.Class.PRIVATE:o+="Private:"}if(n.tagClass===t.Class.UNIVERSAL)switch(o+=n.type,n.type){case t.Type.NONE:o+=" (None)";break;case t.Type.BOOLEAN:o+=" (Boolean)";break;case t.Type.BITSTRING:o+=" (Bit string)";break;case t.Type.INTEGER:o+=" (Integer)";break;case t.Type.OCTETSTRING:o+=" (Octet string)";break;case t.Type.NULL:o+=" (Null)";break;case t.Type.OID:o+=" (Object Identifier)";break;case t.Type.ODESC:o+=" (Object Descriptor)";break;case t.Type.EXTERNAL:o+=" (External or Instance of)";break;case t.Type.REAL:o+=" (Real)";break;case t.Type.ENUMERATED:o+=" (Enumerated)";break;case t.Type.EMBEDDED:o+=" (Embedded PDV)";break;case t.Type.UTF8:o+=" (UTF8)";break;case t.Type.ROID:o+=" (Relative Object Identifier)";break;case t.Type.SEQUENCE:o+=" (Sequence)";break;case t.Type.SET:o+=" (Set)";break;case t.Type.PRINTABLESTRING:o+=" (Printable String)";break;case t.Type.IA5String:o+=" (IA5String (ASCII))";break;case t.Type.UTCTIME:o+=" (UTC time)";break;case t.Type.GENERALIZEDTIME:o+=" (Generalized time)";break;case t.Type.BMPSTRING:o+=" (BMP String)"}else o+=n.type;if(o+="\n",o+=u+"Constructed: "+n.constructed+"\n",n.composed){for(var f=0,l="",a=0;a<n.value.length;++a)void 0!==n.value[a]&&(f+=1,l+=t.prettyPrint(n.value[a],i+1,s),a+1<n.value.length&&(l+=","));o+=u+"Sub values: "+f+l}else{if(o+=u+"Value: ",n.type===t.Type.OID){var c=t.derToOid(n.value);o+=c,e.pki&&e.pki.oids&&c in e.pki.oids&&(o+=" ("+e.pki.oids[c]+")")}if(n.type===t.Type.INTEGER)try{o+=t.derToInteger(n.value)}catch(h){o+="0x"+e.util.bytesToHex(n.value)}else o+=r.test(n.value)?"0x"+e.util.createBuffer(n.value,"utf8").toHex():0===n.value.length?"[null]":n.value}return o}}var r="asn1";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/asn1",["require","module","./util","./oids"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function u(){n=String.fromCharCode(128),n+=e.util.fillString(String.fromCharCode(0),64),r=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,1,6,11,0,5,10,15,4,9,14,3,8,13,2,7,12,5,8,11,14,1,4,7,10,13,0,3,6,9,12,15,2,0,7,14,5,12,3,10,1,8,15,6,13,4,11,2,9],i=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21],s=new Array(64);for(var t=0;64>t;++t)s[t]=Math.floor(4294967296*Math.abs(Math.sin(t+1)));o=!0}function a(e,t,n){for(var o,u,a,f,l,c,h,p,d=n.length();d>=64;){for(u=e.h0,a=e.h1,f=e.h2,l=e.h3,p=0;16>p;++p)t[p]=n.getInt32Le(),c=l^a&(f^l),o=u+c+s[p]+t[p],h=i[p],u=l,l=f,f=a,a+=o<<h|o>>>32-h;for(;32>p;++p)c=f^l&(a^f),o=u+c+s[p]+t[r[p]],h=i[p],u=l,l=f,f=a,a+=o<<h|o>>>32-h;for(;48>p;++p)c=a^f^l,o=u+c+s[p]+t[r[p]],h=i[p],u=l,l=f,f=a,a+=o<<h|o>>>32-h;for(;64>p;++p)c=f^(a|~l),o=u+c+s[p]+t[r[p]],h=i[p],u=l,l=f,f=a,a+=o<<h|o>>>32-h;e.h0=e.h0+u|0,e.h1=e.h1+a|0,e.h2=e.h2+f|0,e.h3=e.h3+l|0,d-=64}}var t=e.md5=e.md5||{};e.md=e.md||{},e.md.algorithms=e.md.algorithms||{},e.md.md5=e.md.algorithms.md5=t,t.create=function(){o||u();var t=null,r=e.util.createBuffer(),i=new Array(16),s={algorithm:"md5",blockLength:64,digestLength:16,messageLength:0,messageLength64:[0,0]};return s.start=function(){return s.messageLength=0,s.messageLength64=[0,0],r=e.util.createBuffer(),t={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878},s},s.start(),s.update=function(n,o){return"utf8"===o&&(n=e.util.encodeUtf8(n)),s.messageLength+=n.length,s.messageLength64[0]+=n.length/4294967296>>>0,s.messageLength64[1]+=n.length>>>0,r.putBytes(n),a(t,i,r),(r.read>2048||0===r.length())&&r.compact(),s},s.digest=function(){var o=e.util.createBuffer();o.putBytes(r.bytes()),o.putBytes(n.substr(0,64-(s.messageLength64[1]+8&63))),o.putInt32Le(s.messageLength64[1]<<3),o.putInt32Le(s.messageLength64[0]<<3|s.messageLength64[0]>>>28);var u={h0:t.h0,h1:t.h1,h2:t.h2,h3:t.h3};a(u,i,o);var f=e.util.createBuffer();return f.putInt32Le(u.h0),f.putInt32Le(u.h1),f.putInt32Le(u.h2),f.putInt32Le(u.h3),f},s};var n=null,r=null,i=null,s=null,o=!1}var r="md5";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/md5",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function i(){n=String.fromCharCode(128),n+=e.util.fillString(String.fromCharCode(0),64),r=!0}function s(e,t,n){for(var r,i,s,o,u,a,f,l,c=n.length();c>=64;){for(i=e.h0,s=e.h1,o=e.h2,u=e.h3,a=e.h4,l=0;16>l;++l)r=n.getInt32(),t[l]=r,f=u^s&(o^u),r=(i<<5|i>>>27)+f+a+1518500249+r,a=u,u=o,o=s<<30|s>>>2,s=i,i=r;for(;20>l;++l)r=t[l-3]^t[l-8]^t[l-14]^t[l-16],r=r<<1|r>>>31,t[l]=r,f=u^s&(o^u),r=(i<<5|i>>>27)+f+a+1518500249+r,a=u,u=o,o=s<<30|s>>>2,s=i,i=r;for(;32>l;++l)r=t[l-3]^t[l-8]^t[l-14]^t[l-16],r=r<<1|r>>>31,t[l]=r,f=s^o^u,r=(i<<5|i>>>27)+f+a+1859775393+r,a=u,u=o,o=s<<30|s>>>2,s=i,i=r;for(;40>l;++l)r=t[l-6]^t[l-16]^t[l-28]^t[l-32],r=r<<2|r>>>30,t[l]=r,f=s^o^u,r=(i<<5|i>>>27)+f+a+1859775393+r,a=u,u=o,o=s<<30|s>>>2,s=i,i=r;for(;60>l;++l)r=t[l-6]^t[l-16]^t[l-28]^t[l-32],r=r<<2|r>>>30,t[l]=r,f=s&o|u&(s^o),r=(i<<5|i>>>27)+f+a+2400959708+r,a=u,u=o,o=s<<30|s>>>2,s=i,i=r;for(;80>l;++l)r=t[l-6]^t[l-16]^t[l-28]^t[l-32],r=r<<2|r>>>30,t[l]=r,f=s^o^u,r=(i<<5|i>>>27)+f+a+3395469782+r,a=u,u=o,o=s<<30|s>>>2,s=i,i=r;e.h0=e.h0+i|0,e.h1=e.h1+s|0,e.h2=e.h2+o|0,e.h3=e.h3+u|0,e.h4=e.h4+a|0,c-=64}}var t=e.sha1=e.sha1||{};e.md=e.md||{},e.md.algorithms=e.md.algorithms||{},e.md.sha1=e.md.algorithms.sha1=t,t.create=function(){r||i();var t=null,o=e.util.createBuffer(),u=new Array(80),a={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,messageLength64:[0,0]};return a.start=function(){return a.messageLength=0,a.messageLength64=[0,0],o=e.util.createBuffer(),t={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},a},a.start(),a.update=function(n,r){return"utf8"===r&&(n=e.util.encodeUtf8(n)),a.messageLength+=n.length,a.messageLength64[0]+=n.length/4294967296>>>0,a.messageLength64[1]+=n.length>>>0,o.putBytes(n),s(t,u,o),(o.read>2048||0===o.length())&&o.compact(),a},a.digest=function(){var r=e.util.createBuffer();r.putBytes(o.bytes()),r.putBytes(n.substr(0,64-(a.messageLength64[1]+8&63))),r.putInt32(a.messageLength64[0]<<3|a.messageLength64[0]>>>28),r.putInt32(a.messageLength64[1]<<3);var i={h0:t.h0,h1:t.h1,h2:t.h2,h3:t.h3,h4:t.h4};s(i,u,r);var f=e.util.createBuffer();return f.putInt32(i.h0),f.putInt32(i.h1),f.putInt32(i.h2),f.putInt32(i.h3),f.putInt32(i.h4),f},a};var n=null,r=!1}var r="sha1";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/sha1",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function s(){n=String.fromCharCode(128),n+=e.util.fillString(String.fromCharCode(0),64),i=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],r=!0}function o(e,t,n){for(var r,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b=n.length();b>=64;){for(l=0;16>l;++l)t[l]=n.getInt32();for(;64>l;++l)r=t[l-2],r=(r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10,s=t[l-15],s=(s>>>7|s<<25)^(s>>>18|s<<14)^s>>>3,t[l]=r+t[l-7]+s+t[l-16]|0;for(c=e.h0,h=e.h1,p=e.h2,d=e.h3,v=e.h4,m=e.h5,g=e.h6,y=e.h7,l=0;64>l;++l)u=(v>>>6|v<<26)^(v>>>11|v<<21)^(v>>>25|v<<7),a=g^v&(m^g),o=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),f=c&h|p&(c^h),r=y+u+a+i[l]+t[l],s=o+f,y=g,g=m,m=v,v=d+r|0,d=p,p=h,h=c,c=r+s|0;e.h0=e.h0+c|0,e.h1=e.h1+h|0,e.h2=e.h2+p|0,e.h3=e.h3+d|0,e.h4=e.h4+v|0,e.h5=e.h5+m|0,e.h6=e.h6+g|0,e.h7=e.h7+y|0,b-=64}}var t=e.sha256=e.sha256||{};e.md=e.md||{},e.md.algorithms=e.md.algorithms||{},e.md.sha256=e.md.algorithms.sha256=t,t.create=function(){r||s();var t=null,i=e.util.createBuffer(),u=new Array(64),a={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,messageLength64:[0,0]};return a.start=function(){return a.messageLength=0,a.messageLength64=[0,0],i=e.util.createBuffer(),t={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},a},a.start(),a.update=function(n,r){return"utf8"===r&&(n=e.util.encodeUtf8(n)),a.messageLength+=n.length,a.messageLength64[0]+=n.length/4294967296>>>0,a.messageLength64[1]+=n.length>>>0,i.putBytes(n),o(t,u,i),(i.read>2048||0===i.length())&&i.compact(),a},a.digest=function(){var r=e.util.createBuffer();r.putBytes(i.bytes()),r.putBytes(n.substr(0,64-(a.messageLength64[1]+8&63))),r.putInt32(a.messageLength64[0]<<3|a.messageLength64[0]>>>28),r.putInt32(a.messageLength64[1]<<3);var s={h0:t.h0,h1:t.h1,h2:t.h2,h3:t.h3,h4:t.h4,h5:t.h5,h6:t.h6,h7:t.h7};o(s,u,r);var f=e.util.createBuffer();return f.putInt32(s.h0),f.putInt32(s.h1),f.putInt32(s.h2),f.putInt32(s.h3),f.putInt32(s.h4),f.putInt32(s.h5),f.putInt32(s.h6),f.putInt32(s.h7),f},a};var n=null,r=!1,i=null}var r="sha256";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/sha256",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function u(){r=String.fromCharCode(128),r+=e.util.fillString(String.fromCharCode(0),128),s=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],o={},o["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],o["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],o["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],o["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],i=!0
}function a(e,t,n){for(var r,i,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I=n.length();I>=128;){for(_=0;16>_;++_)t[_][0]=n.getInt32()>>>0,t[_][1]=n.getInt32()>>>0;for(;80>_;++_)H=t[_-2],D=H[0],P=H[1],r=((D>>>19|P<<13)^(P>>>29|D<<3)^D>>>6)>>>0,i=((D<<13|P>>>19)^(P<<3|D>>>29)^(D<<26|P>>>6))>>>0,j=t[_-15],D=j[0],P=j[1],o=((D>>>1|P<<31)^(D>>>8|P<<24)^D>>>7)>>>0,u=((D<<31|P>>>1)^(D<<24|P>>>8)^(D<<25|P>>>7))>>>0,B=t[_-7],F=t[_-16],P=i+B[1]+u+F[1],t[_][0]=r+B[0]+o+F[0]+(P/4294967296>>>0)>>>0,t[_][1]=P>>>0;for(m=e[0][0],g=e[0][1],y=e[1][0],b=e[1][1],w=e[2][0],E=e[2][1],S=e[3][0],x=e[3][1],T=e[4][0],N=e[4][1],C=e[5][0],k=e[5][1],L=e[6][0],A=e[6][1],O=e[7][0],M=e[7][1],_=0;80>_;++_)l=((T>>>14|N<<18)^(T>>>18|N<<14)^(N>>>9|T<<23))>>>0,c=((T<<18|N>>>14)^(T<<14|N>>>18)^(N<<23|T>>>9))>>>0,h=(L^T&(C^L))>>>0,p=(A^N&(k^A))>>>0,a=((m>>>28|g<<4)^(g>>>2|m<<30)^(g>>>7|m<<25))>>>0,f=((m<<4|g>>>28)^(g<<30|m>>>2)^(g<<25|m>>>7))>>>0,d=(m&y|w&(m^y))>>>0,v=(g&b|E&(g^b))>>>0,P=M+c+p+s[_][1]+t[_][1],r=O+l+h+s[_][0]+t[_][0]+(P/4294967296>>>0)>>>0,i=P>>>0,P=f+v,o=a+d+(P/4294967296>>>0)>>>0,u=P>>>0,O=L,M=A,L=C,A=k,C=T,k=N,P=x+i,T=S+r+(P/4294967296>>>0)>>>0,N=P>>>0,S=w,x=E,w=y,E=b,y=m,b=g,P=i+u,m=r+o+(P/4294967296>>>0)>>>0,g=P>>>0;P=e[0][1]+g,e[0][0]=e[0][0]+m+(P/4294967296>>>0)>>>0,e[0][1]=P>>>0,P=e[1][1]+b,e[1][0]=e[1][0]+y+(P/4294967296>>>0)>>>0,e[1][1]=P>>>0,P=e[2][1]+E,e[2][0]=e[2][0]+w+(P/4294967296>>>0)>>>0,e[2][1]=P>>>0,P=e[3][1]+x,e[3][0]=e[3][0]+S+(P/4294967296>>>0)>>>0,e[3][1]=P>>>0,P=e[4][1]+N,e[4][0]=e[4][0]+T+(P/4294967296>>>0)>>>0,e[4][1]=P>>>0,P=e[5][1]+k,e[5][0]=e[5][0]+C+(P/4294967296>>>0)>>>0,e[5][1]=P>>>0,P=e[6][1]+A,e[6][0]=e[6][0]+L+(P/4294967296>>>0)>>>0,e[6][1]=P>>>0,P=e[7][1]+M,e[7][0]=e[7][0]+O+(P/4294967296>>>0)>>>0,e[7][1]=P>>>0,I-=128}}var t=e.sha512=e.sha512||{};e.md=e.md||{},e.md.algorithms=e.md.algorithms||{},e.md.sha512=e.md.algorithms.sha512=t;var n=e.sha384=e.sha512.sha384=e.sha512.sha384||{};n.create=function(){return t.create("SHA-384")},e.md.sha384=e.md.algorithms.sha384=n,e.sha512.sha256=e.sha512.sha256||{create:function(){return t.create("SHA-512/256")}},e.md["sha512/256"]=e.md.algorithms["sha512/256"]=e.sha512.sha256,e.sha512.sha224=e.sha512.sha224||{create:function(){return t.create("SHA-512/224")}},e.md["sha512/224"]=e.md.algorithms["sha512/224"]=e.sha512.sha224,t.create=function(t){if(i||u(),"undefined"==typeof t&&(t="SHA-512"),t in o){for(var n=o[t],s=null,f=e.util.createBuffer(),l=new Array(80),c=0;80>c;++c)l[c]=new Array(2);var h={algorithm:t.replace("-","").toLowerCase(),blockLength:128,digestLength:64,messageLength:0,messageLength128:[0,0,0,0]};return h.start=function(){h.messageLength=0,h.messageLength128=[0,0,0,0],f=e.util.createBuffer(),s=new Array(n.length);for(var t=0;t<n.length;++t)s[t]=n[t].slice(0);return h},h.start(),h.update=function(t,n){"utf8"===n&&(t=e.util.encodeUtf8(t)),h.messageLength+=t.length;var r=t.length;r=[r/4294967296>>>0,r>>>0];for(var i=3;i>=0;--i)h.messageLength128[i]+=r[1],r[1]=r[0]+(h.messageLength128[i]/4294967296>>>0),h.messageLength128[i]=h.messageLength128[i]>>>0,r[0]=r[1]/4294967296>>>0;return f.putBytes(t),a(s,l,f),(f.read>2048||0===f.length())&&f.compact(),h},h.digest=function(){var n=e.util.createBuffer();n.putBytes(f.bytes()),n.putBytes(r.substr(0,128-(h.messageLength128[3]+16&127)));for(var i=[],o=0;3>o;++o)i[o]=h.messageLength128[o]<<3|h.messageLength128[o-1]>>>28;i[3]=h.messageLength128[3]<<3,n.putInt32(i[0]),n.putInt32(i[1]),n.putInt32(i[2]),n.putInt32(i[3]);for(var u=new Array(s.length),o=0;o<s.length;++o)u[o]=s[o].slice(0);a(u,l,n);var p,c=e.util.createBuffer();p="SHA-512"===t?u.length:"SHA-384"===t?u.length-2:u.length-4;for(var o=0;p>o;++o)c.putInt32(u[o][0]),(o!==p-1||"SHA-512/224"!==t)&&c.putInt32(u[o][1]);return c},h}throw new Error("Invalid SHA-512 algorithm: "+t)};var r=null,i=!1,s=null,o=null}var r="sha512";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/sha512",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){e.md=e.md||{},e.md.algorithms={md5:e.md5,sha1:e.sha1,sha256:e.sha256},e.md.md5=e.md5,e.md.sha1=e.sha1,e.md.sha256=e.sha256}var r="md";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/md",["require","module","./md5","./sha1","./sha256","./sha512"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){var t=e.hmac=e.hmac||{};t.create=function(){var t=null,n=null,r=null,i=null,s={};return s.start=function(s,o){if(null!==s)if("string"==typeof s){if(s=s.toLowerCase(),!(s in e.md.algorithms))throw'Unknown hash algorithm "'+s+'"';n=e.md.algorithms[s].create()}else n=s;if(null===o)o=t;else{if("string"==typeof o)o=e.util.createBuffer(o);else if(e.util.isArray(o)){var u=o;o=e.util.createBuffer();for(var a=0;a<u.length;++a)o.putByte(u[a])}var f=o.length();f>n.blockLength&&(n.start(),n.update(o.bytes()),o=n.digest()),r=e.util.createBuffer(),i=e.util.createBuffer(),f=o.length();for(var a=0;f>a;++a){var u=o.at(a);r.putByte(54^u),i.putByte(92^u)}if(f<n.blockLength)for(var u=n.blockLength-f,a=0;u>a;++a)r.putByte(54),i.putByte(92);t=o,r=r.bytes(),i=i.bytes()}n.start(),n.update(r)},s.update=function(e){n.update(e)},s.getMac=function(){var e=n.digest().bytes();return n.start(),n.update(i),n.update(e),n.digest()},s.digest=s.getMac,s}}var r="hmac";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/hmac",["require","module","./md","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function n(e){for(var t=e.name+": ",n=[],r=function(e,t){return" "+t},i=0;i<e.values.length;++i)n.push(e.values[i].replace(/^(\S+\r\n)/,r));t+=n.join(",")+"\r\n";for(var s=0,o=-1,i=0;i<t.length;++i,++s)if(s>65&&-1!==o){var u=t[o];","===u?(++o,t=t.substr(0,o)+"\r\n "+t.substr(o)):t=t.substr(0,o)+"\r\n"+u+t.substr(o+1),s=i-o-1,o=-1,++i}else(" "===t[i]||"	"===t[i]||","===t[i])&&(o=i);return t}function r(e){return e.replace(/^\s+/,"")}var t=e.pem=e.pem||{};t.encode=function(t,r){r=r||{};var s,i="-----BEGIN "+t.type+"-----\r\n";if(t.procType&&(s={name:"Proc-Type",values:[String(t.procType.version),t.procType.type]},i+=n(s)),t.contentDomain&&(s={name:"Content-Domain",values:[t.contentDomain]},i+=n(s)),t.dekInfo&&(s={name:"DEK-Info",values:[t.dekInfo.algorithm]},t.dekInfo.parameters&&s.values.push(t.dekInfo.parameters),i+=n(s)),t.headers)for(var o=0;o<t.headers.length;++o)i+=n(t.headers[o]);return t.procType&&(i+="\r\n"),i+=e.util.encode64(t.body,r.maxline||64)+"\r\n",i+="-----END "+t.type+"-----\r\n"},t.decode=function(t){for(var u,n=[],i=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,s=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,o=/\r?\n/;u=i.exec(t),u;){var a={type:u[1],procType:null,contentDomain:null,dekInfo:null,headers:[],body:e.util.decode64(u[3])};if(n.push(a),u[2]){for(var f=u[2].split(o),l=0;u&&l<f.length;){for(var c=f[l].replace(/\s+$/,""),h=l+1;h<f.length;++h){var p=f[h];if(!/\s/.test(p[0]))break;c+=p,l=h}if(u=c.match(s)){for(var d={name:u[1],values:[]},v=u[2].split(","),m=0;m<v.length;++m)d.values.push(r(v[m]));if(a.procType)if(a.contentDomain||"Content-Domain"!==d.name)if(a.dekInfo||"DEK-Info"!==d.name)a.headers.push(d);else{if(0===d.values.length)throw{message:'Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.'};a.dekInfo={algorithm:v[0],parameters:v[1]||null}}else a.contentDomain=v[0]||"";else{if("Proc-Type"!==d.name)throw{message:'Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".'};if(2!==d.values.length)throw{message:'Invalid PEM formatted message. The "Proc-Type" header must have two subfields.'};a.procType={version:v[0],type:v[1]}}}++l}if("ENCRYPTED"===a.procType&&!a.dekInfo)throw{message:'Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".'}}}if(0===n.length)throw{message:"Invalid PEM formatted message."};return n}}var r="pem";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/pem",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function t(t,n){var r=function(){return new e.des.Algorithm(t,n)};e.cipher.registerAlgorithm(t,r)}function l(e){for(var b,t=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],n=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],r=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],i=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],s=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],o=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],u=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],a=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],f=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],l=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],c=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],h=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],p=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],d=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],v=e.length()>8?3:1,m=[],g=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],y=0,w=0;v>w;w++){var E=e.getInt32(),S=e.getInt32();b=252645135&(E>>>4^S),S^=b,E^=b<<4,b=65535&(S>>>-16^E),E^=b,S^=b<<-16,b=858993459&(E>>>2^S),S^=b,E^=b<<2,b=65535&(S>>>-16^E),E^=b,S^=b<<-16,b=1431655765&(E>>>1^S),S^=b,E^=b<<1,b=16711935&(S>>>8^E),E^=b,S^=b<<8,b=1431655765&(E>>>1^S),S^=b,E^=b<<1,b=E<<8|S>>>20&240,E=S<<24|S<<8&16711680|S>>>8&65280|S>>>24&240,S=b;for(var x=0;x<g.length;++x){g[x]?(E=E<<2|E>>>26,S=S<<2|S>>>26):(E=E<<1|E>>>27,S=S<<1|S>>>27),E&=-15,S&=-15;var T=t[E>>>28]|n[E>>>24&15]|r[E>>>20&15]|i[E>>>16&15]|s[E>>>12&15]|o[E>>>8&15]|u[E>>>4&15],N=a[S>>>28]|f[S>>>24&15]|l[S>>>20&15]|c[S>>>16&15]|h[S>>>12&15]|p[S>>>8&15]|d[S>>>4&15];b=65535&(N>>>16^T),m[y++]=T^b,m[y++]=N^b<<16}}return m}function c(e,t,l,c){var p,h=32===e.length?3:9;p=3===h?c?[30,-2,-2]:[0,32,2]:c?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var d,v=t[0],m=t[1];d=252645135&(v>>>4^m),m^=d,v^=d<<4,d=65535&(v>>>16^m),m^=d,v^=d<<16,d=858993459&(m>>>2^v),v^=d,m^=d<<2,d=16711935&(m>>>8^v),v^=d,m^=d<<8,d=1431655765&(v>>>1^m),m^=d,v^=d<<1,v=v<<1|v>>>31,m=m<<1|m>>>31;for(var g=0;h>g;g+=3){for(var y=p[g+1],b=p[g+2],w=p[g];w!=y;w+=b){var E=m^e[w],S=(m>>>4|m<<28)^e[w+1];d=v,v=m,m=d^(r[E>>>24&63]|s[E>>>16&63]|u[E>>>8&63]|f[63&E]|n[S>>>24&63]|i[S>>>16&63]|o[S>>>8&63]|a[63&S])}d=v,v=m,m=d}v=v>>>1|v<<31,m=m>>>1|m<<31,d=1431655765&(v>>>1^m),m^=d,v^=d<<1,d=16711935&(m>>>8^v),v^=d,m^=d<<8,d=858993459&(m>>>2^v),v^=d,m^=d<<2,d=65535&(v>>>16^m),m^=d,v^=d<<16,d=252645135&(v>>>4^m),m^=d,v^=d<<4,l[0]=v,l[1]=m}function h(t){t=t||{};var i,n=(t.mode||"CBC").toUpperCase(),r="DES-"+n;i=t.decrypt?e.cipher.createDecipher(r,t.key):e.cipher.createCipher(r,t.key);var s=i.start;return i.start=function(t,n){var r=null;n instanceof e.util.ByteBuffer&&(r=n,n={}),n=n||{},n.output=r,n.iv=t,s.call(i,n)},i}e.des=e.des||{},e.des.startEncrypting=function(e,t,n,r){var i=h({key:e,output:n,decrypt:!1,mode:r||(null===t?"ECB":"CBC")});return i.start(t),i},e.des.createEncryptionCipher=function(e,t){return h({key:e,output:null,decrypt:!1,mode:t})},e.des.startDecrypting=function(e,t,n,r){var i=h({key:e,output:n,decrypt:!0,mode:r||(null===t?"ECB":"CBC")});return i.start(t),i},e.des.createDecryptionCipher=function(e,t){return h({key:e,output:null,decrypt:!0,mode:t})},e.des.Algorithm=function(e,t){var n=this;n.name=e,n.mode=new t({blockSize:8,cipher:{encrypt:function(e,t){return c(n._keys,e,t,!1)},decrypt:function(e,t){return c(n._keys,e,t,!0)}}}),n._init=!1},e.des.Algorithm.prototype.initialize=function(t){if(!this._init){var n=e.util.createBuffer(t.key);if(0===this.name.indexOf("3DES")&&24!==n.length())throw new Error("Invalid Triple-DES key size: "+8*n.length());this._keys=l(n),this._init=!0}},t("DES-ECB",e.cipher.modes.ecb),t("DES-CBC",e.cipher.modes.cbc),t("DES-CFB",e.cipher.modes.cfb),t("DES-OFB",e.cipher.modes.ofb),t("DES-CTR",e.cipher.modes.ctr),t("3DES-ECB",e.cipher.modes.ecb),t("3DES-CBC",e.cipher.modes.cbc),t("3DES-CFB",e.cipher.modes.cfb),t("3DES-OFB",e.cipher.modes.ofb),t("3DES-CTR",e.cipher.modes.ctr);var n=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],r=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],i=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],s=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],o=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],u=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],a=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],f=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696]}var r="des";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/des",["require","module","./cipher","./cipherModes","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){var t=e.pkcs5=e.pkcs5||{};e.pbkdf2=t.pbkdf2=function(t,n,r,i,s){("undefined"==typeof s||null===s)&&(s=e.md.sha1.create());var o=s.digestLength;if(i>4294967295*o)throw{message:"Derived key is too long."};var u=Math.ceil(i/o),a=i-(u-1)*o,f=e.hmac.create();f.start(s,t);for(var c,h,p,l="",d=1;u>=d;++d){f.start(null,null),f.update(n),f.update(e.util.int32ToBytes(d)),c=p=f.digest().getBytes();for(var v=2;r>=v;++v)f.start(null,null),f.update(p),h=f.digest().getBytes(),c=e.util.xorBytes(c,h,o),p=h;l+=u>d?c:c.substr(0,a)}return l}}var r="pbkdf2";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/pbkdf2",["require","module","./hmac","./md","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){var n="undefined"!=typeof process&&process.versions&&process.versions.node,r=null;!e.disableNativeCode&&n&&(r=t("crypto"));var i=e.prng=e.prng||{};i.create=function(t){function u(e){if(n.pools[0].messageLength>=32)return f(),e();var t=32-n.pools[0].messageLength<<5;n.seedFile(t,function(t,r){return t?e(t):(n.collect(r),f(),e(),void 0)})}function a(){if(n.pools[0].messageLength>=32)return f();var e=32-n.pools[0].messageLength<<5;n.collect(n.seedFileSync(e)),f()}function f(){var e=n.plugin.md.create();e.update(n.pools[0].digest().getBytes()),n.pools[0].start();for(var t=1,r=1;32>r;++r)t=31===t?2147483648:t<<2,t%n.reseeds===0&&(e.update(n.pools[r].digest().getBytes()),n.pools[r].start());var i=e.digest().getBytes();e.start(),e.update(i);var s=e.digest().getBytes();n.key=n.plugin.formatKey(i),n.seed=n.plugin.formatSeed(s),n.reseeds=4294967295===n.reseeds?0:n.reseeds+1,n.generated=0}function l(t){var n=null;if("undefined"!=typeof window){var r=window.crypto||window.msCrypto;r&&r.getRandomValues&&(n=function(e){return r.getRandomValues(e)})}var i=e.util.createBuffer();if(n)for(;i.length()<t;){var s=Math.max(1,Math.min(t-i.length(),65536)/4),o=new Uint32Array(Math.floor(s));try{n(o);for(var u=0;u<o.length;++u)i.putInt32(o[u])}catch(a){if(!("undefined"!=typeof QuotaExceededError&&a instanceof QuotaExceededError))throw a}}if(i.length()<t)for(var f,l,c,h=Math.floor(65536*Math.random());i.length()<t;){l=16807*(65535&h),f=16807*(h>>16),l+=(32767&f)<<16,l+=f>>15,l=(2147483647&l)+(l>>31),h=4294967295&l;for(var u=0;3>u;++u)c=h>>>(u<<3),c^=Math.floor(256*Math.random()),i.putByte(String.fromCharCode(255&c))}return i.getBytes(t)}for(var n={plugin:t,key:null,seed:null,time:null,reseeds:0,generated:0},i=t.md,s=new Array(32),o=0;32>o;++o)s[o]=i.create();return n.pools=s,n.pool=0,n.generate=function(t,r){function l(c){if(c)return r(c);if(f.length()>=t)return r(null,f.getBytes(t));if(n.generated>1048575&&(n.key=null),null===n.key)return e.util.nextTick(function(){u(l)});var h=i(n.key,n.seed);n.generated+=h.length,f.putBytes(h),n.key=o(i(n.key,s(n.seed))),n.seed=a(i(n.key,n.seed)),e.util.setImmediate(l)}if(!r)return n.generateSync(t);var i=n.plugin.cipher,s=n.plugin.increment,o=n.plugin.formatKey,a=n.plugin.formatSeed,f=e.util.createBuffer();n.key=null,l()},n.generateSync=function(t){var r=n.plugin.cipher,i=n.plugin.increment,s=n.plugin.formatKey,o=n.plugin.formatSeed;n.key=null;for(var u=e.util.createBuffer();u.length()<t;){n.generated>1048575&&(n.key=null),null===n.key&&a();var f=r(n.key,n.seed);n.generated+=f.length,u.putBytes(f),n.key=s(r(n.key,i(n.seed))),n.seed=o(r(n.key,n.seed))}return u.getBytes(t)},r?(n.seedFile=function(e,t){r.randomBytes(e,function(e,n){return e?t(e):void t(null,n.toString())})},n.seedFileSync=function(e){return r.randomBytes(e).toString()}):(n.seedFile=function(e,t){try{t(null,l(e))}catch(n){t(n)}},n.seedFileSync=l),n.collect=function(e){for(var t=e.length,r=0;t>r;++r)n.pools[n.pool].update(e.substr(r,1)),n.pool=31===n.pool?0:n.pool+1},n.collectInt=function(e,t){for(var r="",i=0;t>i;i+=8)r+=String.fromCharCode(e>>i&255);n.collect(r)},n.registerWorker=function(e){if(e===self)n.seedFile=function(e,t){function n(e){var r=e.data;r.forge&&r.forge.prng&&(self.removeEventListener("message",n),t(r.forge.prng.err,r.forge.prng.bytes))}self.addEventListener("message",n),self.postMessage({forge:{prng:{needed:e}}})};else{var t=function(t){var r=t.data;r.forge&&r.forge.prng&&n.seedFile(r.forge.prng.needed,function(t,n){e.postMessage({forge:{prng:{err:t,bytes:n}}})})};e.addEventListener("message",t)}},n}}var r="prng";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/prng",["require","module","./md","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){e.random&&e.random.getBytes||!function(t){function s(){var t=e.prng.create(n);return t.getBytes=function(e,n){return t.generate(e,n)},t.getBytesSync=function(e){return t.generate(e)},t}var n={},r=new Array(4),i=e.util.createBuffer();n.formatKey=function(t){var n=e.util.createBuffer(t);return t=new Array(4),t[0]=n.getInt32(),t[1]=n.getInt32(),t[2]=n.getInt32(),t[3]=n.getInt32(),e.aes._expandKey(t,!1)},n.formatSeed=function(t){var n=e.util.createBuffer(t);return t=new Array(4),t[0]=n.getInt32(),t[1]=n.getInt32(),t[2]=n.getInt32(),t[3]=n.getInt32(),t},n.cipher=function(t,n){return e.aes._updateBlock(t,n,r,!1),i.putInt32(r[0]),i.putInt32(r[1]),i.putInt32(r[2]),i.putInt32(r[3]),i.getBytes()},n.increment=function(e){return++e[3],e},n.md=e.md.sha256;var o=s(),u="undefined"!=typeof process&&process.versions&&process.versions.node,a=null;if("undefined"!=typeof window){var f=window.crypto||window.msCrypto;f&&f.getRandomValues&&(a=function(e){return f.getRandomValues(e)})}if(e.disableNativeCode||!u&&!a){if("undefined"==typeof window||void 0===window.document,o.collectInt(+new Date,32),"undefined"!=typeof navigator){var l="";for(var c in navigator)try{"string"==typeof navigator[c]&&(l+=navigator[c])}catch(h){}o.collect(l),l=null}t&&(t().mousemove(function(e){o.collectInt(e.clientX,16),o.collectInt(e.clientY,16)}),t().keypress(function(e){o.collectInt(e.charCode,8)}))}if(e.random)for(var c in o)e.random[c]=o[c];else e.random=o;e.random.createInstance=s}("undefined"!=typeof jQuery?jQuery:null)}var r="random";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/random",["require","module","./aes","./md","./prng","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){var t=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],n=[1,2,3,5],r=function(e,t){return e<<t&65535|(65535&e)>>16-t},i=function(e,t){return(65535&e)>>t|e<<16-t&65535};e.rc2=e.rc2||{},e.rc2.expandKey=function(n,r){"string"==typeof n&&(n=e.util.createBuffer(n)),r=r||128;var f,i=n,s=n.length(),o=r,u=Math.ceil(o/8),a=255>>(7&o);for(f=s;128>f;f++)i.putByte(t[i.at(f-1)+i.at(f-s)&255]);for(i.setAt(128-u,t[i.at(128-u)&a]),f=127-u;f>=0;f--)i.setAt(f,t[i.at(f+1)^i.at(f+u)]);return i};var s=function(t,s,o){var c,h,p,d,u=!1,a=null,f=null,l=null,v=[];for(t=e.rc2.expandKey(t,s),p=0;64>p;p++)v.push(t.getInt16Le());o?(c=function(e){for(p=0;4>p;p++)e[p]+=v[d]+(e[(p+3)%4]&e[(p+2)%4])+(~e[(p+3)%4]&e[(p+1)%4]),e[p]=r(e[p],n[p]),d++},h=function(e){for(p=0;4>p;p++)e[p]+=v[63&e[(p+3)%4]]}):(c=function(e){for(p=3;p>=0;p--)e[p]=i(e[p],n[p]),e[p]-=v[d]+(e[(p+3)%4]&e[(p+2)%4])+(~e[(p+3)%4]&e[(p+1)%4]),d--},h=function(e){for(p=3;p>=0;p--)e[p]-=v[63&e[(p+3)%4]]});var m=function(e){var t=[];for(p=0;4>p;p++){var n=a.getInt16Le();null!==l&&(o?n^=l.getInt16Le():l.putInt16Le(n)),t.push(65535&n)}d=o?0:63;for(var r=0;r<e.length;r++)for(var i=0;i<e[r][0];i++)e[r][1](t);for(p=0;4>p;p++)null!==l&&(o?l.putInt16Le(t[p]):t[p]^=l.getInt16Le()),f.putInt16Le(t[p])},g=null;return g={start:function(t,n){t&&"string"==typeof t&&(t=e.util.createBuffer(t)),u=!1,a=e.util.createBuffer(),f=n||new e.util.createBuffer,l=t,g.output=f},update:function(e){for(u||a.putBuffer(e);a.length()>=8;)m([[5,c],[1,h],[6,c],[1,h],[5,c]])},finish:function(e){var t=!0;if(o)if(e)t=e(8,a,!o);else{var n=8===a.length()?8:8-a.length();a.fillWithByte(n,n)}if(t&&(u=!0,g.update()),!o&&(t=0===a.length()))if(e)t=e(8,f,!o);else{var r=f.length(),i=f.at(r-1);i>r?t=!1:f.truncate(i)}return t}}};e.rc2.startEncrypting=function(t,n,r){var i=e.rc2.createEncryptionCipher(t,128);return i.start(n,r),i},e.rc2.createEncryptionCipher=function(e,t){return s(e,t,!0)},e.rc2.startDecrypting=function(t,n,r){var i=e.rc2.createDecryptionCipher(t,128);return i.start(n,r),i},e.rc2.createDecryptionCipher=function(e,t){return s(e,t,!1)}}var r="rc2";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/rc2",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function i(e,t,n){this.data=[],null!=e&&("number"==typeof e?this.fromNumber(e,t,n):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function s(){return new i(null)}function o(e,t,n,r,i,s){for(;--s>=0;){var o=t*this.data[e++]+n.data[r]+i;i=Math.floor(o/67108864),n.data[r++]=67108863&o}return i}function u(e,t,n,r,i,s){for(var o=32767&t,u=t>>15;--s>=0;){var a=32767&this.data[e],f=this.data[e++]>>15,l=u*a+f*o;a=o*a+((32767&l)<<15)+n.data[r]+(1073741823&i),i=(a>>>30)+(l>>>15)+u*f+(i>>>30),n.data[r++]=1073741823&a}return i}function a(e,t,n,r,i,s){for(var o=16383&t,u=t>>14;--s>=0;){var a=16383&this.data[e],f=this.data[e++]>>14,l=u*a+f*o;a=o*a+((16383&l)<<14)+n.data[r]+i,i=(a>>28)+(l>>14)+u*f,n.data[r++]=268435455&a}return i}function d(e){return l.charAt(e)
}function v(e,t){var n=c[e.charCodeAt(t)];return null==n?-1:n}function m(e){for(var t=this.t-1;t>=0;--t)e.data[t]=this.data[t];e.t=this.t,e.s=this.s}function g(e){this.t=1,this.s=0>e?-1:0,e>0?this.data[0]=e:-1>e?this.data[0]=e+this.DV:this.t=0}function y(e){var t=s();return t.fromInt(e),t}function b(e,t){var n;if(16==t)n=4;else if(8==t)n=3;else if(256==t)n=8;else if(2==t)n=1;else if(32==t)n=5;else{if(4!=t)return void this.fromRadix(e,t);n=2}this.t=0,this.s=0;for(var r=e.length,s=!1,o=0;--r>=0;){var u=8==n?255&e[r]:v(e,r);0>u?"-"==e.charAt(r)&&(s=!0):(s=!1,0==o?this.data[this.t++]=u:o+n>this.DB?(this.data[this.t-1]|=(u&(1<<this.DB-o)-1)<<o,this.data[this.t++]=u>>this.DB-o):this.data[this.t-1]|=u<<o,o+=n,o>=this.DB&&(o-=this.DB))}8==n&&0!=(128&e[0])&&(this.s=-1,o>0&&(this.data[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),s&&i.ZERO.subTo(this,this)}function w(){for(var e=this.s&this.DM;this.t>0&&this.data[this.t-1]==e;)--this.t}function E(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var r,n=(1<<t)-1,i=!1,s="",o=this.t,u=this.DB-o*this.DB%t;if(o-->0)for(u<this.DB&&(r=this.data[o]>>u)>0&&(i=!0,s=d(r));o>=0;)t>u?(r=(this.data[o]&(1<<u)-1)<<t-u,r|=this.data[--o]>>(u+=this.DB-t)):(r=this.data[o]>>(u-=t)&n,0>=u&&(u+=this.DB,--o)),r>0&&(i=!0),i&&(s+=d(r));return i?s:"0"}function S(){var e=s();return i.ZERO.subTo(this,e),e}function x(){return this.s<0?this.negate():this}function T(e){var t=this.s-e.s;if(0!=t)return t;var n=this.t;if(t=n-e.t,0!=t)return this.s<0?-t:t;for(;--n>=0;)if(0!=(t=this.data[n]-e.data[n]))return t;return 0}function N(e){var n,t=1;return 0!=(n=e>>>16)&&(e=n,t+=16),0!=(n=e>>8)&&(e=n,t+=8),0!=(n=e>>4)&&(e=n,t+=4),0!=(n=e>>2)&&(e=n,t+=2),0!=(n=e>>1)&&(e=n,t+=1),t}function C(){return this.t<=0?0:this.DB*(this.t-1)+N(this.data[this.t-1]^this.s&this.DM)}function k(e,t){var n;for(n=this.t-1;n>=0;--n)t.data[n+e]=this.data[n];for(n=e-1;n>=0;--n)t.data[n]=0;t.t=this.t+e,t.s=this.s}function L(e,t){for(var n=e;n<this.t;++n)t.data[n-e]=this.data[n];t.t=Math.max(this.t-e,0),t.s=this.s}function A(e,t){var u,n=e%this.DB,r=this.DB-n,i=(1<<r)-1,s=Math.floor(e/this.DB),o=this.s<<n&this.DM;for(u=this.t-1;u>=0;--u)t.data[u+s+1]=this.data[u]>>r|o,o=(this.data[u]&i)<<n;for(u=s-1;u>=0;--u)t.data[u]=0;t.data[s]=o,t.t=this.t+s+1,t.s=this.s,t.clamp()}function O(e,t){t.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t)return void(t.t=0);var r=e%this.DB,i=this.DB-r,s=(1<<r)-1;t.data[0]=this.data[n]>>r;for(var o=n+1;o<this.t;++o)t.data[o-n-1]|=(this.data[o]&s)<<i,t.data[o-n]=this.data[o]>>r;r>0&&(t.data[this.t-n-1]|=(this.s&s)<<i),t.t=this.t-n,t.clamp()}function M(e,t){for(var n=0,r=0,i=Math.min(e.t,this.t);i>n;)r+=this.data[n]-e.data[n],t.data[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r-=e.s;n<this.t;)r+=this.data[n],t.data[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<e.t;)r-=e.data[n],t.data[n++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=0>r?-1:0,-1>r?t.data[n++]=this.DV+r:r>0&&(t.data[n++]=r),t.t=n,t.clamp()}function _(e,t){var n=this.abs(),r=e.abs(),s=n.t;for(t.t=s+r.t;--s>=0;)t.data[s]=0;for(s=0;s<r.t;++s)t.data[s+n.t]=n.am(0,r.data[s],t,s,0,n.t);t.s=0,t.clamp(),this.s!=e.s&&i.ZERO.subTo(t,t)}function D(e){for(var t=this.abs(),n=e.t=2*t.t;--n>=0;)e.data[n]=0;for(n=0;n<t.t-1;++n){var r=t.am(n,t.data[n],e,2*n,0,1);(e.data[n+t.t]+=t.am(n+1,2*t.data[n],e,2*n+1,r,t.t-n-1))>=t.DV&&(e.data[n+t.t]-=t.DV,e.data[n+t.t+1]=1)}e.t>0&&(e.data[e.t-1]+=t.am(n,t.data[n],e,2*n,0,1)),e.s=0,e.clamp()}function P(e,t,n){var r=e.abs();if(!(r.t<=0)){var o=this.abs();if(o.t<r.t)return null!=t&&t.fromInt(0),void(null!=n&&this.copyTo(n));null==n&&(n=s());var u=s(),a=this.s,f=e.s,l=this.DB-N(r.data[r.t-1]);l>0?(r.lShiftTo(l,u),o.lShiftTo(l,n)):(r.copyTo(u),o.copyTo(n));var c=u.t,h=u.data[c-1];if(0!=h){var p=h*(1<<this.F1)+(c>1?u.data[c-2]>>this.F2:0),d=this.FV/p,v=(1<<this.F1)/p,m=1<<this.F2,g=n.t,y=g-c,b=null==t?s():t;for(u.dlShiftTo(y,b),n.compareTo(b)>=0&&(n.data[n.t++]=1,n.subTo(b,n)),i.ONE.dlShiftTo(c,b),b.subTo(u,u);u.t<c;)u.data[u.t++]=0;for(;--y>=0;){var w=n.data[--g]==h?this.DM:Math.floor(n.data[g]*d+(n.data[g-1]+m)*v);if((n.data[g]+=u.am(0,w,n,y,0,c))<w)for(u.dlShiftTo(y,b),n.subTo(b,n);n.data[g]<--w;)n.subTo(b,n)}null!=t&&(n.drShiftTo(c,t),a!=f&&i.ZERO.subTo(t,t)),n.t=c,n.clamp(),l>0&&n.rShiftTo(l,n),0>a&&i.ZERO.subTo(n,n)}}}function H(e){var t=s();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(i.ZERO)>0&&e.subTo(t,t),t}function B(e){this.m=e}function j(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e}function F(e){return e}function I(e){e.divRemTo(this.m,null,e)}function q(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function R(e,t){e.squareTo(t),this.reduce(t)}function U(){if(this.t<1)return 0;var e=this.data[0];if(0==(1&e))return 0;var t=3&e;return t=t*(2-(15&e)*t)&15,t=t*(2-(255&e)*t)&255,t=t*(2-((65535&e)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}function z(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function W(e){var t=s();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(i.ZERO)>0&&this.m.subTo(t,t),t}function X(e){var t=s();return e.copyTo(t),this.reduce(t),t}function V(e){for(;e.t<=this.mt2;)e.data[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=32767&e.data[t],r=n*this.mpl+((n*this.mph+(e.data[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(n=t+this.m.t,e.data[n]+=this.m.am(0,r,e,t,0,this.m.t);e.data[n]>=e.DV;)e.data[n]-=e.DV,e.data[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function $(e,t){e.squareTo(t),this.reduce(t)}function J(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function K(){return 0==(this.t>0?1&this.data[0]:this.s)}function Q(e,t){if(e>4294967295||1>e)return i.ONE;var n=s(),r=s(),o=t.convert(this),u=N(e)-1;for(o.copyTo(n);--u>=0;)if(t.sqrTo(n,r),(e&1<<u)>0)t.mulTo(r,o,n);else{var a=n;n=r,r=a}return t.revert(n)}function G(e,t){var n;return n=256>e||t.isEven()?new B(t):new z(t),this.exp(e,n)}function Y(){var e=s();return this.copyTo(e),e}function Z(){if(this.s<0){if(1==this.t)return this.data[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this.data[0];if(0==this.t)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function et(){return 0==this.t?this.s:this.data[0]<<24>>24}function tt(){return 0==this.t?this.s:this.data[0]<<16>>16}function nt(e){return Math.floor(Math.LN2*this.DB/Math.log(e))}function rt(){return this.s<0?-1:this.t<=0||1==this.t&&this.data[0]<=0?0:1}function it(e){if(null==e&&(e=10),0==this.signum()||2>e||e>36)return"0";var t=this.chunkSize(e),n=Math.pow(e,t),r=y(n),i=s(),o=s(),u="";for(this.divRemTo(r,i,o);i.signum()>0;)u=(n+o.intValue()).toString(e).substr(1)+u,i.divRemTo(r,i,o);return o.intValue().toString(e)+u}function st(e,t){this.fromInt(0),null==t&&(t=10);for(var n=this.chunkSize(t),r=Math.pow(t,n),s=!1,o=0,u=0,a=0;a<e.length;++a){var f=v(e,a);0>f?"-"==e.charAt(a)&&0==this.signum()&&(s=!0):(u=t*u+f,++o>=n&&(this.dMultiply(r),this.dAddOffset(u,0),o=0,u=0))}o>0&&(this.dMultiply(Math.pow(t,o)),this.dAddOffset(u,0)),s&&i.ZERO.subTo(this,this)}function ot(e,t,n){if("number"==typeof t)if(2>e)this.fromInt(1);else for(this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo(i.ONE.shiftLeft(e-1),dt,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(i.ONE.shiftLeft(e-1),this);else{var r=new Array,s=7&e;r.length=(e>>3)+1,t.nextBytes(r),s>0?r[0]&=(1<<s)-1:r[0]=0,this.fromString(r,256)}}function ut(){var e=this.t,t=new Array;t[0]=this.s;var r,n=this.DB-e*this.DB%8,i=0;if(e-->0)for(n<this.DB&&(r=this.data[e]>>n)!=(this.s&this.DM)>>n&&(t[i++]=r|this.s<<this.DB-n);e>=0;)8>n?(r=(this.data[e]&(1<<n)-1)<<8-n,r|=this.data[--e]>>(n+=this.DB-8)):(r=this.data[e]>>(n-=8)&255,0>=n&&(n+=this.DB,--e)),0!=(128&r)&&(r|=-256),0==i&&(128&this.s)!=(128&r)&&++i,(i>0||r!=this.s)&&(t[i++]=r);return t}function at(e){return 0==this.compareTo(e)}function ft(e){return this.compareTo(e)<0?this:e}function lt(e){return this.compareTo(e)>0?this:e}function ct(e,t,n){var r,i,s=Math.min(e.t,this.t);for(r=0;s>r;++r)n.data[r]=t(this.data[r],e.data[r]);if(e.t<this.t){for(i=e.s&this.DM,r=s;r<this.t;++r)n.data[r]=t(this.data[r],i);n.t=this.t}else{for(i=this.s&this.DM,r=s;r<e.t;++r)n.data[r]=t(i,e.data[r]);n.t=e.t}n.s=t(this.s,e.s),n.clamp()}function ht(e,t){return e&t}function pt(e){var t=s();return this.bitwiseTo(e,ht,t),t}function dt(e,t){return e|t}function vt(e){var t=s();return this.bitwiseTo(e,dt,t),t}function mt(e,t){return e^t}function gt(e){var t=s();return this.bitwiseTo(e,mt,t),t}function yt(e,t){return e&~t}function bt(e){var t=s();return this.bitwiseTo(e,yt,t),t}function wt(){for(var e=s(),t=0;t<this.t;++t)e.data[t]=this.DM&~this.data[t];return e.t=this.t,e.s=~this.s,e}function Et(e){var t=s();return 0>e?this.rShiftTo(-e,t):this.lShiftTo(e,t),t}function St(e){var t=s();return 0>e?this.lShiftTo(-e,t):this.rShiftTo(e,t),t}function xt(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function Tt(){for(var e=0;e<this.t;++e)if(0!=this.data[e])return e*this.DB+xt(this.data[e]);return this.s<0?this.t*this.DB:-1}function Nt(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function Ct(){for(var e=0,t=this.s&this.DM,n=0;n<this.t;++n)e+=Nt(this.data[n]^t);return e}function kt(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this.data[t]&1<<e%this.DB)}function Lt(e,t){var n=i.ONE.shiftLeft(e);return this.bitwiseTo(n,t,n),n}function At(e){return this.changeBit(e,dt)}function Ot(e){return this.changeBit(e,yt)}function Mt(e){return this.changeBit(e,mt)}function _t(e,t){for(var n=0,r=0,i=Math.min(e.t,this.t);i>n;)r+=this.data[n]+e.data[n],t.data[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r+=e.s;n<this.t;)r+=this.data[n],t.data[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<e.t;)r+=e.data[n],t.data[n++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=0>r?-1:0,r>0?t.data[n++]=r:-1>r&&(t.data[n++]=this.DV+r),t.t=n,t.clamp()}function Dt(e){var t=s();return this.addTo(e,t),t}function Pt(e){var t=s();return this.subTo(e,t),t}function Ht(e){var t=s();return this.multiplyTo(e,t),t}function Bt(e){var t=s();return this.divRemTo(e,t,null),t}function jt(e){var t=s();return this.divRemTo(e,null,t),t}function Ft(e){var t=s(),n=s();return this.divRemTo(e,t,n),new Array(t,n)}function It(e){this.data[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()}function qt(e,t){if(0!=e){for(;this.t<=t;)this.data[this.t++]=0;for(this.data[t]+=e;this.data[t]>=this.DV;)this.data[t]-=this.DV,++t>=this.t&&(this.data[this.t++]=0),++this.data[t]}}function Rt(){}function Ut(e){return e}function zt(e,t,n){e.multiplyTo(t,n)}function Wt(e,t){e.squareTo(t)}function Xt(e){return this.exp(e,new Rt)}function Vt(e,t,n){var r=Math.min(this.t+e.t,t);for(n.s=0,n.t=r;r>0;)n.data[--r]=0;var i;for(i=n.t-this.t;i>r;++r)n.data[r+this.t]=this.am(0,e.data[r],n,r,0,this.t);for(i=Math.min(e.t,t);i>r;++r)this.am(0,e.data[r],n,r,0,t-r);n.clamp()}function $t(e,t,n){--t;var r=n.t=this.t+e.t-t;for(n.s=0;--r>=0;)n.data[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)n.data[this.t+r-t]=this.am(t-r,e.data[r],n,0,0,this.t+r-t);n.clamp(),n.drShiftTo(1,n)}function Jt(e){this.r2=s(),this.q3=s(),i.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}function Kt(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=s();return e.copyTo(t),this.reduce(t),t}function Qt(e){return e}function Gt(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)}function Yt(e,t){e.squareTo(t),this.reduce(t)}function Zt(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function en(e,t){var r,o,n=e.bitLength(),i=y(1);if(0>=n)return i;r=18>n?1:48>n?3:144>n?4:768>n?5:6,o=8>n?new B(t):t.isEven()?new Jt(t):new z(t);var u=new Array,a=3,f=r-1,l=(1<<r)-1;if(u[1]=o.convert(this),r>1){var c=s();for(o.sqrTo(u[1],c);l>=a;)u[a]=s(),o.mulTo(c,u[a-2],u[a]),a+=2}var p,m,h=e.t-1,d=!0,v=s();for(n=N(e.data[h])-1;h>=0;){for(n>=f?p=e.data[h]>>n-f&l:(p=(e.data[h]&(1<<n+1)-1)<<f-n,h>0&&(p|=e.data[h-1]>>this.DB+n-f)),a=r;0==(1&p);)p>>=1,--a;if((n-=a)<0&&(n+=this.DB,--h),d)u[p].copyTo(i),d=!1;else{for(;a>1;)o.sqrTo(i,v),o.sqrTo(v,i),a-=2;a>0?o.sqrTo(i,v):(m=i,i=v,v=m),o.mulTo(v,u[p],i)}for(;h>=0&&0==(e.data[h]&1<<n);)o.sqrTo(i,v),m=i,i=v,v=m,--n<0&&(n=this.DB-1,--h)}return o.revert(i)}function tn(e){var t=this.s<0?this.negate():this.clone(),n=e.s<0?e.negate():e.clone();if(t.compareTo(n)<0){var r=t;t=n,n=r}var i=t.getLowestSetBit(),s=n.getLowestSetBit();if(0>s)return t;for(s>i&&(s=i),s>0&&(t.rShiftTo(s,t),n.rShiftTo(s,n));t.signum()>0;)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=n.getLowestSetBit())>0&&n.rShiftTo(i,n),t.compareTo(n)>=0?(t.subTo(n,t),t.rShiftTo(1,t)):(n.subTo(t,n),n.rShiftTo(1,n));return s>0&&n.lShiftTo(s,n),n}function nn(e){if(0>=e)return 0;var t=this.DV%e,n=this.s<0?e-1:0;if(this.t>0)if(0==t)n=this.data[0]%e;else for(var r=this.t-1;r>=0;--r)n=(t*n+this.data[r])%e;return n}function rn(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return i.ZERO;for(var n=e.clone(),r=this.clone(),s=y(1),o=y(0),u=y(0),a=y(1);0!=n.signum();){for(;n.isEven();)n.rShiftTo(1,n),t?(s.isEven()&&o.isEven()||(s.addTo(this,s),o.subTo(e,o)),s.rShiftTo(1,s)):o.isEven()||o.subTo(e,o),o.rShiftTo(1,o);for(;r.isEven();)r.rShiftTo(1,r),t?(u.isEven()&&a.isEven()||(u.addTo(this,u),a.subTo(e,a)),u.rShiftTo(1,u)):a.isEven()||a.subTo(e,a),a.rShiftTo(1,a);n.compareTo(r)>=0?(n.subTo(r,n),t&&s.subTo(u,s),o.subTo(a,o)):(r.subTo(n,r),t&&u.subTo(s,u),a.subTo(o,a))}return 0!=r.compareTo(i.ONE)?i.ZERO:a.compareTo(e)>=0?a.subtract(e):a.signum()<0?(a.addTo(e,a),a.signum()<0?a.add(e):a):a}function un(e){var t,n=this.abs();if(1==n.t&&n.data[0]<=sn[sn.length-1]){for(t=0;t<sn.length;++t)if(n.data[0]==sn[t])return!0;return!1}if(n.isEven())return!1;for(t=1;t<sn.length;){for(var r=sn[t],i=t+1;i<sn.length&&on>r;)r*=sn[i++];for(r=n.modInt(r);i>t;)if(r%sn[t++]==0)return!1}return n.millerRabin(e)}function an(e){var t=this.subtract(i.ONE),n=t.getLowestSetBit();if(0>=n)return!1;for(var o,r=t.shiftRight(n),s=fn(),u=0;e>u;++u){do o=new i(this.bitLength(),s);while(o.compareTo(i.ONE)<=0||o.compareTo(t)>=0);var a=o.modPow(r,this);if(0!=a.compareTo(i.ONE)&&0!=a.compareTo(t)){for(var f=1;f++<n&&0!=a.compareTo(t);)if(a=a.modPowInt(2,this),0==a.compareTo(i.ONE))return!1;if(0!=a.compareTo(t))return!1}}return!0}function fn(){return{nextBytes:function(e){for(var t=0;t<e.length;++t)e[t]=Math.floor(255*Math.random())}}}var t,n=0xdeadbeefcafe,r=15715070==(16777215&n);"undefined"==typeof navigator?(i.prototype.am=a,t=28):r&&"Microsoft Internet Explorer"==navigator.appName?(i.prototype.am=u,t=30):r&&"Netscape"!=navigator.appName?(i.prototype.am=o,t=26):(i.prototype.am=a,t=28),i.prototype.DB=t,i.prototype.DM=(1<<t)-1,i.prototype.DV=1<<t;var f=52;i.prototype.FV=Math.pow(2,f),i.prototype.F1=f-t,i.prototype.F2=2*t-f;var h,p,l="0123456789abcdefghijklmnopqrstuvwxyz",c=new Array;for(h="0".charCodeAt(0),p=0;9>=p;++p)c[h++]=p;for(h="a".charCodeAt(0),p=10;36>p;++p)c[h++]=p;for(h="A".charCodeAt(0),p=10;36>p;++p)c[h++]=p;B.prototype.convert=j,B.prototype.revert=F,B.prototype.reduce=I,B.prototype.mulTo=q,B.prototype.sqrTo=R,z.prototype.convert=W,z.prototype.revert=X,z.prototype.reduce=V,z.prototype.mulTo=J,z.prototype.sqrTo=$,i.prototype.copyTo=m,i.prototype.fromInt=g,i.prototype.fromString=b,i.prototype.clamp=w,i.prototype.dlShiftTo=k,i.prototype.drShiftTo=L,i.prototype.lShiftTo=A,i.prototype.rShiftTo=O,i.prototype.subTo=M,i.prototype.multiplyTo=_,i.prototype.squareTo=D,i.prototype.divRemTo=P,i.prototype.invDigit=U,i.prototype.isEven=K,i.prototype.exp=Q,i.prototype.toString=E,i.prototype.negate=S,i.prototype.abs=x,i.prototype.compareTo=T,i.prototype.bitLength=C,i.prototype.mod=H,i.prototype.modPowInt=G,i.ZERO=y(0),i.ONE=y(1),Rt.prototype.convert=Ut,Rt.prototype.revert=Ut,Rt.prototype.mulTo=zt,Rt.prototype.sqrTo=Wt,Jt.prototype.convert=Kt,Jt.prototype.revert=Qt,Jt.prototype.reduce=Gt,Jt.prototype.mulTo=Zt,Jt.prototype.sqrTo=Yt;var sn=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],on=(1<<26)/sn[sn.length-1];i.prototype.chunkSize=nt,i.prototype.toRadix=it,i.prototype.fromRadix=st,i.prototype.fromNumber=ot,i.prototype.bitwiseTo=ct,i.prototype.changeBit=Lt,i.prototype.addTo=_t,i.prototype.dMultiply=It,i.prototype.dAddOffset=qt,i.prototype.multiplyLowerTo=Vt,i.prototype.multiplyUpperTo=$t,i.prototype.modInt=nn,i.prototype.millerRabin=an,i.prototype.clone=Y,i.prototype.intValue=Z,i.prototype.byteValue=et,i.prototype.shortValue=tt,i.prototype.signum=rt,i.prototype.toByteArray=ut,i.prototype.equals=at,i.prototype.min=ft,i.prototype.max=lt,i.prototype.and=pt,i.prototype.or=vt,i.prototype.xor=gt,i.prototype.andNot=bt,i.prototype.not=wt,i.prototype.shiftLeft=Et,i.prototype.shiftRight=St,i.prototype.getLowestSetBit=Tt,i.prototype.bitCount=Ct,i.prototype.testBit=kt,i.prototype.setBit=At,i.prototype.clearBit=Ot,i.prototype.flipBit=Mt,i.prototype.add=Dt,i.prototype.subtract=Pt,i.prototype.multiply=Ht,i.prototype.divide=Bt,i.prototype.remainder=jt,i.prototype.divideAndRemainder=Ft,i.prototype.modPow=en,i.prototype.modInverse=rn,i.prototype.pow=Xt,i.prototype.gcd=tn,i.prototype.isProbablePrime=un,e.jsbn=e.jsbn||{},e.jsbn.BigInteger=i}var r="jsbn";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/jsbn",["require","module"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function n(t,n,r){r||(r=e.md.sha1.create());for(var i="",s=Math.ceil(n/r.digestLength),o=0;s>o;++o){var u=String.fromCharCode(o>>24&255,o>>16&255,o>>8&255,255&o);r.start(),r.update(t+u),i+=r.digest().getBytes()}return i.substring(0,n)}var t=e.pkcs1=e.pkcs1||{};t.encode_rsa_oaep=function(t,r,i){var s,o,u,a;"string"==typeof i?(s=i,o=arguments[3]||void 0,u=arguments[4]||void 0):i&&(s=i.label||void 0,o=i.seed||void 0,u=i.md||void 0,i.mgf1&&i.mgf1.md&&(a=i.mgf1.md)),u?u.start():u=e.md.sha1.create(),a||(a=u);var f=Math.ceil(t.n.bitLength()/8),l=f-2*u.digestLength-2;if(r.length>l)throw{message:"RSAES-OAEP input message length is too long.",length:r.length,maxLength:l};s||(s=""),u.update(s,"raw");for(var c=u.digest(),h="",p=l-r.length,d=0;p>d;d++)h+="\x00";var v=c.getBytes()+h+""+r;if(o){if(o.length!==u.digestLength)throw{message:"Invalid RSAES-OAEP seed. The seed length must match the digest length.",seedLength:o.length,digestLength:u.digestLength}}else o=e.random.getBytes(u.digestLength);var m=n(o,f-u.digestLength-1,a),g=e.util.xorBytes(v,m,v.length),y=n(g,u.digestLength,a),b=e.util.xorBytes(o,y,o.length);return"\x00"+b+g},t.decode_rsa_oaep=function(t,r,i){var s,o,u;"string"==typeof i?(s=i,o=arguments[3]||void 0):i&&(s=i.label||void 0,o=i.md||void 0,i.mgf1&&i.mgf1.md&&(u=i.mgf1.md));var a=Math.ceil(t.n.bitLength()/8);if(r.length!==a)throw{message:"RSAES-OAEP encoded message length is invalid.",length:r.length,expectedLength:a};if(void 0===o?o=e.md.sha1.create():o.start(),u||(u=o),a<2*o.digestLength+2)throw{message:"RSAES-OAEP key is too short for the hash function."};s||(s=""),o.update(s,"raw");for(var f=o.digest().getBytes(),l=r.charAt(0),c=r.substring(1,o.digestLength+1),h=r.substring(1+o.digestLength),p=n(h,o.digestLength,u),d=e.util.xorBytes(c,p,c.length),v=n(d,a-o.digestLength-1,u),m=e.util.xorBytes(h,v,h.length),g=m.substring(0,o.digestLength),y="\x00"!==l,b=0;b<o.digestLength;++b)y|=f.charAt(b)!==g.charAt(b);for(var w=1,E=o.digestLength,S=o.digestLength;S<m.length;S++){var x=m.charCodeAt(S),T=1&x^1,N=w?65534:0;y|=x&N,w&=T,E+=w}if(y||1!==m.charCodeAt(E))throw{message:"Invalid RSAES-OAEP padding."};return m.substring(E+1)}}var r="pkcs1";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/pkcs1",["require","module","./util","./random","./sha1"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function c(t,n,r){var i=e.util.createBuffer(),s=Math.ceil(n.n.bitLength()/8);if(t.length>s-11)throw{message:"Message is too long for PKCS#1 v1.5 padding.",length:t.length,max:s-11};i.putByte(0),i.putByte(r);var u,o=s-3-t.length;if(0===r||1===r){u=0===r?0:255;for(var a=0;o>a;++a)i.putByte(u)}else for(;o>0;){for(var f=0,l=e.random.getBytes(o),a=0;o>a;++a)u=l.charCodeAt(a),0===u?++f:i.putByte(u);o=f}return i.putByte(0),i.putBytes(t),i}function h(t,n,r,i){var s=Math.ceil(n.n.bitLength()/8),o=e.util.createBuffer(t),u=o.getByte(),a=o.getByte();if(0!==u||r&&0!==a&&1!==a||!r&&2!=a||r&&0===a&&"undefined"==typeof i)throw{message:"Encryption block is invalid."};var f=0;if(0===a){f=s-3-i;for(var l=0;f>l;++l)if(0!==o.getByte())throw{message:"Encryption block is invalid."}}else if(1===a)for(f=0;o.length()>1;){if(255!==o.getByte()){--o.read;break}++f}else if(2===a)for(f=0;o.length()>1;){if(0===o.getByte()){--o.read;break}++f}var c=o.getByte();if(0!==c||f!==s-3-o.length())throw{message:"Encryption block is invalid."};return o.getBytes()}function p(n,i,s){function p(){u=Math.max(1,u),d(n.pBits,function(e,t){return e?s(e):(n.p=t,void d(n.qBits,v))})}function d(e,r){function d(){var r=e-1,i=new t(e,n.rng);return i.testBit(r)||i.bitwiseTo(t.ONE.shiftLeft(r),h,i),i.dAddOffset(31-i.mod(c).byteValue(),0),i}function m(s){if(!v){--o;var u=s.data;if(u.found){for(var l=0;l<i.length;++l)i[l].terminate();return v=!0,r(null,new t(u.prime,16))}p.bitLength()>e&&(p=d());var c=p.toString(16);s.target.postMessage({e:n.eInt,hex:c,workLoad:a}),p.dAddOffset(f,0)}}for(var i=[],s=0;u>s;++s)i[s]=new Worker(l);for(var o=u,p=d(),s=0;u>s;++s)i[s].addEventListener("message",m);var v=!1}function v(e,i){if(n.q=i,n.p.compareTo(n.q)<0){var o=n.p;n.p=n.q,n.q=o}if(n.p1=n.p.subtract(t.ONE),n.q1=n.q.subtract(t.ONE),n.phi=n.p1.multiply(n.q1),0!==n.phi.gcd(n.e).compareTo(t.ONE))return n.p=n.q=null,void p();if(n.n=n.p.multiply(n.q),n.n.bitLength()!==n.bits)return n.q=null,void d(n.qBits,v);var u=n.e.modInverse(n.phi);n.keys={privateKey:r.rsa.setPrivateKey(n.n,n.e,u,n.p,n.q,u.mod(n.p1),u.mod(n.q1),n.q.modInverse(n.p)),publicKey:r.rsa.setPublicKey(n.n,n.e)},s(null,n.keys)}if("function"==typeof i&&(s=i,i={}),"undefined"==typeof Worker){var o=function(){return r.rsa.stepKeyPairGenerationState(n,10)?s(null,n.keys):void e.util.setImmediate(o)};return o()}var u=i.workers||2,a=i.workLoad||100,f=30*a/8,l=i.workerScript||"forge/prime.worker.js",c=new t(null);c.fromInt(30);var h=function(e,t){return e|t};return-1===u?e.util.estimateCores(function(e,t){e&&(t=2),u=t-1,p()}):void p()}function d(t){var n=t.toString(16);return n[0]>="8"&&(n="00"+n),e.util.hexToBytes(n)}function v(e){return 100>=e?27:150>=e?18:200>=e?15:250>=e?12:300>=e?9:350>=e?8:400>=e?7:500>=e?6:600>=e?5:800>=e?4:1250>=e?3:2}if("undefined"==typeof t)var t=e.jsbn.BigInteger;var n=e.asn1;e.pki=e.pki||{},e.pki.rsa=e.rsa=e.rsa||{};var r=e.pki,i=[6,4,2,4,2,4,6,2],s={name:"PrivateKeyInfo",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:n.Class.UNIVERSAL,type:n.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:n.Class.UNIVERSAL,type:n.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},o={name:"RSAPrivateKey",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},u={name:"RSAPublicKey",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},a=e.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:n.Class.UNIVERSAL,type:n.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:n.Class.UNIVERSAL,type:n.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},f=function(e){var t;if(e.algorithm in r.oids){t=r.oids[e.algorithm];var i=n.oidToDer(t).getBytes(),s=n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[]),o=n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[]);o.value.push(n.create(n.Class.UNIVERSAL,n.Type.OID,!1,i)),o.value.push(n.create(n.Class.UNIVERSAL,n.Type.NULL,!1,""));var u=n.create(n.Class.UNIVERSAL,n.Type.OCTETSTRING,!1,e.digest().getBytes());return s.value.push(o),s.value.push(u),n.toDer(s).getBytes()}throw{message:"Unknown message digest algorithm.",algorithm:e.algorithm}},l=function(e,n,r){var i;if(r)i=e.modPow(n.e,n.n);else if(n.p&&n.q){n.dP||(n.dP=n.d.mod(n.p.subtract(t.ONE))),n.dQ||(n.dQ=n.d.mod(n.q.subtract(t.ONE))),n.qInv||(n.qInv=n.q.modInverse(n.p));for(var s=e.mod(n.p).modPow(n.dP,n.p),o=e.mod(n.q).modPow(n.dQ,n.q);s.compareTo(o)<0;)s=s.add(n.p);i=s.subtract(o).multiply(n.qInv).mod(n.p).multiply(n.q).add(o)}else i=e.modPow(n.d,n.n);return i};r.rsa.encrypt=function(n,r,i){var o,s=i,u=Math.ceil(r.n.bitLength()/8);i!==!1&&i!==!0?(s=2===i,o=c(n,r,i)):(o=e.util.createBuffer(),o.putBytes(n));for(var a=new t(o.toHex(),16),f=l(a,r,s),h=f.toString(16),p=e.util.createBuffer(),d=u-Math.ceil(h.length/2);d>0;)p.putByte(0),--d;return p.putBytes(e.util.hexToBytes(h)),p.getBytes()},r.rsa.decrypt=function(n,r,i,s){var o=Math.ceil(r.n.bitLength()/8);if(n.length!==o)throw{message:"Encrypted message length is invalid.",length:n.length,expected:o};var u=new t(e.util.createBuffer(n).toHex(),16);if(u.compareTo(r.n)>=0)throw{message:"Encrypted message is invalid."};for(var a=l(u,r,i),f=a.toString(16),c=e.util.createBuffer(),p=o-Math.ceil(f.length/2);p>0;)c.putByte(0),--p;return c.putBytes(e.util.hexToBytes(f)),s!==!1?h(c.getBytes(),r,i):c.getBytes()},r.rsa.createKeyPairGenerationState=function(n,r,i){"string"==typeof n&&(n=parseInt(n,10)),n=n||2048,i=i||{},i.prng=i.prng||e.random;var s={nextBytes:function(e){for(var t=i.prng.getBytesSync(e.length),n=0;n<e.length;++n)e[n]=t.charCodeAt(n)}},o={state:0,bits:n,rng:s,eInt:r||65537,e:new t(null),p:null,q:null,qBits:n>>1,pBits:n-(n>>1),pqState:0,num:null,keys:null};return o.e.fromInt(o.eInt),o},r.rsa.stepKeyPairGenerationState=function(e,n){var s=new t(null);s.fromInt(30);for(var f,o=0,u=function(e,t){return e|t},a=+new Date,l=0;null===e.keys&&(0>=n||n>l);){if(0===e.state){var c=null===e.p?e.pBits:e.qBits,h=c-1;0===e.pqState?(e.num=new t(c,e.rng),e.num.testBit(h)||e.num.bitwiseTo(t.ONE.shiftLeft(h),u,e.num),e.num.dAddOffset(31-e.num.mod(s).byteValue(),0),o=0,++e.pqState):1===e.pqState?e.num.bitLength()>c?e.pqState=0:e.num.isProbablePrime(v(e.num.bitLength()))?++e.pqState:e.num.dAddOffset(i[o++%8],0):2===e.pqState?e.pqState=0===e.num.subtract(t.ONE).gcd(e.e).compareTo(t.ONE)?3:0:3===e.pqState&&(e.pqState=0,null===e.p?e.p=e.num:e.q=e.num,null!==e.p&&null!==e.q&&++e.state,e.num=null)}else if(1===e.state)e.p.compareTo(e.q)<0&&(e.num=e.p,e.p=e.q,e.q=e.num),++e.state;else if(2===e.state)e.p1=e.p.subtract(t.ONE),e.q1=e.q.subtract(t.ONE),e.phi=e.p1.multiply(e.q1),++e.state;else if(3===e.state)0===e.phi.gcd(e.e).compareTo(t.ONE)?++e.state:(e.p=null,e.q=null,e.state=0);else if(4===e.state)e.n=e.p.multiply(e.q),e.n.bitLength()===e.bits?++e.state:(e.q=null,e.state=0);else if(5===e.state){var p=e.e.modInverse(e.phi);e.keys={privateKey:r.rsa.setPrivateKey(e.n,e.e,p,e.p,e.q,p.mod(e.p1),p.mod(e.q1),e.q.modInverse(e.p)),publicKey:r.rsa.setPublicKey(e.n,e.e)}}f=+new Date,l+=f-a,a=f}return null!==e.keys},r.rsa.generateKeyPair=function(e,t,n,i){1===arguments.length?"object"==typeof e?(n=e,e=void 0):"function"==typeof e&&(i=e,e=void 0):2===arguments.length?("number"==typeof e?"function"==typeof t?i=t:n=t:(n=e,i=t,e=void 0),t=void 0):3===arguments.length&&("number"==typeof t?"function"==typeof n&&(i=n,n=void 0):(i=n,n=t,t=void 0)),n=n||{},void 0===e&&(e=n.bits||2048),void 0===t&&(t=n.e||65537);var s=r.rsa.createKeyPairGenerationState(e,t,n);return i?void p(s,n,i):(r.rsa.stepKeyPairGenerationState(s,0),s.keys)},r.setRsaPublicKey=r.rsa.setPublicKey=function(t,i){var s={n:t,e:i};return s.encrypt=function(t,n,i){if("string"==typeof n?n=n.toUpperCase():void 0===n&&(n="RSAES-PKCS1-V1_5"),"RSAES-PKCS1-V1_5"===n)n={encode:function(e,t){return c(e,t,2).getBytes()}};else if("RSA-OAEP"===n||"RSAES-OAEP"===n)n={encode:function(t,n){return e.pkcs1.encode_rsa_oaep(n,t,i)}};else{if(-1===["RAW","NONE","NULL",null].indexOf(n))throw{message:'Unsupported encryption scheme: "'+n+'".'};n={encode:function(e){return e}}}var o=n.encode(t,s,!0);return r.rsa.encrypt(o,s,!0)},s.verify=function(e,t,i){"string"==typeof i?i=i.toUpperCase():void 0===i&&(i="RSASSA-PKCS1-V1_5"),"RSASSA-PKCS1-V1_5"===i?i={verify:function(e,t){t=h(t,s,!0);var r=n.fromDer(t);return e===r.value[1].value}}:("NONE"===i||"NULL"===i||null===i)&&(i={verify:function(e,t){return t=h(t,s,!0),e===t
}});var o=r.rsa.decrypt(t,s,!0,!1);return i.verify(e,o,s.n.bitLength())},s},r.setRsaPrivateKey=r.rsa.setPrivateKey=function(t,n,i,s,o,u,a,l){var c={n:t,e:n,d:i,p:s,q:o,dP:u,dQ:a,qInv:l};return c.decrypt=function(t,n,i){"string"==typeof n?n=n.toUpperCase():void 0===n&&(n="RSAES-PKCS1-V1_5");var s=r.rsa.decrypt(t,c,!1,!1);if("RSAES-PKCS1-V1_5"===n)n={decode:h};else if("RSA-OAEP"===n||"RSAES-OAEP"===n)n={decode:function(t,n){return e.pkcs1.decode_rsa_oaep(n,t,i)}};else{if(-1===["RAW","NONE","NULL",null].indexOf(n))throw{message:'Unsupported encryption scheme: "'+n+'".'};n={decode:function(e){return e}}}return n.decode(s,c,!1)},c.sign=function(e,t){var n=!1;"string"==typeof t&&(t=t.toUpperCase()),void 0===t||"RSASSA-PKCS1-V1_5"===t?(t={encode:f},n=1):("NONE"===t||"NULL"===t||null===t)&&(t={encode:function(){return e}},n=1);var i=t.encode(e,c.n.bitLength());return r.rsa.encrypt(i,c,n)},c},r.wrapRsaPrivateKey=function(e){return n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,n.integerToDer(0).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(r.oids.rsaEncryption).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.NULL,!1,"")]),n.create(n.Class.UNIVERSAL,n.Type.OCTETSTRING,!1,n.toDer(e).getBytes())])},r.privateKeyFromAsn1=function(i){var u={},a=[];if(n.validate(i,s,u,a)&&(i=n.fromDer(e.util.createBuffer(u.privateKey))),u={},a=[],!n.validate(i,o,u,a))throw{message:"Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.",errors:a};var f,l,c,h,p,d,v,m;return f=e.util.createBuffer(u.privateKeyModulus).toHex(),l=e.util.createBuffer(u.privateKeyPublicExponent).toHex(),c=e.util.createBuffer(u.privateKeyPrivateExponent).toHex(),h=e.util.createBuffer(u.privateKeyPrime1).toHex(),p=e.util.createBuffer(u.privateKeyPrime2).toHex(),d=e.util.createBuffer(u.privateKeyExponent1).toHex(),v=e.util.createBuffer(u.privateKeyExponent2).toHex(),m=e.util.createBuffer(u.privateKeyCoefficient).toHex(),r.setRsaPrivateKey(new t(f,16),new t(l,16),new t(c,16),new t(h,16),new t(p,16),new t(d,16),new t(v,16),new t(m,16))},r.privateKeyToAsn1=r.privateKeyToRSAPrivateKey=function(e){return n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,n.integerToDer(0).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(e.n)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(e.e)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(e.d)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(e.p)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(e.q)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(e.dP)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(e.dQ)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(e.qInv))])},r.publicKeyFromAsn1=function(i){var s={},o=[];if(n.validate(i,a,s,o)){var f=n.derToOid(s.publicKeyOid);if(f!==r.oids.rsaEncryption)throw{message:"Cannot read public key. Unknown OID.",oid:f};i=s.rsaPublicKey}if(o=[],!n.validate(i,u,s,o))throw{message:"Cannot read public key. ASN.1 object does not contain an RSAPublicKey.",errors:o};var l=e.util.createBuffer(s.publicKeyModulus).toHex(),c=e.util.createBuffer(s.publicKeyExponent).toHex();return r.setRsaPublicKey(new t(l,16),new t(c,16))},r.publicKeyToAsn1=r.publicKeyToSubjectPublicKeyInfo=function(e){return n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(r.oids.rsaEncryption).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.NULL,!1,"")]),n.create(n.Class.UNIVERSAL,n.Type.BITSTRING,!1,[r.publicKeyToRSAPublicKey(e)])])},r.publicKeyToRSAPublicKey=function(e){return n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(e.n)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(e.e))])}}var r="rsa";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/rsa",["require","module","./asn1","./oids","./random","./util","./jsbn","./pkcs1"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function a(e,t,n){for(var r=[f(e+t)],i=16,s=1;n>i;++s,i+=16)r.push(f(r[s-1]+e+t));return r.join("").substr(0,n)}function f(t){return e.md.md5.create().update(t).digest().getBytes()}if("undefined"==typeof t)var t=e.jsbn.BigInteger;var n=e.asn1,r=e.pki=e.pki||{};r.pbe=e.pbe=e.pbe||{};var i=r.oids,s={name:"EncryptedPrivateKeyInfo",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:n.Class.UNIVERSAL,type:n.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:n.Class.UNIVERSAL,type:n.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},o={name:"PBES2Algorithms",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:n.Class.UNIVERSAL,type:n.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:n.Class.UNIVERSAL,type:n.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,onstructed:!0,capture:"kdfIterationCount"}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:n.Class.UNIVERSAL,type:n.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:n.Class.UNIVERSAL,type:n.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},u={name:"pkcs-12PbeParams",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:n.Class.UNIVERSAL,type:n.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"iterations"}]};r.encryptPrivateKeyInfo=function(t,s,o){o=o||{},o.saltSize=o.saltSize||8,o.count=o.count||2048,o.algorithm=o.algorithm||"aes128";var l,c,h,u=e.random.getBytesSync(o.saltSize),a=o.count,f=n.integerToDer(a);if(0===o.algorithm.indexOf("aes")||"des"===o.algorithm){var p,d,v;switch(o.algorithm){case"aes128":l=16,p=16,d=i["aes128-CBC"],v=e.aes.createEncryptionCipher;break;case"aes192":l=24,p=16,d=i["aes192-CBC"],v=e.aes.createEncryptionCipher;break;case"aes256":l=32,p=16,d=i["aes256-CBC"],v=e.aes.createEncryptionCipher;break;case"des":l=8,p=8,d=i.desCBC,v=e.des.createEncryptionCipher;break;default:throw{message:"Cannot encrypt private key. Unknown encryption algorithm.",algorithm:o.algorithm}}var m=e.pkcs5.pbkdf2(s,u,a,l),g=e.random.getBytesSync(p),y=v(m);y.start(g),y.update(n.toDer(t)),y.finish(),h=y.output.getBytes(),c=n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(i.pkcs5PBES2).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(i.pkcs5PBKDF2).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OCTETSTRING,!1,u),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,f.getBytes())])]),n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(d).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.OCTETSTRING,!1,g)])])])}else{if("3des"!==o.algorithm)throw{message:"Cannot encrypt private key. Unknown encryption algorithm.",algorithm:o.algorithm};l=24;var b=new e.util.ByteBuffer(u),m=r.pbe.generatePkcs12Key(s,b,1,a,l),g=r.pbe.generatePkcs12Key(s,b,2,a,l),y=e.des.createEncryptionCipher(m);y.start(g),y.update(n.toDer(t)),y.finish(),h=y.output.getBytes(),c=n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(i["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OCTETSTRING,!1,u),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,f.getBytes())])])}var w=n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[c,n.create(n.Class.UNIVERSAL,n.Type.OCTETSTRING,!1,h)]);return w},r.decryptPrivateKeyInfo=function(t,i){var o=null,u={},a=[];if(!n.validate(t,s,u,a))throw{message:"Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.",errors:a};var f=n.derToOid(u.encryptionOid),l=r.pbe.getCipher(f,u.encryptionParams,i),c=e.util.createBuffer(u.encryptedData);return l.update(c),l.finish()&&(o=n.fromDer(l.output)),o},r.encryptedPrivateKeyToPem=function(t,r){var i={type:"ENCRYPTED PRIVATE KEY",body:n.toDer(t).getBytes()};return e.pem.encode(i,{maxline:r})},r.encryptedPrivateKeyFromPem=function(t){var r=e.pem.decode(t)[0];if("ENCRYPTED PRIVATE KEY"!==r.type)throw{message:'Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".',headerType:r.type};if(r.procType&&"ENCRYPTED"===r.procType.type)throw{message:"Could not convert encrypted private key from PEM; PEM is encrypted."};return n.fromDer(r.body)},r.encryptRsaPrivateKey=function(t,i,s){if(s=s||{},!s.legacy){var o=r.wrapRsaPrivateKey(r.privateKeyToAsn1(t));return o=r.encryptPrivateKeyInfo(o,i,s),r.encryptedPrivateKeyToPem(o)}var u,f,l,c;switch(s.algorithm){case"aes128":u="AES-128-CBC",l=16,f=e.random.getBytesSync(16),c=e.aes.createEncryptionCipher;break;case"aes192":u="AES-192-CBC",l=24,f=e.random.getBytesSync(16),c=e.aes.createEncryptionCipher;break;case"aes256":u="AES-256-CBC",l=32,f=e.random.getBytesSync(16),c=e.aes.createEncryptionCipher;break;case"3des":u="DES-EDE3-CBC",l=24,f=e.random.getBytesSync(8),c=e.des.createEncryptionCipher;break;case"des":u="DES-CBC",l=8,f=e.random.getBytesSync(8),c=e.des.createEncryptionCipher;break;default:throw{message:'Could not encrypt RSA private key; unsupported encryption algorithm "'+s.algorithm+'".',algorithm:s.algorithm}}var h=a(i,f.substr(0,8),l),p=c(h);p.start(f),p.update(n.toDer(r.privateKeyToAsn1(t))),p.finish();var d={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:u,parameters:e.util.bytesToHex(f).toUpperCase()},body:p.output.getBytes()};return e.pem.encode(d)},r.decryptRsaPrivateKey=function(t,i){var s=null,o=e.pem.decode(t)[0];if("ENCRYPTED PRIVATE KEY"!==o.type&&"PRIVATE KEY"!==o.type&&"RSA PRIVATE KEY"!==o.type)throw{message:'Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".',headerType:o.type};if(o.procType&&"ENCRYPTED"===o.procType.type){var u,f;switch(o.dekInfo.algorithm){case"DES-CBC":u=8,f=e.des.createDecryptionCipher;break;case"DES-EDE3-CBC":u=24,f=e.des.createDecryptionCipher;break;case"AES-128-CBC":u=16,f=e.aes.createDecryptionCipher;break;case"AES-192-CBC":u=24,f=e.aes.createDecryptionCipher;break;case"AES-256-CBC":u=32,f=e.aes.createDecryptionCipher;break;case"RC2-40-CBC":u=5,f=function(t){return e.rc2.createDecryptionCipher(t,40)};break;case"RC2-64-CBC":u=8,f=function(t){return e.rc2.createDecryptionCipher(t,64)};break;case"RC2-128-CBC":u=16,f=function(t){return e.rc2.createDecryptionCipher(t,128)};break;default:throw{message:'Could not decrypt private key; unsupported encryption algorithm "'+o.dekInfo.algorithm+'".',algorithm:o.dekInfo.algorithm}}var l=e.util.hexToBytes(o.dekInfo.parameters),c=a(i,l.substr(0,8),u),h=f(c);if(h.start(l),h.update(e.util.createBuffer(o.body)),!h.finish())return s;s=h.output.getBytes()}else s=o.body;return s="ENCRYPTED PRIVATE KEY"===o.type?r.decryptPrivateKeyInfo(n.fromDer(s),i):n.fromDer(s),null!==s&&(s=r.privateKeyFromAsn1(s)),s},r.pbe.generatePkcs12Key=function(t,n,r,i,s,o){var u,a;("undefined"==typeof o||null===o)&&(o=e.md.sha1.create());var f=o.digestLength,l=o.blockLength,c=new e.util.ByteBuffer,h=new e.util.ByteBuffer;for(a=0;a<t.length;a++)h.putInt16(t.charCodeAt(a));h.putInt16(0);var p=h.length(),d=n.length(),v=new e.util.ByteBuffer;v.fillWithByte(r,l);var m=l*Math.ceil(d/l),g=new e.util.ByteBuffer;for(a=0;m>a;a++)g.putByte(n.at(a%d));var y=l*Math.ceil(p/l),b=new e.util.ByteBuffer;for(a=0;y>a;a++)b.putByte(h.at(a%p));var w=g;w.putBuffer(b);for(var E=Math.ceil(s/f),S=1;E>=S;S++){var x=new e.util.ByteBuffer;x.putBytes(v.bytes()),x.putBytes(w.bytes());for(var T=0;i>T;T++)o.start(),o.update(x.getBytes()),x=o.digest();var N=new e.util.ByteBuffer;for(a=0;l>a;a++)N.putByte(x.at(a%f));var C=Math.ceil(d/l)+Math.ceil(p/l),k=new e.util.ByteBuffer;for(u=0;C>u;u++){var L=new e.util.ByteBuffer(w.getBytes(l)),A=511;for(a=N.length()-1;a>=0;a--)A>>=8,A+=N.at(a)+L.at(a),L.setAt(a,255&A);k.putBuffer(L)}w=k,c.putBuffer(x)}return c.truncate(c.length()-s),c},r.pbe.getCipher=function(e,t,n){switch(e){case r.oids.pkcs5PBES2:return r.pbe.getCipherForPBES2(e,t,n);case r.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case r.oids["pbewithSHAAnd40BitRC2-CBC"]:return r.pbe.getCipherForPKCS12PBE(e,t,n);default:throw{message:"Cannot read encrypted PBE data block. Unsupported OID.",oid:e,supportedOids:["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"]}}},r.pbe.getCipherForPBES2=function(t,i,s){var u={},a=[];if(!n.validate(i,o,u,a))throw{message:"Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.",errors:a};if(t=n.derToOid(u.kdfOid),t!==r.oids.pkcs5PBKDF2)throw{message:"Cannot read encrypted private key. Unsupported key derivation function OID.",oid:t,supportedOids:["pkcs5PBKDF2"]};if(t=n.derToOid(u.encOid),t!==r.oids["aes128-CBC"]&&t!==r.oids["aes192-CBC"]&&t!==r.oids["aes256-CBC"]&&t!==r.oids["des-EDE3-CBC"]&&t!==r.oids.desCBC)throw{message:"Cannot read encrypted private key. Unsupported encryption scheme OID.",oid:t,supportedOids:["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"]};var f=u.kdfSalt,l=e.util.createBuffer(u.kdfIterationCount);l=l.getInt(l.length()<<3);var c,h;switch(r.oids[t]){case"aes128-CBC":c=16,h=e.aes.createDecryptionCipher;break;case"aes192-CBC":c=24,h=e.aes.createDecryptionCipher;break;case"aes256-CBC":c=32,h=e.aes.createDecryptionCipher;break;case"des-EDE3-CBC":c=24,h=e.des.createDecryptionCipher;break;case"desCBC":c=8,h=e.des.createDecryptionCipher}var p=e.pkcs5.pbkdf2(s,f,l,c),d=u.encIv,v=h(p);return v.start(d),v},r.pbe.getCipherForPKCS12PBE=function(t,i,s){var o={},a=[];if(!n.validate(i,u,o,a))throw{message:"Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.",errors:a};var f=e.util.createBuffer(o.salt),l=e.util.createBuffer(o.iterations);l=l.getInt(l.length()<<3);var c,h,p;switch(t){case r.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:c=24,h=8,p=e.des.startDecrypting;break;case r.oids["pbewithSHAAnd40BitRC2-CBC"]:c=5,h=8,p=function(t,n){var r=e.rc2.createDecryptionCipher(t,40);return r.start(n,null),r};break;default:throw{message:"Cannot read PKCS #12 PBE data block. Unsupported OID.",oid:t}}var d=r.pbe.generatePkcs12Key(s,f,1,l,c),v=r.pbe.generatePkcs12Key(s,f,2,l,h);return p(d,v)}}var r="pbe";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/pbe",["require","module","./aes","./asn1","./des","./md","./oids","./pem","./pbkdf2","./random","./rc2","./rsa","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){var t=e.asn1,n=e.pkcs7asn1=e.pkcs7asn1||{};e.pkcs7=e.pkcs7||{},e.pkcs7.asn1=n;var r={name:"ContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};n.contentInfoValidator=r;var i={name:"EncryptedContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:t.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent"}]};n.envelopedDataValidator={name:"EnvelopedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(i)},n.encryptedDataValidator={name:"EncryptedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"}].concat(i)};var s={name:"SignerInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1},{name:"SignerInfo.IssuerAndSerialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0},{name:"SignerInfo.DigestAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0},{name:"SignerInfo.AuthenticatedAttributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.DigestEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0},{name:"SignerInfo.EncryptedDigest",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.UnauthenticatedAttributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0}]};n.signedDataValidator={name:"SignedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},r,{name:"SignedData.Certificates",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,capture:"signerInfos",optional:!0,value:[s]}]},n.recipientInfoValidator={name:"RecipientInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:t.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter"}]},{name:"RecipientInfo.encryptedKey",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}}var r="pkcs7asn1";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/pkcs7asn1",["require","module","./asn1","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){e.mgf=e.mgf||{};var t=e.mgf.mgf1=e.mgf1=e.mgf1||{};t.create=function(t){var n={generate:function(n,r){for(var i=new e.util.ByteBuffer,s=Math.ceil(r/t.digestLength),o=0;s>o;o++){var u=new e.util.ByteBuffer;u.putInt32(o),t.start(),t.update(n+u.getBytes()),i.putBuffer(t.digest())}return i.truncate(i.length()-r),i.getBytes()}};return n}}var r="mgf1";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/mgf1",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){e.mgf=e.mgf||{},e.mgf.mgf1=e.mgf1}var r="mgf";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/mgf",["require","module","./mgf1"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){var t=e.pss=e.pss||{};t.create=function(t,n,r){var i=t.digestLength,s={};return s.verify=function(s,o,u){var a,f=u-1,l=Math.ceil(f/8);if(o=o.substr(-l),i+r+2>l)throw{message:"Inconsistent parameters to PSS signature verification."};if(188!==o.charCodeAt(l-1))throw{message:"Encoded message does not end in 0xBC."};var c=l-i-1,h=o.substr(0,c),p=o.substr(c,i),d=65280>>8*l-f&255;if(0!==(h.charCodeAt(0)&d))throw{message:"Bits beyond keysize not zero as expected."};var v=n.generate(p,c),m="";for(a=0;c>a;a++)m+=String.fromCharCode(h.charCodeAt(a)^v.charCodeAt(a));m=String.fromCharCode(m.charCodeAt(0)&~d)+m.substr(1);var g=l-i-r-2;for(a=0;g>a;a++)if(0!==m.charCodeAt(a))throw{message:"Leftmost octets not zero as expected"};if(1!==m.charCodeAt(g))throw{message:"Inconsistent PSS signature, 0x01 marker not found"};var y=m.substr(-r),b=new e.util.ByteBuffer;b.fillWithByte(0,8),b.putBytes(s),b.putBytes(y),t.start(),t.update(b.getBytes());var w=t.digest().getBytes();return p===w},s.encode=function(s,o){var u,a=o-1,f=Math.ceil(a/8),l=s.digest().getBytes();if(i+r+2>f)throw{message:"Message is too long to encrypt"};var c=e.random.getBytes(r),h=new e.util.ByteBuffer;h.fillWithByte(0,8),h.putBytes(l),h.putBytes(c),t.start(),t.update(h.getBytes());var p=t.digest().getBytes(),d=new e.util.ByteBuffer;d.fillWithByte(0,f-r-i-2),d.putByte(1),d.putBytes(c);var v=d.getBytes(),m=f-i-1,g=n.generate(p,m),y="";for(u=0;m>u;u++)y+=String.fromCharCode(v.charCodeAt(u)^g.charCodeAt(u));var b=65280>>8*f-a&255;return y=String.fromCharCode(y.charCodeAt(0)&~b)+y.substr(1),y+p+String.fromCharCode(188)},s}}var r="pss";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/pss",["require","module","./random","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function l(e,t){"string"==typeof t&&(t={shortName:t});for(var r,n=null,i=0;null===n&&i<e.attributes.length;++i)r=e.attributes[i],t.type&&t.type===r.type?n=r:t.name&&t.name===r.name?n=r:t.shortName&&t.shortName===r.shortName&&(n=r);return n}function p(n){for(var i,s,r=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),o=n.attributes,u=0;u<o.length;++u){i=o[u];var a=i.value,f=t.Type.PRINTABLESTRING;"valueTagClass"in i&&(f=i.valueTagClass,f===t.Type.UTF8&&(a=e.util.encodeUtf8(a))),s=t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.type).getBytes()),t.create(t.Class.UNIVERSAL,f,!1,a)])]),r.value.push(s)}return r}function d(e){var n=t.create(t.Class.CONTEXT_SPECIFIC,3,!0,[]),r=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);n.value.push(r);for(var i,s,o=0;o<e.length;++o){i=e[o],s=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),r.value.push(s),s.value.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.id).getBytes())),i.critical&&s.value.push(t.create(t.Class.UNIVERSAL,t.Type.BOOLEAN,!1,String.fromCharCode(255)));var u=i.value;"string"!=typeof i.value&&(u=t.toDer(u).getBytes()),s.value.push(t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,u))}return n}function m(e){for(var t,r=0;r<e.length;++r){if(t=e[r],"undefined"==typeof t.name&&(t.type&&t.type in n.oids?t.name=n.oids[t.type]:t.shortName&&t.shortName in i&&(t.name=n.oids[i[t.shortName]])),"undefined"==typeof t.type){if(!(t.name&&t.name in n.oids))throw{message:"Attribute type not specified.",attribute:t};t.type=n.oids[t.name]}if("undefined"==typeof t.shortName&&t.name&&t.name in i&&(t.shortName=i[t.name]),"undefined"==typeof t.value)throw{message:"Attribute value not specified.",attribute:t}}}function g(e,n){switch(e){case r["RSASSA-PSS"]:var i=[];return void 0!==n.hash.algorithmOid&&i.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.hash.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])])),void 0!==n.mgf.algorithmOid&&i.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.mgf.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.mgf.hash.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])])])),void 0!==n.saltLength&&i.push(t.create(t.Class.CONTEXT_SPECIFIC,2,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(n.saltLength).getBytes())])),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,i);default:return t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")}}function y(n){var r=t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[]);if(0===n.attributes.length)return r;for(var i=n.attributes,s=0;s<i.length;++s){var o=i[s],u=o.value,a=t.Type.UTF8;"valueTagClass"in o&&(a=o.valueTagClass),a===t.Type.UTF8&&(u=e.util.encodeUtf8(u));var f=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(o.type).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,a,!1,u)])]);r.value.push(f)}return r}var t=e.asn1,n=e.pki=e.pki||{},r=n.oids,i={};i.CN=r.commonName,i.commonName="CN",i.C=r.countryName,i.countryName="C",i.L=r.localityName,i.localityName="L",i.ST=r.stateOrProvinceName,i.stateOrProvinceName="ST",i.O=r.organizationName,i.organizationName="O",i.OU=r.organizationalUnitName,i.organizationalUnitName="OU",i.E=r.emailAddress,i.emailAddress="E";var s=e.pki.rsa.publicKeyValidator,o={name:"Certificate",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:t.Class.UNIVERSAL,type:t.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:t.Class.UNIVERSAL,type:t.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:t.Class.UNIVERSAL,type:t.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:t.Class.UNIVERSAL,type:t.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},s,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,capture:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:t.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,capture:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:t.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,capture:"certSignature"}]},u={name:"rsapss",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:t.Class.UNIVERSAL,type:t.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:t.Class.UNIVERSAL,type:t.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:t.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:t.Class.UNIVERSAL,type:t.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:t.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:t.Class.UNIVERSAL,type:t.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},a={name:"CertificationRequestInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},s,{name:"CertificationRequestInfo.attributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0}]}]}]},f={name:"CertificationRequest",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[a,{name:"CertificationRequest.signatureAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,capture:"csrSignature"}]};
n.RDNAttributesAsArray=function(e,n){for(var o,u,a,s=[],f=0;f<e.value.length;++f){o=e.value[f];for(var l=0;l<o.value.length;++l)a={},u=o.value[l],a.type=t.derToOid(u.value[0].value),a.value=u.value[1].value,a.valueTagClass=u.value[1].type,a.type in r&&(a.name=r[a.type],a.name in i&&(a.shortName=i[a.name])),n&&(n.update(a.type),n.update(a.value)),s.push(a)}return s},n.CRIAttributesAsArray=function(e){for(var n=[],s=0;s<e.length;++s)for(var o=e[s],u=t.derToOid(o.value[0].value),a=o.value[1].value,f=0;f<a.length;++f){var l={};l.type=u,l.value=a[f].value,l.valueTagClass=a[f].type,l.type in r&&(l.name=r[l.type],l.name in i&&(l.shortName=i[l.name])),n.push(l)}return n};var c=function(n){for(var s,o,u,i=[],a=0;a<n.value.length;++a){u=n.value[a];for(var f=0;f<u.value.length;++f){if(o=u.value[f],s={},s.id=t.derToOid(o.value[0].value),s.critical=!1,o.value[1].type===t.Type.BOOLEAN?(s.critical=0!==o.value[1].value.charCodeAt(0),s.value=o.value[2].value):s.value=o.value[1].value,s.id in r)if(s.name=r[s.id],"keyUsage"===s.name){var l=t.fromDer(s.value),c=0,h=0;l.value.length>1&&(c=l.value.charCodeAt(1),h=l.value.length>2?l.value.charCodeAt(2):0),s.digitalSignature=128===(128&c),s.nonRepudiation=64===(64&c),s.keyEncipherment=32===(32&c),s.dataEncipherment=16===(16&c),s.keyAgreement=8===(8&c),s.keyCertSign=4===(4&c),s.cRLSign=2===(2&c),s.encipherOnly=1===(1&c),s.decipherOnly=128===(128&h)}else if("basicConstraints"===s.name){var l=t.fromDer(s.value);s.cA=l.value.length>0&&l.value[0].type===t.Type.BOOLEAN?0!==l.value[0].value.charCodeAt(0):!1;var p=null;l.value.length>0&&l.value[0].type===t.Type.INTEGER?p=l.value[0].value:l.value.length>1&&(p=l.value[1].value),null!==p&&(s.pathLenConstraint=t.derToInteger(p))}else if("extKeyUsage"===s.name)for(var l=t.fromDer(s.value),d=0;d<l.value.length;++d){var v=t.derToOid(l.value[d].value);v in r?s[r[v]]=!0:s[v]=!0}else if("nsCertType"===s.name){var l=t.fromDer(s.value),c=0;l.value.length>1&&(c=l.value.charCodeAt(1)),s.client=128===(128&c),s.server=64===(64&c),s.email=32===(32&c),s.objsign=16===(16&c),s.reserved=8===(8&c),s.sslCA=4===(4&c),s.emailCA=2===(2&c),s.objCA=1===(1&c)}else if("subjectAltName"===s.name||"issuerAltName"===s.name){s.altNames=[];for(var m,l=t.fromDer(s.value),g=0;g<l.value.length;++g){m=l.value[g];var y={type:m.type,value:m.value};switch(s.altNames.push(y),m.type){case 1:case 2:case 6:break;case 7:y.ip=e.util.bytesToIP(m.value);break;case 8:y.oid=t.derToOid(m.value)}}}else if("subjectKeyIdentifier"===s.name){var l=t.fromDer(s.value);s.subjectKeyIdentifier=e.util.bytesToHex(l.value)}i.push(s)}}return i},h=function(e,n,i){var s={};if(e!==r["RSASSA-PSS"])return s;i&&(s={hash:{algorithmOid:r.sha1},mgf:{algorithmOid:r.mgf1,hash:{algorithmOid:r.sha1}},saltLength:20});var o={},a=[];if(!t.validate(n,u,o,a))throw{message:"Cannot read RSASSA-PSS parameter block.",errors:a};return void 0!==o.hashOid&&(s.hash=s.hash||{},s.hash.algorithmOid=t.derToOid(o.hashOid)),void 0!==o.maskGenOid&&(s.mgf=s.mgf||{},s.mgf.algorithmOid=t.derToOid(o.maskGenOid),s.mgf.hash=s.mgf.hash||{},s.mgf.hash.algorithmOid=t.derToOid(o.maskGenHashOid)),void 0!==o.saltLength&&(s.saltLength=o.saltLength.charCodeAt(0)),s};n.certificateFromPem=function(r,i,s){var o=e.pem.decode(r)[0];if("CERTIFICATE"!==o.type&&"X509 CERTIFICATE"!==o.type&&"TRUSTED CERTIFICATE"!==o.type)throw{message:'Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".',headerType:o.type};if(o.procType&&"ENCRYPTED"===o.procType.type)throw{message:"Could not convert certificate from PEM; PEM is encrypted."};var u=t.fromDer(o.body,s);return n.certificateFromAsn1(u,i)},n.certificateToPem=function(r,i){var s={type:"CERTIFICATE",body:t.toDer(n.certificateToAsn1(r)).getBytes()};return e.pem.encode(s,{maxline:i})},n.publicKeyFromPem=function(r){var i=e.pem.decode(r)[0];if("PUBLIC KEY"!==i.type&&"RSA PUBLIC KEY"!==i.type)throw{message:'Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".',headerType:i.type};if(i.procType&&"ENCRYPTED"===i.procType.type)throw{message:"Could not convert public key from PEM; PEM is encrypted."};var s=t.fromDer(i.body);return n.publicKeyFromAsn1(s)},n.publicKeyToPem=function(r,i){var s={type:"PUBLIC KEY",body:t.toDer(n.publicKeyToAsn1(r)).getBytes()};return e.pem.encode(s,{maxline:i})},n.publicKeyToRSAPublicKeyPem=function(r,i){var s={type:"RSA PUBLIC KEY",body:t.toDer(n.publicKeyToRSAPublicKey(r)).getBytes()};return e.pem.encode(s,{maxline:i})},n.certificationRequestFromPem=function(r,i,s){var o=e.pem.decode(r)[0];if("CERTIFICATE REQUEST"!==o.type)throw{message:'Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".',headerType:o.type};if(o.procType&&"ENCRYPTED"===o.procType.type)throw{message:"Could not convert certification request from PEM; PEM is encrypted."};var u=t.fromDer(o.body,s);return n.certificationRequestFromAsn1(u,i)},n.certificationRequestToPem=function(r,i){var s={type:"CERTIFICATE REQUEST",body:t.toDer(n.certificationRequestToAsn1(r)).getBytes()};return e.pem.encode(s,{maxline:i})},n.createCertificate=function(){var i={};return i.version=2,i.serialNumber="00",i.signatureOid=null,i.signature=null,i.siginfo={},i.siginfo.algorithmOid=null,i.validity={},i.validity.notBefore=new Date,i.validity.notAfter=new Date,i.issuer={},i.issuer.getField=function(e){return l(i.issuer,e)},i.issuer.addField=function(e){m([e]),i.issuer.attributes.push(e)},i.issuer.attributes=[],i.issuer.hash=null,i.subject={},i.subject.getField=function(e){return l(i.subject,e)},i.subject.addField=function(e){m([e]),i.subject.attributes.push(e)},i.subject.attributes=[],i.subject.hash=null,i.extensions=[],i.publicKey=null,i.md=null,i.setSubject=function(e,t){m(e),i.subject.attributes=e,delete i.subject.uniqueId,t&&(i.subject.uniqueId=t),i.subject.hash=null},i.setIssuer=function(e,t){m(e),i.issuer.attributes=e,delete i.issuer.uniqueId,t&&(i.issuer.uniqueId=t),i.issuer.hash=null},i.setExtensions=function(s){for(var o,u=0;u<s.length;++u){if(o=s[u],"undefined"==typeof o.name&&o.id&&o.id in n.oids&&(o.name=n.oids[o.id]),"undefined"==typeof o.id){if(!(o.name&&o.name in n.oids))throw{message:"Extension ID not specified.",extension:o};o.id=n.oids[o.name]}if("undefined"==typeof o.value){if("keyUsage"===o.name){var a=0,f=0,l=0;o.digitalSignature&&(f|=128,a=7),o.nonRepudiation&&(f|=64,a=6),o.keyEncipherment&&(f|=32,a=5),o.dataEncipherment&&(f|=16,a=4),o.keyAgreement&&(f|=8,a=3),o.keyCertSign&&(f|=4,a=2),o.cRLSign&&(f|=2,a=1),o.encipherOnly&&(f|=1,a=0),o.decipherOnly&&(l|=128,a=7);var c=String.fromCharCode(a);0!==l?c+=String.fromCharCode(f)+String.fromCharCode(l):0!==f&&(c+=String.fromCharCode(f)),o.value=t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,c)}else if("basicConstraints"===o.name)o.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),o.cA&&o.value.value.push(t.create(t.Class.UNIVERSAL,t.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in o&&o.value.value.push(t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(o.pathLenConstraint).getBytes()));else if("extKeyUsage"===o.name){o.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);var h=o.value.value;for(var p in o)o[p]===!0&&(p in r?h.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(r[p]).getBytes())):-1!==p.indexOf(".")&&h.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(p).getBytes())))}else if("nsCertType"===o.name){var a=0,f=0;o.client&&(f|=128,a=7),o.server&&(f|=64,a=6),o.email&&(f|=32,a=5),o.objsign&&(f|=16,a=4),o.reserved&&(f|=8,a=3),o.sslCA&&(f|=4,a=2),o.emailCA&&(f|=2,a=1),o.objCA&&(f|=1,a=0);var c=String.fromCharCode(a);0!==f&&(c+=String.fromCharCode(f)),o.value=t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,c)}else if("subjectAltName"===o.name||"issuerAltName"===o.name){o.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);for(var d,v=0;v<o.altNames.length;++v){d=o.altNames[v];var c=d.value;if(7===d.type&&d.ip){if(c=e.util.bytesFromIP(d.ip),null===c)throw{message:'Extension "ip" value is not a valid IPv4 or IPv6 address.',extension:o}}else 8===d.type&&(c=t.oidToDer(d.oid?t.oidToDer(d.oid):c));o.value.value.push(t.create(t.Class.CONTEXT_SPECIFIC,d.type,!1,c))}}else if("subjectKeyIdentifier"===o.name){var m=i.generateSubjectKeyIdentifier();o.subjectKeyIdentifier=m.toHex(),o.value=t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,m.getBytes())}if("undefined"==typeof o.value)throw{message:"Extension value not specified.",extension:o}}}i.extensions=s},i.getExtension=function(e){"string"==typeof e&&(e={name:e});for(var n,t=null,r=0;null===t&&r<i.extensions.length;++r)n=i.extensions[r],e.id&&n.id===e.id?t=n:e.name&&n.name===e.name&&(t=n);return t},i.sign=function(s,o){i.md=o||e.md.sha1.create();var u=r[i.md.algorithm+"WithRSAEncryption"];if(!u)throw{message:"Could not compute certificate digest. Unknown message digest algorithm OID.",algorithm:i.md.algorithm};i.signatureOid=i.siginfo.algorithmOid=u,i.tbsCertificate=n.getTBSCertificate(i);var a=t.toDer(i.tbsCertificate);i.md.update(a.getBytes()),i.signature=s.sign(i.md)},i.verify=function(s){var o=!1;if(!i.issued(s)){var u=s.issuer,a=i.subject;throw{message:"The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.",expectedIssuer:u.attributes,actualIssuer:a.attributes}}var f=s.md;if(null===f){if(s.signatureOid in r){var l=r[s.signatureOid];switch(l){case"sha1WithRSAEncryption":f=e.md.sha1.create();break;case"md5WithRSAEncryption":f=e.md.md5.create();break;case"sha256WithRSAEncryption":f=e.md.sha256.create();break;case"RSASSA-PSS":f=e.md.sha256.create()}}if(null===f)throw{message:"Could not compute certificate digest. Unknown signature OID.",signatureOid:s.signatureOid};var c=s.tbsCertificate||n.getTBSCertificate(s),h=t.toDer(c);f.update(h.getBytes())}if(null!==f){var p;switch(s.signatureOid){case r.sha1WithRSAEncryption:p=void 0;break;case r["RSASSA-PSS"]:var d,v;if(d=r[s.signatureParameters.mgf.hash.algorithmOid],void 0===d||void 0===e.md[d])throw{message:"Unsupported MGF hash function.",oid:s.signatureParameters.mgf.hash.algorithmOid,name:d};if(v=r[s.signatureParameters.mgf.algorithmOid],void 0===v||void 0===e.mgf[v])throw{message:"Unsupported MGF function.",oid:s.signatureParameters.mgf.algorithmOid,name:v};if(v=e.mgf[v].create(e.md[d].create()),d=r[s.signatureParameters.hash.algorithmOid],void 0===d||void 0===e.md[d])throw{message:"Unsupported RSASSA-PSS hash function.",oid:s.signatureParameters.hash.algorithmOid,name:d};p=e.pss.create(e.md[d].create(),v,s.signatureParameters.saltLength)}o=i.publicKey.verify(f.digest().getBytes(),s.signature,p)}return o},i.isIssuer=function(e){var t=!1,n=i.issuer,r=e.subject;if(n.hash&&r.hash)t=n.hash===r.hash;else if(n.attributes.length===r.attributes.length){t=!0;for(var s,o,u=0;t&&u<n.attributes.length;++u)s=n.attributes[u],o=r.attributes[u],(s.type!==o.type||s.value!==o.value)&&(t=!1)}return t},i.issued=function(e){return e.isIssuer(i)},i.generateSubjectKeyIdentifier=function(){var r=t.toDer(n.publicKeyToRSAPublicKey(i.publicKey)),s=e.md.sha1.create();return s.update(r.getBytes()),s.digest()},i.verifySubjectKeyIdentifier=function(){for(var t=r.subjectKeyIdentifier,n=0;n<i.extensions.length;++n){var s=i.extensions[n];if(s.id===t){var o=i.generateSubjectKeyIdentifier().getBytes();return e.util.hexToBytes(s.subjectKeyIdentifier)===o}}return!1},i},n.certificateFromAsn1=function(i,s){var u={},a=[];if(!t.validate(i,o,u,a))throw{message:"Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.",errors:a};if("string"!=typeof u.certSignature){for(var f="\x00",p=0;p<u.certSignature.length;++p)f+=t.toDer(u.certSignature[p]).getBytes();u.certSignature=f}var d=t.derToOid(u.publicKeyOid);if(d!==n.oids.rsaEncryption)throw{message:"Cannot read public key. OID is not RSA."};var v=n.createCertificate();v.version=u.certVersion?u.certVersion.charCodeAt(0):0;var g=e.util.createBuffer(u.certSerialNumber);v.serialNumber=g.toHex(),v.signatureOid=e.asn1.derToOid(u.certSignatureOid),v.signatureParameters=h(v.signatureOid,u.certSignatureParams,!0),v.siginfo.algorithmOid=e.asn1.derToOid(u.certinfoSignatureOid),v.siginfo.parameters=h(v.siginfo.algorithmOid,u.certinfoSignatureParams,!1);var y=e.util.createBuffer(u.certSignature);++y.read,v.signature=y.getBytes();var b=[];if(void 0!==u.certValidity1UTCTime&&b.push(t.utcTimeToDate(u.certValidity1UTCTime)),void 0!==u.certValidity2GeneralizedTime&&b.push(t.generalizedTimeToDate(u.certValidity2GeneralizedTime)),void 0!==u.certValidity3UTCTime&&b.push(t.utcTimeToDate(u.certValidity3UTCTime)),void 0!==u.certValidity4GeneralizedTime&&b.push(t.generalizedTimeToDate(u.certValidity4GeneralizedTime)),b.length>2)throw{message:"Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate."};if(b.length<2)throw{message:"Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime."};if(v.validity.notBefore=b[0],v.validity.notAfter=b[1],v.tbsCertificate=u.tbsCertificate,s){if(v.md=null,v.signatureOid in r){var d=r[v.signatureOid];switch(d){case"sha1WithRSAEncryption":v.md=e.md.sha1.create();break;case"md5WithRSAEncryption":v.md=e.md.md5.create();break;case"sha256WithRSAEncryption":v.md=e.md.sha256.create();break;case"RSASSA-PSS":v.md=e.md.sha256.create()}}if(null===v.md)throw{message:"Could not compute certificate digest. Unknown signature OID.",signatureOid:v.signatureOid};var w=t.toDer(v.tbsCertificate);v.md.update(w.getBytes())}var E=e.md.sha1.create();v.issuer.getField=function(e){return l(v.issuer,e)},v.issuer.addField=function(e){m([e]),v.issuer.attributes.push(e)},v.issuer.attributes=n.RDNAttributesAsArray(u.certIssuer,E),u.certIssuerUniqueId&&(v.issuer.uniqueId=u.certIssuerUniqueId),v.issuer.hash=E.digest().toHex();var S=e.md.sha1.create();return v.subject.getField=function(e){return l(v.subject,e)},v.subject.addField=function(e){m([e]),v.subject.attributes.push(e)},v.subject.attributes=n.RDNAttributesAsArray(u.certSubject,S),u.certSubjectUniqueId&&(v.subject.uniqueId=u.certSubjectUniqueId),v.subject.hash=S.digest().toHex(),v.extensions=u.certExtensions?c(u.certExtensions):[],v.publicKey=n.publicKeyFromAsn1(u.subjectPublicKeyInfo),v},n.certificationRequestFromAsn1=function(i,s){var o={},u=[];if(!t.validate(i,f,o,u))throw{message:"Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.",errors:u};if("string"!=typeof o.csrSignature){for(var a="\x00",c=0;c<o.csrSignature.length;++c)a+=t.toDer(o.csrSignature[c]).getBytes();o.csrSignature=a}var p=t.derToOid(o.publicKeyOid);if(p!==n.oids.rsaEncryption)throw{message:"Cannot read public key. OID is not RSA."};var d=n.createCertificationRequest();d.version=o.csrVersion?o.csrVersion.charCodeAt(0):0,d.signatureOid=e.asn1.derToOid(o.csrSignatureOid),d.signatureParameters=h(d.signatureOid,o.csrSignatureParams,!0),d.siginfo.algorithmOid=e.asn1.derToOid(o.csrSignatureOid),d.siginfo.parameters=h(d.siginfo.algorithmOid,o.csrSignatureParams,!1);var v=e.util.createBuffer(o.csrSignature);if(++v.read,d.signature=v.getBytes(),d.certificationRequestInfo=o.certificationRequestInfo,s){if(d.md=null,d.signatureOid in r){var p=r[d.signatureOid];switch(p){case"sha1WithRSAEncryption":d.md=e.md.sha1.create();break;case"md5WithRSAEncryption":d.md=e.md.md5.create();break;case"sha256WithRSAEncryption":d.md=e.md.sha256.create();break;case"RSASSA-PSS":d.md=e.md.sha256.create()}}if(null===d.md)throw{message:"Could not compute certification request digest. Unknown signature OID.",signatureOid:d.signatureOid};var g=t.toDer(d.certificationRequestInfo);d.md.update(g.getBytes())}var y=e.md.sha1.create();return d.subject.getField=function(e){return l(d.subject,e)},d.subject.addField=function(e){m([e]),d.subject.attributes.push(e)},d.subject.attributes=n.RDNAttributesAsArray(o.certificationRequestInfoSubject,y),d.subject.hash=y.digest().toHex(),d.publicKey=n.publicKeyFromAsn1(o.subjectPublicKeyInfo),d.getAttribute=function(e){return l(d.attributes,e)},d.addAttribute=function(e){m([e]),d.attributes.push(e)},d.attributes=n.CRIAttributesAsArray(o.certificationRequestInfoAttributes||[]),d},n.createCertificationRequest=function(){var i={};return i.version=0,i.signatureOid=null,i.signature=null,i.siginfo={},i.siginfo.algorithmOid=null,i.subject={},i.subject.getField=function(e){return l(i.subject,e)},i.subject.addField=function(e){m([e]),i.subject.attributes.push(e)},i.subject.attributes=[],i.subject.hash=null,i.publicKey=null,i.attributes=[],i.getAttribute=function(e){return l(i.attributes,e)},i.addAttribute=function(e){m([e]),i.attributes.push(e)},i.md=null,i.setSubject=function(e){m(e),i.subject.attributes=e,i.subject.hash=null},i.setAttributes=function(e){m(e),i.attributes=e},i.sign=function(s,o){i.md=o||e.md.sha1.create();var u=r[i.md.algorithm+"WithRSAEncryption"];if(!u)throw{message:"Could not compute certification request digest. Unknown message digest algorithm OID.",algorithm:i.md.algorithm};i.signatureOid=i.siginfo.algorithmOid=u,i.certificationRequestInfo=n.getCertificationRequestInfo(i);var a=t.toDer(i.certificationRequestInfo);i.md.update(a.getBytes()),i.signature=s.sign(i.md)},i.verify=function(){var s=!1,o=i.md;if(null===o){if(i.signatureOid in r){var u=r[i.signatureOid];switch(u){case"sha1WithRSAEncryption":o=e.md.sha1.create();break;case"md5WithRSAEncryption":o=e.md.md5.create();break;case"sha256WithRSAEncryption":o=e.md.sha256.create();break;case"RSASSA-PSS":o=e.md.sha256.create()}}if(null===o)throw{message:"Could not compute certification request digest. Unknown signature OID.",signatureOid:i.signatureOid};var a=i.certificationRequestInfo||n.getCertificationRequestInfo(i),f=t.toDer(a);o.update(f.getBytes())}if(null!==o){var l;switch(i.signatureOid){case r.sha1WithRSAEncryption:break;case r["RSASSA-PSS"]:var c,h;if(c=r[i.signatureParameters.mgf.hash.algorithmOid],void 0===c||void 0===e.md[c])throw{message:"Unsupported MGF hash function.",oid:i.signatureParameters.mgf.hash.algorithmOid,name:c};if(h=r[i.signatureParameters.mgf.algorithmOid],void 0===h||void 0===e.mgf[h])throw{message:"Unsupported MGF function.",oid:i.signatureParameters.mgf.algorithmOid,name:h};if(h=e.mgf[h].create(e.md[c].create()),c=r[i.signatureParameters.hash.algorithmOid],void 0===c||void 0===e.md[c])throw{message:"Unsupported RSASSA-PSS hash function.",oid:i.signatureParameters.hash.algorithmOid,name:c};l=e.pss.create(e.md[c].create(),h,i.signatureParameters.saltLength)}s=i.publicKey.verify(o.digest().getBytes(),i.signature,l)}return s},i},n.getTBSCertificate=function(r){var i=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(r.version).getBytes())]),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,e.util.hexToBytes(r.serialNumber)),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(r.siginfo.algorithmOid).getBytes()),g(r.siginfo.algorithmOid,r.siginfo.parameters)]),p(r.issuer),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.UTCTIME,!1,t.dateToUtcTime(r.validity.notBefore)),t.create(t.Class.UNIVERSAL,t.Type.UTCTIME,!1,t.dateToUtcTime(r.validity.notAfter))]),p(r.subject),n.publicKeyToAsn1(r.publicKey)]);return r.issuer.uniqueId&&i.value.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,[t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+r.issuer.uniqueId)])),r.subject.uniqueId&&i.value.push(t.create(t.Class.CONTEXT_SPECIFIC,2,!0,[t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+r.subject.uniqueId)])),r.extensions.length>0&&i.value.push(d(r.extensions)),i},n.getCertificationRequestInfo=function(e){var r=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(e.version).getBytes()),p(e.subject),n.publicKeyToAsn1(e.publicKey),y(e)]);return r},n.distinguishedNameToAsn1=function(e){return p(e)},n.certificateToAsn1=function(e){var r=e.tbsCertificate||n.getTBSCertificate(e);return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[r,t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(e.signatureOid).getBytes()),g(e.signatureOid,e.signatureParameters)]),t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},n.certificationRequestToAsn1=function(e){var r=e.certificationRequestInfo||n.getCertificationRequestInfo(e);return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[r,t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(e.signatureOid).getBytes()),g(e.signatureOid,e.signatureParameters)]),t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},n.createCaStore=function(t){var r={certs:{}};if(r.getIssuer=function(t){var i=null;if(!t.issuer.hash){var s=e.md.sha1.create();t.issuer.attributes=n.RDNAttributesAsArray(p(t.issuer),s),t.issuer.hash=s.digest().toHex()}if(t.issuer.hash in r.certs&&(i=r.certs[t.issuer.hash],e.util.isArray(i)))throw{message:"Resolving multiple issuer matches not implemented yet."};return i},r.addCertificate=function(t){if("string"==typeof t&&(t=e.pki.certificateFromPem(t)),!t.subject.hash){var i=e.md.sha1.create();t.subject.attributes=n.RDNAttributesAsArray(p(t.subject),i),t.subject.hash=i.digest().toHex()}if(t.subject.hash in r.certs){var s=r.certs[t.subject.hash];e.util.isArray(s)||(s=[s]),s.push(t)}else r.certs[t.subject.hash]=t},t)for(var i=0;i<t.length;++i){var s=t[i];r.addCertificate(s)}return r},n.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"},n.verifyCertificateChain=function(t,r,i){r=r.slice(0);var s=r.slice(0),o=new Date,u=!0,a=null,f=0,l=null;do{var c=r.shift();if(o<c.validity.notBefore||o>c.validity.notAfter)a={message:"Certificate is not valid yet or has expired.",error:n.certificateError.certificate_expired,notBefore:c.validity.notBefore,notAfter:c.validity.notAfter,now:o};else{var h=!1;if(r.length>0){l=r[0];try{h=l.verify(c)}catch(p){}}else{var d=t.getIssuer(c);if(null===d)a={message:"Certificate is not trusted.",error:n.certificateError.unknown_ca};else for(e.util.isArray(d)||(d=[d]);!h&&d.length>0;){l=d.shift();try{h=l.verify(c)}catch(p){}}}null===a&&!h&&(a={message:"Certificate signature is invalid.",error:n.certificateError.bad_certificate})}if(null===a&&!c.isIssuer(l)&&(a={message:"Certificate issuer is invalid.",error:n.certificateError.bad_certificate}),null===a)for(var v={keyUsage:!0,basicConstraints:!0},m=0;null===a&&m<c.extensions.length;++m){var g=c.extensions[m];g.critical&&!(g.name in v)&&(a={message:"Certificate has an unsupported critical extension.",error:n.certificateError.unsupported_certificate})}if(!u||0===r.length&&!l){var y=c.getExtension("basicConstraints"),b=c.getExtension("keyUsage");if(null!==b&&(!b.keyCertSign||null===y)&&(a={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:n.certificateError.bad_certificate}),null===a&&null!==y&&!y.cA&&(a={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:n.certificateError.bad_certificate}),null===a&&null!==b&&"pathLenConstraint"in y){for(var w=0,m=1;m<r.length-1;++m)r[m].isIssuer(r[m])&&++w;var E=y.pathLenConstraint+1;r.length-w>E&&(a={message:"Certificate basicConstraints pathLenConstraint violated.",error:n.certificateError.bad_certificate})}}var S=null===a?!0:a.error,x=i?i(S,f,s):S;if(x!==!0)throw S===!0&&(a={message:"The application rejected the certificate.",error:n.certificateError.bad_certificate}),(x||0===x)&&("object"!=typeof x||e.util.isArray(x)?"string"==typeof x&&(a.error=x):(x.message&&(a.message=x.message),x.error&&(a.error=x.error))),a;a=null,u=!1,++f}while(r.length>0);return!0}}var r="x509";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n.pki}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/x509",["require","module","./aes","./asn1","./des","./md","./mgf","./oids","./pem","./pss","./rsa","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function f(e,t,n,r){for(var i=[],s=0;s<e.length;s++)for(var o=0;o<e[s].safeBags.length;o++){var u=e[s].safeBags[o];(void 0===r||u.type===r)&&(null!==t?void 0!==u.attributes[t]&&u.attributes[t].indexOf(n)>=0&&i.push(u):i.push(u))}return i}function l(e,r,s,o){if(r=t.fromDer(r,s),r.tagClass!==t.Class.UNIVERSAL||r.type!==t.Type.SEQUENCE||r.constructed!==!0)throw{message:"PKCS#12 AuthenticatedSafe expected to be a SEQUENCE OF ContentInfo"};for(var u=0;u<r.value.length;u++){var a=r.value[u],f={},l=[];if(!t.validate(a,i,f,l))throw{message:"Cannot read ContentInfo.",errors:l};var p={encrypted:!1},d=null,v=f.content.value[0];switch(t.derToOid(f.contentType)){case n.oids.data:if(v.tagClass!==t.Class.UNIVERSAL||v.type!==t.Type.OCTETSTRING)throw{message:"PKCS#12 SafeContents Data is not an OCTET STRING."};d=v.value;break;case n.oids.encryptedData:if(void 0===o)throw{message:"Found PKCS#12 Encrypted SafeContents Data but no password available."};d=c(v,o),p.encrypted=!0;break;default:throw{message:"Unsupported PKCS#12 contentType.",contentType:t.derToOid(f.contentType)}}p.safeBags=h(d,s,o),e.safeContents.push(p)}}function c(r,i){var s={},o=[];if(!t.validate(r,e.pkcs7.asn1.encryptedDataValidator,s,o))throw{message:"Cannot read EncryptedContentInfo. ",errors:o};var u=t.derToOid(s.contentType);if(u!==n.oids.data)throw{message:"PKCS#12 EncryptedContentInfo ContentType is not Data.",oid:u};u=t.derToOid(s.encAlgorithm);var a=n.pbe.getCipher(u,s.encParameter,i),f=e.util.createBuffer(s.encryptedContent);if(a.update(f),!a.finish())throw{message:"Failed to decrypt PKCS#12 SafeContents."};return a.output.getBytes()}function h(e,r,i){if(e=t.fromDer(e,r),e.tagClass!==t.Class.UNIVERSAL||e.type!==t.Type.SEQUENCE||e.constructed!==!0)throw{message:"PKCS#12 SafeContents expected to be a SEQUENCE OF SafeBag"};for(var s=[],u=0;u<e.value.length;u++){var f=e.value[u],l={},c=[];if(!t.validate(f,o,l,c))throw{message:"Cannot read SafeBag.",errors:c};var h={type:t.derToOid(l.bagId),attributes:p(l.bagAttributes)};s.push(h);var d,v,m=l.bagValue.value[0];switch(h.type){case n.oids.pkcs8ShroudedKeyBag:if(void 0===i)throw{message:"Found PKCS#8 ShroudedKeyBag but no password available."};if(m=n.decryptPrivateKeyInfo(m,i),null===m)throw{message:"Unable to decrypt PKCS#8 ShroudedKeyBag, wrong password?"};case n.oids.keyBag:h.key=n.privateKeyFromAsn1(m);continue;case n.oids.certBag:d=a,v=function(){if(t.derToOid(l.certId)!==n.oids.x509Certificate)throw{message:"Unsupported certificate type, only X.509 supported.",oid:t.derToOid(l.certId)};h.cert=n.certificateFromAsn1(t.fromDer(l.cert,r),!0)};break;default:throw{message:"Unsupported PKCS#12 SafeBag type.",oid:h.type}}if(void 0!==d&&!t.validate(m,d,l,c))throw{message:"Cannot read PKCS#12 "+d.name,errors:c};v()}return s}function p(e){var r={};if(void 0!==e)for(var i=0;i<e.length;++i){var s={},o=[];if(!t.validate(e[i],u,s,o))throw{message:"Cannot read PKCS#12 BagAttribute.",errors:o};var a=t.derToOid(s.oid);if(void 0!==n.oids[a]){r[n.oids[a]]=[];for(var f=0;f<s.values.length;++f)r[n.oids[a]].push(s.values[f].value)}}return r}var t=e.asn1,n=e.pki,r=e.pkcs12=e.pkcs12||{},i={name:"ContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.contentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:t.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"content"}]},s={name:"PFX",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},i,{name:"PFX.macData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"mac",value:[{name:"PFX.macData.mac",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"macAlgorithm"},{name:"PFX.macData.mac.digestAlgorithm.parameters",tagClass:t.Class.UNIVERSAL,captureAsn1:"macAlgorithmParameters"}]},{name:"PFX.macData.mac.digest",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"macDigest"}]},{name:"PFX.macData.macSalt",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"macSalt"},{name:"PFX.macData.iterations",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,optional:!0,capture:"macIterations"}]}]},o={name:"SafeBag",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SafeBag.bagId",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"bagId"},{name:"SafeBag.bagValue",tagClass:t.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"bagValue"},{name:"SafeBag.bagAttributes",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,optional:!0,capture:"bagAttributes"}]},u={name:"Attribute",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Attribute.attrId",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"oid"},{name:"Attribute.attrValues",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,capture:"values"}]},a={name:"CertBag",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"CertBag.certId",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"certId"},{name:"CertBag.certValue",tagClass:t.Class.CONTEXT_SPECIFIC,constructed:!0,value:[{name:"CertBag.certValue[0]",tagClass:t.Class.UNIVERSAL,type:t.Class.OCTETSTRING,constructed:!1,capture:"cert"}]}]};r.pkcs12FromAsn1=function(i,o,u){"string"==typeof o?(u=o,o=!0):void 0===o&&(o=!0);var a={},c=[];if(!t.validate(i,s,a,c))throw{message:"Cannot read PKCS#12 PFX. ASN.1 object is not an PKCS#12 PFX.",errors:c};var h={version:a.version.charCodeAt(0),safeContents:[],getBags:function(t){var r,n={};return"localKeyId"in t?r=t.localKeyId:"localKeyIdHex"in t&&(r=e.util.hexToBytes(t.localKeyIdHex)),void 0===r&&!("friendlyName"in t)&&"bagType"in t&&(n[t.bagType]=f(h.safeContents,null,null,t.bagType)),void 0!==r&&(n.localKeyId=f(h.safeContents,"localKeyId",r,t.bagType)),"friendlyName"in t&&(n.friendlyName=f(h.safeContents,"friendlyName",t.friendlyName,t.bagType)),n},getBagsByFriendlyName:function(e,t){return f(h.safeContents,"friendlyName",e,t)},getBagsByLocalKeyId:function(e,t){return f(h.safeContents,"localKeyId",e,t)}};if(3!==a.version.charCodeAt(0))throw{message:"PKCS#12 PFX of version other than 3 not supported.",version:a.version.charCodeAt(0)};if(t.derToOid(a.contentType)!==n.oids.data)throw{message:"Only PKCS#12 PFX in password integrity mode supported.",oid:t.derToOid(a.contentType)};var p=a.content.value[0];if(p.tagClass!==t.Class.UNIVERSAL||p.type!==t.Type.OCTETSTRING)throw{message:"PKCS#12 authSafe content data is not an OCTET STRING."};if(a.mac){var d=null,v=0,m=t.derToOid(a.macAlgorithm);
switch(m){case n.oids.sha1:d=e.md.sha1.create(),v=20;break;case n.oids.sha256:d=e.md.sha256.create(),v=32;break;case n.oids.sha384:d=e.md.sha384.create(),v=48;break;case n.oids.sha512:d=e.md.sha512.create(),v=64;break;case n.oids.md5:d=e.md.md5.create(),v=16}if(null===d)throw{message:"PKCS#12 uses unsupported MAC algorithm: "+m};var g=new e.util.ByteBuffer(a.macSalt),y="macIterations"in a?parseInt(e.util.bytesToHex(a.macIterations),16):1,b=r.generateKey(u||"",g,3,y,v,d),w=e.hmac.create();w.start(d,b),w.update(p.value);var E=w.getMac();if(E.getBytes()!==a.macDigest)throw{message:"PKCS#12 MAC could not be verified. Invalid password?"}}return l(h,p.value,o,u),h},r.toPkcs12Asn1=function(i,s,o,u){u=u||{},u.saltSize=u.saltSize||8,u.count=u.count||2048,u.algorithm=u.algorithm||u.encAlgorithm||"aes128","useMac"in u||(u.useMac=!0),"localKeyId"in u||(u.localKeyId=null),"generateLocalKeyId"in u||(u.generateLocalKeyId=!0);var f,a=u.localKeyId;if(null!==a)a=e.util.hexToBytes(a);else if(u.generateLocalKeyId)if(s){var l=e.util.isArray(s)?s[0]:s;"string"==typeof l&&(l=n.certificateFromPem(l));var c=e.md.sha1.create();c.update(t.toDer(n.certificateToAsn1(l)).getBytes()),a=c.digest().getBytes()}else a=e.random.getBytes(20);var h=[];null!==a&&h.push(t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.localKeyId).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,a)])])),"friendlyName"in u&&h.push(t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.friendlyName).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,t.Type.BMPSTRING,!1,u.friendlyName)])])),h.length>0&&(f=t.create(t.Class.UNIVERSAL,t.Type.SET,!0,h));var p=[],d=[];null!==s&&(d=e.util.isArray(s)?s:[s]);for(var v=[],m=0;m<d.length;++m){s=d[m],"string"==typeof s&&(s=n.certificateFromPem(s));var g=0===m?f:void 0,y=n.certificateToAsn1(s),b=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.certBag).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.x509Certificate).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,t.toDer(y).getBytes())])])]),g]);v.push(b)}if(v.length>0){var w=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,v),E=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.data).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,t.toDer(w).getBytes())])]);p.push(E)}var S=null;if(null!==i){var x=n.wrapRsaPrivateKey(n.privateKeyToAsn1(i));S=null===o?t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.keyBag).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[x]),f]):t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.pkcs8ShroudedKeyBag).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[n.encryptPrivateKeyInfo(x,o,u)]),f]);var T=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[S]),N=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.data).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,t.toDer(T).getBytes())])]);p.push(N)}var k,C=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,p);if(u.useMac){var c=e.md.sha1.create(),L=new e.util.ByteBuffer(e.random.getBytes(u.saltSize)),A=u.count,i=r.generateKey(o||"",L,3,A,20),O=e.hmac.create();O.start(c,i),O.update(t.toDer(C).getBytes());var M=O.getMac();k=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.sha1).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")]),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,M.getBytes())]),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,L.getBytes()),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(A).getBytes())])}return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(3).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.data).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,t.toDer(C).getBytes())])]),k])},r.generateKey=e.pbe.generatePkcs12Key}var r="pkcs12";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/pkcs12",["require","module","./asn1","./hmac","./oids","./pkcs7asn1","./pbe","./random","./rsa","./sha1","./util","./x509"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){var t=e.asn1,n=e.pki=e.pki||{};n.pemToDer=function(t){var n=e.pem.decode(t)[0];if(n.procType&&"ENCRYPTED"===n.procType.type)throw{message:"Could not convert PEM to DER; PEM is encrypted."};return e.util.createBuffer(n.body)},n.privateKeyFromPem=function(r){var i=e.pem.decode(r)[0];if("PRIVATE KEY"!==i.type&&"RSA PRIVATE KEY"!==i.type)throw{message:'Could not convert private key from PEM; PEM header type is not "PRIVATE KEY" or "RSA PRIVATE KEY".',headerType:i.type};if(i.procType&&"ENCRYPTED"===i.procType.type)throw{message:"Could not convert private key from PEM; PEM is encrypted."};var s=t.fromDer(i.body);return n.privateKeyFromAsn1(s)},n.privateKeyToPem=function(r,i){var s={type:"RSA PRIVATE KEY",body:t.toDer(n.privateKeyToAsn1(r)).getBytes()};return e.pem.encode(s,{maxline:i})},n.privateKeyInfoToPem=function(n,r){var i={type:"PRIVATE KEY",body:t.toDer(n).getBytes()};return e.pem.encode(i,{maxline:r})}}var r="pki";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/pki",["require","module","./asn1","./oids","./pbe","./pem","./pbkdf2","./pkcs12","./pss","./rsa","./util","./x509"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){var t=function(t,n,r,i){var s=e.util.createBuffer(),o=t.length>>1,u=o+(1&t.length),a=t.substr(0,u),f=t.substr(o,u),l=e.util.createBuffer(),c=e.hmac.create();r=n+r;var h=Math.ceil(i/16),p=Math.ceil(i/20);c.start("MD5",a);var d=e.util.createBuffer();l.putBytes(r);for(var v=0;h>v;++v)c.start(null,null),c.update(l.getBytes()),l.putBuffer(c.digest()),c.start(null,null),c.update(l.bytes()+r),d.putBuffer(c.digest());c.start("SHA1",f);var m=e.util.createBuffer();l.clear(),l.putBytes(r);for(var v=0;p>v;++v)c.start(null,null),c.update(l.getBytes()),l.putBuffer(c.digest()),c.start(null,null),c.update(l.bytes()+r),m.putBuffer(c.digest());return s.putBytes(e.util.xorBytes(d.getBytes(),m.getBytes(),i)),s},r=function(t,n,r){var i=e.hmac.create();i.start("SHA1",t);var s=e.util.createBuffer();return s.putInt32(n[0]),s.putInt32(n[1]),s.putByte(r.type),s.putByte(r.version.major),s.putByte(r.version.minor),s.putInt16(r.length),s.putBytes(r.fragment.bytes()),i.update(s.getBytes()),i.digest().getBytes()},i=function(t,n){var i=!1;try{var s=t.deflate(n.fragment.getBytes());n.fragment=e.util.createBuffer(s),n.length=s.length,i=!0}catch(o){}return i},s=function(t,n){var i=!1;try{var s=t.inflate(n.fragment.getBytes());n.fragment=e.util.createBuffer(s),n.length=s.length,i=!0}catch(o){}return i},o=function(t,n){var r=0;switch(n){case 1:r=t.getByte();break;case 2:r=t.getInt16();break;case 3:r=t.getInt24();break;case 4:r=t.getInt32()}return e.util.createBuffer(t.getBytes(r))},u=function(e,t,n){e.putInt(n.length(),t<<3),e.putBuffer(n)},a={};a.Versions={TLS_1_0:{major:3,minor:1},TLS_1_1:{major:3,minor:2},TLS_1_2:{major:3,minor:3}},a.SupportedVersions=[a.Versions.TLS_1_1,a.Versions.TLS_1_0],a.Version=a.SupportedVersions[0],a.MaxFragment=15360,a.ConnectionEnd={server:0,client:1},a.PRFAlgorithm={tls_prf_sha256:0},a.BulkCipherAlgorithm={none:null,rc4:0,des3:1,aes:2},a.CipherType={stream:0,block:1,aead:2},a.MACAlgorithm={none:null,hmac_md5:0,hmac_sha1:1,hmac_sha256:2,hmac_sha384:3,hmac_sha512:4},a.CompressionMethod={none:0,deflate:1},a.ContentType={change_cipher_spec:20,alert:21,handshake:22,application_data:23,heartbeat:24},a.HandshakeType={hello_request:0,client_hello:1,server_hello:2,certificate:11,server_key_exchange:12,certificate_request:13,server_hello_done:14,certificate_verify:15,client_key_exchange:16,finished:20},a.Alert={},a.Alert.Level={warning:1,fatal:2},a.Alert.Description={close_notify:0,unexpected_message:10,bad_record_mac:20,decryption_failed:21,record_overflow:22,decompression_failure:30,handshake_failure:40,bad_certificate:42,unsupported_certificate:43,certificate_revoked:44,certificate_expired:45,certificate_unknown:46,illegal_parameter:47,unknown_ca:48,access_denied:49,decode_error:50,decrypt_error:51,export_restriction:60,protocol_version:70,insufficient_security:71,internal_error:80,user_canceled:90,no_renegotiation:100},a.HeartbeatMessageType={heartbeat_request:1,heartbeat_response:2},a.CipherSuites={},a.getCipherSuite=function(e){var t=null;for(var n in a.CipherSuites){var r=a.CipherSuites[n];if(r.id[0]===e.charCodeAt(0)&&r.id[1]===e.charCodeAt(1)){t=r;break}}return t},a.handleUnexpected=function(e){var n=!e.open&&e.entity===a.ConnectionEnd.client;n||e.error(e,{message:"Unexpected message. Received TLS record out of order.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.unexpected_message}})},a.handleHelloRequest=function(e){!e.handshaking&&e.handshakes>0&&(a.queue(e,a.createAlert(e,{level:a.Alert.Level.warning,description:a.Alert.Description.no_renegotiation})),a.flush(e)),e.process()},a.parseHelloMessage=function(t,n,r){var i=null,s=t.entity===a.ConnectionEnd.client;if(38>r)t.error(t,{message:s?"Invalid ServerHello message. Message too short.":"Invalid ClientHello message. Message too short.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.illegal_parameter}});else{var u=n.fragment,f=u.length();if(i={version:{major:u.getByte(),minor:u.getByte()},random:e.util.createBuffer(u.getBytes(32)),session_id:o(u,1),extensions:[]},s?(i.cipher_suite=u.getBytes(2),i.compression_method=u.getByte()):(i.cipher_suites=o(u,2),i.compression_methods=o(u,1)),f=r-(f-u.length()),f>0){for(var l=o(u,2);l.length()>0;)i.extensions.push({type:[l.getByte(),l.getByte()],data:o(l,2)});if(!s)for(var c=0;c<i.extensions.length;++c){var h=i.extensions[c];if(0===h.type[0]&&0===h.type[1])for(var p=o(h.data,2);p.length()>0;){var d=p.getByte();if(0!==d)break;t.session.extensions.server_name.serverNameList.push(o(p,2).getBytes())}}}if(t.session.version&&(i.version.major!==t.session.version.major||i.version.minor!==t.session.version.minor))return t.error(t,{message:"TLS version change is disallowed during renegotiation.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.protocol_version}});if(s)t.session.cipherSuite=a.getCipherSuite(i.cipher_suite);else for(var v=e.util.createBuffer(i.cipher_suites.bytes());v.length()>0&&(t.session.cipherSuite=a.getCipherSuite(v.getBytes(2)),null===t.session.cipherSuite););if(null===t.session.cipherSuite)return t.error(t,{message:"No cipher suites in common.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.handshake_failure},cipherSuite:e.util.bytesToHex(i.cipher_suite)});t.session.compressionMethod=s?i.compression_method:a.CompressionMethod.none}return i},a.createSecurityParameters=function(e,t){var n=e.entity===a.ConnectionEnd.client,r=t.random.bytes(),i=n?e.session.sp.client_random:r,s=n?r:a.createRandom().getBytes();e.session.sp={entity:e.entity,prf_algorithm:a.PRFAlgorithm.tls_prf_sha256,bulk_cipher_algorithm:null,cipher_type:null,enc_key_length:null,block_length:null,fixed_iv_length:null,record_iv_length:null,mac_algorithm:null,mac_length:null,mac_key_length:null,compression_algorithm:e.session.compressionMethod,pre_master_secret:null,master_secret:null,client_random:i,server_random:s}},a.handleServerHello=function(e,t,n){var r=a.parseHelloMessage(e,t,n);if(!e.fail){if(!(r.version.minor<=e.version.minor))return e.error(e,{message:"Incompatible TLS version.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.protocol_version}});e.version.minor=r.version.minor,e.session.version=e.version;var i=r.session_id.bytes();i.length>0&&i===e.session.id?(e.expect=d,e.session.resuming=!0,e.session.sp.server_random=r.random.bytes()):(e.expect=l,e.session.resuming=!1,a.createSecurityParameters(e,r)),e.session.id=i,e.process()}},a.handleClientHello=function(t,n,r){var i=a.parseHelloMessage(t,n,r);if(!t.fail){var s=i.session_id.bytes(),o=null;if(t.sessionCache&&(o=t.sessionCache.getSession(s),null===o?s="":(o.version.major!==i.version.major||o.version.minor>i.version.minor)&&(o=null,s="")),0===s.length&&(s=e.random.getBytes(32)),t.session.id=s,t.session.clientHelloVersion=i.version,t.session.sp={},o)t.version=t.session.version=o.version,t.session.sp=o.sp;else{for(var u,f=1;f<a.SupportedVersions.length&&(u=a.SupportedVersions[f],!(u.minor<=i.version.minor));++f);t.version={major:u.major,minor:u.minor},t.session.version=t.version}null!==o?(t.expect=S,t.session.resuming=!0,t.session.sp.client_random=i.random.bytes()):(t.expect=t.verifyClient!==!1?b:w,t.session.resuming=!1,a.createSecurityParameters(t,i)),t.open=!0,a.queue(t,a.createRecord(t,{type:a.ContentType.handshake,data:a.createServerHello(t)})),t.session.resuming?(a.queue(t,a.createRecord(t,{type:a.ContentType.change_cipher_spec,data:a.createChangeCipherSpec()})),t.state.pending=a.createConnectionState(t),t.state.current.write=t.state.pending.write,a.queue(t,a.createRecord(t,{type:a.ContentType.handshake,data:a.createFinished(t)}))):(a.queue(t,a.createRecord(t,{type:a.ContentType.handshake,data:a.createCertificate(t)})),t.fail||(a.queue(t,a.createRecord(t,{type:a.ContentType.handshake,data:a.createServerKeyExchange(t)})),t.verifyClient!==!1&&a.queue(t,a.createRecord(t,{type:a.ContentType.handshake,data:a.createCertificateRequest(t)})),a.queue(t,a.createRecord(t,{type:a.ContentType.handshake,data:a.createServerHelloDone(t)})))),a.flush(t),t.process()}},a.handleCertificate=function(t,n,r){if(3>r)return t.error(t,{message:"Invalid Certificate message. Message too short.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.illegal_parameter}});var u,f,i=n.fragment,s={certificate_list:o(i,3)},l=[];try{for(;s.certificate_list.length()>0;)u=o(s.certificate_list,3),f=e.asn1.fromDer(u),u=e.pki.certificateFromAsn1(f,!0),l.push(u)}catch(h){return t.error(t,{message:"Could not parse certificate list.",cause:h,send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.bad_certificate}})}var p=t.entity===a.ConnectionEnd.client;!p&&t.verifyClient!==!0||0!==l.length?0===l.length?t.expect=p?c:w:(p?t.session.serverCertificate=l[0]:t.session.clientCertificate=l[0],a.verifyCertificateChain(t,l)&&(t.expect=p?c:w)):t.error(t,{message:p?"No server certificate provided.":"No client certificate provided.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.illegal_parameter}}),t.process()},a.handleServerKeyExchange=function(e,t,n){return n>0?e.error(e,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.unsupported_certificate}}):(e.expect=h,void e.process())},a.handleClientKeyExchange=function(t,n,r){if(48>r)return t.error(t,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.unsupported_certificate}});var i=n.fragment,s={enc_pre_master_secret:o(i,2).getBytes()},u=null;if(t.getPrivateKey)try{u=t.getPrivateKey(t,t.session.serverCertificate),u=e.pki.privateKeyFromPem(u)}catch(f){t.error(t,{message:"Could not get private key.",cause:f,send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.internal_error}})}if(null===u)return t.error(t,{message:"No private key set.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.internal_error}});try{var l=t.session.sp;l.pre_master_secret=u.decrypt(s.enc_pre_master_secret);var c=t.session.clientHelloVersion;if(c.major!==l.pre_master_secret.charCodeAt(0)||c.minor!==l.pre_master_secret.charCodeAt(1))throw{message:"TLS version rollback attack detected."}}catch(f){l.pre_master_secret=e.random.getBytes(48)}t.expect=S,null!==t.session.clientCertificate&&(t.expect=E),t.process()},a.handleCertificateRequest=function(e,t,n){if(3>n)return e.error(e,{message:"Invalid CertificateRequest. Message too short.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.illegal_parameter}});var r=t.fragment,i={certificate_types:o(r,1),certificate_authorities:o(r,2)};e.session.certificateRequest=i,e.expect=p,e.process()},a.handleCertificateVerify=function(t,n,r){if(2>r)return t.error(t,{message:"Invalid CertificateVerify. Message too short.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.illegal_parameter}});var i=n.fragment;i.read-=4;var s=i.bytes();i.read+=4;var u={signature:o(i,2).getBytes()},f=e.util.createBuffer();f.putBuffer(t.session.md5.digest()),f.putBuffer(t.session.sha1.digest()),f=f.getBytes();try{var l=t.session.clientCertificate;if(!l.publicKey.verify(f,u.signature,"NONE"))throw{message:"CertificateVerify signature does not match."};t.session.md5.update(s),t.session.sha1.update(s)}catch(c){return t.error(t,{message:"Bad signature in CertificateVerify.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.handshake_failure}})}t.expect=S,t.process()},a.handleServerHelloDone=function(t,n,r){if(r>0)return t.error(t,{message:"Invalid ServerHelloDone message. Invalid length.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.record_overflow}});if(null===t.serverCertificate){var i={message:"No server certificate provided. Not enough security.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.insufficient_security}},s=0,o=t.verify(t,i.alert.description,s,[]);if(o!==!0)return(o||0===o)&&("object"!=typeof o||e.util.isArray(o)?"number"==typeof o&&(i.alert.description=o):(o.message&&(i.message=o.message),o.alert&&(i.alert.description=o.alert))),t.error(t,i)}null!==t.session.certificateRequest&&(n=a.createRecord(t,{type:a.ContentType.handshake,data:a.createCertificate(t)}),a.queue(t,n)),n=a.createRecord(t,{type:a.ContentType.handshake,data:a.createClientKeyExchange(t)}),a.queue(t,n),t.expect=g;var u=function(e,t){null!==e.session.certificateRequest&&null!==e.session.clientCertificate&&a.queue(e,a.createRecord(e,{type:a.ContentType.handshake,data:a.createCertificateVerify(e,t)})),a.queue(e,a.createRecord(e,{type:a.ContentType.change_cipher_spec,data:a.createChangeCipherSpec()})),e.state.pending=a.createConnectionState(e),e.state.current.write=e.state.pending.write,a.queue(e,a.createRecord(e,{type:a.ContentType.handshake,data:a.createFinished(e)})),e.expect=d,a.flush(e),e.process()};return null===t.session.certificateRequest||null===t.session.clientCertificate?u(t,null):void a.getClientSignature(t,u)},a.handleChangeCipherSpec=function(e,t){if(1!==t.fragment.getByte())return e.error(e,{message:"Invalid ChangeCipherSpec message received.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.illegal_parameter}});var n=e.entity===a.ConnectionEnd.client;(e.session.resuming&&n||!e.session.resuming&&!n)&&(e.state.pending=a.createConnectionState(e)),e.state.current.read=e.state.pending.read,(!e.session.resuming&&n||e.session.resuming&&!n)&&(e.state.pending=null),e.expect=n?v:x,e.process()},a.handleFinished=function(n,r){var s=r.fragment;s.read-=4;var o=s.bytes();s.read+=4;var u=r.fragment.getBytes();s=e.util.createBuffer(),s.putBuffer(n.session.md5.digest()),s.putBuffer(n.session.sha1.digest());var f=n.entity===a.ConnectionEnd.client,l=f?"server finished":"client finished",c=n.session.sp,h=12,p=t;return s=p(c.master_secret,l,s.getBytes(),h),s.getBytes()!==u?n.error(n,{message:"Invalid verify_data in Finished message.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.decrypt_error}}):(n.session.md5.update(o),n.session.sha1.update(o),(n.session.resuming&&f||!n.session.resuming&&!f)&&(a.queue(n,a.createRecord(n,{type:a.ContentType.change_cipher_spec,data:a.createChangeCipherSpec()})),n.state.current.write=n.state.pending.write,n.state.pending=null,a.queue(n,a.createRecord(n,{type:a.ContentType.handshake,data:a.createFinished(n)}))),n.expect=f?m:T,n.handshaking=!1,++n.handshakes,n.peerCertificate=f?n.session.serverCertificate:n.session.clientCertificate,a.flush(n),n.isConnected=!0,n.connected(n),n.process(),void 0)},a.handleAlert=function(e,t){var i,n=t.fragment,r={level:n.getByte(),description:n.getByte()};switch(r.description){case a.Alert.Description.close_notify:i="Connection closed.";break;case a.Alert.Description.unexpected_message:i="Unexpected message.";break;case a.Alert.Description.bad_record_mac:i="Bad record MAC.";break;case a.Alert.Description.decryption_failed:i="Decryption failed.";break;case a.Alert.Description.record_overflow:i="Record overflow.";break;case a.Alert.Description.decompression_failure:i="Decompression failed.";break;case a.Alert.Description.handshake_failure:i="Handshake failure.";break;case a.Alert.Description.bad_certificate:i="Bad certificate.";break;case a.Alert.Description.unsupported_certificate:i="Unsupported certificate.";break;case a.Alert.Description.certificate_revoked:i="Certificate revoked.";break;case a.Alert.Description.certificate_expired:i="Certificate expired.";break;case a.Alert.Description.certificate_unknown:i="Certificate unknown.";break;case a.Alert.Description.illegal_parameter:i="Illegal parameter.";break;case a.Alert.Description.unknown_ca:i="Unknown certificate authority.";break;case a.Alert.Description.access_denied:i="Access denied.";break;case a.Alert.Description.decode_error:i="Decode error.";break;case a.Alert.Description.decrypt_error:i="Decrypt error.";break;case a.Alert.Description.export_restriction:i="Export restriction.";break;case a.Alert.Description.protocol_version:i="Unsupported protocol version.";break;case a.Alert.Description.insufficient_security:i="Insufficient security.";break;case a.Alert.Description.internal_error:i="Internal error.";break;case a.Alert.Description.user_canceled:i="User canceled.";break;case a.Alert.Description.no_renegotiation:i="Renegotiation not supported.";break;default:i="Unknown error."}return r.description===a.Alert.Description.close_notify?e.close():(e.error(e,{message:i,send:!1,origin:e.entity===a.ConnectionEnd.client?"server":"client",alert:r}),void e.process())},a.handleHandshake=function(t,n){var r=n.fragment,i=r.getByte(),s=r.getInt24();if(s>r.length())return t.fragmented=n,n.fragment=e.util.createBuffer(),r.read-=4,t.process();t.fragmented=null,r.read-=4;var o=r.bytes(s+4);r.read+=4,i in q[t.entity][t.expect]?(t.entity===a.ConnectionEnd.server&&!t.open&&!t.fail&&(t.handshaking=!0,t.session={version:null,extensions:{server_name:{serverNameList:[]}},cipherSuite:null,compressionMethod:null,serverCertificate:null,clientCertificate:null,md5:e.md.md5.create(),sha1:e.md.sha1.create()}),i!==a.HandshakeType.hello_request&&i!==a.HandshakeType.certificate_verify&&i!==a.HandshakeType.finished&&(t.session.md5.update(o),t.session.sha1.update(o)),q[t.entity][t.expect][i](t,n,s)):a.handleUnexpected(t,n)},a.handleApplicationData=function(e,t){e.data.putBuffer(t.fragment),e.dataReady(e),e.process()},a.handleHeartbeat=function(t,n){var r=n.fragment,i=r.getByte(),s=r.getInt16(),o=r.getBytes(s);if(i===a.HeartbeatMessageType.heartbeat_request){if(t.handshaking||s>o.length)return t.process();a.queue(t,a.createRecord(t,{type:a.ContentType.heartbeat,data:a.createHeartbeat(a.HeartbeatMessageType.heartbeat_response,o)})),a.flush(t)}else if(i===a.HeartbeatMessageType.heartbeat_response){if(o!==t.expectedHeartbeatPayload)return t.process();t.heartbeatReceived&&t.heartbeatReceived(t,e.util.createBuffer(o))}t.process()};var f=0,l=1,c=2,h=3,p=4,d=5,v=6,m=7,g=8,y=0,b=1,w=2,E=3,S=4,x=5,T=6,C=a.handleUnexpected,k=a.handleChangeCipherSpec,L=a.handleAlert,A=a.handleHandshake,O=a.handleApplicationData,M=a.handleHeartbeat,_=[];_[a.ConnectionEnd.client]=[[C,L,A,C,M],[C,L,A,C,M],[C,L,A,C,M],[C,L,A,C,M],[C,L,A,C,M],[k,L,C,C,M],[C,L,A,C,M],[C,L,A,O,M],[C,L,A,C,M]],_[a.ConnectionEnd.server]=[[C,L,A,C,M],[C,L,A,C,M],[C,L,A,C,M],[C,L,A,C,M],[k,L,C,C,M],[C,L,A,C,M],[C,L,A,O,M],[C,L,A,C,M]];var D=a.handleHelloRequest,P=a.handleServerHello,H=a.handleCertificate,B=a.handleServerKeyExchange,j=a.handleCertificateRequest,F=a.handleServerHelloDone,I=a.handleFinished,q=[];q[a.ConnectionEnd.client]=[[C,C,P,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[D,C,C,C,C,C,C,C,C,C,C,H,B,j,F,C,C,C,C,C,C],[D,C,C,C,C,C,C,C,C,C,C,C,B,j,F,C,C,C,C,C,C],[D,C,C,C,C,C,C,C,C,C,C,C,C,j,F,C,C,C,C,C,C],[D,C,C,C,C,C,C,C,C,C,C,C,C,C,F,C,C,C,C,C,C],[D,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[D,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,I],[D,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[D,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C]];var R=a.handleClientHello,U=a.handleClientKeyExchange,z=a.handleCertificateVerify;q[a.ConnectionEnd.server]=[[C,R,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,H,C,C,C,C,C,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,U,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,z,C,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,I],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C]],a.generateKeys=function(e,n){var r=t,i=n.client_random+n.server_random;e.session.resuming||(n.master_secret=r(n.pre_master_secret,"master secret",i,48).bytes(),n.pre_master_secret=null),i=n.server_random+n.client_random;var s=2*n.mac_key_length+2*n.enc_key_length,o=e.version.major===a.Versions.TLS_1_0.major&&e.version.minor===a.Versions.TLS_1_0.minor;o&&(s+=2*n.fixed_iv_length);var u=r(n.master_secret,"key expansion",i,s),f={client_write_MAC_key:u.getBytes(n.mac_key_length),server_write_MAC_key:u.getBytes(n.mac_key_length),client_write_key:u.getBytes(n.enc_key_length),server_write_key:u.getBytes(n.enc_key_length)};return o&&(f.client_write_IV=u.getBytes(n.fixed_iv_length),f.server_write_IV=u.getBytes(n.fixed_iv_length)),f},a.createConnectionState=function(e){var t=e.entity===a.ConnectionEnd.client,n=function(){var e={sequenceNumber:[0,0],macKey:null,macLength:0,macFunction:null,cipherState:null,cipherFunction:function(){return!0},compressionState:null,compressFunction:function(){return!0},updateSequenceNumber:function(){4294967295===e.sequenceNumber[1]?(e.sequenceNumber[1]=0,++e.sequenceNumber[0]):++e.sequenceNumber[1]}};return e},r={read:n(),write:n()};if(r.read.update=function(e,t){return r.read.cipherFunction(t,r.read)?r.read.compressFunction(e,t,r.read)||e.error(e,{message:"Could not decompress record.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.decompression_failure}}):e.error(e,{message:"Could not decrypt record or bad MAC.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.bad_record_mac}}),!e.fail},r.write.update=function(e,t){return r.write.compressFunction(e,t,r.write)?r.write.cipherFunction(t,r.write)||e.error(e,{message:"Could not encrypt record.",send:!1,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.internal_error}}):e.error(e,{message:"Could not compress record.",send:!1,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.internal_error}}),!e.fail},e.session){var o=e.session.sp;switch(e.session.cipherSuite.initSecurityParameters(o),o.keys=a.generateKeys(e,o),r.read.macKey=t?o.keys.server_write_MAC_key:o.keys.client_write_MAC_key,r.write.macKey=t?o.keys.client_write_MAC_key:o.keys.server_write_MAC_key,e.session.cipherSuite.initConnectionState(r,e,o),o.compression_algorithm){case a.CompressionMethod.none:break;case a.CompressionMethod.deflate:r.read.compressFunction=s,r.write.compressFunction=i;break;default:throw{message:"Unsupported compression algorithm."}}}return r},a.createRandom=function(){var t=new Date,n=+t+6e4*t.getTimezoneOffset(),r=e.util.createBuffer();return r.putInt32(n),r.putBytes(e.random.getBytes(28)),r},a.createRecord=function(e,t){if(!t.data)return null;var n={type:t.type,version:{major:e.version.major,minor:e.version.minor},length:t.data.length(),fragment:t.data};return n},a.createAlert=function(t,n){var r=e.util.createBuffer();return r.putByte(n.level),r.putByte(n.description),a.createRecord(t,{type:a.ContentType.alert,data:r})},a.createClientHello=function(t){t.session.clientHelloVersion={major:t.version.major,minor:t.version.minor};for(var n=e.util.createBuffer(),r=0;r<t.cipherSuites.length;++r){var i=t.cipherSuites[r];n.putByte(i.id[0]),n.putByte(i.id[1])}var s=n.length(),o=e.util.createBuffer();o.putByte(a.CompressionMethod.none);var f=o.length(),l=e.util.createBuffer();if(t.virtualHost){var c=e.util.createBuffer();c.putByte(0),c.putByte(0);var h=e.util.createBuffer();h.putByte(0),u(h,2,e.util.createBuffer(t.virtualHost));var p=e.util.createBuffer();u(p,2,h),u(c,2,p),l.putBuffer(c)}var d=l.length();d>0&&(d+=2);var v=t.session.id,m=v.length+1+2+4+28+2+s+1+f+d,g=e.util.createBuffer();return g.putByte(a.HandshakeType.client_hello),g.putInt24(m),g.putByte(t.version.major),g.putByte(t.version.minor),g.putBytes(t.session.sp.client_random),u(g,1,e.util.createBuffer(v)),u(g,2,n),u(g,1,o),d>0&&u(g,2,l),g},a.createServerHello=function(t){var n=t.session.id,r=n.length+1+2+4+28+2+1,i=e.util.createBuffer();return i.putByte(a.HandshakeType.server_hello),i.putInt24(r),i.putByte(t.version.major),i.putByte(t.version.minor),i.putBytes(t.session.sp.server_random),u(i,1,e.util.createBuffer(n)),i.putByte(t.session.cipherSuite.id[0]),i.putByte(t.session.cipherSuite.id[1]),i.putByte(t.session.compressionMethod),i},a.createCertificate=function(t){var n=t.entity===a.ConnectionEnd.client,r=null;if(t.getCertificate){var i;i=n?t.session.certificateRequest:t.session.extensions.server_name.serverNameList,r=t.getCertificate(t,i)}var s=e.util.createBuffer();if(null!==r)try{e.util.isArray(r)||(r=[r]);for(var o=null,f=0;f<r.length;++f){var l=e.pem.decode(r[f])[0];if("CERTIFICATE"!==l.type&&"X509 CERTIFICATE"!==l.type&&"TRUSTED CERTIFICATE"!==l.type)throw{message:'Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".',headerType:l.type};if(l.procType&&"ENCRYPTED"===l.procType.type)throw{message:"Could not convert certificate from PEM; PEM is encrypted."};var c=e.util.createBuffer(l.body);null===o&&(o=e.asn1.fromDer(c.bytes(),!1));var h=e.util.createBuffer();u(h,3,c),s.putBuffer(h)}r=e.pki.certificateFromAsn1(o),n?t.session.clientCertificate=r:t.session.serverCertificate=r}catch(p){return t.error(t,{message:"Could not send certificate list.",cause:p,send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.bad_certificate}})
}var d=3+s.length(),v=e.util.createBuffer();return v.putByte(a.HandshakeType.certificate),v.putInt24(d),u(v,3,s),v},a.createClientKeyExchange=function(t){var n=e.util.createBuffer();n.putByte(t.session.clientHelloVersion.major),n.putByte(t.session.clientHelloVersion.minor),n.putBytes(e.random.getBytes(46));var r=t.session.sp;r.pre_master_secret=n.getBytes();var i=t.session.serverCertificate.publicKey;n=i.encrypt(r.pre_master_secret);var s=n.length+2,o=e.util.createBuffer();return o.putByte(a.HandshakeType.client_key_exchange),o.putInt24(s),o.putInt16(n.length),o.putBytes(n),o},a.createServerKeyExchange=function(){var n=0,r=e.util.createBuffer();return n>0&&(r.putByte(a.HandshakeType.server_key_exchange),r.putInt24(n)),r},a.getClientSignature=function(t,n){var r=e.util.createBuffer();r.putBuffer(t.session.md5.digest()),r.putBuffer(t.session.sha1.digest()),r=r.getBytes(),t.getSignature=t.getSignature||function(t,n,r){var i=null;if(t.getPrivateKey)try{i=t.getPrivateKey(t,t.session.clientCertificate),i=e.pki.privateKeyFromPem(i)}catch(s){t.error(t,{message:"Could not get private key.",cause:s,send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.internal_error}})}null===i?t.error(t,{message:"No private key set.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.internal_error}}):n=i.sign(n,null),r(t,n)},t.getSignature(t,r,n)},a.createCertificateVerify=function(t,n){var r=n.length+2,i=e.util.createBuffer();return i.putByte(a.HandshakeType.certificate_verify),i.putInt24(r),i.putInt16(n.length),i.putBytes(n),i},a.createCertificateRequest=function(t){var n=e.util.createBuffer();n.putByte(1);var r=e.util.createBuffer();for(var i in t.caStore.certs){var s=t.caStore.certs[i],o=e.pki.distinguishedNameToAsn1(s.subject);r.putBuffer(e.asn1.toDer(o))}var f=1+n.length()+2+r.length(),l=e.util.createBuffer();return l.putByte(a.HandshakeType.certificate_request),l.putInt24(f),u(l,1,n),u(l,2,r),l},a.createServerHelloDone=function(){var n=e.util.createBuffer();return n.putByte(a.HandshakeType.server_hello_done),n.putInt24(0),n},a.createChangeCipherSpec=function(){var t=e.util.createBuffer();return t.putByte(1),t},a.createFinished=function(n){var r=e.util.createBuffer();r.putBuffer(n.session.md5.digest()),r.putBuffer(n.session.sha1.digest());var i=n.entity===a.ConnectionEnd.client,s=n.session.sp,o=12,u=t,f=i?"client finished":"server finished";r=u(s.master_secret,f,r.getBytes(),o);var l=e.util.createBuffer();return l.putByte(a.HandshakeType.finished),l.putInt24(r.length()),l.putBuffer(r),l},a.createHeartbeat=function(t,n,r){"undefined"==typeof r&&(r=n.length);var i=e.util.createBuffer();i.putByte(t),i.putInt16(r),i.putBytes(n);var s=i.length(),o=Math.max(16,s-r-3);return i.putBytes(e.random.getBytes(o)),i},a.queue=function(t,n){if(n){if(n.type===a.ContentType.handshake){var r=n.fragment.bytes();t.session.md5.update(r),t.session.sha1.update(r),r=null}var i;if(n.fragment.length()<=a.MaxFragment)i=[n];else{i=[];for(var s=n.fragment.bytes();s.length>a.MaxFragment;)i.push(a.createRecord(t,{type:n.type,data:e.util.createBuffer(s.slice(0,a.MaxFragment))})),s=s.slice(a.MaxFragment);s.length>0&&i.push(a.createRecord(t,{type:n.type,data:e.util.createBuffer(s)}))}for(var o=0;o<i.length&&!t.fail;++o){var u=i[o],f=t.state.current.write;f.update(t,u)&&t.records.push(u)}}},a.flush=function(e){for(var t=0;t<e.records.length;++t){var n=e.records[t];e.tlsData.putByte(n.type),e.tlsData.putByte(n.version.major),e.tlsData.putByte(n.version.minor),e.tlsData.putInt16(n.fragment.length()),e.tlsData.putBuffer(e.records[t].fragment)}return e.records=[],e.tlsDataReady(e)};var W=function(t){switch(t){case!0:return!0;case e.pki.certificateError.bad_certificate:return a.Alert.Description.bad_certificate;case e.pki.certificateError.unsupported_certificate:return a.Alert.Description.unsupported_certificate;case e.pki.certificateError.certificate_revoked:return a.Alert.Description.certificate_revoked;case e.pki.certificateError.certificate_expired:return a.Alert.Description.certificate_expired;case e.pki.certificateError.certificate_unknown:return a.Alert.Description.certificate_unknown;case e.pki.certificateError.unknown_ca:return a.Alert.Description.unknown_ca;default:return a.Alert.Description.bad_certificate}},X=function(t){switch(t){case!0:return!0;case a.Alert.Description.bad_certificate:return e.pki.certificateError.bad_certificate;case a.Alert.Description.unsupported_certificate:return e.pki.certificateError.unsupported_certificate;case a.Alert.Description.certificate_revoked:return e.pki.certificateError.certificate_revoked;case a.Alert.Description.certificate_expired:return e.pki.certificateError.certificate_expired;case a.Alert.Description.certificate_unknown:return e.pki.certificateError.certificate_unknown;case a.Alert.Description.unknown_ca:return e.pki.certificateError.unknown_ca;default:return e.pki.certificateError.bad_certificate}};a.verifyCertificateChain=function(t,n){try{e.pki.verifyCertificateChain(t.caStore,n,function(r,i,s){var u=(W(r),t.verify(t,r,i,s));if(u!==!0){if("object"==typeof u&&!e.util.isArray(u)){var f={message:"The application rejected the certificate.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.bad_certificate}};throw u.message&&(f.message=u.message),u.alert&&(f.alert.description=u.alert),f}u!==r&&(u=X(u))}return u})}catch(r){var i=r;("object"!=typeof i||e.util.isArray(i))&&(i={send:!0,alert:{level:a.Alert.Level.fatal,description:W(r)}}),"send"in i||(i.send=!0),"alert"in i||(i.alert={level:a.Alert.Level.fatal,description:W(i.error)}),t.error(t,i)}return!t.fail},a.createSessionCache=function(t,n){var r=null;if(t&&t.getSession&&t.setSession&&t.order)r=t;else{r={},r.cache=t||{},r.capacity=Math.max(n||100,1),r.order=[];for(var i in t)r.order.length<=n?r.order.push(i):delete t[i];r.getSession=function(t){var n=null,i=null;if(t?i=e.util.bytesToHex(t):r.order.length>0&&(i=r.order[0]),null!==i&&i in r.cache){n=r.cache[i],delete r.cache[i];for(var s in r.order)if(r.order[s]===i){r.order.splice(s,1);break}}return n},r.setSession=function(t,n){if(r.order.length===r.capacity){var i=r.order.shift();delete r.cache[i]}var i=e.util.bytesToHex(t);r.order.push(i),r.cache[i]=n}}return r},a.createConnection=function(t){var n=null;n=t.caStore?e.util.isArray(t.caStore)?e.pki.createCaStore(t.caStore):t.caStore:e.pki.createCaStore();var r=t.cipherSuites||null;if(null===r){r=[];for(var i in a.CipherSuites)r.push(a.CipherSuites[i])}var s=t.server?a.ConnectionEnd.server:a.ConnectionEnd.client,o=t.sessionCache?a.createSessionCache(t.sessionCache):null,u={version:{major:a.Version.major,minor:a.Version.minor},entity:s,sessionId:t.sessionId,caStore:n,sessionCache:o,cipherSuites:r,connected:t.connected,virtualHost:t.virtualHost||null,verifyClient:t.verifyClient||!1,verify:t.verify||function(e,t){return t},getCertificate:t.getCertificate||null,getPrivateKey:t.getPrivateKey||null,getSignature:t.getSignature||null,input:e.util.createBuffer(),tlsData:e.util.createBuffer(),data:e.util.createBuffer(),tlsDataReady:t.tlsDataReady,dataReady:t.dataReady,heartbeatReceived:t.heartbeatReceived,closed:t.closed,error:function(e,n){n.origin=n.origin||(e.entity===a.ConnectionEnd.client?"client":"server"),n.send&&(a.queue(e,a.createAlert(e,n.alert)),a.flush(e));var r=n.fatal!==!1;r&&(e.fail=!0),t.error(e,n),r&&e.close(!1)},deflate:t.deflate||null,inflate:t.inflate||null};u.reset=function(e){u.version={major:a.Version.major,minor:a.Version.minor},u.record=null,u.session=null,u.peerCertificate=null,u.state={pending:null,current:null},u.expect=u.entity===a.ConnectionEnd.client?f:y,u.fragmented=null,u.records=[],u.open=!1,u.handshakes=0,u.handshaking=!1,u.isConnected=!1,u.fail=!e&&"undefined"!=typeof e,u.input.clear(),u.tlsData.clear(),u.data.clear(),u.state.current=a.createConnectionState(u)},u.reset();var l=function(e,t){var n=t.type-a.ContentType.change_cipher_spec,r=_[e.entity][e.expect];n in r?r[n](e,t):a.handleUnexpected(e,t)},c=function(t){var n=0,r=t.input,i=r.length();if(5>i)n=5-i;else{t.record={type:r.getByte(),version:{major:r.getByte(),minor:r.getByte()},length:r.getInt16(),fragment:e.util.createBuffer(),ready:!1};var s=t.record.version.major===t.version.major;s&&t.session&&t.session.version&&(s=t.record.version.minor===t.version.minor),s||t.error(t,{message:"Incompatible TLS version.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.protocol_version}})}return n},h=function(e){var t=0,n=e.input,r=n.length();if(r<e.record.length)t=e.record.length-r;else{e.record.fragment.putBytes(n.getBytes(e.record.length)),n.compact();var i=e.state.current.read;i.update(e,e.record)&&(null!==e.fragmented&&(e.fragmented.type===e.record.type?(e.fragmented.fragment.putBuffer(e.record.fragment),e.record=e.fragmented):e.error(e,{message:"Invalid fragmented record.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.unexpected_message}})),e.record.ready=!0)}return t};return u.handshake=function(t){if(u.entity!==a.ConnectionEnd.client)u.error(u,{message:"Cannot initiate handshake as a server.",fatal:!1});else if(u.handshaking)u.error(u,{message:"Handshake already in progress.",fatal:!1});else{u.fail&&!u.open&&0===u.handshakes&&(u.fail=!1),u.handshaking=!0,t=t||"";var n=null;t.length>0&&(u.sessionCache&&(n=u.sessionCache.getSession(t)),null===n&&(t="")),0===t.length&&u.sessionCache&&(n=u.sessionCache.getSession(),null!==n&&(t=n.id)),u.session={id:t,version:null,cipherSuite:null,compressionMethod:null,serverCertificate:null,certificateRequest:null,clientCertificate:null,sp:{},md5:e.md.md5.create(),sha1:e.md.sha1.create()},n&&(u.version=n.version,u.session.sp=n.sp),u.session.sp.client_random=a.createRandom().getBytes(),u.open=!0,a.queue(u,a.createRecord(u,{type:a.ContentType.handshake,data:a.createClientHello(u)})),a.flush(u)}},u.process=function(e){var t=0;return e&&u.input.putBytes(e),u.fail||(null!==u.record&&u.record.ready&&u.record.fragment.isEmpty()&&(u.record=null),null===u.record&&(t=c(u)),!u.fail&&null!==u.record&&!u.record.ready&&(t=h(u)),!u.fail&&null!==u.record&&u.record.ready&&l(u,u.record)),t},u.prepare=function(t){return a.queue(u,a.createRecord(u,{type:a.ContentType.application_data,data:e.util.createBuffer(t)})),a.flush(u)},u.prepareHeartbeatRequest=function(t,n){return t instanceof e.util.ByteBuffer&&(t=t.bytes()),"undefined"==typeof n&&(n=t.length),u.expectedHeartbeatPayload=t,a.queue(u,a.createRecord(u,{type:a.ContentType.heartbeat,data:a.createHeartbeat(a.HeartbeatMessageType.heartbeat_request,t,n)})),a.flush(u)},u.close=function(e){if(!u.fail&&u.sessionCache&&u.session){var t={id:u.session.id,version:u.session.version,sp:u.session.sp};t.sp.keys=null,u.sessionCache.setSession(t.id,t)}u.open&&(u.open=!1,u.input.clear(),(u.isConnected||u.handshaking)&&(u.isConnected=u.handshaking=!1,a.queue(u,a.createAlert(u,{level:a.Alert.Level.warning,description:a.Alert.Description.close_notify})),a.flush(u)),u.closed(u)),u.reset(e)},u},e.tls=e.tls||{};for(var V in a)"function"!=typeof a[V]&&(e.tls[V]=a[V]);e.tls.prf_tls1=t,e.tls.hmac_sha1=r,e.tls.createSessionCache=a.createSessionCache,e.tls.createConnection=a.createConnection}var r="tls";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/tls",["require","module","./asn1","./hmac","./md","./pem","./pki","./random","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function n(n,i,s){var o=i.entity===e.tls.ConnectionEnd.client;n.read.cipherState={init:!1,cipher:e.cipher.createDecipher("AES-CBC",o?s.keys.server_write_key:s.keys.client_write_key),iv:o?s.keys.server_write_IV:s.keys.client_write_IV},n.write.cipherState={init:!1,cipher:e.cipher.createCipher("AES-CBC",o?s.keys.client_write_key:s.keys.server_write_key),iv:o?s.keys.client_write_IV:s.keys.server_write_IV},n.read.cipherFunction=u,n.write.cipherFunction=r,n.read.macLength=n.write.macLength=s.mac_length,n.read.macFunction=n.write.macFunction=t.hmac_sha1}function r(n,r){var s=!1,o=r.macFunction(r.macKey,r.sequenceNumber,n);n.fragment.putBytes(o),r.updateSequenceNumber();var u;u=n.version.minor===t.Versions.TLS_1_0.minor?r.cipherState.init?null:r.cipherState.iv:e.random.getBytesSync(16),r.cipherState.init=!0;var a=r.cipherState.cipher;return a.start({iv:u}),n.version.minor>=t.Versions.TLS_1_1.minor&&a.output.putBytes(u),a.update(n.fragment),a.finish(i)&&(n.fragment=a.output,n.length=n.fragment.length(),s=!0),s}function i(e,t,n){if(!n){var r=e-t.length()%e;t.fillWithByte(r-1,r)}return!0}function s(e,t,n){var r=!0;if(n){for(var i=t.length(),s=t.last(),o=i-1-s;i-1>o;++o)r=r&&t.at(o)==s;r&&t.truncate(s+1)}return r}function u(n,r){var i=!1;++o;var u;u=n.version.minor===t.Versions.TLS_1_0.minor?r.cipherState.init?null:r.cipherState.iv:n.fragment.getBytes(16),r.cipherState.init=!0;var a=r.cipherState.cipher;a.start({iv:u}),a.update(n.fragment),i=a.finish(s);for(var f=r.macLength,l="",c=0;f>c;++c)l+=String.fromCharCode(0);var h=a.output.length();h>=f?(n.fragment=a.output.getBytes(h-f),l=a.output.getBytes(f)):n.fragment=a.output.getBytes(),n.fragment=e.util.createBuffer(n.fragment),n.length=n.fragment.length();var p=r.macFunction(r.macKey,r.sequenceNumber,n);return r.updateSequenceNumber(),i=p===l&&i}var t=e.tls;t.CipherSuites.TLS_RSA_WITH_AES_128_CBC_SHA={id:[0,47],name:"TLS_RSA_WITH_AES_128_CBC_SHA",initSecurityParameters:function(e){e.bulk_cipher_algorithm=t.BulkCipherAlgorithm.aes,e.cipher_type=t.CipherType.block,e.enc_key_length=16,e.block_length=16,e.fixed_iv_length=16,e.record_iv_length=16,e.mac_algorithm=t.MACAlgorithm.hmac_sha1,e.mac_length=20,e.mac_key_length=20},initConnectionState:n},t.CipherSuites.TLS_RSA_WITH_AES_256_CBC_SHA={id:[0,53],name:"TLS_RSA_WITH_AES_256_CBC_SHA",initSecurityParameters:function(e){e.bulk_cipher_algorithm=t.BulkCipherAlgorithm.aes,e.cipher_type=t.CipherType.block,e.enc_key_length=32,e.block_length=16,e.fixed_iv_length=16,e.record_iv_length=16,e.mac_algorithm=t.MACAlgorithm.hmac_sha1,e.mac_length=20,e.mac_key_length=20},initConnectionState:n};var o=0}var r="aesCipherSuites";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/aesCipherSuites",["require","module","./aes","./tls"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){e.debug=e.debug||{},e.debug.storage={},e.debug.get=function(t,n){var r;return"undefined"==typeof t?r=e.debug.storage:t in e.debug.storage&&(r="undefined"==typeof n?e.debug.storage[t]:e.debug.storage[t][n]),r},e.debug.set=function(t,n,r){t in e.debug.storage||(e.debug.storage[t]={}),e.debug.storage[t][n]=r},e.debug.clear=function(t,n){"undefined"==typeof t?e.debug.storage={}:t in e.debug.storage&&("undefined"==typeof n?delete e.debug.storage[t]:delete e.debug.storage[t][n])}}var r="debug";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/debug",["require","module"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){e.log=e.log||{},e.log.levels=["none","error","warning","info","debug","verbose","max"];var t={},n=[],r=null;e.log.LEVEL_LOCKED=2,e.log.NO_LEVEL_CHECK=4,e.log.INTERPOLATE=8;for(var i=0;i<e.log.levels.length;++i){var s=e.log.levels[i];t[s]={index:i,name:s.toUpperCase()}}e.log.logMessage=function(r){for(var i=t[r.level].index,s=0;s<n.length;++s){var o=n[s];if(o.flags&e.log.NO_LEVEL_CHECK)o.f(r);else{var u=t[o.level].index;u>=i&&o.f(o,r)}}},e.log.prepareStandard=function(e){"standard"in e||(e.standard=t[e.level].name+" ["+e.category+"] "+e.message)},e.log.prepareFull=function(t){if(!("full"in t)){var n=[t.message];n=n.concat([]||t.arguments),t.full=e.util.format.apply(this,n)}},e.log.prepareStandardFull=function(t){"standardFull"in t||(e.log.prepareStandard(t),t.standardFull=t.standard)};for(var o=["error","warning","info","debug","verbose"],i=0;i<o.length;++i)(function(t){e.log[t]=function(n,r){var i=Array.prototype.slice.call(arguments).slice(2),s={timestamp:new Date,level:t,category:n,message:r,arguments:i};e.log.logMessage(s)}})(o[i]);if(e.log.makeLogger=function(t){var n={flags:0,f:t};return e.log.setLevel(n,"none"),n},e.log.setLevel=function(t,n){var r=!1;if(t&&!(t.flags&e.log.LEVEL_LOCKED))for(var i=0;i<e.log.levels.length;++i){var s=e.log.levels[i];if(n==s){t.level=n,r=!0;break}}return r},e.log.lock=function(t,n){"undefined"==typeof n||n?t.flags|=e.log.LEVEL_LOCKED:t.flags&=~e.log.LEVEL_LOCKED},e.log.addLogger=function(e){n.push(e)},"undefined"!=typeof console&&"log"in console){var u;if(console.error&&console.warn&&console.info&&console.debug){var a={error:console.error,warning:console.warn,info:console.info,debug:console.debug,verbose:console.debug},f=function(t,n){e.log.prepareStandard(n);var r=a[n.level],i=[n.standard];i=i.concat(n.arguments.slice()),r.apply(console,i)};u=e.log.makeLogger(f)}else{var f=function(t,n){e.log.prepareStandardFull(n),console.log(n.standardFull)};u=e.log.makeLogger(f)}e.log.setLevel(u,"debug"),e.log.addLogger(u),r=u}else console={log:function(){}};if(null!==r){var l=e.util.getQueryVariables();if("console.level"in l&&e.log.setLevel(r,l["console.level"].slice(-1)[0]),"console.lock"in l){var c=l["console.lock"].slice(-1)[0];"true"==c&&e.log.lock(r)}}e.log.consoleLogger=r}var r="log";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/log",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){var t=e.asn1,n=e.pkcs7=e.pkcs7||{};n.messageFromPem=function(r){var i=e.pem.decode(r)[0];if("PKCS7"!==i.type)throw{message:'Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".',headerType:i.type};if(i.procType&&"ENCRYPTED"===i.procType.type)throw{message:"Could not convert PKCS#7 message from PEM; PEM is encrypted."};var s=t.fromDer(i.body);return n.messageFromAsn1(s)},n.messageToPem=function(n,r){var i={type:"PKCS7",body:t.toDer(n.toAsn1()).getBytes()};return e.pem.encode(i,{maxline:r})},n.messageFromAsn1=function(r){var i={},s=[];if(!t.validate(r,n.asn1.contentInfoValidator,i,s))throw{message:"Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.",errors:s};var u,o=t.derToOid(i.contentType);switch(o){case e.pki.oids.envelopedData:u=n.createEnvelopedData();break;case e.pki.oids.encryptedData:u=n.createEncryptedData();break;case e.pki.oids.signedData:u=n.createSignedData();break;default:throw{message:"Cannot read PKCS#7 message. ContentType with OID "+o+" is not (yet) supported."}}return u.fromAsn1(i.content.value[0]),u};var r=function(r){var i={},s=[];if(!t.validate(r,n.asn1.recipientInfoValidator,i,s))throw{message:"Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 EnvelopedData.",errors:s};return{version:i.version.charCodeAt(0),issuer:e.pki.RDNAttributesAsArray(i.issuer),serialNumber:e.util.createBuffer(i.serial).toHex(),encryptedContent:{algorithm:t.derToOid(i.encAlgorithm),parameter:i.encParameter.value,content:i.encKey}}},i=function(n){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(n.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[e.pki.distinguishedNameToAsn1({attributes:n.issuer}),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,e.util.hexToBytes(n.serialNumber))]),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.encryptedContent.algorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")]),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,n.encryptedContent.content)])},s=function(e){for(var t=[],n=0;n<e.length;n++)t.push(r(e[n]));return t},o=function(e){for(var t=[],n=0;n<e.length;n++)t.push(i(e[n]));return t},u=function(n){return[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(e.pki.oids.data).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.algorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,n.parameter.getBytes())]),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,n.content.getBytes())])]},a=function(n,r,i){var s={},o=[];if(!t.validate(r,i,s,o))throw{message:"Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.",errors:o};var u=t.derToOid(s.contentType);if(u!==e.pki.oids.data)throw{message:"Unsupported PKCS#7 message. Only wrapped ContentType Data supported."};if(s.encryptedContent){var a="";if(e.util.isArray(s.encryptedContent))for(var f=0;f<s.encryptedContent.length;++f){if(s.encryptedContent[f].type!==t.Type.OCTETSTRING)throw{message:"Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects."};a+=s.encryptedContent[f].value}else a=s.encryptedContent;n.encryptedContent={algorithm:t.derToOid(s.encAlgorithm),parameter:e.util.createBuffer(s.encParameter.value),content:e.util.createBuffer(a)}}if(s.content){var a="";if(e.util.isArray(s.content))for(var f=0;f<s.content.length;++f){if(s.content[f].type!==t.Type.OCTETSTRING)throw{message:"Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects."};a+=s.content[f].value}else a=s.content;n.content=e.util.createBuffer(a)}return n.version=s.version.charCodeAt(0),n.rawCapture=s,s},f=function(t){if(void 0===t.encryptedContent.key)throw{message:"Symmetric key not available."};if(void 0===t.content){var n;switch(t.encryptedContent.algorithm){case e.pki.oids["aes128-CBC"]:case e.pki.oids["aes192-CBC"]:case e.pki.oids["aes256-CBC"]:n=e.aes.createDecryptionCipher(t.encryptedContent.key);break;case e.pki.oids.desCBC:case e.pki.oids["des-EDE3-CBC"]:n=e.des.createDecryptionCipher(t.encryptedContent.key);break;default:throw{message:"Unsupported symmetric cipher, OID "+t.encryptedContent.algorithm}}if(n.start(t.encryptedContent.parameter),n.update(t.encryptedContent.content),!n.finish())throw{message:"Symmetric decryption failed."};t.content=n.output}};n.createSignedData=function(){var r=null;return r={type:e.pki.oids.signedData,version:1,certificates:[],crls:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(t){a(r,t,n.asn1.signedDataValidator),r.certificates=[],r.crls=[],r.digestAlgorithmIdentifiers=[],r.contentInfo=null,r.signerInfos=[];for(var i=r.rawCapture.certificates.value,s=0;s<i.length;++s)r.certificates.push(e.pki.certificateFromAsn1(i[s]))},toAsn1:function(){if("content"in r)throw"Signing PKCS#7 content not yet implemented.";r.contentInfo||r.sign();for(var n=[],i=0;i<r.certificates.length;++i)n.push(e.pki.certificateToAsn1(r.certificates[0]));var s=[];return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(r.type).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(r.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,r.digestAlgorithmIdentifiers),r.contentInfo,t.create(t.Class.CONTEXT_SPECIFIC,0,!0,n),t.create(t.Class.CONTEXT_SPECIFIC,1,!0,s),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,r.signerInfos)])])])},sign:function(){if("content"in r)throw"PKCS#7 signing not yet implemented.";"object"!=typeof r.content&&(r.contentInfo=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(e.pki.oids.data).getBytes())]),"content"in r&&r.contentInfo.value.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,r.content)])))},verify:function(){throw"PKCS#7 signature verification not yet implemented."},addCertificate:function(t){"string"==typeof t&&(t=e.pki.certificateFromPem(t)),r.certificates.push(t)},addCertificateRevokationList:function(){throw"PKCS#7 CRL support not yet implemented."}}},n.createEncryptedData=function(){var t=null;return t={type:e.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:e.pki.oids["aes256-CBC"]},fromAsn1:function(e){a(t,e,n.asn1.encryptedDataValidator)},decrypt:function(e){void 0!==e&&(t.encryptedContent.key=e),f(t)}}},n.createEnvelopedData=function(){var r=null;return r={type:e.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:e.pki.oids["aes256-CBC"]},fromAsn1:function(e){var t=a(r,e,n.asn1.envelopedDataValidator);r.recipients=s(t.recipientInfos.value)},toAsn1:function(){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(r.type).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(r.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,o(r.recipients)),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,u(r.encryptedContent))])])])},findRecipient:function(e){for(var t=e.issuer.attributes,n=0;n<r.recipients.length;++n){var i=r.recipients[n],s=i.issuer;if(i.serialNumber===e.serialNumber&&s.length===t.length){for(var o=!0,u=0;u<t.length;++u)if(s[u].type!==t[u].type||s[u].value!==t[u].value){o=!1;break}if(o)return i}}return null},decrypt:function(t,n){if(void 0===r.encryptedContent.key&&void 0!==t&&void 0!==n)switch(t.encryptedContent.algorithm){case e.pki.oids.rsaEncryption:case e.pki.oids.desCBC:var i=n.decrypt(t.encryptedContent.content);r.encryptedContent.key=e.util.createBuffer(i);break;default:throw{message:"Unsupported asymmetric cipher, OID "+t.encryptedContent.algorithm}}f(r)},addRecipient:function(t){r.recipients.push({version:0,issuer:t.subject.attributes,serialNumber:t.serialNumber,encryptedContent:{algorithm:e.pki.oids.rsaEncryption,key:t.publicKey}})},encrypt:function(t,n){if(void 0===r.encryptedContent.content){n=n||r.encryptedContent.algorithm,t=t||r.encryptedContent.key;var i,s,o;switch(n){case e.pki.oids["aes128-CBC"]:i=16,s=16,o=e.aes.createEncryptionCipher;break;case e.pki.oids["aes192-CBC"]:i=24,s=16,o=e.aes.createEncryptionCipher;break;case e.pki.oids["aes256-CBC"]:i=32,s=16,o=e.aes.createEncryptionCipher;break;case e.pki.oids["des-EDE3-CBC"]:i=24,s=8,o=e.des.createEncryptionCipher;break;default:throw{message:"Unsupported symmetric cipher, OID "+n}}if(void 0===t)t=e.util.createBuffer(e.random.getBytes(i));else if(t.length()!=i)throw{message:"Symmetric key has wrong length; got "+t.length()+" bytes, expected "+i+"."};r.encryptedContent.algorithm=n,r.encryptedContent.key=t,r.encryptedContent.parameter=e.util.createBuffer(e.random.getBytes(s));var u=o(t);if(u.start(r.encryptedContent.parameter.copy()),u.update(r.content),!u.finish())throw{message:"Symmetric encryption failed."};r.encryptedContent.content=u.output}for(var a=0;a<r.recipients.length;a++){var f=r.recipients[a];if(void 0===f.encryptedContent.content)switch(f.encryptedContent.algorithm){case e.pki.oids.rsaEncryption:f.encryptedContent.content=f.encryptedContent.key.encrypt(r.encryptedContent.key.data);break;default:throw{message:"Unsupported asymmetric cipher, OID "+f.encryptedContent.algorithm}}}}}}}var r="pkcs7";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/pkcs7",["require","module","./aes","./asn1","./des","./oids","./pem","./pkcs7asn1","./random","./util","./x509"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){var t="forge.task",n=0,r={},i=0;e.debug.set(t,"tasks",r);var s={};e.debug.set(t,"queues",s);var o="?",u=30,a=20,f="ready",l="running",c="blocked",h="sleeping",p="done",d="error",v="stop",m="start",g="block",y="unblock",b="sleep",w="wakeup",E="cancel",S="fail",x={};x[f]={},x[f][v]=f,x[f][m]=l,x[f][E]=p,x[f][S]=d,x[l]={},x[l][v]=f,x[l][m]=l,x[l][g]=c,x[l][y]=l,x[l][b]=h,x[l][w]=l,x[l][E]=p,x[l][S]=d,x[c]={},x[c][v]=c,x[c][m]=c,x[c][g]=c,x[c][y]=c,x[c][b]=c,x[c][w]=c,x[c][E]=p,x[c][S]=d,x[h]={},x[h][v]=h,x[h][m]=h,x[h][g]=h,x[h][y]=h,x[h][b]=h,x[h][w]=h,x[h][E]=p,x[h][S]=d,x[p]={},x[p][v]=p,x[p][m]=p,x[p][g]=p,x[p][y]=p,x[p][b]=p,x[p][w]=p,x[p][E]=p,x[p][S]=d,x[d]={},x[d][v]=d,x[d][m]=d,x[d][g]=d,x[d][y]=d,x[d][b]=d,x[d][w]=d,x[d][E]=d,x[d][S]=d;var T=function(s){this.id=-1,this.name=s.name||o,this.parent=s.parent||null,this.run=s.run,this.subtasks=[],this.error=!1,this.state=f,this.blocks=0,this.timeoutId=null,this.swapTime=null,this.userData=null,this.id=i++,r[this.id]=this,n>=1&&e.log.verbose(t,"[%s][%s] init",this.id,this.name,this)};T.prototype.debug=function(n){n=n||"",e.log.debug(t,n,"[%s][%s] task:",this.id,this.name,this,"subtasks:",this.subtasks.length,"queue:",s)},T.prototype.next=function(e,t){"function"==typeof e&&(t=e,e=this.name);var n=new T({run:t,name:e,parent:this});return n.state=l,n.type=this.type,n.successCallback=this.successCallback||null,n.failureCallback=this.failureCallback||null,this.subtasks.push(n),this},T.prototype.parallel=function(t,n){return e.util.isArray(t)&&(n=t,t=this.name),this.next(t,function(r){var i=r;i.block(n.length);for(var s=function(t,r){e.task.start({type:t,run:function(e){n[r](e)},success:function(){i.unblock()},failure:function(){i.unblock()}})},o=0;o<n.length;o++){var u=t+"__parallel-"+r.id+"-"+o,a=o;s(u,a)}})},T.prototype.stop=function(){this.state=x[this.state][v]},T.prototype.start=function(){this.error=!1,this.state=x[this.state][m],this.state===l&&(this.start=new Date,this.run(this),C(this,0))},T.prototype.block=function(e){e="undefined"==typeof e?1:e,this.blocks+=e,this.blocks>0&&(this.state=x[this.state][g])},T.prototype.unblock=function(e){return e="undefined"==typeof e?1:e,this.blocks-=e,0===this.blocks&&this.state!==p&&(this.state=l,C(this,0)),this.blocks
},T.prototype.sleep=function(e){e="undefined"==typeof e?0:e,this.state=x[this.state][b];var t=this;this.timeoutId=setTimeout(function(){t.timeoutId=null,t.state=l,C(t,0)},e)},T.prototype.wait=function(e){e.wait(this)},T.prototype.wakeup=function(){this.state===h&&(cancelTimeout(this.timeoutId),this.timeoutId=null,this.state=l,C(this,0))},T.prototype.cancel=function(){this.state=x[this.state][E],this.permitsNeeded=0,null!==this.timeoutId&&(cancelTimeout(this.timeoutId),this.timeoutId=null),this.subtasks=[]},T.prototype.fail=function(e){if(this.error=!0,k(this,!0),e)e.error=this.error,e.swapTime=this.swapTime,e.userData=this.userData,C(e,0);else{if(null!==this.parent){for(var t=this.parent;null!==t.parent;)t.error=this.error,t.swapTime=this.swapTime,t.userData=this.userData,t=t.parent;k(t,!0)}this.failureCallback&&this.failureCallback(this)}};var N=function(e){e.error=!1,e.state=x[e.state][m],setTimeout(function(){e.state===l&&(e.swapTime=+new Date,e.run(e),C(e,0))},0)},C=function(e,t){var n=t>u||+new Date-e.swapTime>a,r=function(t){if(t++,e.state===l)if(n&&(e.swapTime=+new Date),e.subtasks.length>0){var r=e.subtasks.shift();r.error=e.error,r.swapTime=e.swapTime,r.userData=e.userData,r.run(r),r.error||C(r,t)}else k(e),e.error||null!==e.parent&&(e.parent.error=e.error,e.parent.swapTime=e.swapTime,e.parent.userData=e.userData,C(e.parent,t))};n?setTimeout(r,0):r(t)},k=function(i,o){i.state=p,delete r[i.id],n>=1&&e.log.verbose(t,"[%s][%s] finish",i.id,i.name,i),null===i.parent&&(i.type in s?0===s[i.type].length?e.log.error(t,"[%s][%s] task queue empty [%s]",i.id,i.name,i.type):s[i.type][0]!==i?e.log.error(t,"[%s][%s] task not first in queue [%s]",i.id,i.name,i.type):(s[i.type].shift(),0===s[i.type].length?(n>=1&&e.log.verbose(t,"[%s][%s] delete queue [%s]",i.id,i.name,i.type),delete s[i.type]):(n>=1&&e.log.verbose(t,"[%s][%s] queue start next [%s] remain:%s",i.id,i.name,i.type,s[i.type].length),s[i.type][0].start())):e.log.error(t,"[%s][%s] task queue missing [%s]",i.id,i.name,i.type),o||(i.error&&i.failureCallback?i.failureCallback(i):!i.error&&i.successCallback&&i.successCallback(i)))};e.task=e.task||{},e.task.start=function(r){var i=new T({run:r.run,name:r.name||o});i.type=r.type,i.successCallback=r.success||null,i.failureCallback=r.failure||null,i.type in s?s[r.type].push(i):(n>=1&&e.log.verbose(t,"[%s][%s] create queue [%s]",i.id,i.name,i.type),s[i.type]=[i],N(i))},e.task.cancel=function(e){e in s&&(s[e]=[s[e][0]])},e.task.createCondition=function(){var e={tasks:{}};return e.wait=function(t){t.id in e.tasks||(t.block(),e.tasks[t.id]=t)},e.notify=function(){var t=e.tasks;e.tasks={};for(var n in t)t[n].unblock()},e}}var r="task";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/task",["require","module","./debug","./log","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function n(t,n){var r=n.toString(16);r[0]>="8"&&(r="00"+r);var i=e.util.hexToBytes(r);t.putInt32(i.length),t.putBytes(i)}function r(e,t){e.putInt32(t.length),e.putString(t)}function i(){for(var t=e.md.sha1.create(),n=arguments.length,r=0;n>r;++r)t.update(arguments[r]);return t.digest()}var t=e.ssh=e.ssh||{};t.privateKeyToPutty=function(t,s,o){o=o||"",s=s||"";var u="ssh-rsa",a=""===s?"none":"aes256-cbc",f="PuTTY-User-Key-File-2: "+u+"\r\n";f+="Encryption: "+a+"\r\n",f+="Comment: "+o+"\r\n";var l=e.util.createBuffer();r(l,u),n(l,t.e),n(l,t.n);var c=e.util.encode64(l.bytes(),64),h=Math.floor(c.length/66)+1;f+="Public-Lines: "+h+"\r\n",f+=c;var p=e.util.createBuffer();n(p,t.d),n(p,t.p),n(p,t.q),n(p,t.qInv);var d;if(s){var v=p.length()+16-1;v-=v%16;var m=i(p.bytes());m.truncate(m.length()-v+p.length()),p.putBuffer(m);var g=e.util.createBuffer();g.putBuffer(i("\x00\x00\x00\x00",s)),g.putBuffer(i("\x00\x00\x00",s));var y=e.aes.createEncryptionCipher(g.truncate(8),"CBC");y.start(e.util.createBuffer().fillWithByte(0,16)),y.update(p.copy()),y.finish();var b=y.output;b.truncate(16),d=e.util.encode64(b.bytes(),64)}else d=e.util.encode64(p.bytes(),64);h=Math.floor(d.length/66)+1,f+="\r\nPrivate-Lines: "+h+"\r\n",f+=d;var w=i("putty-private-key-file-mac-key",s),E=e.util.createBuffer();r(E,u),r(E,a),r(E,o),E.putInt32(l.length()),E.putBuffer(l),E.putInt32(p.length()),E.putBuffer(p);var S=e.hmac.create();return S.start("sha1",w),S.update(E.bytes()),f+="\r\nPrivate-MAC: "+S.digest().toHex()+"\r\n"},t.publicKeyToOpenSSH=function(t,i){var s="ssh-rsa";i=i||"";var o=e.util.createBuffer();return r(o,s),n(o,t.e),n(o,t.n),s+" "+e.util.encode64(o.bytes())+" "+i},t.privateKeyToOpenSSH=function(t,n){return n?e.pki.encryptRsaPrivateKey(t,n,{legacy:!0,algorithm:"aes128"}):e.pki.privateKeyToPem(t)}}var r="ssh";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/ssh",["require","module","./util","./sha1","./aes","./hmac"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){var e="forge";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return void("undefined"==typeof forge&&(forge={disableNativeCode:!1}));var r=!0;n=function(e,n){n(t,module)}}var i,s=function(t,n){n.exports=function(n){var r=i.map(function(e){return t(e)});if(n=n||{},n.defined=n.defined||{},n.defined[e])return n[e];n.defined[e]=!0;for(var s=0;s<r.length;++s)r[s](n);return n},n.exports.disableNativeCode=!1,n.exports(n.exports)},o=n;(n=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete n,o.apply(null,Array.prototype.slice.call(arguments,0))):(n=o,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/forge",["require","module","./aes","./aesCipherSuites","./asn1","./cipher","./cipherModes","./debug","./des","./hmac","./log","./pbkdf2","./pem","./pkcs7","./pkcs1","./pkcs12","./pki","./prng","./pss","./random","./rc2","./task","./tls","./util","./md","./mgf1","./ssh"],function(){s.apply(null,Array.prototype.slice.call(arguments,0))})}(),t("js/forge")}),!function(w){if("object"==typeof exports)module.exports=w();else if("function"==typeof define&&define.amd)define(w);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.eio=w()}}(function(){return function e(g,h,b){function c(d,f){if(!h[d]){if(!g[d]){var k="function"==typeof require&&require;if(!f&&k)return k(d,!0);if(a)return a(d,!0);throw Error("Cannot find module '"+d+"'")}k=h[d]={exports:{}},g[d][0].call(k.exports,function(a){var b=g[d][1][a];return c(b?b:a)},k,k.exports,e,g,h,b)}return h[d].exports}for(var a="function"==typeof require&&require,f=0;f<b.length;f++)c(b[f]);return c}({1:[function(e,g){g.exports=e("./lib/")},{"./lib/":2}],2:[function(e,g){g.exports=e("./socket"),g.exports.parser=e("engine.io-parser")},{"./socket":3,"engine.io-parser":13}],3:[function(e,g){(function(b){function c(a,d){if(!(this instanceof c))return new c(a,d);if(d=d||{},a&&"object"==typeof a&&(d=a,a=null),a&&(a=l(a),d.host=a.host,d.secure="https"==a.protocol||"wss"==a.protocol,d.port=a.port,a.query&&(d.query=a.query)),this.secure=null!=d.secure?d.secure:b.location&&"https:"==location.protocol,d.host){var f=d.host.split(":");d.hostname=f.shift(),f.length&&(d.port=f.pop())}this.agent=d.agent||!1,this.hostname=d.hostname||(b.location?location.hostname:"localhost"),this.port=d.port||(b.location&&location.port?location.port:this.secure?443:80),this.query=d.query||{},"string"==typeof this.query&&(this.query=s.decode(this.query)),this.upgrade=!1!==d.upgrade,this.path=(d.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!d.forceJSONP,this.forceBase64=!!d.forceBase64,this.timestampParam=d.timestampParam||"t",this.timestampRequests=d.timestampRequests,this.transports=d.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.callbackBuffer=[],this.policyPort=d.policyPort||843,this.rememberUpgrade=d.rememberUpgrade||!1,this.open(),this.binaryType=null,this.onlyBinaryUpgrades=d.onlyBinaryUpgrades}var a=e("./transports"),f=e("emitter"),d=e("debug")("engine.io-client:socket"),h=e("indexof"),k=e("engine.io-parser"),l=e("parseuri"),n=e("parsejson"),s=e("parseqs");g.exports=c,c.priorWebsocketSuccess=!1,f(c.prototype),c.protocol=k.protocol,c.Socket=c,c.Transport=e("./transport"),c.transports=e("./transports"),c.parser=e("engine.io-parser"),c.prototype.createTransport=function(b){d('creating transport "%s"',b);var m,c=this.query,f={};for(m in c)c.hasOwnProperty(m)&&(f[m]=c[m]);return f.EIO=k.protocol,f.transport=b,this.id&&(f.sid=this.id),new a[b]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:f,forceJSONP:this.forceJSONP,forceBase64:this.forceBase64,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this})},c.prototype.open=function(){var a;a=this.rememberUpgrade&&c.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket")?"websocket":this.transports[0],this.readyState="opening",a=this.createTransport(a),a.open(),this.setTransport(a)},c.prototype.setTransport=function(a){d("setting transport %s",a.name);var b=this;this.transport&&(d("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=a,a.on("drain",function(){b.onDrain()}).on("packet",function(a){b.onPacket(a)}).on("error",function(a){b.onError(a)}).on("close",function(){b.onClose("transport close")})},c.prototype.probe=function(a){function b(){if(g.onlyBinaryUpgrades){var m=!this.supportsBinary&&g.transport.supportsBinary;h=h||m}h||(d('probe transport "%s" opened',a),p.send([{type:"ping",data:"probe"}]),p.once("packet",function(b){h||("pong"==b.type&&"probe"==b.data?(d('probe transport "%s" pong',a),g.upgrading=!0,g.emit("upgrading",p),c.priorWebsocketSuccess="websocket"==p.name,d('pausing current transport "%s"',g.transport.name),g.transport.pause(function(){h||"closed"==g.readyState||"closing"==g.readyState||(d("changing transport and sending upgrade packet"),l(),g.setTransport(p),p.send([{type:"upgrade"}]),g.emit("upgrade",p),p=null,g.upgrading=!1,g.flush())})):(d('probe transport "%s" failed',a),b=Error("probe error"),b.transport=p.name,g.emit("upgradeError",b)))}))}function f(){h||(h=!0,l(),p.close(),p=null)}function m(b){var m=Error("probe error: "+b);m.transport=p.name,f(),d('probe transport "%s" failed because of error: %s',a,b),g.emit("upgradeError",m)}function k(){m("transport closed")}function e(){m("socket closed")}function v(a){p&&a.name!=p.name&&(d('"%s" works - aborting "%s"',a.name,p.name),f())}function l(){p.removeListener("open",b),p.removeListener("error",m),p.removeListener("close",k),g.removeListener("close",e),g.removeListener("upgrading",v)}d('probing transport "%s"',a);var p=this.createTransport(a,{probe:1}),h=!1,g=this;c.priorWebsocketSuccess=!1,p.once("open",b),p.once("error",m),p.once("close",k),this.once("close",e),this.once("upgrading",v),p.open()},c.prototype.onOpen=function(){if(d("socket open"),this.readyState="open",c.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){d("starting upgrade probes");for(var a=0,b=this.upgrades.length;b>a;a++)this.probe(this.upgrades[a])}},c.prototype.onPacket=function(a){if("opening"==this.readyState||"open"==this.readyState)switch(d('socket receive: type "%s", data "%s"',a.type,a.data),this.emit("packet",a),this.emit("heartbeat"),a.type){case"open":this.onHandshake(n(a.data));break;case"pong":this.setPing();break;case"error":var b=Error("server error");b.code=a.data,this.emit("error",b);break;case"message":this.emit("data",a.data),this.emit("message",a.data)}else d('packet received with socket readyState "%s"',this.readyState)},c.prototype.onHandshake=function(a){this.emit("handshake",a),this.id=a.sid,this.transport.query.sid=a.sid,this.upgrades=this.filterUpgrades(a.upgrades),this.pingInterval=a.pingInterval,this.pingTimeout=a.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},c.prototype.onHeartbeat=function(a){clearTimeout(this.pingTimeoutTimer);var b=this;b.pingTimeoutTimer=setTimeout(function(){"closed"!=b.readyState&&b.onClose("ping timeout")},a||b.pingInterval+b.pingTimeout)},c.prototype.setPing=function(){var a=this;clearTimeout(a.pingIntervalTimer),a.pingIntervalTimer=setTimeout(function(){d("writing ping packet - expecting pong within %sms",a.pingTimeout),a.ping(),a.onHeartbeat(a.pingTimeout)},a.pingInterval)},c.prototype.ping=function(){this.sendPacket("ping")},c.prototype.onDrain=function(){for(var a=0;a<this.prevBufferLen;a++)this.callbackBuffer[a]&&this.callbackBuffer[a]();this.writeBuffer.splice(0,this.prevBufferLen),this.callbackBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0==this.writeBuffer.length?this.emit("drain"):this.flush()},c.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(d("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},c.prototype.write=c.prototype.send=function(a,b){return this.sendPacket("message",a,b),this},c.prototype.sendPacket=function(a,b,d){a={type:a,data:b},this.emit("packetCreate",a),this.writeBuffer.push(a),this.callbackBuffer.push(d),this.flush()},c.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.onClose("forced close"),d("socket closing - telling transport to close"),this.transport.close()),this},c.prototype.onError=function(a){d("socket error %j",a),c.priorWebsocketSuccess=!1,this.emit("error",a),this.onClose("transport error",a)},c.prototype.onClose=function(a,b){if("opening"==this.readyState||"open"==this.readyState){d('socket close with reason: "%s"',a);var c=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),setTimeout(function(){c.writeBuffer=[],c.callbackBuffer=[],c.prevBufferLen=0},0),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",a,b)}},c.prototype.filterUpgrades=function(a){for(var b=[],d=0,m=a.length;m>d;d++)~h(this.transports,a[d])&&b.push(a[d]);return b}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./transport":4,"./transports":5,debug:11,emitter:12,"engine.io-parser":13,indexof:22,parsejson:24,parseqs:25,parseuri:26}],4:[function(e,g){function b(a){this.path=a.path,this.hostname=a.hostname,this.port=a.port,this.secure=a.secure,this.query=a.query,this.timestampParam=a.timestampParam,this.timestampRequests=a.timestampRequests,this.readyState="",this.agent=a.agent||!1,this.socket=a.socket}var c=e("engine.io-parser");e=e("emitter"),g.exports=b,e(b.prototype),b.timestamps=0,b.prototype.onError=function(a,b){var d=Error(a);return d.type="TransportError",d.description=b,this.emit("error",d),this},b.prototype.open=function(){return("closed"==this.readyState||""==this.readyState)&&(this.readyState="opening",this.doOpen()),this},b.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.doClose(),this.onClose()),this},b.prototype.send=function(a){if("open"!=this.readyState)throw Error("Transport not open");this.write(a)},b.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},b.prototype.onData=function(a){this.onPacket(c.decodePacket(a,this.socket.binaryType))},b.prototype.onPacket=function(a){this.emit("packet",a)},b.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{emitter:12,"engine.io-parser":13}],5:[function(e,g,h){(function(b){var c=e("xmlhttprequest"),a=e("./polling-xhr"),f=e("./polling-jsonp"),d=e("./websocket");h.polling=function(d){var k=!1;if(b.location){var k="https:"==location.protocol,e=location.port;e||(e=k?443:80),k=d.hostname!=location.hostname||e!=d.port}return d.xdomain=k,"open"in new c(d)&&!d.forceJSONP?new a(d):new f(d)},h.websocket=d}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling-jsonp":6,"./polling-xhr":7,"./websocket":9,xmlhttprequest:10}],6:[function(e,g){(function(b){function c(){}function a(a){f.call(this,a),this.query=this.query||{},l||(b.___eio||(b.___eio=[]),l=b.___eio),this.index=l.length;var d=this;l.push(function(a){d.onData(a)}),this.query.j=this.index,b.document&&b.addEventListener&&b.addEventListener("beforeunload",function(){d.script&&(d.script.onerror=c)})}var f=e("./polling"),d=e("inherits");g.exports=a;var l,h=/\n/g,k=/\\n/g;d(a,f),a.prototype.supportsBinary=!1,a.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null),f.prototype.doClose.call(this)},a.prototype.doPoll=function(){var a=this,b=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),b.async=!0,b.src=this.uri(),b.onerror=function(b){a.onError("jsonp poll error",b)};var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(b,d),this.script=b,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a),document.body.removeChild(a)},100)},a.prototype.doWrite=function(a,b){function d(){c(),b()}function c(){if(f.iframe)try{f.form.removeChild(f.iframe)}catch(a){f.onError("jsonp polling iframe removal error",a)}try{v=document.createElement('<iframe src="javascript:0" name="'+f.iframeId+'">')}catch(b){v=document.createElement("iframe"),v.name=f.iframeId,v.src="javascript:0"}v.id=f.iframeId,f.form.appendChild(v),f.iframe=v}var f=this;if(!this.form){var v,m=document.createElement("form"),e=document.createElement("textarea"),l=this.iframeId="eio_iframe_"+this.index;m.className="socketio",m.style.position="absolute",m.style.top="-1000px",m.style.left="-1000px",m.target=l,m.method="POST",m.setAttribute("accept-charset","utf-8"),e.name="d",m.appendChild(e),document.body.appendChild(m),this.form=m,this.area=e}this.form.action=this.uri(),c(),a=a.replace(k,"\\\n"),this.area.value=a.replace(h,"\\n");try{this.form.submit()}catch(g){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==f.iframe.readyState&&d()}:this.iframe.onload=d}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":8,inherits:23}],7:[function(e,g){(function(b){function c(){}function a(a){if(k.call(this,a),b.location){var d="https:"==location.protocol,c=location.port;c||(c=d?443:80),this.xd=a.hostname!=b.location.hostname||c!=a.port}}function f(a){this.method=a.method||"GET",this.uri=a.uri,this.xd=!!a.xd,this.async=!1!==a.async,this.data=void 0!=a.data?a.data:null,this.agent=a.agent,this.create(a.isBinary,a.supportsBinary)}function d(){for(var a in f.requests)f.requests.hasOwnProperty(a)&&f.requests[a].abort()}var h=e("xmlhttprequest"),k=e("./polling"),l=e("emitter"),n=e("debug")("engine.io-client:polling-xhr"),s=e("inherits");g.exports=a,g.exports.Request=f,s(a,k),a.prototype.supportsBinary=!0,a.prototype.request=function(a){return a=a||{},a.uri=this.uri(),a.xd=this.xd,a.agent=this.agent||!1,a.supportsBinary=this.supportsBinary,new f(a)},a.prototype.doWrite=function(a,b){var d=this.request({method:"POST",data:a,isBinary:"string"!=typeof a&&void 0!==a}),c=this;d.on("success",b),d.on("error",function(a){c.onError("xhr post error",a)}),this.sendXhr=d},a.prototype.doPoll=function(){n("xhr poll");var a=this.request(),b=this;a.on("data",function(a){b.onData(a)}),a.on("error",function(a){b.onError("xhr poll error",a)}),this.pollXhr=a},l(f.prototype),f.prototype.create=function(a,d){var c=this.xhr=new h({agent:this.agent,xdomain:this.xd}),m=this;try{if(n("xhr open %s: %s",this.method,this.uri),c.open(this.method,this.uri,this.async),d&&(c.responseType="arraybuffer"),"POST"==this.method)try{a?c.setRequestHeader("Content-type","application/octet-stream"):c.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}"withCredentials"in c&&(c.withCredentials=!0),c.onreadystatechange=function(){var a;try{if(4!=c.readyState)return;200==c.status||1223==c.status?a="application/octet-stream"===c.getResponseHeader("Content-Type")?c.response:d?"ok":c.responseText:setTimeout(function(){m.onError(c.status)},0)}catch(b){m.onError(b)}null!=a&&m.onData(a)},n("xhr data %s",this.data),c.send(this.data)}catch(k){return void setTimeout(function(){m.onError(k)},0)}b.document&&(this.index=f.requestsCount++,f.requests[this.index]=this)},f.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},f.prototype.onData=function(a){this.emit("data",a),this.onSuccess()},f.prototype.onError=function(a){this.emit("error",a),this.cleanup()},f.prototype.cleanup=function(){if("undefined"!=typeof this.xhr&&null!==this.xhr){this.xhr.onreadystatechange=c;try{this.xhr.abort()}catch(a){}b.document&&delete f.requests[this.index],this.xhr=null}},f.prototype.abort=function(){this.cleanup()},b.document&&(f.requestsCount=0,f.requests={},b.attachEvent?b.attachEvent("onunload",d):b.addEventListener&&b.addEventListener("beforeunload",d))}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":8,debug:11,emitter:12,inherits:23,xmlhttprequest:10}],8:[function(e,g,h){function b(a){var b=a&&a.forceBase64;(!u||b)&&(this.supportsBinary=!1),c.call(this,a)}var c=e("../transport"),a=e("parseqs"),f=e("engine.io-parser"),d=e("debug")("engine.io-client:polling");h=e("inherits"),g.exports=b;var u=function(){return null!=new(e("xmlhttprequest"))({agent:this.agent,xdomain:!1}).responseType}();h(b,c),b.prototype.name="polling",b.prototype.doOpen=function(){this.poll()},b.prototype.pause=function(a){function b(){d("paused"),c.readyState="paused",a()}var c=this;if(this.readyState="pausing",this.polling||!this.writable){var f=0;this.polling&&(d("we are currently polling - waiting to pause"),f++,this.once("pollComplete",function(){d("pre-pause polling complete"),--f||b()})),this.writable||(d("we are currently writing - waiting to pause"),f++,this.once("drain",function(){d("pre-pause writing complete"),--f||b()}))}else b()},b.prototype.poll=function(){d("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},b.prototype.onData=function(a){var b=this;d("polling got data %s",a),f.decodePayload(a,this.socket.binaryType,function(a){return"opening"==b.readyState&&b.onOpen(),"close"==a.type?(b.onClose(),!1):void b.onPacket(a)}),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():d('ignoring poll - transport state "%s"',this.readyState))},b.prototype.doClose=function(){function a(){d("writing close packet"),b.write([{type:"close"}])}var b=this;"open"==this.readyState?(d("transport open - closing"),a()):(d("transport not open - deferring close"),this.once("open",a))},b.prototype.write=function(a){var b=this;this.writable=!1;var d=function(){b.writable=!0,b.emit("drain")},b=this;f.encodePayload(a,this.supportsBinary,function(a){b.doWrite(a,d)})},b.prototype.uri=function(){var b=this.query||{},d=this.secure?"https":"http",f="";return!1!==this.timestampRequests&&(b[this.timestampParam]=+new Date+"-"+c.timestamps++),this.supportsBinary||b.sid||(b.b64=1),b=a.encode(b),this.port&&("https"==d&&443!=this.port||"http"==d&&80!=this.port)&&(f=":"+this.port),b.length&&(b="?"+b),d+"://"+this.hostname+f+this.path+b}},{"../transport":4,debug:11,"engine.io-parser":13,inherits:23,parseqs:25,xmlhttprequest:10}],9:[function(e,g,h){function b(a){a&&a.forceBase64&&(this.supportsBinary=!1),c.call(this,a)}var c=e("../transport"),a=e("engine.io-parser"),f=e("parseqs"),d=e("debug")("engine.io-client:websocket");h=e("inherits");var u=e("ws");g.exports=b,h(b,c),b.prototype.name="websocket",b.prototype.supportsBinary=!0,b.prototype.doOpen=function(){if(this.check()){var a=this.uri();this.ws=new u(a,void 0,{agent:this.agent}),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.binaryType="arraybuffer",this.addEventListeners()}},b.prototype.addEventListeners=function(){var a=this;this.ws.onopen=function(){a.onOpen()},this.ws.onclose=function(){a.onClose()},this.ws.onmessage=function(b){a.onData(b.data)},this.ws.onerror=function(b){a.onError("websocket error",b)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(b.prototype.onData=function(a){var b=this;setTimeout(function(){c.prototype.onData.call(b,a)},0)}),b.prototype.write=function(b){var c=this;this.writable=!1;for(var f=0,e=b.length;e>f;f++)a.encodePacket(b[f],this.supportsBinary,function(a){try{c.ws.send(a)}catch(b){d("websocket closed before onclose event")}});setTimeout(function(){c.writable=!0,c.emit("drain")},0)},b.prototype.onClose=function(){c.prototype.onClose.call(this)},b.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},b.prototype.uri=function(){var a=this.query||{},b=this.secure?"wss":"ws",d="";return this.port&&("wss"==b&&443!=this.port||"ws"==b&&80!=this.port)&&(d=":"+this.port),this.timestampRequests&&(a[this.timestampParam]=+new Date),this.supportsBinary||(a.b64=1),a=f.encode(a),a.length&&(a="?"+a),b+"://"+this.hostname+d+this.path+a},b.prototype.check=function(){return!(!u||"__initialize"in u&&this.name===b.prototype.name)}},{"../transport":4,debug:11,"engine.io-parser":13,inherits:23,parseqs:25,ws:27}],10:[function(e,g){var b=e("has-cors");g.exports=function(c){c=c.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!c||b))return new XMLHttpRequest}catch(a){}if(!c)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(f){}}},{"has-cors":20}],11:[function(e,g){function b(a){return b.enabled(a)?function(c){c instanceof Error&&(c=c.stack||c.message);var d=new Date,e=d-(b[a]||d);b[a]=d,c=a+" "+c+" +"+b.humanize(e),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}g.exports=b,b.names=[],b.skips=[],b.enable=function(a){try{localStorage.debug=a}catch(c){}for(var d=(a||"").split(/[\s,]+/),e=d.length,h=0;e>h;h++)a=d[h].replace("*",".*?"),"-"===a[0]?b.skips.push(new RegExp("^"+a.substr(1)+"$")):b.names.push(new RegExp("^"+a+"$"))},b.disable=function(){b.enable("")},b.humanize=function(a){return a>=36e5?(a/36e5).toFixed(1)+"h":a>=6e4?(a/6e4).toFixed(1)+"m":a>=1e3?(a/1e3|0)+"s":a+"ms"},b.enabled=function(a){for(var c=0,d=b.skips.length;d>c;c++)if(b.skips[c].test(a))return!1;for(c=0,d=b.names.length;d>c;c++)if(b.names[c].test(a))return!0;return!1};try{window.localStorage&&b.enable(localStorage.debug)}catch(c){}},{}],12:[function(e,g){function b(a){if(a){for(var c in b.prototype)a[c]=b.prototype[c];return a}}var c=e("indexof");g.exports=b,b.prototype.on=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks[a]=this._callbacks[a]||[]).push(b),this},b.prototype.once=function(a,b){function c(){e.off(a,c),b.apply(this,arguments)}var e=this;return this._callbacks=this._callbacks||{},b._off=c,this.on(a,c),this},b.prototype.off=b.prototype.removeListener=b.prototype.removeAllListeners=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var d=this._callbacks[a];if(!d)return this;if(1==arguments.length)return delete this._callbacks[a],this;var e=c(d,b._off||b);return~e&&d.splice(e,1),this},b.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks[a];if(c)for(var c=c.slice(0),e=0,h=c.length;h>e;++e)c[e].apply(this,b);return this},b.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks[a]||[]},b.prototype.hasListeners=function(a){return!!this.listeners(a).length}},{indexof:22}],13:[function(e,g,h){(function(b){function c(a,b,c){if(!b)return h.encodeBase64Packet(a,c);var d=new FileReader;return d.onload=function(){a.data=d.result,h.encodePacket(a,b,c)},d.readAsArrayBuffer(a.data)}function a(a,b,c){var d=Array(a.length);c=k(a.length,c);for(var f=function(a,c,m){b(c,function(b,c){d[a]=c,m(b,d)})},e=0;e<a.length;e++)f(e,a[e],c)}var f=e("./keys"),d=e("arraybuffer.slice"),g=e("base64-arraybuffer"),k=e("after"),l=e("utf8"),n=navigator.userAgent.match(/Android/i);h.protocol=2;var s=h.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},t=f(s),q={type:"error",data:"parser error"},r=e("blob");h.encodePacket=function(a,d,f){"function"==typeof d&&(f=d,d=!1);var e=void 0===a.data?void 0:a.data.buffer||a.data;if(b.ArrayBuffer&&e instanceof ArrayBuffer){if(d){for(e=a.data,d=new Uint8Array(e),e=new Uint8Array(1+e.byteLength),e[0]=s[a.type],a=0;a<d.length;a++)e[a+1]=d[a];a=f(e.buffer)}else a=h.encodeBase64Packet(a,f);return a}return r&&e instanceof b.Blob?(d?n?a=c(a,d,f):(d=new Uint8Array(1),d[0]=s[a.type],a=new r([d.buffer,a.data]),a=f(a)):a=h.encodeBase64Packet(a,f),a):(d=s[a.type],void 0!==a.data&&(d+=l.encode(String(a.data))),f(""+d))},h.encodeBase64Packet=function(a,c){var d="b"+h.packets[a.type];if(r&&a.data instanceof r){var f=new FileReader;return f.onload=function(){var a=f.result.split(",")[1];c(d+a)},f.readAsDataURL(a.data)}var e;try{e=String.fromCharCode.apply(null,new Uint8Array(a.data))}catch(g){e=new Uint8Array(a.data);for(var l=Array(e.length),k=0;k<e.length;k++)l[k]=e[k];e=String.fromCharCode.apply(null,l)}return d+=b.btoa(e),c(d)},h.decodePacket=function(a,b){if("string"==typeof a||void 0===a){if("b"==a.charAt(0))return h.decodeBase64Packet(a.substr(1),b);a=l.decode(a);var c=a.charAt(0);return Number(c)==c&&t[c]?1<a.length?{type:t[c],data:a.substring(1)}:{type:t[c]}:q}var c=new Uint8Array(a)[0],f=d(a,1);return r&&"blob"===b&&(f=new r([f])),{type:t[c],data:f}},h.decodeBase64Packet=function(a,c){var d=t[a.charAt(0)];if(!b.ArrayBuffer)return{type:d,data:{base64:!0,data:a.substr(1)}};var f=g.decode(a.substr(1));return"blob"===c&&r&&(f=new r([f])),{type:d,data:f}},h.encodePayload=function(b,c,d){return"function"==typeof c&&(d=c,c=null),c?r&&!n?h.encodePayloadAsBlob(b,d):h.encodePayloadAsArrayBuffer(b,d):b.length?void a(b,function(a,b){h.encodePacket(a,c,function(a){b(null,a.length+":"+a)})},function(a,b){return d(b.join(""))}):d("0:")},h.decodePayload=function(a,b,c){if("string"!=typeof a)return h.decodePayloadAsBinary(a,b,c);"function"==typeof b&&(c=b,b=null);var d;if(""==a)return c(q,0,1);d="";for(var f,e,g=0,l=a.length;l>g;g++)if(e=a.charAt(g),":"!=e)d+=e;else{if(""==d||d!=(f=Number(d)))return c(q,0,1);if(e=a.substr(g+1,f),d!=e.length)return c(q,0,1);if(e.length){if(d=h.decodePacket(e,b),q.type==d.type&&q.data==d.data)return c(q,0,1);if(!1===c(d,g+f,l))return}g+=f,d=""}return""!=d?c(q,0,1):void 0},h.encodePayloadAsArrayBuffer=function(b,c){return b.length?void a(b,function(a,b){h.encodePacket(a,!0,function(a){return b(null,a)})},function(a,b){var d=b.reduce(function(a,b){var c;return c="string"==typeof b?b.length:b.byteLength,a+c.toString().length+c+2},0),f=new Uint8Array(d),e=0;return b.forEach(function(a){var b="string"==typeof a,c=a;
if(b){for(var c=new Uint8Array(a.length),d=0;d<a.length;d++)c[d]=a.charCodeAt(d);c=c.buffer}for(f[e++]=b?0:1,a=c.byteLength.toString(),d=0;d<a.length;d++)f[e++]=parseInt(a[d]);for(f[e++]=255,c=new Uint8Array(c),d=0;d<c.length;d++)f[e++]=c[d]}),c(f.buffer)}):c(new ArrayBuffer(0))},h.encodePayloadAsBlob=function(b,c){a(b,function(a,b){h.encodePacket(a,!0,function(a){var c=new Uint8Array(1);if(c[0]=1,"string"==typeof a){for(var d=new Uint8Array(a.length),f=0;f<a.length;f++)d[f]=a.charCodeAt(f);a=d.buffer,c[0]=0}for(var d=(a instanceof ArrayBuffer?a.byteLength:a.size).toString(),e=new Uint8Array(d.length+1),f=0;f<d.length;f++)e[f]=parseInt(d[f]);e[d.length]=255,r&&(a=new r([c.buffer,e.buffer,a]),b(null,a))})},function(a,b){return c(new r(b))})},h.decodePayloadAsBinary=function(a,b,c){"function"==typeof b&&(c=b,b=null);for(var f=[];0<a.byteLength;){for(var e=new Uint8Array(a),g=0===e[0],l="",k=1;255!=e[k];k++)l+=e[k];if(a=d(a,2+l.length),l=parseInt(l),e=d(a,0,l),g)try{e=String.fromCharCode.apply(null,new Uint8Array(e))}catch(n){for(g=new Uint8Array(e),e="",k=0;k<g.length;k++)e+=String.fromCharCode(g[k])}f.push(e),a=d(a,l)}var u=f.length;f.forEach(function(a,d){c(h.decodePacket(a,b),d,u)})}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./keys":14,after:15,"arraybuffer.slice":16,"base64-arraybuffer":17,blob:18,utf8:19}],14:[function(e,g){g.exports=Object.keys||function(b){var f,c=[],a=Object.prototype.hasOwnProperty;for(f in b)a.call(b,f)&&c.push(f);return c}},{}],15:[function(e,g){function b(){}g.exports=function(c,a,f){function d(b,c){if(0>=d.count)throw Error("after called too many times");--d.count,b?(e=!0,a(b),a=f):0!==d.count||e||a(null,c)}var e=!1;return f=f||b,d.count=c,0===c?a():d}},{}],16:[function(e,g){g.exports=function(b,c,a){var f=b.byteLength;if(c=c||0,a=a||f,b.slice)return b.slice(c,a);if(0>c&&(c+=f),0>a&&(a+=f),a>f&&(a=f),c>=f||c>=a||0===f)return new ArrayBuffer(0);b=new Uint8Array(b);for(var f=new Uint8Array(a-c),d=0;a>c;c++,d++)f[d]=b[c];return f.buffer}},{}],17:[function(e,g,h){!function(b){h.encode=function(c){c=new Uint8Array(c);var a,f=c.buffer.byteLength,d="";for(a=0;f>a;a+=3)d+=b[c.buffer[a]>>2],d+=b[(3&c.buffer[a])<<4|c.buffer[a+1]>>4],d+=b[(15&c.buffer[a+1])<<2|c.buffer[a+2]>>6],d+=b[63&c.buffer[a+2]];return 2===f%3?d=d.substring(0,d.length-1)+"=":1===f%3&&(d=d.substring(0,d.length-2)+"=="),d},h.decode=function(c){var e,g,h,n,a=.75*c.length,f=c.length,d=0;"="===c[c.length-1]&&(a--,"="===c[c.length-2]&&a--);for(var s=new ArrayBuffer(a),t=new Uint8Array(s),a=0;f>a;a+=4)e=b.indexOf(c[a]),g=b.indexOf(c[a+1]),h=b.indexOf(c[a+2]),n=b.indexOf(c[a+3]),t[d++]=e<<2|g>>4,t[d++]=(15&g)<<4|h>>2,t[d++]=(3&h)<<6|63&n;return s}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],18:[function(e,g){(function(b){function c(b,c){c=c||{};for(var d=new a,e=0;e<b.length;e++)d.append(b[e]);return c.type?d.getBlob(c.type):d.getBlob()}var e,a=b.BlobBuilder||b.WebKitBlobBuilder||b.MSBlobBuilder||b.MozBlobBuilder;try{e=2==new Blob(["hi"]).size}catch(d){e=!1}var h=a&&a.prototype.append&&a.prototype.getBlob;b=e?b.Blob:h?c:void 0,g.exports=b}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],19:[function(e,g,h){(function(b){!function(c){function a(a){for(var e,f,b=[],c=0,d=a.length;d>c;)e=a.charCodeAt(c++),e>=55296&&56319>=e&&d>c?(f=a.charCodeAt(c++),56320==(64512&f)?b.push(((1023&e)<<10)+(1023&f)+65536):(b.push(e),c--)):b.push(e);return b}function e(){if(q>=t)throw Error("Invalid byte index");var a=255&s[q];if(q++,128==(192&a))return 63&a;throw Error("Invalid continuation byte")}function d(){var a,b,c,d;if(q>t)throw Error("Invalid byte index");if(q==t)return!1;if(a=255&s[q],q++,0==(128&a))return a;if(192==(224&a)){if(b=e(),a=(31&a)<<6|b,a>=128)return a;throw Error("Invalid continuation byte")}if(224==(240&a)){if(b=e(),c=e(),a=(15&a)<<12|b<<6|c,a>=2048)return a;throw Error("Invalid continuation byte")}if(240==(248&a)&&(b=e(),c=e(),d=e(),a=(15&a)<<18|b<<12|c<<6|d,a>=65536&&1114111>=a))return a;throw Error("Invalid UTF-8 detected")}var u="object"==typeof h&&h,k="object"==typeof g&&g&&g.exports==u&&g,l="object"==typeof b&&b;(l.global===l||l.window===l)&&(c=l);var s,t,q,n=String.fromCharCode,l={version:"2.0.0",encode:function(b){b=a(b);for(var e,c=b.length,d=-1,f="";++d<c;){if(e=b[d],0==(4294967168&e))e=n(e);else{var g="";0==(4294965248&e)?g=n(e>>6&31|192):0==(4294901760&e)?(g=n(e>>12&15|224),g+=n(e>>6&63|128)):0==(4292870144&e)&&(g=n(e>>18&7|240),g+=n(e>>12&63|128),g+=n(e>>6&63|128)),e=g+=n(63&e|128)}f+=e}return f},decode:function(b){s=a(b),t=s.length,q=0,b=[];for(var c;!1!==(c=d());)b.push(c);c=b.length;for(var f,e=-1,g="";++e<c;)f=b[e],f>65535&&(f-=65536,g+=n(f>>>10&1023|55296),f=56320|1023&f),g+=n(f);return g}};if(u&&!u.nodeType)if(k)k.exports=l;else{c={}.hasOwnProperty;for(var r in l)c.call(l,r)&&(u[r]=l[r])}else c.utf8=l}(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],20:[function(e,g){e=e("global");try{g.exports="XMLHttpRequest"in e&&"withCredentials"in new e.XMLHttpRequest}catch(b){g.exports=!1}},{global:21}],21:[function(e,g){g.exports=function(){return this}()},{}],22:[function(e,g){var b=[].indexOf;g.exports=function(c,a){if(b)return c.indexOf(a);for(var e=0;e<c.length;++e)if(c[e]===a)return e;return-1}},{}],23:[function(e,g){g.exports="function"==typeof Object.create?function(b,c){b.super_=c,b.prototype=Object.create(c.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}})}:function(b,c){b.super_=c;var a=function(){};a.prototype=c.prototype,b.prototype=new a,b.prototype.constructor=b}},{}],24:[function(e,g){(function(b){var c=/^[\],:{}\s]*$/,a=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,e=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,d=/(?:^|:|,)(?:\s*\[)+/g,h=/^\s+/,k=/\s+$/;g.exports=function(g){return"string"==typeof g&&g?(g=g.replace(h,"").replace(k,""),b.JSON&&JSON.parse?JSON.parse(g):c.test(g.replace(a,"@").replace(e,"]").replace(d,""))?new Function("return "+g)():void 0):null}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],25:[function(e,g,h){h.encode=function(b){var a,c="";for(a in b)b.hasOwnProperty(a)&&(c.length&&(c+="&"),c+=encodeURIComponent(a)+"="+encodeURIComponent(b[a]));return c},h.decode=function(b){var c={};b=b.split("&");for(var a=0,e=b.length;e>a;a++){var d=b[a].split("=");c[decodeURIComponent(d[0])]=decodeURIComponent(d[1])}return c}},{}],26:[function(e,g){var b=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,c="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");g.exports=function(a){a=b.exec(a||"");for(var e={},d=14;d--;)e[c[d]]=a[d]||"";return e}},{}],27:[function(e,g){function b(a,b){return b?new c(a,b):new c(a)}e=function(){return this}();var c=e.WebSocket||e.MozWebSocket;g.exports=c?b:null,c&&(b.prototype=c.prototype)},{}]},{},[1])(1)});var api={map:{},emit:function(type,data){if(this.map[type])for(var i in this.map[type])this.map[type][i](data)},on:function(type,handler){this.map[type]||(this.map[type]=[]),this.map[type].push(handler)}},appcore={version:.23,connected:!1,sock:null,sockbuffer:[],write:null,map:{},generatedRSAKey:null,username:"",displayname:"",uid:"",passwordTempHolder:"",pubKey:"",derivedKeySalt:"",derivedKey:"",derivedKeyHash:"",activeCall:"",list:[],listHash:{},profileBlob:{},reconnect:-1,bufferTimestampIgnore:[],bufferTimestampReplace:[],userList:[],noListBuffer:[],bgColorCache:[]};appcore.sockemit=function(type,message){if(!appcore.sock)throw new Error("No socket is defined.");"raw"!=type?(message.sockType=type,appcore.connected?appcore.sock.send(JSON.stringify(message)):appcore.sockbuffer.push(message)):appcore.sock.send(message)},appcore.sockon=function(type,callback){appcore.map[type]&&console.log("WARNING: Rebinding for "+type),appcore.map[type]=callback},api.on("connect",function(){if(!appcore.connected){var server="wss://subrosa.io";"#local"==document.location.hash&&(server=""),appcore.sock=new eio(server),appcore.sock.on("open",function(){console.log("open"),appcore.connected=!0,clearInterval(appcore.reconnect),appcore.reconnect=-1,appcore.derivedKey&&appcore.sockemit("loginMain",{step:2,username:appcore.username,hash:appcore.derivedKeyHash,resendBlob:!1});for(var i in appcore.sockbuffer)appcore.sock.send(JSON.stringify(appcore.sockbuffer[i]));appcore.sockbuffer=[]}),appcore.sock.on("message",function(data){if("{"==data[0])if(appcore.map[data[0]])appcore.map[data[0]](data.substr(1));else{try{data=JSON.parse(data)}catch(error){return}if(!data.sockType)throw new Error("Unknown type"+data.sockType);appcore.map[data.sockType]&&appcore.map[data.sockType](data)}}),appcore.sock.on("close",function(){console.log("close"),appcore.connected=!1,-1==appcore.reconnect&&(appcore.reconnect=setInterval(function(){api.emit("connect")},1500)),closeEvents()})}}),api.emit("connect",{}),api.on("userExists",function(data){data.username&&appcore.sockemit("userExists",{username:data.username})}),appcore.sockon("log",function(data){console.log("log event: "+data.msg)}),appcore.sockon("*",function(){api.emit("sendRawComm","*")}),appcore.sockon("userExists",function(data){api.emit("userExistsResult",data)}),appcore.sockon("captcha",function(data){api.emit("gotCaptcha",data)}),api.on("getCaptcha",function(data){appcore.sockemit("getCaptcha",{purpose:data.purpose})}),api.on("genKey",function(data){var rsa=forge.pki.rsa,state=rsa.createKeyPairGenerationState(2048,415031),step=function(){rsa.stepKeyPairGenerationState(state,100)?(appcore.generatedRSAKey=state.keys,data.generated()):(data.generating(),setTimeout(step,1))};setTimeout(step)}),api.on("register",function(data){var profileBlob={};profileBlob.privateKey=forge.pki.privateKeyToPem(appcore.generatedRSAKey.privateKey),profileBlob.conversations={};var publicKey=forge.pki.publicKeyToPem(appcore.generatedRSAKey.publicKey),profileBlobJson=JSON.stringify(profileBlob),pbdkf2Salt=forge.random.getBytesSync(32),derivedKey=forge.pbkdf2(data.password,pbdkf2Salt,1e4,32),derivedKeyHash=forge.sha256.create().update(derivedKey).digest().toHex(),iv=forge.random.getBytesSync(16),cipher=forge.cipher.createCipher("AES-CBC",derivedKey);cipher.start({iv:iv}),cipher.update(forge.util.createBuffer(profileBlobJson)),cipher.finish();var cipherOutput=btoa(cipher.output.data),encryptedBlob={iv:iv,pbdkf2Salt:pbdkf2Salt,data:cipherOutput};appcore.sockemit("register",{encryptedBlob:encryptedBlob,publicKey:publicKey,username:data.username,displayname:data.displayname,email:data.email,newsletter:data.newsletter,challenge:data.challenge,captcha:data.captcha,derivedKeyHash:derivedKeyHash})}),appcore.sockon("register",function(data){"OK"==data.status&&(appcore.generatedRSAKey={}),api.emit("registerResult",data)}),api.on("loginMain",function(data){api.emit("connect",{}),appcore.sockemit("loginMain",{step:1,username:data.username}),appcore.username=data.username,appcore.passwordTempHolder=data.password}),appcore.sockon("loginMain",function(data){if(1==data.step)if(data.salt){var password=appcore.passwordTempHolder;appcore.passwordTempHolder="";var derivedKey=forge.pbkdf2(password,data.salt,1e4,32),derivedKeyHash=forge.sha256.create().update(derivedKey).digest().toHex();appcore.derivedKeySalt=data.salt,appcore.derivedKey=derivedKey,appcore.derivedKeyHash=derivedKeyHash,appcore.sockemit("loginMain",{step:2,username:appcore.username,hash:derivedKeyHash})}else api.emit("loginMainResult",data);else if(2==data.step)if(data.iv){var encryptedBlob=atob(data.userBlob),cipher=forge.cipher.createDecipher("AES-CBC",appcore.derivedKey);cipher.start({iv:data.iv}),cipher.update(forge.util.createBuffer(encryptedBlob)),cipher.finish();var profileBlob,cipherOutput=cipher.output.data;try{profileBlob=JSON.parse(cipherOutput)}catch(exception){api.emit("loginMainResult",{status:"FAIL",message:"Decryption has failed - the encrypted data became corrupt."})}if(profileBlob){appcore.profileBlob=profileBlob;var privateKey=forge.pki.privateKeyFromPem(appcore.profileBlob.privateKey),publicKey=forge.pki.setRsaPublicKey(privateKey.n,privateKey.e);appcore.pubKey=forge.pki.publicKeyToPem(publicKey),appcore.username=data.username,appcore.displayname=data.displayname,appcore.status=data.status,appcore.avatar=data.avatar,appcore.uid=data.uid,appcore.bgColorCache[appcore.uid]=data.bgColor,api.emit("loginMainResult",{status:"OK"}),updateBlob(),api.emit("getHome")}}else api.emit("loginMainResult",data)}),appcore.sockon("news",function(data){api.emit("homeData",{news:data.news})}),api.on("getHome",function(){appcore.sockemit("news",{})}),appcore.sockon("getLists",function(data){appcore.list=data.list;for(var i in appcore.list)appcore.listHash[appcore.list[i].id]=i,appcore.list[i].active&&20==appcore.list[i].id.length&&api.emit("callUpdate",{state:"CALLING",oldState:"",target:appcore.list[i].id,callType:appcore.list[i].active.type}),appcore.list[i].uid&&(appcore.bgColorCache[appcore.list[i].uid]=appcore.list[i].bgColor);api.emit("getListsResult",{})}),appcore.sockon("newList",function(data){if(data.autojoin&&37==data.object.id.length){var uids=data.object.id.substr(4).split("-");if(getProp(uids[0]+"-blocked")||getProp(uids[1]+"-blocked"))return appcore.sockemit("removeList",{removeID:data.object.id})}if(data.object.waitingForBundle=!0,appcore.list.push(data.object),data.object.active&&20==data.object.id.length&&api.emit("callUpdate",{state:"CALLING",oldState:"",target:data.object.id,callType:data.object.type}),data.object.uid&&(appcore.bgColorCache[data.object.uid]=data.object.bgColor),appcore.listHash[data.object.id]=appcore.list.length-1,appcore.noListBuffer[data.object.id]){for(var i in appcore.noListBuffer[data.object.id])commHandler(appcore.noListBuffer[data.object.id][i]);delete appcore.noListBuffer[data.object.id]}api.emit("getListsResult",{})}),api.on("addList",function(data){data.id&&appcore.sockemit("addList",{addID:data.id})}),api.on("removeList",function(data){if(data.id){data.onlySync||appcore.sockemit("removeList",{removeID:data.id}),appcore.list.splice(appcore.listHash[data.id],1);var minusOneAfter=appcore.listHash[data.id];delete appcore.listHash[data.id],delete convBodyHolders[data.id];for(var i in appcore.listHash)appcore.listHash[i]>minusOneAfter&&appcore.listHash[i]--}}),appcore.sockon("kicked",function(data){var roomName=appcore.list[appcore.listHash[data.target]].name;api.emit("removeList",{id:data.target,onlySync:!0}),api.emit("notify",{type:"kicked",kickerUID:data.kickerUID,kickerUsername:data.kickerUsername,target:data.target,roomName:roomName})}),appcore.sockon("noInvite",function(){api.emit("notify",{type:"noInvite"})}),api.on("changeStatus",function(data){appcore.status=data.status,appcore.sockemit("changeStatus",{status:parseInt(data.status)})}),api.on("changeProfile",function(data){if(data.displayname&&data.displayname!=appcore.displayname&&(appcore.displayname=data.displayname.substr(0,30)),data.oldpass&&data.newpass){var derivedKey=forge.pbkdf2(data.oldpass,appcore.derivedKeySalt,1e4,32),derivedKeyHash=forge.sha256.create().update(derivedKey).digest().toHex();if(derivedKeyHash!=appcore.derivedKeyHash)return void api.emit("notify",{type:"changePassOldWrong"});data.oldDerivedKeyHash=appcore.derivedKeyHash,appcore.derivedKeySalt=forge.random.getBytesSync(32),appcore.derivedKey=forge.pbkdf2(data.newpass,appcore.derivedKeySalt,1e4,32),appcore.derivedKeyHash=forge.sha256.create().update(appcore.derivedKey).digest().toHex(),updateBlob(!0,"changeProfile"),data.oldpass="",data.newpass="",data.derivedKeyHash=appcore.derivedKeyHash,data.derivedKeySalt=appcore.derivedKeySalt}data.bgColor&&(appcore.bgColorCache[appcore.uid]=data.bgColor),appcore.sockemit("changeProfile",data)}),api.on("addContact",function(data){if(data.id){var listItem=appcore.list[appcore.listHash[data.id]];api.emit("keyExchange",{id:data.id}),api.emit("sendComm",{type:5,target:data.id,message:{msg:data.message}}),commHandler({type:5,sender:appcore.uid,decrypted:{msg:data.message},target:data.id}),listItem.contact=1,listItem.myRequest=!0}}),api.on("removeContact",function(data){data.id&&(appcore.sockemit("removeContact",{removeID:data.id}),api.emit("notify",{type:"contactChange",id:data.id,contact:data.contact}),appcore.list[appcore.listHash[data.id]].contact=0,delete appcore.list[appcore.listHash[data.id]].displayname,delete appcore.list[appcore.listHash[data.id]].status)}),api.on("generateKeyExchange",function(data){if(!data.keyExchange){if(appcore.profileBlob.conversations[data.id])return void(data.keyExchange="existing");data.keyExchange="pending",appcore.sockemit("getPubKey",{uid:data.uid})}}),api.on("keyExchange",function(data){var listItem=appcore.list[appcore.listHash[data.id]];appcore.profileBlob.conversations[listItem.id]||(appcore.sockemit("comm",{type:1,target:listItem.id,data:listItem.keyExchange.encrypted,auxdata:listItem.keyExchange.signature}),commHandler({type:1,target:listItem.id,data:listItem.keyExchange.encrypted,auxdata:listItem.keyExchange.signature}),appcore.profileBlob.conversations[listItem.id]=listItem.keyExchange.convKey,updateBlob(!0,"keyExchange"))}),api.on("acceptContact",function(data){if(data.id){var listItem=appcore.list[appcore.listHash[data.id]];api.emit("sendComm",{type:5,target:data.id,message:{accepted:!0}}),commHandler({type:5,sender:appcore.uid,decrypted:{accepted:!0},target:data.id}),listItem.contact=2}}),api.on("createRoom",function(data){var inviteToRoom,convKey,roomName;"new"==data.mode?(inviteToRoom="conv"+randomUID(16),convKey=forge.random.getBytesSync(32),roomName=data.name,appcore.profileBlob.conversations[inviteToRoom]=convKey,appcore.sockemit("createRoom",{roomID:inviteToRoom,name:data.name}),updateBlob(!0,"createRoom")):"add"==data.mode&&(inviteToRoom=data.target,convKey=appcore.profileBlob.conversations[inviteToRoom],roomName=appcore.list[appcore.listHash[inviteToRoom]].name);for(var i in data.invite){var theirUsername=appcore.list[appcore.listHash["conv"+sortUID(data.invite[i],appcore.uid)]].username,theMessage={target:inviteToRoom,name:roomName,convKey:convKey};api.emit("sendComm",{type:7,target:"conv"+sortUID(data.invite[i],appcore.uid),message:theMessage,inviteToRoom:inviteToRoom}),commHandler({type:7,target:"conv"+sortUID(data.invite[i],appcore.uid),decrypted:theMessage}),commHandler({type:8,target:inviteToRoom,decrypted:{username:theirUsername,uid:data.invite[i]}})}}),api.on("joinRoom",function(data){appcore.profileBlob.conversations[data.target]||(appcore.profileBlob.conversations[data.target]=data.convKey,updateBlob(!0,"joinRoom")),appcore.sockemit("addList",{addID:data.target})}),api.on("kickUser",function(data){var listItem=appcore.list[appcore.listHash[data.target]];listItem.users.indexOf(data.kicking)&&listItem.users.splice(listItem.users.indexOf(data.kicking),1),appcore.sockemit("kickUser",data)}),appcore.sockon("comm",function(d){commHandler(d)});var callTimeout;api.on("getUsers",function(data){appcore.sockemit("getUsers",{target:data.target})}),appcore.sockon("userList",function(data){var listItem=appcore.list[appcore.listHash[data.target]];for(var i in data.users)-1==listItem.users.indexOf(data.users[i][1])&&listItem.users.push(data.users[i][1]),appcore.userList[data.users[i][1]]={username:data.users[i][0]};listItem.pendingInvites=data.invites||[],listItem.ranks=data.ranks,api.emit("userList",data)}),api.on("setUserRank",function(data){var listItem=appcore.list[appcore.listHash[data.target]],myRank=listItem.myRank,theirRank=0;return listItem.ranks&&listItem.ranks[data.user]&&(theirRank=listItem.ranks[data.user]),4>myRank?api.emit("notify",{type:"noPermission",action:"setUserRank"}):theirRank>=myRank&&9!=myRank?api.emit("notify",{type:"noPermission",action:"setUserRank"}):data.newRank>=myRank&&9!=myRank?api.emit("notify",{type:"noPermission",action:"setUserRank"}):(appcore.sockemit("setUserRank",data),void commHandler({type:11,target:data.target,decrypted:{targetUserUID:data.user,targetUserUsername:getNameFromUID(data.user),newRank:data.newRank}}))}),appcore.sockon("1",function(){appcore.activeCall}),appcore.sockon("2",function(){appcore.activeCall}),appcore.sockon("statusUpdate",function(data){var relevantList=appcore.list[appcore.listHash["conv"+sortUID(appcore.uid,data.target)]];if(relevantList){if(data.displayname&&(relevantList.displayname=data.displayname),"undefined"!=typeof data.status&&(null==data.status&&(data.status=void 0),api.emit("notify",{type:"statusChanged",uid:data.target,displayname:relevantList.displayname||relevantList.username,newStatus:data.status,oldStatus:relevantList.status}),relevantList.status=data.status,0===data.status))if(relevantList.active)api.emit("dropCall",{target:relevantList.id});else for(var i in appcore.list)if(appcore.list[i].active&&appcore.list[i].active.callUsers&&-1!=appcore.list[i].active.callUsers.indexOf(data.target))return void handleRoomCallQuit(appcore.list[i].id,data.target);"undefined"!=typeof data.contact&&(relevantList.contact=data.contact,"undefined"!=typeof data.myRequest&&(relevantList.myRequest=data.myRequest),api.emit("notify",{type:"contactChange",uid:data.target,contact:data.contact})),"undefined"!=typeof data.displayname&&(api.emit("notify",{type:"displaynameChanged",uid:data.target,displayname:data.displayname,oldDisplayname:relevantList.displayname}),relevantList.displayname=data.displayname),api.emit("lay",{id:"conv"+sortUID(appcore.uid,data.target)})}}),appcore.sockon("commBundle",function(data){var listItem=appcore.list[appcore.listHash[data.target]];listItem&&(listItem.hasBundle=data.small?1:2,listItem.waitingForBundle=!1),api.emit("notify",{type:"bundleRecieved",target:data.target,more:data.small});for(var i in data.bundle)commHandler(data.bundle[i],data.target,!0)}),appcore.sockon("typingState",function(data){var listItem=appcore.list[appcore.listHash[data.target]];if(listItem.typings||(listItem.typings=[]),!getProp(data.uid+"-blocked")){var alreadyInTypings=!1;for(var i in listItem.typings)if(listItem.typings[i][0]==data.uid){alreadyInTypings=!0,"empty"!=data.state?(listItem.typings[i][1]=data.state,listItem.typings[i][2]=(new Date).getTime()):listItem.typings.splice(i,1);break}alreadyInTypings||"empty"==data.state||listItem.typings.push([data.uid,data.state,(new Date).getTime()]),api.emit("refreshTypingDisplay",{})}}),setInterval(function(){var curTime=(new Date).getTime()-6e3;for(var i in appcore.list)if(appcore.list[i].typings)for(var j in appcore.list[i].typings)("typed"==appcore.list[i].typings[j][1]&&appcore.list[i].typings[j][2]<curTime||"empty"==appcore.list[i].typings[j][1])&&(appcore.list[i].typings.splice(j,1),api.emit("refreshTypingDisplay",{}))},3500),api.on("blockUser",function(data){var listItem=appcore.list[appcore.listHash[data.target]];data.unblock?api.emit("setProp",{name:listItem.uid+"-blocked",value:null}):(2==listItem.contact&&api.emit("removeContact",{id:currentTab}),listItem.typings.length&&(listItem.typings=[],api.emit("refreshTypingDisplay",{})),api.emit("setProp",{name:listItem.uid+"-blocked",value:!0}),api.emit("removeList",{id:data.target}))}),api.on("updateTypingState",function(data){var listItem=appcore.list[appcore.listHash[data.target]];if("typing"==data.state){if(4==appcore.status)return;listItem.typingState&&"typing"==listItem.typingState?(clearTimeout(listItem.stoppedTypingTimeout),listItem.stoppedTypingTimeout=setTimeout(function(){listItem.typingState="typed",appcore.sockemit("typingState",{target:data.target,state:"typed"})},3e3)):(listItem.typingState="typing",appcore.sockemit("typingState",{target:data.target,state:"typing"}),listItem.stoppedTypingTimeout&&clearTimeout(listItem.stoppedTypingTimeout),"empty"!=data.state&&(listItem.stoppedTypingTimeout=setTimeout(function(){listItem.typingState="typed",appcore.sockemit("typingState",{target:data.target,state:"typed"})},3e3)))}else"empty"==data.state&&(clearTimeout(listItem.stoppedTypingTimeout),listItem.typingState&&"empty"==listItem.typingState||(listItem.typingState="empty",appcore.sockemit("typingState",{target:data.target,state:"empty"})))}),api.on("sendText",function(data){if(0!=data.message.length){var listItem=appcore.list[appcore.listHash[data.target]];if(appcore.list[appcore.listHash[data.target]].typingState="",clearTimeout(listItem.stoppedTypingTimeout),listItem.keyExchange&&"pending"!=listItem.keyExchange||appcore.profileBlob.conversations[data.target]){listItem.keyExchange&&api.emit("keyExchange",{id:data.target});var currentTime=(new Date).getTime();listItem.lastRead=currentTime,api.emit("sendComm",{target:data.target,type:2,message:{msg:data.message},clientTs:currentTime}),commHandler({type:2,sender:appcore.uid,decrypted:{msg:data.message},target:data.target,time:currentTime})}}}),api.on("editText",function(data){0==data.newMessage.length&&(data.newMessage="."),api.emit("sendComm",{target:data.target,type:2,message:{msg:data.newMessage,replaceTimestamp:data.replaceTimestamp}}),commHandler({type:2,sender:appcore.uid,decrypted:{msg:data.newMessage,replaceTimestamp:data.replaceTimestamp},target:data.target})}),api.on("clearHistory",function(data){appcore.sockemit("clearHistory",data)}),api.on("uploadAvatar",function(data){appcore.fileString=data.data,appcore.partsTotal=Math.ceil(appcore.fileString.length/10240),uploadPart()}),appcore.sockon("avatarSet",function(data){data.error?api.emit("avatarUploadProgress",{percent:-1}):(api.emit("avatarUploadProgress",{percent:100}),appcore.avatar=data.newAvatar,api.emit("notify",{type:"avatarUpdated",uid:appcore.uid,avatar:data.newAvatar}))}),appcore.sockon("avatar",function(data){var listItem=appcore.list[appcore.listHash["conv"+sortUID(appcore.uid,data.uid)]];listItem.avatar=data.avatar,api.emit("notify",{type:"avatarUpdated",uid:data.uid,avatar:data.avatar})}),appcore.sockon("gotPart",function(){uploadPart()}),api.on("makeCall",function(data){var listItem=appcore.list[appcore.listHash[data.target]];listItem.active&&"INCALL"==listItem.active.state&&api.emit("dropCall",{target:data.target}),listItem.active={type:data.type,state:"CALLING"},api.emit("sendComm",{target:data.target,type:6,message:{type:data.type}}),api.emit("callUpdate",{state:"CALLING",oldState:"",myInitiate:!0,target:listItem.id,callType:data.type}),37==data.target.length?(listItem.active.myInitiate=!0,callTimeout=setTimeout(function(){if("CALLING"==listItem.active.state){var callType=listItem.active.type;listItem.active=-1,api.emit("callUpdate",{state:"",oldState:"CALLING",target:listItem.id,callType:callType})}},3e4)):(listItem.active.myInitiate=!1,listItem.active.callUsers=[appcore.uid],acceptCall(data.target,!1))}),api.on("dropCall",function(data){clearTimeout(callTimeout);var listItem=appcore.list[appcore.listHash[data.target]],oldState=listItem.active&&listItem.active.state||"",oldType=listItem.active&&listItem.active.type;37==data.target.length?listItem.active=!1:(listItem.active.state="CALLING",listItem.active.callUsers.splice(listItem.active.callUsers.indexOf(appcore.uid),1),0==listItem.active.callUsers.length&&(listItem.active=!1)),appcore.activeCall="",api.emit("sendComm",{target:data.target,type:6,message:{type:"dropCall"}}),20==data.target.length&&appcore.sockemit("dropActive",{target:data.target}),api.emit("callUpdate",{state:listItem.active?"CALLING":"",oldState:oldState,target:listItem.id,callType:oldType})}),api.on("acceptCall",function(data){acceptCall(data.target,!0)}),api.on("verifyKey",function(data){var keyCombined,otherPubKey=appcore.list[appcore.listHash[data.target]].pubKey,myPubKey=appcore.pubKey;keyCombined=data.target.substr(4).split("-")[0]==appcore.uid?myPubKey+otherPubKey:otherPubKey+myPubKey;var md=forge.md.sha256.create();md.update(keyCombined),api.emit("notify",{type:"verifyKeyInfo",hash:md.digest().toHex()})});var fingerprintsToVerify=[];api.on("verifyFingerprint",function(data){appcore.sockemit("verifyFingerprint",{uid:data.uid,remoteFingerprint:data.remoteFingerprint,localFingerprint:data.localFingerprint}),fingerprintsToVerify.push(data.uid),setTimeout(function(){-1!=fingerprintsToVerify.indexOf(data.uid)&&appcore.activeCall&&(api.emit("dropCall",{target:appcore.activeCall}),api.emit("verifyFingerprintResult",{result:data.result}))},6e3)}),appcore.sockon("verifyFingerprint",function(data){var otherUID=data.uids[0]==appcore.uid?data.uids[1]:data.uids[0];-1!=fingerprintsToVerify.indexOf(otherUID)&&fingerprintsToVerify.splice(fingerprintsToVerify.indexOf(otherUID),1),"FAIL"==data.result&&appcore.activeCall?api.emit("dropCall",{target:appcore.activeCall}):"SUCCESS"==data.result&&console.log("Fingerprint verified successfully."),api.emit("verifyFingerprintResult",{result:data.result})}),api.on("sendComm",function(data){var listItem=appcore.list[appcore.listHash[data.target]],convKey=appcore.profileBlob.conversations[listItem.id];if(!convKey)throw new Error("No convKey available for "+listItem.id);if(data.message.t)throw new Error("Message already has property 't' reserved for client timestamp",data.message);var shortTimestamp=Math.floor(((new Date).getTime()-14e11)/36e5);data.message.t=shortTimestamp;var iv=forge.random.getBytesSync(16),cipher=forge.cipher.createCipher("AES-GCM",convKey);cipher.start({iv:iv}),cipher.update(forge.util.createBuffer(JSON.stringify(data.message))),cipher.finish();var encrypted=cipher.output.data,inviteToRoom=data.inviteToRoom?data.inviteToRoom:void 0,clientTs=data.clientTs?data.clientTs:void 0;appcore.sockemit("comm",{target:data.target,type:data.type,data:encrypted,auxdata:iv,inviteToRoom:inviteToRoom,clientTs:clientTs})}),api.on("sendRawComm",function(data){appcore.sockemit("raw",data)}),appcore.sockon("ack",function(data){api.emit("notify",{type:"messageAck",clientTs:data.cTs,serverTs:data.sTs,target:data.target})}),appcore.sockon("getPubKey",function(data){var listItem=appcore.list[appcore.listHash["conv"+sortUID(data.uid,appcore.uid)]];console.log(data.pubKey),listItem.pubKey=data.pubKey;var convKey=forge.random.getBytesSync(32),signedMessage=convKey+"conv"+sortUID(data.uid,appcore.uid),otherPartyPublicKey=forge.pki.publicKeyFromPem(data.pubKey),privateKey=forge.pki.privateKeyFromPem(appcore.profileBlob.privateKey),md=forge.md.sha256.create();md.update(signedMessage,"utf8");var signature=privateKey.sign(md),encrypted=otherPartyPublicKey.encrypt(signedMessage,"RSA-OAEP");listItem.keyExchange={encrypted:encrypted,signature:signature,convKey:convKey}});var commReadBuffer=[],commReadBufferTimeout=-1;api.on("markRead",function(data){appcore.list[appcore.listHash[data.target]].canMarkRead&&(appcore.sockemit("markRead",{target:data.target}),appcore.list[appcore.listHash[data.target]].canMarkRead=!1)}),api.on("getBuffer",function(data){var listItem=appcore.list[appcore.listHash[data.target]];1==data.small?listItem.hasBundle||listItem.waitingForBundle||(appcore.sockemit("getBuffer",{target:data.target,small:!0}),listItem.waitingForBundle=!0):2==listItem.hasBundle||listItem.waitingForBundle||appcore.sockemit("getBuffer",{target:data.target,small:!1})}),api.on("setProp",function(data){null==data.value?delete appcore.profileBlob.props[data.name]:appcore.profileBlob.props[data.name]=data.value,updateBlob(!0,"setProp")}),api.on("logout",function(){appcore.reconnect=0,appcore.sock.close(),appcore.sockbuffer=[],appcore.list=[],appcore.listHash=[],appcore.profileBlob={},appcore.bufferTimestampIgnore=[],appcore.bufferTimestampReplace=[],appcore.userList=[],appcore.noListBuffer=[],appcore.bgColorCache=[],appcore.derivedKeyHash="",appcore.derivedKey="",appcore.derivedKeySalt="",appcore.displayname="",appcore.pubKey="",appcore.uid="",appcore.username="",appcore.avatar="",appcore.activeCall=""}),appcore.sockemit("version",{}),appcore.sockon("version",function(data){data.latestVersion?appcore.version<data.mandatory?api.emit("versionCheck",2):appcore.version<data.latestVersion?api.emit("versionCheck",1):api.emit("versionCheck",0):api.emit("versionCheck",-1),Math.abs(data.time-(new Date).getTime())>72e5&&api.emit("systemTimeInaccurate",{})
});var updateCheckerInterval=setInterval(function(){appcore.sockemit("version",{})},24e4),convMessageMetaHidden=!1,sidebarCollapsed=!1,sidebarWidth=255;window.localStorage&&window.localStorage.getItem("sidebarWidth")&&(sidebarWidth=Math.max(window.localStorage.getItem("sidebarWidth"),215)),api.on("lay",function(){layContent(!0,!1)});var lastLayTime=0,layUsersTimeout=0,keepPos,lastTrigger;jQuery.fn.clearable=function(){function tog(v){return v?"addClass":"removeClass"}$(this).addClass("clearable"),$(this).on("input",function(){$(this)[tog(this.value)]("x")}),$(this).mousemove(function(e){$(this).hasClass("x")&&$(this)[tog(this.offsetWidth-18<e.clientX-this.getBoundingClientRect().left)]("onX")}),$(this).click(function(){$(this).hasClass("onX")&&($(this).removeClass("x onX").val(""),$(this).trigger("keyup"))})},jQuery.fn.popover=function(obj){var triggerElement=$(this),popover=obj;$("body").unbind("click.dismissPopover"),keepPos=function(){if(!triggerElement.is(":hidden")){if(popover.hasClass("popoverBottom"))var top=triggerElement.offset().top-triggerElement.outerHeight()-popover.outerHeight()-32;else if(popover.hasClass("popoverRight")||popover.hasClass("popoverLeft"))var top=triggerElement.position().top-popover.outerHeight()/2+triggerElement.outerHeight()/2;else var top=triggerElement.position().top+8+triggerElement.outerHeight();if(popover.hasClass("popoverRight"))var left=triggerElement.offset().left+triggerElement.outerWidth()+8;else var left=triggerElement.offset().left+triggerElement.width()/2-popover.outerWidth()/2;var leftCorrection=0,topCorrection=0;if($(window).width()-left-popover.outerWidth()<20&&(leftCorrection=20-($(window).width()-left-popover.outerWidth())),10>top&&(topCorrection-=-10-top),left-=leftCorrection,top-=topCorrection,popover.css("top",top),popover.css("left",left),popover.hasClass("popoverBottom"));else if(popover.hasClass("popoverRight"))popover.find(".popoverCaret").css("top",popover.outerHeight()/2-8+topCorrection);else{var caretTop=top-16;popover.find(".popoverCaret").css("top",caretTop-top)}if(!popover.hasClass("popoverRight")){var caretLeft=triggerElement.offset().left+triggerElement.width()/2-left;popover.find(".popoverCaret").css("left",caretLeft)}}},$("body").on("mousedown.dismissPopover",function(event){0!=$(event.target).parents(".popover").length||$(event.target).is(triggerElement)||$(triggerElement).children().is(event.target)?keepPos&&keepPos():($("div[data-popover='true']").fadeOut().attr("data-popover",""),lastTrigger&&lastTrigger.removeClass("active"),keepPos=null,$("body").unbind("mousedown.dismissPopover"))}),popover.attr("data-popover")?(popover.fadeOut(),triggerElement.removeClass("active"),popover.attr("data-popover",""),keepPos=null):($("div[data-popover='true']").fadeOut().attr("data-popover",""),lastTrigger&&lastTrigger.removeClass("active"),popover.finish().fadeIn(),keepPos(),triggerElement.addClass("active"),popover.attr("data-popover","true")),lastTrigger=triggerElement};var activeModal;$("#overlay,.modalClose").click(function(){activeModal&&$.modal("","hide")}),jQuery.fn.moveCaretToEnd=function(){var el=$(this)[0];if("number"==typeof el.selectionStart)el.selectionStart=el.selectionEnd=el.value.length;else if("undefined"!=typeof el.createTextRange){el.focus();var range=el.createTextRange();range.collapse(!1),range.select()}},jQuery.fn.draggable=function(){var dragging=!1,lastPos=[0,0];$(this).mousedown(function(event){if("SELECT"!=event.target.tagName){1===event.which&&(dragging=!0,lastPos=[event.pageX,event.pageY]);var element=$(this)[0];$("body").on("mousemove.videoPanelDrag",function(event){var diffX=event.pageX-lastPos[0],diffY=event.pageY-lastPos[1],curX=parseInt(element.style.left.split("px")[0]),curY=parseInt(element.style.top.split("px")[0]);element.style.left=curX+diffX+"px",element.style.top=curY+diffY+"px",lastPos=[event.pageX,event.pageY]})}}),$(this).mouseup(function(){dragging=!1,$("body").unbind("mousemove.videoPanelDrag")})},$("#modal").draggable(),jQuery.modal=function(ref,state){var thisModal=$("#modal");$(thisModal).is(":visible")||state&&"show"!=state?!$(thisModal).is(":visible")||state&&"hide"!=state||($(thisModal).fadeOut(425,function(){$("#overlay").css("z-index",-100)}),$("#overlay").css("opacity",0)):(activeModal=$(thisModal),thisModal.find("div[data-ref]").hide(),thisModal.find("div[data-ref='"+ref+"']").show(),keepPosModals(),$(thisModal).fadeIn(425),$("#overlay").css({opacity:.5,"z-index":1e4}))},jQuery.fn.shake=function(intShakes,intDistance,intDuration){return intShakes||(intShakes=2),intDistance=10,intDuration=400,this.each(function(){$(this).css("position","relative");for(var x=1;intShakes>=x;x++)$(this).animate({left:-1*intDistance},intDuration/intShakes/4).animate({left:intDistance},intDuration/intShakes/2).animate({left:0},intDuration/intShakes/4)}),this};var baseFaviconImage=new Image;baseFaviconImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAB5UlEQVQ4jY2SvWuTURTGf+ckqdUEk1pbKGp50W4W2sYEQQeD4tA6GP+DdKkZBZ0duoqQMRbBzO0SwdEhnRSsSQqKIn68dFEsocSPRmNzr0PyviZpSz3wwP3gOc+5z3OFvprOv7iuSFrA6T634BpssZpNPu4+F28xky9PKSaHkOpv2lOWkkFvVbLxdb/BuQdrUWupirRVr5w8jHM0iBMJYKzlVa3JZqNF6XOz3cPiijD98maiHuz0LYjghEPK3fPHmRwewBjjY/JYCGMMydEm99Z/0BEqADdkZql8Sa0pAdxJjnB1PNxD7sfyhwYrHxsAGNGUijEZgIsnwsyejqKq+0JEuDZ+iJFBbRtoTEYR0gCzZ2IHklWVyECAs0NBL4J0UCAGEB+LoOqH0mu8taiqvx89EvAijHkmEh1sG9VP9JS7S+SfkFqLC/B+6/eeI+8F93vLj1NFqAIsv6n9F3m7BZ++7XQmoapGNOf9qIPIqsrD13W+NlpejDmtLMRX5yaGi7cvnEJEdj3FV96xLD7f5OnGtvf8YmUhvhoEWLzsuBv1X+79Z1+cJ+9qjEVCzE0MYa31sfJ2i59/OiZbSggZb3K/4vm1R9K52K+spVDOJub9FLovy9nEfMvaNFDczaRkRFPdZIC/EibJIIaTP3UAAAAASUVORK5CYII=",setFaviconBadge(0);var titleAlertInterval=-1,originalTitle="";layScreen(),$(document).ready(function(){$(window).resize(layScreen),$(".preloader").hide(),hooks(),startScreen(!1)});var statusText=["Offline","Online","Busy","Away","Invisible"],hasFocus=!0,titleBadgeCount=0,openNotifications=[];$(window).focus(function(){hasFocus=!0;for(var i in openNotifications)openNotifications[i].cancel?openNotifications[i].cancel():openNotifications[i].close();openNotifications=[],titleBadgeCount=0,document.title="Subrosa",setFaviconBadge(0),focusInput()}),$(window).blur(function(){hasFocus=!1});var entropyToCollect=1024;$("body").on("mousemove.entropyCollect",function(e){entropyToCollect--,0==entropyToCollect&&$("body").unbind("mousemove.entropyCollect"),forge.random.collectInt(e.clientX,16),forge.random.collectInt(e.clientY,16)});var dividerDragging="",lastMessageContentWidth=0,checkUsernameTimeout=null,lastCaptchaChallenge=-1,hasNotificationPerm=!1,permissionsContinue,lastTab="",currentTab="",convBodyHolders={},convInputHolders={};api.on("replaceText",function(data){if(data.target==currentTab){var $theMessage=$(".convMessage[data-timestamp='"+data.replaceTimestamp+"'].chatMessage");$theMessage.length&&$theMessage.attr("data-user")==data.user&&($theMessage.find(".convMessageContent").html(data.newMessage),$theMessage.find(".convMessageContent").addClass("edited"))}if(convBodyHolders[data.target]){var replaceHTML=function(htmlString){return $("#htmlToText").html(htmlString),$convMessage=$("#htmlToText").find(".convMessage"),$convMessage.length&&$convMessage.hasClass("chatMessage")&&$convMessage.attr("data-user")==data.user&&$convMessage.attr("data-timestamp")==data.replaceTimestamp?($convMessage.find(".convMessageContent").html(data.newMessage),$convMessage.find(".convMessageContent").addClass("edited"),$("#htmlToText").html()):htmlString};for(var i in convBodyHolders[data.target].buffer)-1!=convBodyHolders[data.target].buffer[i].indexOf(data.replaceTimestamp)&&(convBodyHolders[data.target].buffer[i]=replaceHTML(convBodyHolders[data.target].buffer[i]));for(var i in convBodyHolders[data.target].live)-1!=convBodyHolders[data.target].live[i].indexOf(data.replaceTimestamp)&&(convBodyHolders[data.target].live[i]=replaceHTML(convBodyHolders[data.target].live[i]));$("#htmlToText").html("")}});const shortMonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var searchNameTimeout=-1;api.on("homeData",function(data){var homeNewsHTML="";for(var i in data.news)data.news[i].link&&"http://"!=data.news[i].link.substr(0,7)&&"https://"!=data.news[i].link.substr(0,8)||(homeNewsHTML+='<div class="homeNewsElem">'+(data.news[i].link?'<a href="'+escapeText(data.news[i].link)+'" target="_blank">':"")+'<span class="title">'+escapeText(data.news[i].title)+"</span>"+(data.news[i].link?"</a>":"")+'<span class="time">'+(data.news[i].time?friendlyTime(data.news[i].time):"")+'</span><span class="content">'+escapeText(data.news[i].content)+"</span></div>");homeNewsHTML+="</div>",$("#homeNews").append(homeNewsHTML)}),api.on("versionCheck",function(status){0==status?$("#versionInfo").text("up to date"):($("#versionInfo").addClass("errorMessage"),1==status?($("#versionInfo").text("New version available"),$("#outdatedVersionMandatory").hide(),$.modal("outdatedVersion")):2==status?($("#versionInfo").text("Critical security update required. You must update."),$("#outdatedVersionOptional").hide(),$("#loginButton,#createAccountBtn").addClass("disabled"),$.modal("outdatedVersion")):$("#versionInfo").text("Failed to check."))}),api.on("systemTimeInaccurate",function(){$.modal("systemTimeInaccurate")}),api.on("avatarUploadProgress",function(data){100==data.percent?($("#uploadAvatarProgress").html("<br />Uploaded avatar."),$("#avatarFile").show()):-1==data.percent?($("#uploadAvatarProgress").hide(),$("#avatarFile").show(),$.modal("avatarUploadFailed")):$("#uploadAvatarProgress").text("Uploading ("+data.percent+"%)")}),api.on("callUpdate",function(data){if("CALLING"==data.state)if(37==data.target.length){if(!data.myInitiate){startRinging();var icon=appcore.list[appcore.listHash[data.target]].avatar||"img/noavatar.png",name=appcore.list[appcore.listHash[data.target]].name||appcore.list[appcore.listHash[data.target]].displayname;newNotification(icon,"Call from "+escapeText(name),escapeText(name)+" is ringing you..",0,!1),startTitleAlert("CALL | Subrosa")}data.target!=currentTab&&changeTabTo(data.target)}else setListItem(data.target);else"INCALL"==data.state&&(startCallInput(20==appcore.activeCall.length,data.callType),setListItem(data.target));"INCALL"==data.oldState&&stopCallInput(data.callType),"CALLING"==data.oldState&&(stopRinging(),stopTitleAlert(),document.title="Subrosa"),""==data.state&&setListItem(data.target),data.target==currentTab&&layContent(!0,!1)}),api.on("gotCaptcha",function(data){"createAccount"==data.purpose?($("#createAccountStep4CaptchaImg").html("<img id='createAccountCaptchaImg' />"),$("#createAccountCaptchaImg").attr("src",data.captcha),lastCaptchaChallenge=data.challenge):console.log(data)}),api.on("notify",function(data){if("statusChanged"==data.type){if(0!=data.newStatus&&!data.oldStatus){if(-1!=currentTab.indexOf("-")&&(currentTab.split("-")[0]==data.uid||currentTab.split("-")[1]==data.uid))return;var icon=appcore.list[appcore.listHash["conv"+sortUID(data.uid,appcore.uid)]].avatar||"img/noavatar.png";newNotification(icon,escapeText(data.displayname)+" is online",statusText[data.newStatus],5e3,!0)}$(".sidebarListItem[data-item='conv"+sortUID(data.uid,appcore.uid)+"'] .listItemIcon").attr("data-status",void 0==data.newStatus?"":data.newStatus)}else if("displaynameChanged"==data.type)setListItem("conv"+sortUID(data.uid,appcore.uid));else if("newMessage"==data.type){if(-1!=data.target.indexOf("-")||data.target==currentTab){var icon=getUserItem(data.uid).avatar||"img/noavatar.png";hasFocus?data.target!=currentTab&&(appcore.list[appcore.listHash[data.target]].relatedNotifications||(appcore.list[appcore.listHash[data.target]].relatedNotifications=[]),appcore.list[appcore.listHash[data.target]].relatedNotifications.push(newNotification(icon,escapeText(data.displayname),data.message,0,!0))):($("#soundNewMessage")[0].play(),newNotification(icon,escapeText(data.displayname),data.message,0,!1))}}else if("messageAck"==data.type){if(data.target==currentTab&&$(".convMessage[data-timestamp='"+data.clientTs+"']").attr("data-timestamp",data.serverTs),convBodyHolders[data.target])for(var i in convBodyHolders[data.target].live){var messageHTML=convBodyHolders[data.target].live[i];if(-1!=messageHTML.indexOf("data-timestamp='"+data.clientTs+"'"))return void(convBodyHolders[data.target].live[i]=messageHTML.replace("data-timestamp='"+data.clientTs+"'","data-timestamp='"+data.serverTs+"'"))}}else if("changePassOldWrong"==data.type)$("#editProfilePassOldFail").show().shake();else if("bundleRecieved"==data.type){var lastScrollPos;if(data.target==currentTab)if($("#convText").find("#bufferLoading").remove(),data.more)$("#convText").prepend("<a id='bufferMore' href='javascript:;'><span class='fa fa-clock-o'></span>Decrypt earlier history</a>");else{var bufferMore=$("#convText").find("#bufferMore");lastScrollPos=bufferMore.attr("data-scrollPos")}!data.more&&convBodyHolders[data.target]&&convBodyHolders[data.target].buffer.length&&(convBodyHolders[data.target].buffer=[],layContent(!1,!0),lastScrollPos&&setTimeout(function(){$("#convText")[0].scrollTop=$("#convText")[0].scrollHeight-lastScrollPos},10))}else"userIdentified"==data.type?data.target==currentTab&&layUsers():"kicked"==data.type?(removeList(data.target),$("#kickerUsername").text(data.kickerUsername),$("#kickerUsername").attr("data-uid",data.kickerUID),$("#kickedFromName").text(data.roomName),$.modal("kicked","show")):"noInvite"==data.type?$.modal("noInvite","show"):"callUserUpdate"==data.type?(data.target==currentTab&&(layContent(!0,!1),layUsersMore(!0)),callUserUpdate(data.event,data.uid,data.callType)):"avatarUpdated"==data.type?data.uid==appcore.uid?$(".sidebarListItem[data-item=me]").find(".listItemIcon")[0].src=data.avatar:($(".sidebarListItem[data-item='conv"+sortUID(appcore.uid,data.uid)+"']").find(".listItemIcon")[0].src=data.avatar,-1!=currentTab.indexOf(data.uid)&&layContent(!0,!1)):"verifyKeyInfo"==data.type?($("#verifyKeyHash #main").text(data.hash.substr(0,8)),$("#verifyKeyHash #tiny").text(data.hash.substr(8)),$.modal("verifyKey")):"contactChange"==data.type?setListItem(data.id?data.id:"conv"+sortUID(appcore.uid,data.uid)):"verifyFingerprintResult"==data.type?"SUCCESS"==data.result||$.modal("verifyFingerprintResultFail","show"):"noPermission"==data.type?$.modal("noPermission","show"):"userRankChanged"==data.type&&data.target==currentTab&&$("#usersMorePopover:visible").length&&layUsersMore(!1)});var audioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.operaAudioContext;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var appcall={};appcall.micMute=!1,appcall.videoMute=!1,appcall.callDuration=0,appcall.callDurationInterval=-1;var apprtc={};apprtc.supported=!0,apprtc.mediaStream,apprtc.playerCount=0,apprtc.localVideoPanel,apprtc.callVideo=null,apprtc.pc=[],apprtc.audioPlayers=[],apprtc.group=null,apprtc.pc_config={iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"turn:46.28.205.143:3478",credential:"turnserver",username:"subrosa"}]},apprtc.pc_constraints={optional:[{DtlsSrtpKeyAgreement:!0},{RtpDataChannels:!0}]},apprtc.sdpVoiceConstraints={mandatory:{OfferToReceiveAudio:!0}},apprtc.sdpVideoConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}};var dataChannelsEnabled=!1;"undefined"!=typeof webkitRTCPeerConnection?RTCPeerConnection=webkitRTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?RTCPeerConnection=mozRTCPeerConnection:apprtc.supported=!1,"undefined"!=typeof mozRTCSessionDescription&&(RTCSessionDescription=mozRTCSessionDescription),"undefined"!=typeof mozRTCIceCandidate&&(RTCIceCandidate=mozRTCIceCandidate);